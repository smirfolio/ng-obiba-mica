/*!
 * ng-obiba-mica - v3.4.0
 * https://github.com/obiba/ng-obiba-mica
 *
 * License: GNU Public License version 3
 * Date: 2019-06-12
 */
"use strict";function NgObibaMicaTemplateUrlFactory(){function a(a){var c=a;this.getHeaderUrl=function(a){return a in c?c[a].header:null},this.getFooterUrl=function(a){return a in c?c[a].footer:null},this.getTemplateUrl=function(a){return a in c?c[a].template?c[a].template:b[a]:null}}var b={searchStudiesResultTable:"search/components/result/studies-result-table/component.html",searchNetworksResultTable:"search/components/result/networks-result-table/component.html",searchDatasetsResultTable:"search/components/result/datasets-result-table/component.html",searchCriteriaRegionTemplate:"search/components/criteria/item-region/region/component.html",vocabularyFilterDetailHeading:"search/components/vocabulary-filter-detail-heading/component.html",CriterionDropdownTemplate:"search/components/criteria/item-region/dropdown/component.html",searchResultList:"search/components/result/search-result/list.html",searchInputList:"lists/views/input-search-widget/input-search-widget-template.html",searchResultCoverage:"search/components/result/search-result/coverage.html",searchResultGraphics:"search/components/result/search-result/graphics.html",variableCrosstab:"analysis/crosstab/views/crosstab-variable-crosstab.html",variableFrequencies:"analysis/crosstab/views/crosstab-variable-frequencies.html",variableFrequenciesEmpty:"analysis/crosstab/views/crosstab-variable-frequencies-empty.html",variableStatistics:"analysis/crosstab/views/crosstab-variable-statistics.html",variableStatisticsEmpty:"analysis/crosstab/views/crosstab-variable-statistics-empty.html",searchCellStatValue:"search/components/result/cell-stat-value/component.html"},c={registry:null};c.setTemplateUrl=function(a,b){a in this.registry&&(this.registry[a].template=b)},c.setHeaderUrl=function(a,b){a in this.registry&&(this.registry[a].header=b)},c.setFooterUrl=function(a,b){a in this.registry&&(this.registry[a].footer=b)},c.$get=function(){return new a(this.registry)},this.create=function(a){return c.registry=a,c}}function CriteriaBuilder(a,b,c,d,e){this.newCriteriaItemBuilder=function(){return new CriteriaItemBuilder(d,e)},this.initialize=function(f){this.leafItemMap={},this.target=f,this.rootRql=a,this.taxonomies=c,this.LocalizedValues=d,this.lang=e,this.rootItem=this.newCriteriaItemBuilder().parent(b).type(this.target).rqlQuery(this.rootRql).target(this.target).build()},this.buildLeafItem=function(a,b,c,d,e){var f=this,g=new CriteriaItemBuilder(f.LocalizedValues,f.lang).type(d.name).target(f.target).taxonomy(a).vocabulary(b).rqlQuery(d).parent(e);return g.selectedTerms(c).build(),g.build()}}function CriteriaIdGenerator(){}function CriteriaItemBuilder(a,b){function c(){d.term?(d.itemTitle=a.forLocale(d.term.title,d.lang),d.itemDescription=a.forLocale(d.term.description,d.lang),d.itemParentTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemParentDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemTitle||(d.itemTitle=d.term.name),d.itemParentTitle||(d.itemParentTitle=d.vocabulary.name)):(d.itemTitle=a.forLocale(d.vocabulary.title,d.lang),d.itemDescription=a.forLocale(d.vocabulary.description,d.lang),d.itemParentTitle=a.forLocale(d.taxonomy.title,d.lang),d.itemParentDescription=a.forLocale(d.taxonomy.description,d.lang),d.itemTitle||(d.itemTitle=d.vocabulary.name),d.itemParentTitle||(d.itemParentTitle=d.taxonomy.name)),d.id=CriteriaIdGenerator.generate(d.taxonomy,d.vocabulary,d.term)}var d={type:null,rqlQuery:null,lang:b||"en",parent:null,children:[]},e=this;this.type=function(a){if(!RQL_NODE[a.toUpperCase()])throw new Error("Invalid node type:",a);return d.type=a,this},this.target=function(a){return d.target=a,this},this.parent=function(a){return d.parent=a,this},this.taxonomy=function(a){return d.taxonomy=a,this},this.vocabulary=function(a){return d.vocabulary=a,this},this.term=function(a){return Array.isArray(a)?e.selectedTerms(a):(d.term=a,this)},this.rqlQuery=function(a){return d.rqlQuery=a,this},this.selectedTerm=function(a){return d.selectedTerms||(d.selectedTerms=[]),d.selectedTerms.push("string"==typeof a||"number"==typeof a?a:a.name),this},this.selectedTerms=function(a){return d.selectedTerms=a.filter(function(a){return a}).map(function(a){return"string"==typeof a||"number"==typeof a?a:a.name}),this},this.build=function(){return d.taxonomy&&d.vocabulary&&c(),new CriteriaItem(d)}}function CriteriaItem(a){var b=this;Object.keys(a).forEach(function(c){b[c]=a[c]})}function RepeatableCriteriaItem(){CriteriaItem.call(this,{}),this.list=[]}function targetToType(a){switch(a.toLocaleString()){case QUERY_TARGETS.NETWORK:return QUERY_TYPES.NETWORKS;case QUERY_TARGETS.STUDY:return QUERY_TYPES.STUDIES;case QUERY_TARGETS.DATASET:return QUERY_TYPES.DATASETS;case QUERY_TARGETS.VARIABLE:return QUERY_TYPES.VARIABLES}throw new Error("Invalid target: "+a)}function typeToTarget(a){switch(a.toLocaleString()){case QUERY_TYPES.NETWORKS:return QUERY_TARGETS.NETWORK;case QUERY_TYPES.STUDIES:return QUERY_TARGETS.STUDY;case QUERY_TYPES.DATASETS:return QUERY_TARGETS.DATASET;case QUERY_TYPES.VARIABLES:return QUERY_TARGETS.VARIABLE}throw new Error("Invalid type: "+a)}function BaseTaxonomiesController(a,b,c,d,e,f,g,h,i,j){b.options=g.getOptions(),b.RqlQueryUtils=h,b.metaTaxonomy=e.get({target:"taxonomy",taxonomy:"Mica_taxonomy"}),b.taxonomies={all:[],search:{text:null,active:!1},target:b.target||"variable",taxonomy:null,vocabulary:null},a.$on("$translateChangeSuccess",function(){b.taxonomies&&b.taxonomies.vocabulary&&j.sortVocabularyTerms(b.taxonomies.vocabulary,c.use())}),b.canNavigate=function(a){return!(b.options.hideNavigate.indexOf(a.name)>-1)&&0===(a.attributes||[]).filter(function(a){return"showNavigate"===a.key}).length},this.navigateTaxonomy=function(a,c,e){if(b.taxonomies.term=e,b.isHistoryEnabled){var f=d.search();f.taxonomy=a?a.name:null,c&&f.vocabulary!==c.name?(j.sortVocabularyTerms(c,b.lang),f.vocabulary=c.name):f.vocabulary=null,d.search(f)}else b.taxonomies.taxonomy=a,b.taxonomies.vocabulary&&b.taxonomies.vocabulary.name===c.name||j.sortVocabularyTerms(c,b.lang),b.taxonomies.vocabulary=c},this.updateStateFromLocation=function(){var a=d.search(),c=a.taxonomy,e=a.vocabulary,f=null,g=null;b.taxonomies.all&&(b.taxonomies.all.forEach(function(a){a.name===c&&(f=a,a.vocabularies.forEach(function(a){a.name===e&&(g=a)}))}),angular.equals(b.taxonomies.taxonomy,f)&&angular.equals(b.taxonomies.vocabulary,g)||(b.taxonomies.taxonomy=f,g&&j.sortVocabularyTerms(g,b.lang),b.taxonomies.vocabulary=g))},this.selectTerm=function(a,c,d,e){b.onSelectTerm(a,c,d,e)},this.clearCache=function(){var a=i.get("taxonomyResource");a&&a.removeAll()};var k=this;b.$on("$locationChangeSuccess",function(){b.isHistoryEnabled&&k.updateStateFromLocation()}),b.$watch("taxonomies.vocabulary",function(a){h&&a?(b.taxonomies.isNumericVocabulary=j.isNumericVocabulary(b.taxonomies.vocabulary),b.taxonomies.isMatchVocabulary=j.isMatchVocabulary(b.taxonomies.vocabulary)):(b.taxonomies.isNumericVocabulary=null,b.taxonomies.isMatchVocabulary=null)}),b.navigateTaxonomy=this.navigateTaxonomy,b.selectTerm=this.selectTerm,b.clearCache=this.clearCache}function NgObibaMicaListsOptionsFactory(){function a(){this.getOptions=function(){return b}}var b={listSearchOptions:{network:{fields:["studyIds","acronym.*","name.*","description.*","logo"]},study:{fields:["logo","objectives.*","acronym.*","name.*","model.methods.design","model.numberOfParticipants.participant"]},dataset:{fields:["acronym.*","name.*","description.*","variableType","studyTable.studyId","studyTable.project","studyTable.table","studyTable.populationId","studyTable.dataCollectionEventId","harmonizationTable.studyId","harmonizationTable.project","harmonizationTable.table","harmonizationTable.populationId"]}},listOptions:{networkOptions:{showStudyBadge:!0,showDatasetBadge:!0,showVariableBadge:!0},studyOptions:{studiesCountCaption:!0,studiesSearchForm:!0,studiesSupplInfoDetails:!0,studiesTrimmedDescription:!0,showNetworkBadge:!0,showDatasetBadge:!0,showVariableBadge:!0},datasetOptions:{showNetworkBadge:!0,showStudyBadge:!0,showVariableBadge:!0}}};this.$get=function(){return new a},this.setOptions=function(a){Object.keys(a).forEach(function(c){c in b&&(b[c]=a[c])})}}function SortWidgetOptionsProvider(){function a(a){var b=a;this.getOptions=function(){return b}}var b={sortOrderField:{options:[{value:"-_score",label:"relevance"},{value:"name",label:"name"},{value:"-name",label:"name"},{value:"acronym",label:"acronym"},{value:"-acronym",label:"acronym"}],defaultValue:"-_score"}},c=this;this.getDefaultOptions=function(){return c.defaultOptions},this.$get=function(){return new a(b)},this.setOptions=function(a){Object.keys(a).forEach(function(c){c in b&&a[c].options&&(b[c].options=b[c].options.concat(a[c].options),b[c].default=a[c].default)})}}function GraphicChartsDataProvider(){function a(a){var b=a;this.getData=function(a){a&&b.$promise.then(a)}}this.$get=["$log","JoinQuerySearchResource","ServerErrorUtils","AlertService","GraphicChartsConfig","GraphicChartsQuery",function(b,c,d,e,f,g){var h=g.queryDtoBuilder(f.getOptions().entityIds,f.getOptions().entityType);return new a(c.studies({query:h},function(a){return a},function(a){b.error("Server error",a)}))}]}function NgObibaMicaFileBrowserOptionsProvider(){var a={locale:"en",downloadInline:!0,downloadKey:!1,folders:{excludes:["population"]},documentsTitle:"file.documents"};this.addExcludeFolder=function(b){b&&a.folders.excludes.push(b)},this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.$get=function(){return a}}var ngObibaMica;!function(){function a(){function a(a){b.$get=a}var b=this;b.$get=function(){throw new Error("The provider factory method $get() must be overridden by client code.")},b.setFactory=a}function b(){function a(a){var b=a;this.getUrl=function(a){return a in b?b[a]:null}}var b={DataAccessClientDetailPath:"",DataAccessClientListPath:"",DataAccessFormConfigResource:"ws/config/data-access-form",DataAccessAmendmentFormConfigResource:"ws/config/data-access-amendment-form",DataAccessRequestsResource:"ws/data-access-requests",DataAccessAmendmentsResource:"ws/data-access-request/:parentId/amendments",DataAccessAmendmentResource:"ws/data-access-request/:parentId/amendment/:id",DataAccessRequestsExportHistoryResource:"ws/data-access-requests/_history?lang=:lang",DataAccessRequestsExportCsvResource:"ws/data-access-requests/csv?lang=:lang",DataAccessRequestResource:"ws/data-access-request/:id",DataAccessRequestActionLogsResource:"ws/data-access-request/:id/_log-actions",DataAccessAmendmentsLogHistoryResource:"ws/data-access-request/:id/amendments/_history",DataAccessRequestAttachmentsUpdateResource:"ws/data-access-request/:id/_attachments",DataAccessRequestAttachmentDownloadResource:"ws/data-access-request/:id/attachments/:attachmentId/_download",SchemaFormAttachmentDownloadResource:"/ws/:path/form/attachments/:attachmentName/:attachmentId/_download",DataAccessRequestDownloadPdfResource:"/ws/data-access-request/:id/_pdf",DataAccessRequestCommentsResource:"ws/data-access-request/:id/comments?admin=:admin",DataAccessRequestCommentResource:"ws/data-access-request/:id/comment/:commentId",DataAccessRequestStatusResource:"ws/data-access-request/:id/_status?to=:status",DataAccessAmendmentStatusResource:"ws/data-access-request/:parentId/amendment/:id/_status?to=:status",TempFileUploadResource:"ws/files/temp",TempFileResource:"ws/files/temp/:id",TaxonomiesSearchResource:"ws/taxonomies/_search",TaxonomiesResource:"ws/taxonomies/_filter",TaxonomyResource:"ws/taxonomy/:taxonomy/_filter",VocabularyResource:"ws/taxonomy/:taxonomy/vocabulary/:vocabulary/_filter",VariableResource:"ws/variable/:id",VariableSummaryResource:"ws/variable/:id/summary",CartPage:"#/cart",SetsPage:"#/sets",SetsResource:"ws/:type/sets",SetsImportResource:"ws/:type/sets/_import",SetResource:"ws/:type/set/:id",SetClearResource:"ws/:type/set/:id/documents",SetDocumentsResource:"ws/:type/set/:id/documents?from=:from&limit=:limit",SetExistsResource:"ws/:type/set/:id/document/:did/_exists",SetImportResource:"ws/:type/set/:id/documents/_import",SetImportQueryResource:"ws/:type/set/:id/documents/_rql",SetRemoveResource:"ws/:type/set/:id/documents/_delete",SetOpalExportResource:"ws/:type/set/:id/documents/_opal",JoinQuerySearchResource:"ws/:type/_rql",JoinQuerySearchCsvResource:"ws/:type/_rql_csv?query=:query",JoinQuerySearchCsvReportResource:"ws/:type/_report?query=:query",JoinQuerySearchCsvReportByNetworkResource:"ws/:type/_report_by_network?networkId=:networkId&locale=:locale",JoinQueryCoverageResource:"ws/variables/_coverage",JoinQueryCoverageDownloadResource:"ws/variables/_coverage_download?query=:query",VariablePage:"",NetworkPage:"#/network/:network",StudyPage:"#/:type/:study",StudyPopulationsPage:"#/:type/:study",StudyDcePage:"#/:type/:study/dce-id-:dce",DatasetPage:"#/:type/:dataset",BaseUrl:"",FileBrowserFileResource:"ws/file/:path/",FileBrowserSearchResource:"ws/files-search/:path",FileBrowserDownloadUrl:"ws/draft/file-dl/:path?inline=:inline",SearchBaseUrl:"#/search",DocumentSuggestion:"ws/:documentType/_suggest",EntitiesCountResource:"ws/datasets/entities/_count?query=:query",EntitiesCountBaseUrl:"#/entities-count",DatasetCategoricalVariablesResource:"ws/:dsType/:dsId/variables/:query/categorical",DatasetVariablesResource:"ws/:dsType/:dsId/variables/:query",DatasetVariableResource:"ws/variable/:varId",DatasetVariablesCrosstabResource:"ws/:dsType/:dsId/variables/cross/:v1/by/:v2",DatasetResource:"ws/dataset/:dsType/:dsId"};this.setUrl=function(a,c){a in b&&(b[a]=c)},this.$get=function(){return new a(b)}}ngObibaMica=angular.module("ngObibaMica",["schemaForm","ngCookies","obiba.mica.utils","obiba.mica.file","obiba.mica.attachment","obiba.mica.access","obiba.mica.search","obiba.mica.analysis","obiba.mica.sets","obiba.mica.graphics","obiba.mica.localized","obiba.mica.fileBrowser","angularUtils.directives.dirPagination"]),ngObibaMica.constant("USER_ROLES",{all:"*",admin:"mica-administrator",reviewer:"mica-reviewer",editor:"mica-editor",user:"mica-user",dao:"mica-data-access-officer"}).config(["$provide","paginationTemplateProvider",function(c,d){c.provider("ngObibaMicaUrl",b),c.provider("ObibaServerConfigResource",a),d.setPath("views/pagination-template.html")}])}(),function(){ngObibaMica.utils=angular.module("obiba.mica.utils",["schemaForm","LocalStorageModule"]),ngObibaMica.utils.factory("urlEncode",function(){return function(a){return window.encodeURIComponent(a)}}).service("GraphicChartsConfigurations",function(){this.getClientConfig=function(){return!0},this.setClientConfig=function(){return!0}}).directive("fixedHeader",["$timeout","$window",function(a,b){return{restrict:"A",scope:{tableMaxHeight:"@",trigger:"=fixedHeader"},link:function(c,d){function e(a){return"none"!==b.getComputedStyle(a).display&&0!==a.offsetWidth}function f(){return e(h.querySelector("tbody"))&&null!==h.querySelector("tbody tr:first-child")}function g(){c.redraw||(angular.element(h.querySelectorAll("thead, tbody, tfoot")).css("display",""),a(function(){c.redraw=!0;var a=0;if(angular.forEach(h.querySelectorAll("tr:first-child th"),function(b,c){var d=h.querySelector("tbody tr:first-child td:nth-child("+(c+1)+")"),e=h.querySelector("tfoot tr:first-child td:nth-child("+(c+1)+")"),f=d?d.offsetWidth:b.offsetWidth;d&&(d.style.width=f+"px"),b&&(b.style.width=f+"px"),e&&(e.style.width=f+"px"),a+=f}),angular.element(h.querySelectorAll("thead, tfoot")).css("display","block"),angular.element(h.querySelectorAll("tbody")).css({display:"block","max-height":c.tableMaxHeight||"inherit",overflow:"auto"}),a<h.offsetWidth){var b=h.querySelector("tbody tr:first-child td:last-child");b&&(b.style.width=b.offsetWidth+h.offsetWidth-a+"px",b=h.querySelector("thead tr:first-child th:last-child"),b.style.width=b.offsetWidth+h.offsetWidth-a+"px")}var d=h.querySelector("tbody"),e=d.offsetWidth-d.clientWidth;if(e>0){var f=h.querySelector("tbody tr:first-child td:last-child");f.style.width=parseInt(f.style.width.replace("px",""))-e+"px"}c.redraw=!1}))}var h=d[0];c.redraw=!1,c.$watchGroup(["trigger",f],function(a){!0===a[1]&&g()}),c.$watch(function(){return h.offsetWidth},function(){g()})}}}]).directive("routeChecker",["$route",function(a){return{restrict:"A",scope:{routeCheckerHidesParent:"="},link:function(b,c,d){var e=d.ngHref.substr(1,d.ngHref.length-1);Object.keys(a.routes).filter(function(b){var c=a.routes[b].regexp;return!!c&&c.test(e)}).pop()||(b.routeCheckerHidesParent?c.parent().hide():c.hide())}}}]).factory("FormDirtyStateObserver",["$uibModal","$location",function(a,b){var c;return{observe:function(d){c&&c(),c=d.$on("$locationChangeStart",function(e,f){if(d.form&&d.form.$dirty)return a.open({backdrop:"static",controller:["$scope","$uibModalInstance",function(a,b){a.ok=function(){b.close(!0)},a.cancel=function(){b.dismiss("cancel")}}],templateUrl:"utils/views/unsaved-modal.html"}).result.then(function(a){!0===a&&(c(),b.path(angular.copy(b).url(f).hash()))}),void e.preventDefault();c()})},unobserve:function(){c&&c()}}}]).service("SfOptionsService",["$translate","$q",function(a,b){var c=["required","errors.does-not-validate","errors.localized.completed"];this.transform=function(){var d=b.defer();return a(c).then(function(a){d.resolve({validationMessage:{302:a.required,default:a["errors.does-not-validate"],completed:a["errors.localized.completed"]}})}),d.promise}}]).config(["schemaFormProvider",function(a){a.postProcess(function(a){return a.filter(function(a){return a.hasOwnProperty("wordLimit")}).forEach(function(a){a.$validators={wordLimitError:function(b){if(angular.isDefined(b)&&null!==b){if((b.match(/\S+/g)||[]).length>parseInt(a.wordLimit))return!1}return!0}}}),a})}]).config(["localStorageServiceProvider",function(a){a.setPrefix("mica").setStorageType("localStorage")}])}();var ApplicationCacheService=function(){function a(a,b){this.$cacheFactory=a,this.$log=b}return a.prototype.clearCache=function(a){var b=this.$cacheFactory.get(a);b&&b.removeAll()},a.prototype.getCache=function(a){return this.$cacheFactory.get(a)},a.$inject=["$cacheFactory","$log"],a}();ngObibaMica.utils.service("ApplicationCacheService",ApplicationCacheService);var UserProfileModalService=function(){function a(a,b){this.$uibModal=a,this.UserProfileService=b}return a.prototype.show=function(a){var b={email:this.UserProfileService.getEmail(a),fullName:this.UserProfileService.getFullName(a),profile:a};this.$uibModal.open({controller:["$scope",function(a){return a.applicant=b}],templateUrl:"utils/services/user-profile-modal/service.html"})},a.$inject=["$uibModal","UserProfileService"],a}();ngObibaMica.utils.service("UserProfileModalService",UserProfileModalService);var UserProfileService=function(){function a(){}return a.prototype.getAttribute=function(a,b){return this.getAttibuteValue(a,b)},a.prototype.getFullName=function(a){var b=this.getProfileAttributeValue(a,"firstName"),c=this.getProfileAttributeValue(a,"lastName");return b&&c?b+" "+c:null},a.prototype.getEmail=function(a){return this.getProfileAttributeValue(a,"email")},a.prototype.getProfileAttributeValue=function(a,b){return a?this.getAttibuteValue(a.attributes,b):null},a.prototype.getAttibuteValue=function(a,b){if(a){var c=a.filter(function(a){return a.key===b});return c&&c.length>0?c[0].value:null}return null},a}();ngObibaMica.utils.service("UserProfileService",UserProfileService);var CustomWatchDomElementService=function(){function a(){this.attributes=[]}return a.prototype.configWatch=function(a,b){return this.node=a,this.attributes=b,this.config={attributeFilter:this.attributes},this},a.prototype.customWatch=function(a){var b=function(b){for(var c=0,d=b;c<d.length;c++){"attributes"===d[c].type&&a()}};new MutationObserver(b).observe(this.node,this.config)},a}();ngObibaMica.utils.service("CustomWatchDomElementService",[CustomWatchDomElementService]),function(){function a(a,b,c,d,e){function f(){b(function(){l.form=angular.copy(l.form),m.$broadcast("schemaFormRedraw"),j(!0)},250)}function g(a,b){return 0===Object.getOwnPropertyNames(a).length&&(a={},"function"==typeof b&&b()),a}function h(a,b){return 0===a.length&&(a=[],"function"==typeof b&&b()),a}function i(a){return"object"!=typeof l.parsingErrorCallbacks?function(){console.error("Error parsing ",a,l.schemaForm)}:l.parsingErrorCallbacks[a]}function j(a){"function"==typeof l.onRedraw&&l.onRedraw(a)}function k(a){if(a&&a.schemaForm&&a.schemaForm.currentValue){j(!1);var b=a.schemaForm.currentValue;l.form.definition=h(c.translate(e.parseJsonSafely(b.definition,[])),i("definition")),l.form.schema=g(c.translate(e.parseJsonSafely(b.schema,{})),i("schema")),l.form.schema.readonly=l.readOnly,d.transform().then(function(a){l.sfOptions=a,l.sfOptions.pristine={errors:!0,success:!1}})}f()}var l=this,m=a.$new();l.form={},l.sfOptions={},l.$onChanges=k}angular.module("obiba.mica.utils").component("obibaSchemaFormRenderer",{bindings:{schemaForm:"<",model:"<",readOnly:"<",parsingErrorCallbacks:"<",onRedraw:"<"},templateUrl:"utils/components/entity-schema-form/component.html",controller:["$rootScope","$timeout","LocalizedSchemaFormService","SfOptionsService","JsonUtils",a]})}();var TableAlarmHeaderController=function(){function a(a){this.$log=a}return a.prototype.selectAll=function(){this.onSelectAll({})},a.$inject=["$log"],a}(),TableAlarmHeaderComponent=function(){function a(){this.templateUrl="utils/components/table-alert-header/component.html",this.transclude=!1,this.transclude=!0,this.bindings={allSelected:"<",onSelectAll:"&"},this.controller=TableAlarmHeaderController,this.controllerAs="$ctrl"}return a}();ngObibaMica.utils.component("tableAlertHeader",new TableAlarmHeaderComponent),ngObibaMica.file=angular.module("obiba.mica.file",["ngResource"]),ngObibaMica.file.filter("bytes",function(){return function(a){return null===a||void 0===a?"":filesize(a)}}),ngObibaMica.file.factory("TempFileResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TempFileResource"),{},{get:{method:"GET"},delete:{method:"DELETE"}})}]),ngObibaMica.attachment=angular.module("obiba.mica.attachment",["obiba.mica.file","ui.bootstrap","ngFileUpload","templates-ngObibaMica"]),ngObibaMica.attachment.directive("attachmentList",[function(){return{restrict:"E",scope:{hrefBuilder:"=",files:"=",emptyMessage:"="},templateUrl:"attachment/attachment-list-template.html",link:function(a){a.attachments=[],a.hrefBuilder=a.hrefBuilder||function(a){return a.id},a.hasAttachments=!1,a.$watch("files",function(b){a.attachments=[],b&&(a.hasAttachments=b.length>0,a.attachments=b.map(function(b){var c=angular.copy(b);return c.href=a.hrefBuilder(b),c}))},!0)}}}]).directive("attachmentInput",[function(){return{restrict:"E",require:"^form",scope:{multiple:"=",accept:"@",files:"=",disabled:"=",onError:"=",deleteAttachments:"<"},templateUrl:"attachment/attachment-input-template.html",controller:"AttachmentCtrl"}}]).controller("AttachmentCtrl",["$scope","$timeout","$log","Upload","TempFileResource","ngObibaMicaUrl",function(a,b,c,d,e,f){void 0!==a.deleteAttachments&&null!==a.deleteAttachments||(a.deleteAttachments=!0);var g=function(g){a.files=a.files||[];var h={showProgressBar:!0,lang:"en",progress:0,fileName:g.name,size:g.size};a.multiple?a.files.push(h):(a.files.splice(0,a.files.length),a.files.push(h)),a.upload=d.upload({url:f.getUrl("TempFileUploadResource"),method:"POST",file:g}).progress(function(a){h.progress=parseInt(100*a.loaded/a.total)}).success(function(a,d,f){var g=f().location.split("/"),i=g[g.length-1];e.get({id:i},function(a){c.debug("tempFile",a),h.id=a.id,h.md5=a.md5,h.justUploaded=!0,h.timestamps={created:new Date},b(function(){h.showProgressBar=!1},1e3)})}).error(function(b){c.error("File upload failed: ",JSON.stringify(b,null,2));var d=a.files.indexOf(h);-1!==d&&a.files.splice(d,1),a.onError&&a.onError(h)})};a.onFileSelect=function(b){a.uploadedFiles=b,a.uploadedFiles.forEach(function(a){g(a)})},a.deleteTempFile=function(b){e.delete({id:b},function(){for(var c=a.files.length;c--;){var d=a.files[c];d.justUploaded&&d.id===b&&a.files.splice(c,1)}})},a.deleteFile=function(b){for(var c=a.files.length;c--;)a.files[c].id===b&&a.files.splice(c,1)}}]),ngObibaMica.access=angular.module("obiba.mica.access",["pascalprecht.translate","ui.bootstrap","obiba.alert","obiba.comments","obiba.mica.attachment","obiba.utils","angularMoment","templates-ngObibaMica"]),ngObibaMica.access.config(["$provide",function(a){a.provider("ngObibaMicaAccessTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({list:{header:null,footer:null},view:{header:null,footer:null},form:{header:null,footer:null},amendmentView:{header:null,footer:null},amendmentForm:{header:null,footer:null}}))}]),function(){function a(a,b){var c=this;c.filterOutItemFromCollection=function(a,b){return(b||[]).filter(function(b){return b.action!==a.action||b.author!==a.author||b.changedOn!==a.changedOn})},c.sourceCollectionWithout=function(a){return c.filterOutItemFromCollection(a,c.sourceCollection)},c.replaceActionNameByTranslationKey=function(a){var b=(c.predefinedActionNames||[]).indexOf(a.action);b>-1&&(a.action=c.predefinedActions[b])},c.add=function(b){if(c.showError=!1,b&&b.action&&b.changedOn){c.replaceActionNameByTranslationKey(b),b.changedOn=b.changedOn.toISOString(),b.author||(b.author=a.login());var d=c.sourceCollectionWithout(b);d.push(b),c.update&&"function"==typeof c.update?(c.update({logs:d}),c.item={},c.changedOn=null):console.error("Did not create",b)}else c.showError=!0},c.predefinedActionsChanged=function(a){a.predefinedActions&&a.predefinedActions.currentValue&&(c.predefinedActionNames=c.predefinedActions.map(function(a){return b("translate")(a)}))},c.$onChanges=function(a){c.predefinedActionsChanged(a)}}function b(b,c,d){function e(a){return a&&a.hasOwnProperty("action")&&a.hasOwnProperty("author")&&a.hasOwnProperty("changedOn")}var f=this;a.call(f,b,d),f.remove=function(a){c.open({templateUrl:"access/components/action-log/item/delete-modal.html",controller:["$uibModalInstance","actionLogItem",function(a,b){this.item=b}],controllerAs:"$modal",resolve:{actionLogItem:function(){return{action:d("translate")(a.action),author:a.author,changedOn:moment(a.changedOn).calendar()}}}}).result.then(function(){var b=f.sourceCollectionWithout(a);b.length<f.sourceCollection.length&&f.update&&"function"==typeof f.update?f.update({logs:b}):console.error("Did not remove",a)})},f.edit=function(a){c.open({templateUrl:"access/components/action-log/item/edit-modal.html",controller:["$uibModalInstance","actionLogItem","predefinedActionNames",function(a,b,c){this.item=b,this.predefinedActionNames=c}],controllerAs:"$modal",size:"sm",resolve:{actionLogItem:function(){return{action:d("translate")(a.action),author:a.author,changedOn:new Date(a.changedOn)}},predefinedActionNames:function(){return f.predefinedActionNames}}}).result.then(function(b){if(f.replaceActionNameByTranslationKey(b),b.changedOn=b.changedOn.toISOString(),f.update&&"function"==typeof f.update){var c=f.sourceCollectionWithout(a);c=f.filterOutItemFromCollection(b,c),c.push(b),f.update({logs:c})}else console.error("Did not update",a)})},f.$onChanges=function(a){f.predefinedActionsChanged(a),f.showButtons=f.item&&e(f.item)}}angular.module("obiba.mica.access").component("actionLogEditor",{bindings:{sourceCollection:"<",predefinedActions:"<",update:"&"},templateUrl:"access/components/action-log/component.html",controller:["SessionProxy","$filter",a]}),angular.module("obiba.mica.access").component("actionLogItemEditor",{bindings:{item:"<",sourceCollection:"<",predefinedActions:"<",update:"&"},templateUrl:"access/components/action-log/item/component.html",controller:["SessionProxy","$uibModal","$filter",b]})}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){return null===y.parentId?y.config.newRequestButtonCaption||"data-access-request.add":"data-access-amendment.add"}function o(){return null===y.parentId?"data-access-request.none":"data-access-amendment.none"}function p(){y.headerTemplateUrl=h.getHeaderUrl("list"),y.footerTemplateUrl=h.getFooterUrl("list"),y.config=i.getOptions(),y.searchStatus={},y.loading=!0,y.addButtonCaption=n(),y.noneCaption=o(),y.actions=d.actions,y.showApplicant=f.roles().filter(function(a){return[g.dao,g.admin].indexOf(a)>-1}).length>0;var b=a.$new();y.$on=angular.bind(b,b.$on),y.$on(e.confirmDialogAccepted,x),d.getStatusFilterData(function(a){y.REQUEST_STATUS=a})}function q(a){for(var b=0;b<a.length;b++){var c=a[b];if("OPENED"!==c.status)for(var d=0;d<c.statusChangeHistory.length;d++){var e=c.statusChangeHistory[d];"OPENED"===e.from&&"SUBMITTED"===e.to&&(c.submissionDate=e.changedOn)}c.lastUpdate=c.timestamps.lastUpdate,c.amendmentsSummary&&c.amendmentsSummary.lastModifiedDate&&new Date(c.amendmentsSummary.lastModifiedDate)>new Date(c.timestamps.lastUpdate)&&(c.lastUpdate=c.amendmentsSummary.lastModifiedDate)}y.requests=a,y.loading=!1}function r(){y.loading=!1}function s(a){a.parentId&&void 0!==a.parentId.currentValue&&(null===a.parentId.currentValue?(y.listUrl=b.getDataAccessRequestsUrl(),y.entityBaseUrl=b.getDataAccessRequestBaseUrl()):(y.listUrl=b.getDataAccessAmendmentsUrl(y.parentId),y.entityBaseUrl=b.getDataAccessAmendmentBaseUrl(y.parentId)),c.list(y.listUrl).$promise.then(q,r))}function t(b){y.requestToDelete=b.id,a.$broadcast(e.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.title,b.applicant]},b.id)}function u(){return j.getUrl("DataAccessRequestsExportCsvResource").replace(":lang",k.use())}function v(){return j.getUrl("DataAccessRequestsExportHistoryResource").replace(":lang",k.use())}function w(){return j.getUrl("DataAccessClientDetailPath")?j.getUrl("BaseUrl")+j.getUrl("DataAccessClientDetailPath"):null}function x(a,b){y.requestToDelete===b&&(c.delete(y.entityBaseUrl,y.requestToDelete).$promise.then(function(){y.loading=!0,c.list(y.listUrl).$promise.then(q,r)},r),delete y.requestToDelete)}var y=this;y.getHistoryExportHref=v,y.getCsvExportHref=u,y.getDataAccessRequestPageUrl=w,y.deleteRequest=t,y.$onInit=p,y.$onChanges=s,y.UserProfileService=l,y.UserProfileModalService=m}ngObibaMica.access.component("entityList",{bindings:{parentId:"<",canAdd:"<"},templateUrl:"access/components/entity-list/component.html",controller:["$rootScope","DataAccessEntityUrls","DataAccessEntityResource","DataAccessEntityService","NOTIFICATION_EVENTS","SessionProxy","USER_ROLES","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","ngObibaMicaUrl","$translate","UserProfileService","UserProfileModalService",a]})}();var PrintFriendlyController=function(){function a(){}return a}(),PrintFriendlyComponent=function(){function a(){this.transclude=!0,this.bindings={accessForm:"<",lastSubmittedDate:"<",model:"<",project:"<",validForm:"<"},this.controller=PrintFriendlyController,this.controllerAs="$ctrl",this.templateUrl="access/components/print-friendly-view/component.html"}return a}();ngObibaMica.access.component("printFriendlyView",new PrintFriendlyComponent);var StatusProgressBarController=function(){function a(a){this.$log=a,this.percent=0}return a.prototype.$onChanges=function(a){this.status&&this.config&&(this.states||this.initializeStates(),this.updateStatus())},a.prototype.initializeStates=function(){var a=0;this.states={},this.states.OPENED=a++,this.states.SUBMITTED=a++,!0===this.config.withReview&&(this.states.REVIEWED=a++),!0===this.config.withConditionalApproval&&(this.states.CONDITIONALLY_APPROVED=a++),this.states.APPROVED=this.states.REJECTED=a,this.step=100/a},a.prototype.updateStatus=function(){this.percent=this.states[this.status]*this.step},a.$inject=["$log"],a}(),StatusProgressBarComponent=function(){function a(){this.templateUrl="access/components/status-progressbar/component.html",this.transclude=!1,this.transclude=!0,this.bindings={config:"<",status:"<"},this.controller=StatusProgressBarController,this.controllerAs="$ctrl"}return a}();ngObibaMica.access.component("statusProgressbar",new StatusProgressBarComponent),function(){function a(a,b,c,d,e,f,g){this.for=function(h,i,j,k){function l(c,d,e){a.$broadcast(g.showConfirmDialog,{titleKey:r+".status-change-confirmation.title",messageKey:null!==d?d:r+".status-change-confirmation.message",messageArgs:null!==e?[b("translate")(e).toLowerCase()]:[]},c)}function m(a,b){a===b&&e.updateStatus(q,i.id,a).$promise.then(j,k)}function n(a,b){i.id===b&&e.delete(q,b).$promise.then(function(){c.path(p?"/data-access-request/"+p:"/data-access-requests").replace()})}var o={},p=i["obiba.mica.DataAccessAmendmentDto.amendment"].parentId,q=p?d.getDataAccessAmendmentUrl(p,i.id):d.getDataAccessRequestUrl(i.id),r=p?"data-access-amendment":"data-access-request";return o.reopen=function(){l(f.status.OPENED,null,"reopen")},o.review=function(){l(f.status.REVIEWED,r+".status-change-confirmation.message-review",null)},o.approve=function(){l(f.status.APPROVED,null,"approve")},o.reject=function(){l(f.status.REJECTED,null,"reject")},o.conditionallyApprove=function(){l(f.status.CONDITIONALLY_APPROVED,null,"conditionallyApprove")},o.delete=function(){a.$broadcast(g.showConfirmDialog,{titleKey:r+".delete-dialog.title",messageKey:r+".delete-dialog.message",messageArgs:[i.title,i.applicant]},i.id)},o.printForm=function(){setTimeout(function(){window.print()},250)},h.$on(g.confirmDialogAccepted,n),h.$on(g.confirmDialogAccepted,function(a,b){m(f.status.OPENED,b)}),h.$on(g.confirmDialogAccepted,function(a,b){m(f.status.REVIEWED,b)}),h.$on(g.confirmDialogAccepted,function(a,b){m(f.status.CONDITIONALLY_APPROVED,b)}),h.$on(g.confirmDialogAccepted,function(a,b){m(f.status.APPROVED,b)}),h.$on(g.confirmDialogAccepted,function(a,b){m(f.status.REJECTED,b)}),o}}angular.module("obiba.mica.access").service("DataAccessEntityFormService",["$rootScope","$filter","$location","DataAccessEntityUrls","DataAccessEntityResource","DataAccessEntityService","NOTIFICATION_EVENTS",a])}();var DataAccessEntityResource=function(){function a(a,b,c,d,e,f){this.DataAccessRequestsResource=a,this.DataAccessRequestResource=b,this.DataAccessAmendmentsResource=c,this.DataAccessAmendmentResource=d,this.DataAccessRequestStatusResource=e,this.DataAccessAmendmentStatusResource=f}return a.prototype.list=function(a){var b=this.getParentId(a);return b?this.DataAccessAmendmentsResource.query({parentId:b}):this.DataAccessRequestsResource.query()},a.prototype.create=function(a,b,c,d){return this.getParentId(a)?this.DataAccessAmendmentsResource.save(b,c,d):this.DataAccessRequestsResource.save(b,c,d)},a.prototype.update=function(a,b){return this.getParentId(a)?this.DataAccessAmendmentResource.save(b):this.DataAccessRequestResource.save(b)},a.prototype.get=function(a,b){var c=this.getParentId(a);return c?this.DataAccessAmendmentResource.get({parentId:c,id:b}):this.DataAccessRequestResource.get({id:b})},a.prototype.delete=function(a,b){var c=this.getParentId(a);return c?this.DataAccessAmendmentResource.delete({parentId:c,id:b}):this.DataAccessRequestResource.delete({id:b})},a.prototype.updateStatus=function(a,b,c){var d=this.getParentId(a);return d?this.DataAccessAmendmentStatusResource.update({parentId:d,id:b,status:c}):this.DataAccessRequestStatusResource.update({id:b,status:c})},a.prototype.getParentId=function(a){var b=/data-access-request\/([a-zA-Z0-9_-]+)(?:\/amendment)?/.exec(a);return b&&2===b.length?b[b.index]:null},a.$inject=["DataAccessRequestsResource","DataAccessRequestResource","DataAccessAmendmentsResource","DataAccessAmendmentResource","DataAccessRequestStatusResource","DataAccessAmendmentStatusResource"],a}();ngObibaMica.access.service("DataAccessEntityResource",DataAccessEntityResource),function(){function a(a,b,c,d){function e(b){b&&a(Object.keys(k)).then(function(a){b(Object.keys(a).map(function(b){return{key:b,translation:a[b]}}))})}function f(a,b){return!!a.actions&&-1!==a.actions.indexOf(b)}function g(a,b){return a.nextStatus?-1!==a.nextStatus.indexOf(b):null}function h(a){var b="opened";if(a.action)b="action";else if("OPENED"!==a.from||a.from!==a.to)switch(a.to){case"OPENED":b="reopened";break;case"SUBMITTED":b="submitted";break;case"REVIEWED":b="reviewed";break;case"CONDITIONALLY_APPROVED":b="conditionallyApproved";break;case"APPROVED":b="approved";break;case"REJECTED":b="rejected"}return b}function i(a){return(a||[]).map(function(a){switch(h(a)){case"opened":a.msg="data-access-request.histories.opened",a.icon="glyphicon glyphicon-saved";break;case"reopened":a.msg="data-access-request.histories.reopened",a.icon="glyphicon glyphicon-saved";break;case"submitted":a.msg="data-access-request.histories.submitted",a.icon="glyphicon glyphicon-export";break;case"reviewed":a.msg="data-access-request.histories.reviewed",a.icon="glyphicon glyphicon-check";break;case"conditionallyApproved":a.msg="data-access-request.histories.conditionallyApproved",a.icon="glyphicon glyphicon-unchecked";break;case"approved":a.msg="data-access-request.histories.approved",a.icon="glyphicon glyphicon-ok";break;case"rejected":a.msg="data-access-request.histories.rejected",a.icon="glyphicon glyphicon-remove";break;case"action":a.msg=a.action,a.icon="glyphicon glyphicon-play-circle",a.changedOn=new Date(a.changedOn).toISOString()}return a})}function j(){return d.getUrl("DataAccessClientListPath")?d.getUrl("BaseUrl")+d.getUrl("DataAccessClientListPath"):null}var k={OPENED:"OPENED",SUBMITTED:"SUBMITTED",REVIEWED:"REVIEWED",CONDITIONALLY_APPROVED:"CONDITIONALLY_APPROVED",APPROVED:"APPROVED",REJECTED:"REJECTED"},l={canViewProfile:function(a){var d=!1,e=b.roles();return angular.forEach(e,function(b){b!==a&&b!==c.admin||(d=!0)}),d},canView:function(a){return f(a,"VIEW")},canEdit:function(a){return f(a,"EDIT")},canEditStatus:function(a){return f(a,"EDIT_STATUS")},canDelete:function(a){return f(a,"DELETE")},canEditAttachments:function(a){return f(a,"EDIT_ATTACHMENTS")},canDeleteAttachments:function(a){return f(a,"DELETE_ATTACHMENTS")},canAddAmendments:function(a){return!!a["obiba.mica.DataAccessAmendmentDto.amendment"]||f(a,"ADD_AMENDMENTS")},canEditActionLogs:function(a){return f(a,"EDIT_ACTION_LOGS")},canViewPrivateComments:function(a){return f(a,"VIEW_PRIVATE_COMMENTS")},canAddPrivateComments:function(a){return f(a,"ADD_PRIVATE_COMMENTS")}},m={canSubmit:function(a){return g(a,"SUBMITTED")},canReopen:function(a){return g(a,"OPENED")},canReview:function(a){return g(a,"REVIEWED")},canConditionallyApprove:function(a){return g(a,"CONDITIONALLY_APPROVED")},canApprove:function(a){return g(a,"APPROVED")},canReject:function(a){return g(a,"REJECTED")}};return this.status=k,this.actions=l,this.nextStatus=m,this.getStatusFilterData=e,this.processLogsHistory=i,this.getListDataAccessRequestPageUrl=j,this}ngObibaMica.access.service("DataAccessEntityService",["$translate","SessionProxy","USER_ROLES","ngObibaMicaUrl",a])}();var DataAccessEntityUrls=function(){function a(){}return a.prototype.getDataAccessRequestsUrl=function(){return"/data-access-requests"},a.prototype.getDataAccessRequestBaseUrl=function(){return"/data-access-request"},a.prototype.getDataAccessRequestUrl=function(a){return this.getDataAccessRequestBaseUrl()+"/"+a},a.prototype.getDataAccessAmendmentsUrl=function(a){return"/data-access-request/"+a+"/amendments"},a.prototype.getDataAccessAmendmentBaseUrl=function(a){return"/data-access-request/"+a+"/amendment"},a.prototype.getDataAccessAmendmentUrl=function(a,b){return this.getDataAccessAmendmentBaseUrl(a)+"/"+b},a}();ngObibaMica.access.service("DataAccessEntityUrls",DataAccessEntityUrls),ngObibaMica.access.controller("DataAccessRequestListController",["$scope","ngObibaMicaAccessTemplateUrl",function(a,b){a.headerTemplateUrl=b.getHeaderUrl("list"),a.footerTemplateUrl=b.getFooterUrl("list")}]).controller("DataAccessRequestViewController",["$rootScope","$scope","$q","$location","$uibModal","$routeParams","$filter","$translate","DataAccessRequestResource","DataAccessAmendmentsResource","DataAccessEntityService","DataAccessRequestStatusResource","DataAccessFormConfigResource","DataAccessRequestAttachmentsUpdateResource","DataAccessRequestCommentsResource","DataAccessRequestCommentResource","ngObibaMicaUrl","ngObibaMicaAccessTemplateUrl","AlertService","ServerErrorUtils","NOTIFICATION_EVENTS","DataAccessRequestConfig","SfOptionsService","moment","UserProfileService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(a){s.alert({id:"DataAccessRequestViewController",type:"danger",msg:t.buildMessage(a)})}function A(a){s.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"server.error.file.upload",msgArgs:[a.fileName]})}function B(){o.query({id:f.id,admin:!0===b.privateComments||""},function(a){b.form.comments=a||[]})}function C(a){switch(a){case fa.form:case fa.history:case fa.documents:break;case fa.comments:b.privateComments=!1,void 0===b.parentId&&B();break;case fa.privateComments:void 0===b.parentId&&(b.privateComments=!0,B());break;case fa.amendments:b.parentId=f.id}}function D(a){o.save({id:f.id,admin:!0===b.privateComments},a.message,B,z)}function E(a){p.update({id:f.id,commentId:a.id},a.message,B,z)}function F(c){b.commentToDelete=c.id,a.$broadcast(u.showConfirmDialog,{titleKey:"comment.delete-dialog.title",messageKey:"comment.delete-dialog.message",messageArgs:[c.createdBy]},c.id)}function G(a){a&&(b.attachments=angular.copy(b.dataAccessRequest.attachments)||[]),b.showAttachmentsForm=a}function H(){var a=[i.get];b.dataAccessForm.amendmentsEnabled&&a.push(j.getLogHistory),c.all(a.map(function(a){return a.apply(null,[{id:f.id}]).$promise})).then(function(a){var c=a[0],d=a[1];try{b.dataAccessRequest=c,b.form.model=c.content?JSON.parse(c.content):{};var e=q.getUrl("DataAccessRequestDownloadPdfResource").replace(":id",b.dataAccessRequest.id);b.requestDownloadUrl=e+(-1!==e.indexOf("?q=")?"&":"?")+"lang="+h.use(),b.attachments=c.attachments||[],b.lastSubmittedDate=K(),b.logsHistory=k.processLogsHistory([].concat(c.statusChangeHistory,c.actionLogHistory||[],d||[]).sort(function(a,b){return a.changedOn.localeCompare(b.changedOn)}))}catch(a){b.validForm=!1,b.form.model={},s.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.parse-error"})}b.loading=!1},z)}function I(){var a=angular.copy(b.dataAccessRequest);a.attachments=b.attachments,n.save(a,function(){G(!1),H()})}function J(){var a=c.defer();return c.all([w.transform(),m.get().$promise]).then(function(c){b.sfOptions=c[0],b.sfOptions.pristine={errors:!0,success:!1},b.dataAccessForm=c[1],b.dataAccessForm.downloadTemplate="Template"===b.dataAccessForm.pdfDownloadType,a.resolve()},z),a.promise}function K(){return(b.dataAccessRequest.logsHistory||[]).filter(function(a){return a.to===k.status.SUBMITTED}).sort(function(a,b){return x(a).isBefore(b)?-1:x(a).isSame(b)?0:x(a).isAfter(b)?1:void 0}).pop()}function L(){b.requestToDelete=b.dataAccessRequest.id,a.$broadcast(u.showConfirmDialog,{titleKey:"data-access-request.delete-dialog.title",messageKey:"data-access-request.delete-dialog.message",messageArgs:[b.dataAccessRequest.title,b.dataAccessRequest.applicant]},b.requestToDelete)}function M(a){return q.getUrl("DataAccessRequestAttachmentDownloadResource").replace(":id",b.dataAccessRequest.id).replace(":attachmentId",a.id)}function N(a,c){b.requestToDelete===c&&(i.delete({id:b.requestToDelete},function(){d.path("/data-access-requests").replace()}),delete b.requestToDelete)}function O(){setTimeout(function(){H()})}function P(b,c,d){a.$broadcast(u.showConfirmDialog,{titleKey:"data-access-request.status-change-confirmation.title",messageKey:null!==c?c:"data-access-request.status-change-confirmation.message",messageArgs:null!==d?[g("translate")(d).toLowerCase()]:[]},b)}function Q(a,c){a===c&&l.update({id:b.dataAccessRequest.id,status:a},O,z)}function R(){setTimeout(function(){window.print()},250)}function S(){b.$broadcast("schemaFormValidate"),b.forms.requestForm.$valid?l.update({id:b.dataAccessRequest.id,status:k.status.SUBMITTED},function(){e.open({scope:b,templateUrl:"access/views/data-access-request-submitted-modal.html"}).result.then(function(){O()})},z):s.alert({id:"DataAccessRequestViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})}function T(a,c){b.commentToDelete===c&&p.delete({id:f.id,commentId:c},{},B,z)}function U(a){Array.isArray(a)&&(b.loading=!0,b.dataAccessRequest.actionLogHistory=a,i.editActionLogs(b.dataAccessRequest,function(){O()}))}function V(){P(k.status.OPENED,null,"reopen")}function W(){P(k.status.REVIEWED,"data-access-request.status-change-confirmation.message-review",null)}function X(){P(k.status.APPROVED,null,"approve")}function Y(){P(k.status.REJECTED,null,"reject")}function Z(){P(k.status.CONDITIONALLY_APPROVED,null,"conditionallyApprove")}function $(a,b){Q(k.status.OPENED,b)}function _(a,b){Q(k.status.REVIEWED,b)}function aa(a,b){Q(k.status.CONDITIONALLY_APPROVED,b)}function ba(a,b){Q(k.status.APPROVED,b)}function ca(a,b){Q(k.status.REJECTED,b)}function da(a){return y.getFullName(a)}function ea(a){return y.getEmail(a)}var fa=Object.freeze({form:0,amendments:1,documents:2,comments:3,privateComments:4,history:5});b.logsHistory=[],b.parentId=void 0,b.loading=!1,b.validForm=!0,b.config=v.getOptions(),b.actions=k.actions,b.nextStatus=k.nextStatus,b.showAttachmentsForm=!1,b.selectTab=C,b.delete=L,b.submitComment=D,b.updateComment=E,b.deleteComment=F,b.getDownloadHref=M,b.updateAttachments=I,b.cancelAttachments=function(){G(!1)},b.editAttachments=function(){G(!0)},b.updateActionLogs=U,b.onAttachmentError=A,b.headerTemplateUrl=r.getHeaderUrl("view"),b.footerTemplateUrl=r.getFooterUrl("view"),b.submit=S,b.reopen=V,b.review=W,b.approve=X,b.reject=Y,b.conditionallyApprove=Z,b.UserProfileService=y,b.getProfileEmail=ea,b.userProfile=function(a){b.applicant=a,e.open({scope:b,templateUrl:"access/views/data-access-request-profile-user-modal.html"})},b.dataAccessRequest={},b.getDataAccessListPageUrl=k.getListDataAccessRequestPageUrl(),b.printForm=R,b.getFullName=da,b.$on(u.confirmDialogAccepted,N),b.$on(u.confirmDialogAccepted,T),b.$on(u.confirmDialogAccepted,$),b.$on(u.confirmDialogAccepted,_),b.$on(u.confirmDialogAccepted,aa),b.$on(u.confirmDialogAccepted,ba),b.$on(u.confirmDialogAccepted,ca),a.$on("$translateChangeSuccess",J),b.tabs={activeTab:0},b.TAB_NAMES=fa,b.forms={},b.form={schema:null,definition:null,model:{},comments:null},f.id&&J().then(function(){H()})}]).controller("DataAccessRequestEditController",["$rootScope","$scope","$q","$routeParams","$location","$uibModal","DataAccessRequestsResource","DataAccessRequestResource","DataAccessFormConfigResource","AlertService","ServerErrorUtils","SessionProxy","DataAccessEntityService","ngObibaMicaAccessTemplateUrl","DataAccessRequestConfig","SfOptionsService","FormDirtyStateObserver","DataAccessRequestDirtyStateService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){c.all([d.id?h.get({id:d.id},function(a){return a.attachments=a.attachments||[],a}).$promise:{applicant:l.login(),status:m.status.OPENED,attachments:[]},i.get().$promise]).then(function(a){b.dataAccessRequest=a[0],b.sfForm=a[1]||{},b.sfForm.model=b.dataAccessRequest.content?JSON.parse(b.dataAccessRequest.content):{},b.loaded=!0},function(a){b.validForm=!1,u(a)})}var t=function(a,b){q.unobserve();var c=b().location.split("/");e.path("/data-access-request/"+c[c.length-1]).replace()},u=function(a){j.alert({id:"DataAccessRequestEditController",type:"danger",msg:k.buildMessage(a)})};b.getDataAccessListPageUrl=m.getListDataAccessRequestPageUrl();var v=function(a){b.$broadcast("schemaFormValidate"),f.open({resolve:{isValid:a.$valid},templateUrl:"access/views/data-access-request-validation-modal.html",controller:["$scope","isValid",function(a,b){a.isValid=b}]})},w=function(){e.path("/data-access-request"+(d.id?"/"+d.id:"s")).replace()},x=function(){function a(){h.save(b.dataAccessRequest,function(){q.unobserve(),e.path("/data-access-request"+(b.dataAccessRequest.id?"/"+b.dataAccessRequest.id:"s")).replace()},u)}if(b.dataAccessRequest.content=angular.toJson(b.sfForm.model||{}),b.newRequest)g.save(b.dataAccessRequest,t,u);else{-1===["OPENED","CONDITIONALLY_APPROVED"].indexOf(b.dataAccessRequest.status)?(b.$broadcast("schemaFormValidate"),b.form.$valid?a():v(b.form)):a()}};a.$on("$translateChangeSuccess",function(){s()}),s(),b.loaded=!1,b.config=o.getOptions(),b.validForm=!0,b.requestId=d.id,b.newRequest=!d.id,b.cancel=w,b.save=x,b.editable=!0,b.validate=v,b.headerTemplateUrl=n.getHeaderUrl("form"),b.footerTemplateUrl=n.getFooterUrl("form"),b.sfForm=null,q.observe(b),r.setForm(b.form),b.$on("$destroy",function(){r.setForm(null)})}]),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){return a.content?JSON.parse(a.content):{}}function r(b,d){n.unobserve();var e=d().location.split("/");c.path(a.entityUrl+"/amendment/"+e[e.length-1]).replace()}function s(a){l.alert({id:"DataAccessAmendmentEditController",type:"danger",msg:k.buildMessage(a)})}function t(){n.unobserve(),m.setForm(null)}a.entityUrl=e.id?i.getDataAccessAmendmentUrl(e.parentId,e.id):i.getDataAccessRequestUrl(e.parentId),a.read=!1,a.formDrawn=!1,b.$on("$translateChangeSuccess",function(){h.get().$promise.then(function(b){a.dataAccessForm=b})});var u=e.id?g.get(a.entityUrl,e.id):{"obiba.mica.DataAccessAmendmentDto.amendment":{parentId:e.parentId},$promise:new Promise(function(a){setTimeout(a,0,{})}),status:j.status.OPENED},v=u.$promise.then(q),w=h.get();d.all([u,v,w.$promise]).then(function(b){return a.requestEntity=b[0],a.model=b[1],a.dataAccessForm=b[2],b},function(a){console.error("Failed to resolve amendment promises because",a)}),a.headerTemplateUrl=p.getHeaderUrl("amendmentForm"),a.footerTemplateUrl=p.getFooterUrl("amendmentForm"),n.observe(a),m.setForm(a.form),a.$on("$destroy",t),a.cancel=function(){t(),c.path(a.entityUrl).replace()},a.save=function(){function b(){g.update(a.entityUrl,a.requestEntity).$promise.then(function(){n.unobserve(),c.path(a.entityUrl).replace()},s)}if(a.requestEntity.content=angular.toJson(a.model||{}),a.requestEntity.parentId=e.parentId,delete a.requestEntity.$promise,a.requestEntity.applicant||(a.requestEntity.applicant=o.login()),e.id){-1===["OPENED","CONDITIONALLY_APPROVED"].indexOf(a.requestEntity.status)?(a.$broadcast("schemaFormValidate"),a.forms.requestForm.$valid?b():a.validate(a.forms.requestForm)):b()}else g.create(a.entityUrl,a.requestEntity,r,s)},a.validate=function(b){a.$broadcast("schemaFormValidate"),f.open({resolve:{isValid:b.$valid},templateUrl:"access/views/data-access-request-validation-modal.html",controller:["$scope","isValid",function(a,b){a.isValid=b}]})},a.toggleFormDrawnStatus=function(b){a.formDrawn=b}}angular.module("obiba.mica.access").controller("DataAccessAmendmentEditController",["$scope","$rootScope","$location","$q","$routeParams","$uibModal","DataAccessEntityResource","DataAccessAmendmentFormConfigResource","DataAccessEntityUrls","DataAccessEntityService","ServerErrorUtils","AlertService","DataAccessRequestDirtyStateService","FormDirtyStateObserver","SessionProxy","ngObibaMicaAccessTemplateUrl",a])}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){return m.getFullName(a)}function o(a){return m.getEmail(a)}function p(a){return a.content?JSON.parse(a.content):{}}function q(){var b=f.get(a.entityUrl,c.id);d.all([b,b.$promise.then(p)]).then(function(b){a.requestEntity=b[0],a.model=b[1]})}b.$on("$translateChangeSuccess",function(){i.get().$promise.then(function(b){a.dataAccessForm=b})}),a.userProfile=function(b){a.applicant=b,e.open({scope:a,templateUrl:"access/views/data-access-request-profile-user-modal.html"})},a.entityUrl=j.getDataAccessAmendmentUrl(c.parentId,c.id),a.read=!0,a.formDrawn=!1;var r=f.get(a.entityUrl,c.id),s=r.$promise.then(p),t=i.get();d.all([r,s,t.$promise]).then(function(b){return a.requestEntity=b[0],a.model=b[1],a.dataAccessForm=b[2],a.actions=g.actions,a.nextStatus=g.nextStatus,Object.assign(a,h.for(a,a.requestEntity,q)),b},function(a){console.error("Failed to resolve amendment promises because",a)}),a.headerTemplateUrl=l.getHeaderUrl("amendmentView"),a.footerTemplateUrl=l.getFooterUrl("amendmentView"),a.submit=function(){a.$broadcast("schemaFormValidate"),a.forms.requestForm.$valid?f.updateStatus(a.entityUrl,c.id,g.status.SUBMITTED).$promise.then(function(){e.open({scope:a,templateUrl:"access/views/data-access-request-submitted-modal.html"}).result.then(function(){q()})}):k.alert({id:"DataAccessAmendmentViewController",type:"danger",msgKey:"data-access-request.submit.invalid"})},a.toggleFormDrawnStatus=function(b){a.formDrawn=b},a.getFullName=n,a.getProfileEmail=o}angular.module("obiba.mica.access").controller("DataAccessAmendmentViewController",["$scope","$rootScope","$routeParams","$q","$uibModal","DataAccessEntityResource","DataAccessEntityService","DataAccessEntityFormService","DataAccessAmendmentFormConfigResource","DataAccessEntityUrls","AlertService","ngObibaMicaAccessTemplateUrl","UserProfileService",a])}(),ngObibaMica.access.config(["$routeProvider",function(a){a.when("/data-access-requests",{templateUrl:"access/views/data-access-request-list.html",controller:"DataAccessRequestListController"}).when("/data-access-request/new",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id/edit",{templateUrl:"access/views/data-access-request-form.html",controller:"DataAccessRequestEditController"}).when("/data-access-request/:id",{templateUrl:"access/views/data-access-request-view.html",controller:"DataAccessRequestViewController"}).when("/data-access-request/:parentId/amendment/new",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentEditController"}).when("/data-access-request/:parentId/amendment/:id/edit",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentEditController"}).when("/data-access-request/:parentId/amendment/:id",{templateUrl:"access/views/data-access-amendment-view.html",controller:"DataAccessAmendmentViewController"})}]),ngObibaMica.access.factory("DataAccessFormConfigResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessAmendmentFormConfigResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessAmendmentFormConfigResource"),{},{get:{method:"GET",errorHandler:!0}})}]).factory("DataAccessRequestsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsResource"),{},{save:{method:"POST",errorHandler:!0},get:{method:"GET"}})}]).factory("DataAccessRequestsExportCsvResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestsExportCsvResource"),{},{get:{method:"GET"}})}]).factory("DataAccessRequestResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0},editActionLogs:{method:"PUT",params:{id:"@id"},url:b.getUrl("DataAccessRequestActionLogsResource"),errorHandler:!0},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("DataAccessAmendmentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessAmendmentsResource"),{},{save:{method:"POST",params:{parentId:"@parentId"},errorHandler:!0},get:{method:"GET",params:{parentId:"@parentId"}},getLogHistory:{method:"GET",isArray:!0,url:b.getUrl("DataAccessAmendmentsLogHistoryResource")}})}]).factory("DataAccessAmendmentResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessAmendmentResource"),{},{save:{method:"PUT",params:{parentId:"@parentId",id:"@id"},errorHandler:!0},get:{method:"GET"},delete:{method:"DELETE"}})}]).factory("DataAccessRequestAttachmentsUpdateResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestAttachmentsUpdateResource"),{},{save:{method:"PUT",params:{id:"@id"},errorHandler:!0}})}]).factory("DataAccessRequestCommentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentsResource"),{},{save:{method:"POST",params:{id:"@id",admin:"@admin"},headers:{"Content-Type":"text/plain"},errorHandler:!0},get:{method:"GET",params:{id:"@id",admin:"@admin"},errorHandler:!0}})}]).factory("DataAccessRequestCommentResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestCommentResource"),{},{delete:{method:"DELETE",params:{id:"@id",commentId:"@commentId"},errorHandler:!0},update:{method:"PUT",params:{id:"@id",commentId:"@commentId"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("DataAccessRequestStatusResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessRequestStatusResource"),{},{update:{method:"PUT",params:{id:"@id",status:"@status"},errorHandler:!0}})}]).factory("DataAccessAmendmentStatusResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DataAccessAmendmentStatusResource"),{},{update:{method:"PUT",params:{id:"@id",parentId:"@parentId",status:"@status"},errorHandler:!0}})}]).service("DataAccessRequestConfig",function(){var a={newRequestButtonCaption:null,documentsSectionTitle:null,documentsSectionHelpText:null,downloadButtonCaption:null,commentsEnabled:!0,userListPageTitle:null,newRequestButtonHelpText:null};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}).service("DataAccessRequestDirtyStateService",[function(){var a=null;this.setForm=function(b){a=b},this.isDirty=function(){return a&&a.$dirty}}]).filter("filterProfileAttributes",function(){return function(a){var b=["email","firstName","lastName","createdDate","lastLogin","username"];return a.filter(function(a){return-1===b.indexOf(a.key)})}}).filter("capitalizeFirstLetter",["StringUtils",function(a){return function(b){return a.capitaliseFirstLetter(b)}}]),ngObibaMica.sets=angular.module("obiba.mica.sets",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica","LocalStorageModule"]),function(){ngObibaMica.sets.config(["$provide",function(a){a.provider("ngObibaMicaSetsTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({cart:{header:null,footer:null},sets:{header:null,footer:null}}))}])}(),function(){ngObibaMica.sets.factory("SetResource",["$resource","ApplicationCacheService","ngObibaMicaUrl",function(a,b,c){return a(c.getUrl("SetResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id"},errorHandler:!0},delete:{method:"DELETE",params:{type:"@type",id:"@id"},errorHandler:!0,transformResponse:function(){b.clearCache("taxonomyResource"),b.clearCache("taxonomiesResource")}}})}]).factory("SetDocumentsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetDocumentsResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id",from:"@from",limit:"@limit"},errorHandler:!0}})}]).factory("SetClearResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetClearResource"),{},{clear:{method:"DELETE",params:{type:"@type",id:"@id"},errorHandler:!0}})}]).factory("SetExistsResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetExistsResource"),{},{get:{method:"GET",params:{type:"@type",id:"@id",did:"@did"},errorHandler:!0}})}]).factory("SetImportResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetImportResource"),{},{save:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}]).factory("SetImportQueryResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetImportQueryResource"),{},{save:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"application/x-www-form-urlencoded"},errorHandler:!0,transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]).factory("SetRemoveResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("SetRemoveResource"),{},{delete:{method:"POST",params:{type:"@type",id:"@id"},headers:{"Content-Type":"text/plain"},errorHandler:!0}})}])}(),function(){ngObibaMica.sets.factory("SetsResource",["$resource","ApplicationCacheService","ngObibaMicaUrl",function(a,b,c){return a(c.getUrl("SetsResource"),{},{save:{method:"POST",params:{type:"@type"},errorHandler:!0,transformResponse:function(a){return b.clearCache("taxonomyResource"),b.clearCache("taxonomiesResource"),JSON.parse(a)}}})}]).factory("SetsImportResource",["$resource","ApplicationCacheService","ngObibaMicaUrl",function(a,b,c){return a(c.getUrl("SetsImportResource"),{},{save:{method:"POST",params:{type:"@type"},headers:{"Content-Type":"text/plain"},errorHandler:!0,transformResponse:function(a){return b.clearCache("taxonomyResource"),b.clearCache("taxonomiesResource"),JSON.parse(a)}}})}])}();var SetService=function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){this.$window=a,this.$location=b,this.$log=c,this.$translate=d,this.localStorageService=e,this.PageUrlService=f,this.SetsImportResource=g,this.SetResource=h,this.SetDocumentsResource=i,this.SetClearResource=j,this.SetExistsResource=k,this.SetImportResource=l,this.SetImportQueryResource=m,this.SetRemoveResource=n,this.ObibaServerConfigResource=o,this.SessionProxy=p,this.options={CartHelpText:null,SetsHelpText:null}}return a.prototype.setSettingOption=function(a){var b=this;"object"==typeof a&&Object.keys(a).forEach(function(c){c in b.options&&(b.options[c]=a[c])})},a.prototype.setGettingOption=function(){return angular.copy(this.options)},a.prototype.serverConfig=function(){var a=this,b=this.ObibaServerConfigResource.get(function(b){return a.hasMultipleStudies=!b.isSingleStudyEnabled||b.isHarmonizedDatasetEnabled,a.hasHarmonization=b.isHarmonizedDatasetEnabled,a.maxNumberOfSets=b.maxNumberOfSets,a.maxItemsPerSets=b.maxItemsPerSet,b});return b.$promise||b},a.prototype.isSingleStudy=function(){return!this.hasMultipleStudies},a.prototype.hasHarmonizedDatasets=function(){return this.hasHarmonization},a.prototype.getMaxItemsPerSets=function(){return this.maxItemsPerSets},a.prototype.getMaxNumberOfSets=function(){return this.maxNumberOfSets},a.prototype.getSetDocuments=function(a,b,c,d){return this.SetDocumentsResource.get({from:c,id:a,limit:d,type:b}).$promise},a.prototype.getCartDocuments=function(a,b,c){var d=this;return this.getOrCreateCart(a).then(function(e){return d.getSetDocuments(e.id,a,b,c)})},a.prototype.isDocumentInSet=function(a,b,c){return this.SetExistsResource.get({type:b,id:a,did:c}).$promise},a.prototype.isDocumentInCart=function(a,b){var c=this;return this.getOrCreateCart(a).then(function(d){return c.isDocumentInSet(d.id,a,b)})},a.prototype.addDocumentToSet=function(a,b,c){var d=this,e=Array.isArray(c)?c.join("\n"):c;return this.SetResource.get({type:b,id:a}).$promise.then(function(a){return d.SetImportResource.save({type:b,id:a.id},e).$promise}).then(function(a){return d.notifySetChanged(a),a})},a.prototype.addDocumentToCart=function(a,b){var c=this,d=Array.isArray(b)?b.join("\n"):b;return this.getOrCreateCart(a).then(function(b){return c.SetImportResource.save({type:a,id:b.id},d).$promise}).then(function(b){return c.saveCart(a,b)})},a.prototype.addDocumentQueryToSet=function(a,b,c){var d=this;return this.$log.info("query="+c),this.SetImportQueryResource.save({type:b,id:a,query:c}).$promise.then(function(a){return d.notifySetChanged(a),a})},a.prototype.addDocumentQueryToCart=function(a,b){var c=this;return this.$log.info("query="+b),this.getOrCreateCart(a).then(function(d){return c.SetImportQueryResource.save({type:a,id:d.id,query:b}).$promise}).then(function(b){return c.saveCart(a,b)})},a.prototype.removeDocumentFromSet=function(a,b,c){var d=this,e=Array.isArray(c)?c.join("\n"):c;return this.SetRemoveResource.delete({type:b,id:a},e).$promise.then(function(a){return d.notifySetChanged(a),a})},a.prototype.removeDocumentFromCart=function(a,b){var c=this,d=Array.isArray(b)?b.join("\n"):b;return this.getOrCreateCart(a).then(function(b){return c.SetRemoveResource.delete({type:a,id:b.id},d).$promise}).then(function(b){return c.saveCart(a,b)})},a.prototype.clearSet=function(a,b){var c=this;return this.SetClearResource.clear({type:b,id:a}).$promise.then(function(){return c.SetResource.get({id:a,type:b}).$promise}).then(function(a){return c.notifySetChanged(a),a})},a.prototype.clearCart=function(a){var b=this;return this.getOrCreateCart(a).then(function(c){return b.SetClearResource.clear({type:a,id:c.id}).$promise}).then(function(){return b.notifyCartChanged(a),b.getOrCreateCart(a)})},a.prototype.gotoSetEntitiesCount=function(a,b){var c=this,d=20,e=a;if(!e){var f=this.getCartSet("variables");f&&(e=f.id)}if(b){var g=Array.isArray(b)?b:[b];this.gotoEntitiesCount(g.slice(0,d))}else this.SetDocumentsResource.get({type:"variables",id:e,from:0,limit:d}).$promise.then(function(a){c.gotoEntitiesCount(a.variables.map(function(a){return a.id}))})},a.prototype.gotoEntitiesCount=function(a){if(a){var b=a.map(function(a){return"all("+a+")"}).join(",");this.$window.location.href=this.PageUrlService.entitiesCountPage(b),this.$location.replace()}},a.prototype.getOpalViewsDownloadUrl=function(a,b){if(!b){var c=this.getCartSet("variables");c&&(b=c.id)}return this.PageUrlService.downloadOpalView(a,b)},a.prototype.getDownloadUrl=function(a,b){var c=b;if(!c){var d=this.getCartSet(a);d&&(c=d.id)}if(c){var e="variable(in(Mica_variable.sets,"+c+"),limit(0,"+this.maxItemsPerSets+"),fields((attributes.label.*,variableType,datasetId,datasetAcronym)),sort(variableType,containerId,populationWeight,dataCollectionEventWeight,datasetId,index,name)),locale("+this.$translate.use()+")";return this.PageUrlService.downloadList(a,e)}return null},a.prototype.getDownloadUrlForIds=function(a,b,c){if(!c||c.length<1)return this.getDownloadUrl(a,b);var d="variable(in(id,("+c.join(",")+")),limit(0,"+this.maxItemsPerSets+"),fields((attributes.label.*,variableType,datasetId,datasetAcronym)),sort(variableType,containerId,populationWeight,dataCollectionEventWeight,datasetId,index,name)),locale("+this.$translate.use()+")";return this.PageUrlService.downloadList(a,d)},a.prototype.getSearchQuery=function(a,b){var c=typeToTarget(a);return b?c+"(in(Mica_"+c+".sets,"+b+"))":c+"(in(Mica_"+c+".sets,"+this.getCartSet(a).id+"))"},a.prototype.gotoSearch=function(a,b){var c=b;if(!c){var d=this.getCartSet(a);d&&(c=d.id)}if(c){var e=this.getSearchQuery(a,c);this.$window.location.href=this.PageUrlService.searchPage(e),this.$location.replace()}},a.prototype.getCartSet=function(a){return(this.localStorageService.get(this.getCartKey(a))||{})[this.SessionProxy.profile()?this.SessionProxy.login():"anonymous"]},a.prototype.getOrCreateCart=function(a){var b=this,c=this.getCartSet(a);return c?this.SetResource.get({type:a,id:c.id}).$promise.then(function(c){return b.saveCart(a,c)}).catch(function(){return b.createCart(a,"")}):this.createCart(a,"")},a.prototype.createCart=function(a,b){var c=this;return this.SetsImportResource.save({type:a},b).$promise.then(function(b){return c.saveCart(a,b)})},a.prototype.saveCart=function(a,b){if(b&&b.id){var c=this.localStorageService.get(this.getCartKey(a))||{};return c[b.username]=b,this.localStorageService.set(this.getCartKey(a),c),this.notifyCartChanged(a),b}},a.prototype.getCartKey=function(a){return"cart."+a},a.prototype.notify=function(a,b){var c;try{c=new CustomEvent(a,{detail:b})}catch(d){c=document.createEvent("Event"),c.initEvent(a,!0,!0),c.detail=b}document.dispatchEvent(c)},a.prototype.notifySetChanged=function(a){this.notify("set-updated",a)},a.prototype.notifyCartChanged=function(a){this.notify("cart-updated",a)},a.$inject=["$window","$location","$log","$translate","localStorageService","PageUrlService","SetsImportResource","SetResource","SetDocumentsResource","SetClearResource","SetExistsResource","SetImportResource","SetImportQueryResource","SetRemoveResource","ObibaServerConfigResource","SessionProxy"],a}();ngObibaMica.sets.service("SetService",SetService);var DocumentsSetTableComponentController=function(){function a(a,b,c,d){this.SetService=a,this.AnalysisConfigService=b,this.$log=c,this.$uibModal=d,this.allSelected=!1,this.allPageSelected={},this.selections={},this.documents={from:0,limit:0,total:0},this.pagination={currentPage:1,from:0,itemsPerPage:10,maxSize:3,pageCount:1,to:0,totalHits:0},this.micaConfigShowAnalysis=!0,this.micaConfigShowOpalViews=!1}return a.prototype.showAnalysis=function(){return this.AnalysisConfigService.showAnalysis()&&this.micaConfigShowAnalysis},a.prototype.hasSelections=function(){return this.allSelected||this.getSelectedDocumentIds().length>0},a.prototype.updateAllSelected=function(){this.$log.info("ALL="+this.allSelected),this.allSelected=!this.allSelected,this.allSelected?(this.allPageSelected[this.pagination.currentPage]=!0,this.updateAllCurrentPageSelected()):(this.allPageSelected={},this.selections={})},a.prototype.updateAllCurrentPageSelected=function(){var a=this;this.$log.info("ALLPAGE="+JSON.stringify(this.allPageSelected)),this.allSelected&&!this.allPageSelected[this.pagination.currentPage]?(this.allSelected=!1,this.allPageSelected={},this.selections={}):this.documents&&this.documents[this.type]&&this.documents[this.type].forEach(function(b){a.selections[b.id]=a.allPageSelected[a.pagination.currentPage]})},a.prototype.updateSelection=function(a){this.selections[a]||(this.allPageSelected[this.pagination.currentPage]=!1,this.allSelected=!1)},a.prototype.entitiesCount=function(){if(this.pagination.totalHits){var a=this.getSelectedDocumentIds();this.SetService.gotoSetEntitiesCount(this.setId,a&&a.length>0?a:void 0)}},a.prototype.download=function(){return this.hasSelections()?this.SetService.getDownloadUrlForIds(this.type,this.setId,this.getSelectedDocumentIds()):this.SetService.getDownloadUrl(this.type,this.setId)},a.prototype.opalExport=function(){return this.SetService.getOpalViewsDownloadUrl(this.type,this.setId)},a.prototype.search=function(){this.SetService.gotoSearch(this.type,this.setId)},a.prototype.clearSet=function(){var a=this;if(this.hasSelections()){var b=this.getSelectedDocumentIds();b&&b.length>0?this.SetService.removeDocumentFromSet(this.setId,this.type,b).then(function(){a.allSelected=!1,a.allPageSelected={},a.selections={},a.onPageChange(a.type,0)}):this.SetService.clearSet(this.setId,this.type).then(function(){a.clearSelections(),a.onPageChange(a.type,0)})}},a.prototype.pageChanged=function(){var a=(this.pagination.currentPage-1)*this.documents.limit;this.onPageChange(this.type,a)},a.prototype.addToSet=function(){var a=this;this.$uibModal.open({component:"addToSetModal",keyboard:!1,resolve:{excludeId:function(){return a.setId},ids:function(){return a.allSelected?{}:a.selections},query:function(){return a.SetService.getSearchQuery(a.type,a.setId)},type:function(){return a.type}}}).result.then(function(b){a.clearSelections(),a.onUpdate(b.id,b.name,b.newCount)})},a.prototype.$onInit=function(){this.table={rows:new Array}},a.prototype.getSelectedDocumentIds=function(){var a=this;return this.allSelected?[]:Object.keys(this.selections).filter(function(b){return a.selections[b]})},a.prototype.clearSelections=function(){this.allSelected=!1,this.allPageSelected={},this.selections={}},a}(),SetsAlertBuilder=function(){function a(a){this.AlertService=a}return a.newBuilder=function(b){return new a(b)},a.prototype.withId=function(a){return this.id=a,this},a.prototype.withName=function(a){return this.name=a,this},a.prototype.withCount=function(a){return this.count=a,this},a.prototype.withMsgKey=function(a){return this.msgKey=a,this},a.prototype.withEmptyMsgKey=function(a){return this.emptyMsgKey=a,this},a.prototype.withRedirectUrl=function(a){return this.redirectUrl=a,this},a.prototype.showAlert=function(){var a=this.msgKey,b=[this.redirectUrl];this.id&&b.push(this.id),b.push(this.count+""),this.name&&b.push(this.name),0===this.count&&(a=this.emptyMsgKey,b=[]),this.AlertService.growl({delay:4e3,id:"MainControllerGrowl",msgArgs:b,msgKey:a,type:"info"})},a}(),AddToSetComponentModalController=function(){function a(a,b,c,d,e,f,g){this.RqlQueryService=a,this.RqlQueryUtils=b,this.SetsResource=c,this.SetsImportResource=d,this.SetService=e,this.ngObibaMicaUrl=f,this.AlertService=g,this.disableActions=!1}return a.prototype.accept=function(){var a=this;this.disableActions=!0,"NEW"===this.choice.radio&&(this.choice.name=this.choice.name.trim()),"EXISTING"===this.choice.radio&&void 0!==this.choice.selected?this.processDocumentSet(this.choice.selected.id,this.resolve.type,this.resolve.query,this.resolve.ids).then(function(b){a.close({$value:{id:b.id,name:b.name,newCount:b.count-a.choice.selected.count}})}):this.SetsImportResource.save({type:this.resolve.type,name:this.choice.name},"").$promise.then(function(b){a.processDocumentSet(b.id,a.resolve.type,a.resolve.query,a.resolve.ids).then(function(b){a.close({$value:{id:b.id,name:b.name,newCount:b.count}})})})},a.prototype.cancel=function(){this.dismiss()},a.prototype.onRadioChanged=function(){"NEW"===this.choice.radio?this.onNameChanged():"EXISTING"===this.choice.radio&&this.onSelected()},a.prototype.onNameChanged=function(){this.choice.radio="NEW",this.canAccept=this.choice.name&&this.choice.name.trim().length>0,void 0!==this.choice.selected&&(this.choice.selected=void 0)},a.prototype.onSelected=function(){this.choice.radio="EXISTING",this.canAccept=void 0!==this.choice.selected,void 0!==this.choice.name&&(this.choice.name=void 0)},a.prototype.$onInit=function(){var a=this;this.SetsResource.query({type:this.resolve.type}).$promise.then(function(b){a.sets=b.filter(function(b){return b.name&&(!a.resolve.excludeId||a.resolve.excludeId!==b.id)});var c=a.SetService.getMaxNumberOfSets();a.canAddMoreSets=a.sets.length<c-(a.resolve.excludeId?1:0),a.canAddMoreSets||a.AlertService.alert({delay:0,id:"MaxAttainedAlert",msgArgs:[c,a.ngObibaMicaUrl.getUrl("SetsPage")],msgKey:"sets.maximum-number-attained",type:"warning"})})},a.prototype.addQuery=function(a,b,c){var d=this.RqlQueryService.parseQuery(c),e=typeToTarget(b),f=this.RqlQueryUtils.rewriteQueryWithLimitAndFields(d,e,this.SetService.getMaxItemsPerSets(),["id"]);return this.SetService.addDocumentQueryToSet(a,b,f)},a.prototype.processDocumentSet=function(a,b,c,d){var e=Object.keys(d);return void 0!==d&&e.length>0?this.SetService.addDocumentToSet(a,b,e):this.addQuery(a,b,c)},a.EXISTING_CHOICE="EXISTING",a.NEW_CHOICE="NEW",a.$inject=["RqlQueryService","RqlQueryUtils","SetsResource","SetsImportResource","SetService","ngObibaMicaUrl","AlertService"],a}(),AddToSetComponentModalComponent=function(){function a(){this.transclude=!0,this.bindings={close:"&",dismiss:"&",resolve:"<"},this.controller=AddToSetComponentModalController,this.controllerAs="$ctrl",this.templateUrl="sets/components/add-to-set-modal/component.html"}return a}();angular.module("obiba.mica.sets").component("addToSetModal",new AddToSetComponentModalComponent);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),CartDocumentsTableController=function(a){function b(b,c,d,e,f,g,h,i){var j=a.call(this,d,e,g,i)||this;return j.PageUrlService=b,j.LocalizedValues=c,j.SetService=d,j.AnalysisConfigService=e,j.$translate=f,j.$log=g,j.$scope=h,d.serverConfig().then(function(a){j.showStudies=!j.SetService.isSingleStudy(),j.showVariableType=j.SetService.hasHarmonizedDatasets(),j.currentUserCanCreateSets=a.currentUserCanCreateSets,j.micaConfigShowAnalysis=a.isSetsAnalysisEnabled,j.micaConfigShowSearch=a.isSetsSearchEnabled,j.micaConfigShowOpalViews=a.downloadOpalViewsFromSetsAllowed}),j}return __extends(b,a),b.prototype.search=function(){this.SetService.gotoSearch(this.type)},b.prototype.clearSet=function(){var a=this;if(this.hasSelections()){var b=this.getSelectedDocumentIds();b&&b.length>0?this.SetService.removeDocumentFromCart(this.type,b).then(function(){a.allSelected=!1,a.allPageSelected={},a.selections={},a.$scope.$emit("cart-cleared",a.type)}):this.SetService.clearCart(this.type).then(function(){a.allSelected=!1,a.allPageSelected={},a.selections={},a.$scope.$emit("cart-cleared",a.type)})}},b.prototype.$onChanges=function(){this.table=this.asTable(),this.localizedTotal=this.LocalizedValues.formatNumber(this.documents&&this.documents.total?this.documents.total:0)},b.prototype.localize=function(a){return this.LocalizedValues.forLang(a,this.$translate.use())},b.prototype.asTable=function(){var a=this,b={rows:new Array};this.pagination.totalHits=this.documents?this.documents.total:0,this.pagination.currentPage=this.documents?this.documents.from/this.documents.limit+1:0,this.pagination.itemsPerPage=this.documents?this.documents.limit:0,this.pagination.pageCount=Math.ceil(this.pagination.totalHits/this.pagination.itemsPerPage),this.pagination.currentPage=this.documents?this.documents.from/this.documents.limit+1:0,this.pagination.from=this.documents?this.documents.from+1:0;var c=this.documents&&this.documents[this.type]?this.documents[this.type].length:0;return this.pagination.to=this.documents?this.documents.from+c:0,c&&(this.allSelected&&(this.allPageSelected[this.pagination.currentPage]=!0),this.documents[this.type].forEach(function(c){a.allSelected&&(a.selections[c.id]=!0);var d=a.localize(c.studySummary.acronym),e=(a.localize(c.studySummary.name),"Dataschema"===c.variableType?"harmonization":"individual"),f=a.PageUrlService.studyPage(c.studyId,e),g=a.localize(c.datasetName),h=a.PageUrlService.datasetPage(c.datasetId,c.variableType),i=a.PageUrlService.variablePage(c.id),j=c.attributes.filter(function(a){return"label"===a.name}),k=j&&j.length>0?a.localize(j[0].values):"",l=new Array({link:void 0,value:c.id},{link:i||h,value:c.name},{link:void 0,value:k},{link:void 0,value:c.variableType},{link:f,value:d},{link:h,value:g});b.rows.push(l)})),b},b.$inject=["PageUrlService","LocalizedValues","SetService","AnalysisConfigService","$translate","$log","$scope","$uibModal"],b}(DocumentsSetTableComponentController),CartDocumentsTableComponent=function(){function a(){this.transclude=!0,this.bindings={documents:"<",onPageChange:"<",onUpdate:"<",options:"<",type:"<"},this.controller=CartDocumentsTableController,this.controllerAs="$ctrl",this.templateUrl="sets/components/cart-documents-table/component.html"}return a}();ngObibaMica.sets.component("cartDocumentsTable",new CartDocumentsTableComponent);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),VariablesSetTableComponentController=function(a){function b(b,c,d,e,f,g,h){var i=a.call(this,b,c,d,h)||this;return i.SetService=b,i.AnalysisConfigService=c,i.$log=d,i.$translate=e,i.PageUrlService=f,i.LocalizedValues=g,i.$uibModal=h,b.serverConfig().then(function(a){i.micaConfigShowAnalysis=a.isSetsAnalysisEnabled,i.micaConfigShowSearch=a.isSetsSearchEnabled,i.micaConfigShowOpalViews=a.downloadOpalViewsFromSetsAllowed}),i}return __extends(b,a),b.prototype.$onChanges=function(a){void 0!==a.setId&&(this.allSelected=!1,this.allPageSelected={},this.selections={}),this.table=this.asTable(),this.localizedTotal=this.LocalizedValues.formatNumber(this.documents&&this.documents.total?this.documents.total:0)},b.prototype.localize=function(a){return this.LocalizedValues.forLang(a,this.$translate.use())},b.prototype.asTable=function(){var a=this,b={rows:new Array};this.pagination.totalHits=this.documents?this.documents.total:0,this.pagination.currentPage=this.documents?this.documents.from/this.documents.limit+1:0,this.pagination.itemsPerPage=this.documents?this.documents.limit:0,this.pagination.pageCount=Math.ceil(this.pagination.totalHits/this.pagination.itemsPerPage),this.pagination.from=this.documents?this.documents.from+1:0;var c=this.documents&&this.documents[this.type]?this.documents[this.type].length:0;return this.pagination.to=this.documents?this.documents.from+c:0,c&&(this.allSelected&&(this.allPageSelected[this.pagination.currentPage]=!0),this.documents[this.type].forEach(function(c){a.allSelected&&(a.selections[c.id]=!0);var d=a.localize(c.studySummary.acronym),e=(a.localize(c.studySummary.name),"Dataschema"===c.variableType?"harmonization":"individual"),f=a.PageUrlService.studyPage(c.studyId,e),g=a.localize(c.datasetName),h=a.PageUrlService.datasetPage(c.datasetId,c.variableType),i=a.PageUrlService.variablePage(c.id),j=c.attributes.filter(function(a){return"label"===a.name}),k=j&&j.length>0?a.localize(j[0].values):"",l=new Array({link:void 0,value:c.id},{link:i||h,value:c.name},{link:void 0,value:k},{link:void 0,value:c.variableType},{link:f,value:d},{link:h,value:g});b.rows.push(l)})),b},b.$inject=["SetService","AnalysisConfigService","$log","$translate","PageUrlService","LocalizedValues","$uibModal"],b}(DocumentsSetTableComponentController),DocumentSetTableComponent=function(){function a(){this.transclude=!0,this.bindings={documents:"<",onPageChange:"<",onUpdate:"<",options:"<",setId:"<",type:"<"},this.controller=VariablesSetTableComponentController,this.controllerAs="$ctrl",this.templateUrl="sets/components/set-variables-table/component.html"}return a}();angular.module("obiba.mica.sets").component("setVariablesTable",new DocumentSetTableComponent),function(){function a(a,b,c,d,e){var f=d+"_micaHideHelpText";b([e]).then(function(b){a.options[d]||c.get(f)||(a.options[d]=b[e])}),a.closeHelpBox=function(){c.put(f,!0),a.options[d]=null},c.get(f)&&(a.options[d]=null)}ngObibaMica.sets.controller("CartController",["$scope","$location","$translate","$cookies","SetService","ngObibaMicaSetsTemplateUrl","AlertService","ngObibaMicaUrl","ObibaSearchOptions",function(b,c,d,e,f,g,h,i,j){function k(a,b,c){SetsAlertBuilder.newBuilder(h).withId(a).withName(b).withCount(c).withMsgKey("sets.set.variables-added").withEmptyMsgKey("sets.set.no-variable-added").withRedirectUrl(i.getUrl("SetsPage")).showAlert()}b.options=f.setGettingOption(),a(b,d,e,"CartHelpText","sets.cart.help"),b.cartHeaderTemplateUrl=g.getHeaderUrl("cart"),b.loading=!0;var l=100,m=function(a){b.loading=!1,b.variables=a},n=f.getCartDocuments("variables",0,l);n?n.then(m):b.variables={total:0};var o={variable:j.variables.showSearchTab};b.tabs=j.targetTabsOrder.filter(function(a){return o[a]}).map(function(a){var b=targetToType(a);return{type:b,options:j[b]}}),b.$on("cart-cleared",function(a,c){b.loading=!0,f.getCartDocuments(c,0,l).then(m)}),b.onPaginate=function(a,b){f.getCartDocuments(a,b,l).then(m)},b.onUpdate=k}]).controller("VariableToCartController",["$scope","SetService","AlertService","ngObibaMicaUrl",function(a,b,c,d){a.canBeAdded=!1,a.canBeRemoved=!1,a.loading=!0,a.onInit=function(c){b.serverConfig().then(function(d){var e=d.isCartEnabled&&d.currentUserCanCreateCart;b.isDocumentInCart("variables",c).then(function(){a.loading=!1,a.canBeRemoved=e}).catch(function(){a.loading=!1,a.canBeAdded=e})})},a.onAdd=function(e){a.loading=!0;var f=b.getCartSet("variables");b.addDocumentToCart("variables",e).then(function(b){a.loading=!1;var e=b.count-(f?f.count:0);a.canBeRemoved=e>0,a.canBeAdded=!a.canBeRemoved,SetsAlertBuilder.newBuilder(c).withCount(e).withMsgKey("sets.cart.variable-added").withEmptyMsgKey("sets.cart.no-variable-added").withRedirectUrl(d.getUrl("CartPage")).showAlert()}).catch(function(){a.loading=!1})},a.onRemove=function(e){a.loading=!0;var f=b.getCartSet("variables");b.removeDocumentFromCart("variables",e).then(function(b){a.loading=!1;var e=(f?f.count:0)-b.count;a.canBeAdded=e>0,a.canBeRemoved=!a.canBeAdded,SetsAlertBuilder.newBuilder(c).withCount(e).withMsgKey("sets.cart.variable-removed").withEmptyMsgKey("sets.cart.no-variable-removed").withRedirectUrl(d.getUrl("CartPage")).showAlert()}).catch(function(){a.loading=!1})}}]).controller("SetsController",["$rootScope","$scope","$route","$location","$cookies","$translate","ObibaSearchOptions","ngObibaMicaSetsTemplateUrl","MetaTaxonomyService","SetsResource","SetResource","SetService","NOTIFICATION_EVENTS","AlertService","ngObibaMicaUrl","ServerErrorUtils",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,b){return(a||[]).filter(function(a){return a.id===b}).pop()}function s(){j.getMetaTaxonomyForTargets(["variable"]).then(function(a){c.useableTabs=a,a.forEach(function(a){k.query({type:targetToType(a.name)}).$promise.then(function(a){return a.filter(function(a){return a.name})}).then(function(b){c.sets[a.name]=b;var f=c.selectedSet.id,g=r(b,f);if(g)v(g.id);else if(!g){var h=d.current.params.id&&d.current.params.id!==f?d.current.params.id:null,i=null;h?i=h:b.length>0?i=b[0].id:(c.selectedSet={},u(),e.search("id",null),t()),v(i)}}).catch(function(a){o.alert({id:"MainController",type:"danger",msg:q.buildMessage(a)})})})})}function t(){H&&u(),H=c.$on("$locationChangeSuccess",function(){return v(d.current.params.id)})}function u(){H&&(H(),H=void 0)}function v(a){if(a){var b=Object.keys(c.sets).reduce(function(a,b){return a.concat(c.sets[b])},[]).find(function(b){return b.id===a});b?w(b.type.toLowerCase(),b):(u(),t(),c.selectedSet.id===a&&(c.selectedSet={}),e.search("id",c.selectedSet.id))}}function w(a,b){c.loading=!0,c.selectedType=targetToType(a),c.selectedSet=b,u(),e.search("id",b.id),t();var d=m.getSetDocuments(c.selectedSet.id,c.selectedType,0,J);d?d.then(x):c.documents={total:0}}function x(a){c.loading=!1,c.documents=a,c.selectedSet.count=a.total}function y(a,b,c,d,e,f){var g=d,h=[f,a,c,b];0===c&&(g=e,h=[]),o.growl({id:"MainControllerGrowl",type:"info",msgKey:g,msgArgs:h,delay:4e3})}function z(a,b,c){y(a,b,c,"sets.set.variables-added","sets.set.no-variable-added",p.getUrl("SetsPage")),s()}function A(a,b){c.selectedSet&&m.getSetDocuments(c.selectedSet.id,a,b,J).then(x)}function B(a){return Object.keys(c.checked[a]).filter(function(b){return c.checked[a][b]})}function C(a){return c.checked[a]&&B(a).length>0}function D(a,b){B(b).reduce(function(a,c){return void 0===a||null===a?l.delete({id:c,type:targetToType(b)}).$promise:a.then(function(){return l.delete({id:c,type:targetToType(b)}).$promise})},null).then(function(){G(b),s()}),c.onDeleteConfirmed()}function E(a){b.$broadcast(n.showConfirmDialog,{titleKey:"sets.delete-dialog.title",messageKey:"sets.delete-dialog.message"},a),c.onDeleteConfirmed=c.$on(n.confirmDialogAccepted,D)}function F(a){c.canDelete[a]=C(a)}function G(a){c.checked[a]={},c.documents={total:0},F(a)}c.options=m.setGettingOption(),a(c,g,f,"SetsHelpText","sets.set.help");var H,I={variable:h.variables.showSearchTab},J=100;c.setsHeaderTemplateUrl=i.getHeaderUrl("sets"),c.tabs=h.targetTabsOrder.filter(function(a){return I[a]}).map(function(a){var b=targetToType(a);return{type:b,options:h[b]}}),c.sets={},c.checked={},c.canDelete={},c.selectedSet={},s(),c.check=F,c.deleteChecked=E,c.canDeleteChecked=C,c.onUpdate=z,c.onPaginate=A,c.selectSet=w}])}(),ngObibaMica.sets.config(["$routeProvider",function(a){var b=["ngObibaMicaSearch",function(a){return a.getOptionsAsyn()}];a.when("/cart",{templateUrl:"sets/views/cart.html",controller:"CartController",reloadOnSearch:!1,resolve:{ObibaSearchOptions:b}}).when("/sets",{templateUrl:"sets/views/sets.html",controller:"SetsController",reloadOnSearch:!1,resolve:{ObibaSearchOptions:b}})}]);var DISPLAY_TYPES={LIST:"list",COVERAGE:"coverage",GRAPHICS:"graphics"};ngObibaMica.search=angular.module("obiba.mica.search",["obiba.alert","ui.bootstrap","pascalprecht.translate","ngclipboard","templates-ngObibaMica","obiba.mica.sets"]),function(){ngObibaMica.search.run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}])}(),function(){function a(){function a(a){return a?a.filter(function(a){return c.indexOf(a)>-1}):null}function b(){function a(a,b){var c=a.indexOf(b);return c>-1&&a.splice(c,1),a}f.coverage.groupBy.dce=f.coverage.groupBy.study&&f.coverage.groupBy.dce,Object.keys(f.coverage.groupBy).filter(function(a){return f.coverage.groupBy[a]}).length>0||a(f.searchTabsOrder,DISPLAY_TYPES.COVERAGE),f.networks.showSearchTab||(a(f.targetTabsOrder,QUERY_TARGETS.NETWORK),a(f.resultTabsOrder,QUERY_TARGETS.NETWORK)),f.studies.showSearchTab||(a(f.searchTabsOrder,DISPLAY_TYPES.GRAPHICS),a(f.targetTabsOrder,QUERY_TARGETS.STUDY),a(f.resultTabsOrder,QUERY_TARGETS.STUDY))}function d(c){f=angular.merge(f,c),f.targetTabsOrder=c.targetTabsOrder||f.targetTabsOrder,f.searchTabsOrder=c.searchTabsOrder||f.searchTabsOrder,f.resultTabsOrder=c.resultTabsOrder||f.resultTabsOrder,f.showCopyQuery=c.showCopyQuery||f.showCopyQuery,f.variableTaxonomiesOrder=c.variableTaxonomiesOrder||f.variableTaxonomiesOrder,f.studyTaxonomiesOrder=c.studyTaxonomiesOrder||f.studyTaxonomiesOrder,f.datasetTaxonomiesOrder=c.datasetTaxonomiesOrder||f.datasetTaxonomiesOrder,f.networkTaxonomiesOrder=c.networkTaxonomiesOrder||f.networkTaxonomiesOrder,f.hideNavigate=c.hideNavigate||f.hideNavigate,f.hideSearch=c.hideSearch||f.hideSearch,f.studies.fields=c.studies&&c.studies.fields||f.studies.fields,f.networks.fields=c.networks&&c.networks.fields||f.networks.fields,f.datasets.fields=c.datasets&&c.datasets.fields||f.datasets.fields,c.taxonomyPanelOptions&&(f.taxonomyPanelOptions.fieldsToFilter=a(c.taxonomyPanelOptions.fieldsToFilter)||f.taxonomyPanelOptions.fieldsToFilter),c.studies&&c.studies.obibaListOptions&&(f.obibaListOptions.countCaption=0!==c.studies.obibaListOptions.studiesCountCaption||c.studies.obibaListOptions.studiesCountCaption,f.obibaListOptions.searchForm=0!==c.studies.obibaListOptions.studiesSearchForm||c.studies.obibaListOptions.studiesSearchForm,f.obibaListOptions.supplInfoDetails=0!==c.studies.obibaListOptions.studiesSupplInfoDetails||c.studies.obibaListOptions.studiesSupplInfoDetails,f.obibaListOptions.trimmedDescription=0!==c.studies.obibaListOptions.studiesTrimmedDescription||c.studies.obibaListOptions.studiesTrimmedDescription,f.searchLayout=c.searchLayout?c.searchLayout:f.searchLayout),b()}function e(){return angular.copy(f)}var f={searchLayout:"layout2",taxonomyPanelOptions:{network:{taxonomies:{Mica_network:{trKey:"properties"}}},study:{taxonomies:{Mica_study:{trKey:"properties"}}},dataset:{taxonomies:{Mica_dataset:{trKey:"properties"}}},variable:{taxonomies:{Mica_variable:{trKey:"properties"}}},fieldsToFilter:c},obibaListOptions:{countCaption:!0,searchForm:!0,supplInfoDetails:!0,trimmedDescription:!0},targetTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],searchTabsOrder:[DISPLAY_TYPES.LIST,DISPLAY_TYPES.COVERAGE,DISPLAY_TYPES.GRAPHICS],resultTabsOrder:[QUERY_TARGETS.VARIABLE,QUERY_TARGETS.DATASET,QUERY_TARGETS.STUDY,QUERY_TARGETS.NETWORK],showAllFacetedTaxonomies:!0,showFacetTermsWithZeroCount:!1,showSearchBox:!0,showSearchBrowser:!0,showCopyQuery:!0,showSearchRefreshButton:!1,variableTaxonomiesOrder:[],studyTaxonomiesOrder:[],datasetTaxonomiesOrder:[],networkTaxonomiesOrder:[],hideNavigate:[],hideSearch:["studyId","dceId","datasetId","networkId"],variables:{showSearchTab:!0,listPageSize:20,variablesColumn:{showVariablesTypeColumn:!0,showVariablesStudiesColumn:!0,showVariablesDatasetsColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0},showCart:!0},datasets:{showSearchTab:!0,listPageSize:20,showDatasetsSearchFilter:!0,datasetsColumn:{showDatasetsAcronymColumn:!0,showDatasetsTypeColumn:!0,showDatasetsNetworkColumn:!0,showDatasetsStudiesColumn:!0,showDatasetsVariablesColumn:!0},fields:["acronym.*","name.*","variableType","studyTable.studyId","studyTable.project","studyTable.table","studyTable.populationId","studyTable.dataCollectionEventId","harmonizationTable.studyId","harmonizationTable.project","harmonizationTable.table","harmonizationTable.populationId"]},studies:{showSearchTab:!0,listPageSize:20,showStudiesSearchFilter:!0,studiesColumn:{showStudiesTypeColumn:!0,showStudiesDesignColumn:!0,showStudiesQuestionnaireColumn:!0,showStudiesPmColumn:!0,showStudiesBioColumn:!0,showStudiesOtherColumn:!0,showStudiesParticipantsColumn:!0,showStudiesNetworksColumn:!0,showStudiesStudyDatasetsColumn:!0,showStudiesHarmonizationDatasetsColumn:!0,showStudiesVariablesColumn:!1,showStudiesStudyVariablesColumn:!0,showStudiesDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","model.methods.design","populations.dataCollectionEvents.model.dataSources","model.numberOfParticipants.participant"]},networks:{showSearchTab:!0,listPageSize:20,networksColumn:{showNetworksStudiesColumn:!0,showNetworksStudyDatasetColumn:!0,showNetworksHarmonizationDatasetColumn:!0,showNetworksVariablesColumn:!1,showNetworksStudyVariablesColumn:!0,showNetworksDataschemaVariablesColumn:!0},fields:["acronym.*","name.*","studyIds"]},coverage:{groupBy:{study:!0,dce:!0,dataset:!0}}};this.setOptions=d,this.getOptions=e}function b(a,b,c,d){function e(){var e=c.getOptions();return g?a.when(c.getOptions()):(d.get(function(a){var d=a.isNetworkEnabled&&!a.isSingleNetworkEnabled,h=!a.isSingleStudyEnabled||a.isHarmonizedDatasetEnabled,i=a.isCollectedDatasetEnabled||a.isHarmonizedDatasetEnabled,j={searchLayout:a.searchLayout,locale:a.languages||b.use(),showSearchRefreshButton:!0,networks:{showSearchTab:d},studies:{showSearchTab:h,studiesColumn:{showStudiesTypeColumn:!1!==(a.isCollectedDatasetEnabled&&a.isHarmonizedDatasetEnabled)&&e.studies.studiesColumn.showStudiesTypeColumn,showStudiesNetworksColumn:d&&e.studies.studiesColumn.showStudiesNetworksColumn,showStudiesVariablesColumn:i&&e.studies.studiesColumn.showStudiesVariablesColumn,showStudiesStudyDatasetsColumn:!1!==(i&&a.isCollectedDatasetEnabled)&&e.studies.studiesColumn.showStudiesStudyDatasetsColumn,showStudiesStudyVariablesColumn:!1!==(i&&a.isCollectedDatasetEnabled)&&e.studies.studiesColumn.showStudiesStudyVariablesColumn,showStudiesHarmonizationDatasetsColumn:!1!==(i&&a.isHarmonizedDatasetEnabled)&&e.studies.studiesColumn.showStudiesHarmonizationDatasetsColumn,showStudiesDataschemaVariablesColumn:!1!==(i&&a.isHarmonizedDatasetEnabled)&&e.studies.studiesColumn.showStudiesDataschemaVariablesColumn}},datasets:{showSearchTab:i,datasetsColumn:{showDatasetsTypeColumn:a.isCollectedDatasetEnabled&&a.isHarmonizedDatasetEnabled,showDatasetsNetworkColumn:d&&e.datasets.datasetsColumn.showDatasetsNetworkColumn,showDatasetsStudiesColumn:h&&e.datasets.datasetsColumn.showDatasetsStudiesColumn,showDatasetsVariablesColumn:e.datasets.datasetsColumn.showDatasetsVariablesColumn}},variables:{showSearchTab:i,variablesColumn:{showVariablesTypeColumn:!1!==(a.isCollectedDatasetEnabled&&a.isHarmonizedDatasetEnabled)&&e.variables.variablesColumn.showVariablesTypeColumn,showVariablesStudiesColumn:h&&e.variables.variablesColumn.showVariablesStudiesColumn,showVariablesDatasetsColumn:!1!==(a.isCollectedDatasetEnabled||a.isHarmonizedDatasetEnabled)&&e.variables.variablesColumn.showVariablesDatasetsColumn}}};c.setOptions(j),f.resolve(c.getOptions()),g=!0}),f.promise)}var f=a.defer(),g=!1;return{getOptionsAsyn:function(){return e()},getOptions:function(){return c.getOptions()},getDefaultListPageSize:function(a){var b=c.getOptions();switch(a){case QUERY_TARGETS.VARIABLE:return b.variables.listPageSize;case QUERY_TARGETS.DATASET:return b.datasets.listPageSize;case QUERY_TARGETS.STUDY:return b.studies.listPageSize;case QUERY_TARGETS.NETWORK:return b.networks.listPageSize}return 20}}}var c=["name","title","description","keywords"];ngObibaMica.search.config(["$provide",function(c){c.provider("ngObibaMicaSearch",function(){function c(a){d.setOptions(a)}var d=new a;this.initialize=c,this.$get=["$q","$translate","ObibaServerConfigResource",function(a,c,e){return new b(a,c,d,e)}]})}])}(),function(){ngObibaMica.search.config(["$provide",function(a){a.provider("ngObibaMicaSearchTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({search:{header:null,footer:null},searchStudiesResultTable:{template:null},searchNetworksResultTable:{template:null},searchDatasetsResultTable:{template:null},searchCriteriaRegionTemplate:{template:null},vocabularyFilterDetailHeading:{template:null},CriterionDropdownTemplate:{template:null},searchResultList:{template:null},searchInputList:{template:null},searchResultCoverage:{template:null},searchResultGraphics:{template:null},classifications:{header:null,footer:null},searchCellStatValue:{template:null}}))}])}(),CriteriaBuilder.prototype.fieldToVocabulary=function(a){var b={taxonomy:null,vocabulary:null},c=a;a.indexOf(".")<0&&(c="Mica_"+this.target+"."+a);var d=c.split(".",2),e=d[0],f=d[1],g=this.taxonomies.filter(function(a){return e===a.name});if(0===g.length)throw new Error("Could not find taxonomy:",e);b.taxonomy=g[0];var h=b.taxonomy.vocabularies.filter(function(a){return f===a.name});if(0===h.length)throw new Error("Could not find vocabulary:",f);return b.vocabulary=h[0],b},CriteriaBuilder.prototype.visitLeaf=function(a,b){var c=RQL_NODE.MATCH===a.name,d=a.args[c?1:0],e=a.args[c?0:1],f=this.fieldToVocabulary(d),g=this.buildLeafItem(f.taxonomy,f.vocabulary,e instanceof Array?e:[e],a,b),h=this.leafItemMap[g.id];h?h.isRepeatable()?h.addItem(g):(console.error("Non-repeatable criteria items must be unique,",h.id,"will be overwritten."),h=g):h=g.vocabulary.repeatable?(new RepeatableCriteriaItem).addItem(g):g,this.leafItemMap[g.id]=h,b.children.push(g)},CriteriaBuilder.prototype.getRootItem=function(){return this.rootItem},CriteriaBuilder.prototype.getLeafItemMap=function(){return this.leafItemMap},CriteriaBuilder.prototype.visitCondition=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c),this.visit(a.args[1],c)},CriteriaBuilder.prototype.visitNot=function(a,b){var c=this.newCriteriaItemBuilder().parent(b).rqlQuery(a).type(a.name).build();b.children.push(c),this.visit(a.args[0],c)},CriteriaBuilder.prototype.visit=function(a,b){switch(a.name){case RQL_NODE.NOT:this.visitNot(a,b);break;case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:this.visitCondition(a,b);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.LE:case RQL_NODE.LT:case RQL_NODE.GE:case RQL_NODE.GT:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:case RQL_NODE.MATCH:this.visitLeaf(a,b);break;case RQL_NODE.FILTER:}},CriteriaBuilder.prototype.build=function(){var a=this;this.rootRql.args.forEach(function(b){a.visit(b,a.rootItem)})},CriteriaIdGenerator.generate=function(a,b,c){return a&&b?a.name+"."+b.name+(c?"."+c.name:""):void 0},CriteriaItem.prototype.isRepeatable=function(){return!1},CriteriaItem.prototype.getTarget=function(){return this.target||null},CriteriaItem.prototype.getRangeTerms=function(){var a={from:null,to:null};return this.type===RQL_NODE.BETWEEN?(a.from=this.selectedTerms[0],a.to=this.selectedTerms[1]):this.type===RQL_NODE.GE?(a.from=this.selectedTerms[0],a.to=null):this.type===RQL_NODE.LE&&(a.from=null,a.to=this.selectedTerms[0]),a},function(){function a(){}a.reduce=function(b,c){if(b.type===RQL_NODE.OR){var d=b.parent,e=d.children.indexOf(b);d.children[e]=c;var f=b.rqlQuery,g=d.rqlQuery,h=g.args.indexOf(f);g.args[h]=c.rqlQuery,d.type!==QUERY_TARGETS.VARIABLE&&a.reduce(d,c)}else c.type!==RQL_NODE.VARIABLE&&b.type===RQL_NODE.AND&&a.reduce(b.parent,b)},ngObibaMica.search.CriteriaReducer=a}(),RepeatableCriteriaItem.prototype=Object.create(CriteriaItem.prototype),RepeatableCriteriaItem.prototype.isRepeatable=function(){return!0},RepeatableCriteriaItem.prototype.addItem=function(a){return this.list.push(a),this},RepeatableCriteriaItem.prototype.items=function(){return this.list},RepeatableCriteriaItem.prototype.first=function(){return this.list[0]},RepeatableCriteriaItem.prototype.getTarget=function(){return this.list.length>0?this.list[0].getTarget():null},function(){function a(a,b){function c(a){function b(a,c){return c.reduce(function(a,c){return Array.isArray(c.terms)?b(a,c.terms):(a.push(c),a)},a||[])}return b([],a)}function d(a,b){return o.then(function(c){k=[],l=[],a.forEach(function(a){var d=c.vocabularies.filter(function(b){if(b.name===a)return l.push(a),!0}).pop();d&&d.terms&&d.terms.forEach(function(c){c.target=a;var d=c.title.filter(function(a){return a.locale===b})[0],e=c.description?c.description.filter(function(a){return a.locale===b})[0]:void 0;c.locale={title:d,description:e},c.terms&&c.terms.forEach(function(a){var c=a.title.filter(function(a){return a.locale===b})[0],d=a.description?a.description.filter(function(a){return a.locale===b})[0]:void 0;a.locale={title:c,description:d}}),k.push(c)})})})}function e(){return o.then(function(a){m={},n=!1,a.vocabularies.reduce(function(a,b){function d(a){return f.filter(function(b){return b.name===a})[0]}function e(a){return null!==a&&void 0!==a}var f=c(b.terms);return p.showAllFacetedTaxonomies?a[b.name]=f.filter(function(a){return a.attributes&&a.attributes.some(function(a){return"showFacetedNavigation"===a.key&&"true"===a.value.toString()})}):a[b.name]=(p[b.name+"TaxonomiesOrder"]||[]).map(d).filter(e),n=n||a[b.name].length,a},m)})}function f(){return k}function g(){return m}function h(){return l}function i(){return n}function j(a,b){return Promise.all([e(),d(a,b)]).then(function(){return{getTaxonomyNav:f,getFacetedTaxonomies:g,getTabOrderTodisplay:h,getHasFacetedTaxonomies:i}})}var k,l,m,n,o=a.getMetaTaxonomiesPromise(),p=b.getOptions();this.help=j}ngObibaMica.search.service("SearchControllerFacetHelperService",["MetaTaxonomyService","ngObibaMicaSearch",a])}();var AbstractSelectionsDecorator=function(){function a(a){this.documentType=a}return a.prototype.getSelections=function(){return this.component.selections},a.prototype.getSelectionIds=function(){return this.component.selections?Object.keys(this.component.selections):[]},a.prototype.clearSelections=function(){this.component.selections={},this.component.page={selections:{},all:!1}},a.prototype.decorate=function(a){this.component=a,this.component.selections={},this.component.page={selections:{},all:!1}},a}();!function(){var a=[{label:"10",value:10},{label:"20",value:20},{label:"50",value:50},{label:"100",value:100}];ngObibaMica.search.PaginationState=function(a,b){this.target=a,this.initialPageSize=b,this.currentPage=1,this.from=0,this.to=0,this.selected=this.findPageSize(b),this.totalHits=null,this.pageCount=0,this.maxSize=3},ngObibaMica.search.PaginationState.prototype.updateRange=function(){var a=this.selected.value,b=this.currentPage;this.from=a*(b-1)+1,this.to=Math.min(this.totalHits,a*b)},ngObibaMica.search.PaginationState.prototype.initializeCurrentPage=function(a){a&&a.hasOwnProperty("from")?(this.selected=this.findPageSize(a.size),this.currentPage=1+a.from/this.selected.value):(this.selected=this.findPageSize(this.initialPageSize),this.currentPage=1)},ngObibaMica.search.PaginationState.prototype.update=function(a,b){this.totalHits=b||null,this.initializeCurrentPage(a),this.updateRange(),this.updatePageCount(),this.updateMaxSize()},ngObibaMica.search.PaginationState.prototype.findPageSize=function(b){var c=a.filter(function(a){return a.value===b}).pop();return c||a[0]},ngObibaMica.search.PaginationState.prototype.totalHitsChanged=function(a){return null!==this.totalHits&&this.totalHits!==a},ngObibaMica.search.PaginationState.prototype.updatePageCount=function(){this.pageCount=Math.ceil(this.totalHits/this.selected.value)},ngObibaMica.search.PaginationState.prototype.updateMaxSize=function(){this.maxSize=Math.min(3,this.pageCount)},ngObibaMica.search.PaginationState.prototype.data=function(){return{target:this.target,initialPageSize:this.initialPageSize,currentPage:this.currentPage,from:this.from,to:this.to,selected:this.selected,totalHits:this.totalHits,maxSize:this.maxSize,pageCount:this.pageCount,pageSizes:a}}}(),function(){function a(a){var b=0;if(a.attributes){var c=a.attributes.filter(function(a){return"weight"===a.key})[0];b=c?parseInt(c.value)||0:0}return b}ngObibaMica.search.MetaTaxonomyParser=function(b){function c(b,c){return c.map(function(c,d){var e={state:new ngObibaMica.search.PanelTaxonomyState(d+""),info:{name:c.name||"",title:c.title||"",description:c.description||"",weight:a(c)},taxonomies:[c]},f=b.taxonomies[c.name];return f&&f.hasOwnProperty("trKey")&&(e.info.trKey=f.trKey),e})}function d(a,b){return{name:a.name,title:a.title,taxonomies:b}}function e(a){a.sort(function(a,b){return a.info.weight-b.info.weight})}this.config=b,this.parseTerms=c,this.createResultObject=d,this.sortTaxonomies=e},ngObibaMica.search.MetaTaxonomyParser.prototype.parseEntityTaxonomies=function(a){return this.createResultObject(a,this.parseTerms(this.config[a.name],a.terms||[]))},ngObibaMica.search.MetaTaxonomyParser.prototype.parseVariableTaxonomies=function(b){var c=b.terms.filter(function(a){return["Variable_chars","Scales"].indexOf(a.name)>-1}).reduce(function(a,b){return a[(new obiba.utils.NgObibaStringUtils).camelize(b.name)]=b,a},{}),d=this.parseTerms(this.config[QUERY_TARGETS.VARIABLE],c.variableChars.terms),e=c.scales;return e&&e.terms&&d.push({state:new ngObibaMica.search.PanelTaxonomyState,info:{name:e.name,names:e.terms.map(function(a){return a.name}),title:e.title,description:e.description||"",weight:a(e)},taxonomies:e.terms}),this.sortTaxonomies(d),this.createResultObject(b,d)}}(),function(){ngObibaMica.search.PanelTaxonomyState=function(a){var b={NONE:0,ACTIVE:1,LOADING:2};this.id=a,this.STATES=b,this.state=b.NONE},ngObibaMica.search.PanelTaxonomyState.prototype.isLoading=function(){return this.STATES.LOADING===(this.state&this.STATES.LOADING)},ngObibaMica.search.PanelTaxonomyState.prototype.isActive=function(){return this.STATES.ACTIVE===(this.state&this.STATES.ACTIVE)},ngObibaMica.search.PanelTaxonomyState.prototype.active=function(){this.state=this.state|this.STATES.ACTIVE},ngObibaMica.search.PanelTaxonomyState.prototype.inactive=function(){this.state=this.state&~this.STATES.ACTIVE},ngObibaMica.search.PanelTaxonomyState.prototype.loading=function(){this.state=this.state|this.STATES.LOADING},ngObibaMica.search.PanelTaxonomyState.prototype.loaded=function(){this.state=this.state&~this.STATES.LOADING},ngObibaMica.search.PanelTaxonomyState.prototype.none=function(){this.state=this.STATES.NONE}}();var TaxonomyCartFilter=function(){function a(){}return a.filter=function(a,b,c){var d=a.getCartSet(targetToType(b.name.split("Mica_")[1]));(b.vocabularies||[]).filter(function(a){return"sets"===a.name}).forEach(function(a){if(Array.isArray(a.terms)){var b=a.terms.filter(function(a){return d&&a.name===d.id&&c(["sets.cart.title"]).then(function(b){a.title=[{locale:c.use(),text:b["sets.cart.title"]}]}),Array.isArray(a.title)||d&&a.name===d.id});a.terms=b.length>0?b:null}})},a}();!function(){ngObibaMica.search.factory("DocumentSuggestionResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DocumentSuggestion"),{},{query:{method:"GET",errorHandler:!0,isArray:!0}})}])}(),function(){ngObibaMica.search.factory("JoinQueryCoverageResource",["$resource","ngObibaMicaUrl",function(a,b){var c=b.getUrl("JoinQueryCoverageResource"),d=-1===c.indexOf(":query")?"POST":"GET";return a(c,{},{get:{method:d,headers:{"Content-Type":"POST"===d?"application/x-www-form-urlencoded":"application/json"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},errorHandler:!0}})}])}(),function(){ngObibaMica.search.factory("JoinQuerySearchResource",["$resource","ngObibaMicaUrl","$translate","SetService",function(a,b,c,d){var e=b.getUrl("JoinQuerySearchResource"),f=function(a){var b=-1===e.indexOf(":query")?"POST":"GET";return{method:b,headers:{"Content-Type":"POST"===b?"application/x-www-form-urlencoded":"application/json"},errorHandler:!0,params:{type:a},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},transformResponse:function(b){var c,e=JSON.parse(b),f=d.getCartSet(a);return"variables"===a?c=e.variableResultDto:"datasets"===a?c=e.datasetResultDto:"studies"===a?c=e.studyResultDto:"networks"===a&&(c=e.networkResultDto),c&&Array.isArray(c.aggs)&&c.aggs.filter(function(a){return"sets"===a.aggregation}).forEach(function(a){var b=a["obiba.mica.TermsAggregationResultDto.terms"];Array.isArray(b)&&(a["obiba.mica.TermsAggregationResultDto.terms"]=b.filter(function(a){return a.title||a.key===(f||{}).id}))}),e}}};return a(e,{},{variables:f("variables"),studies:f("studies"),networks:f("networks"),datasets:f("datasets")})}])}(),function(){ngObibaMica.search.factory("TaxonomiesResource",["$resource","ngObibaMicaUrl","$cacheFactory","SetService","$translate",function(a,b,c,d,e){return a(b.getUrl("TaxonomiesResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0,cache:c("taxonomiesResource"),transformResponse:function(a){var b=JSON.parse(a);return b.filter(function(a){return a.name.startsWith("Mica_")}).forEach(function(a){TaxonomyCartFilter.filter(d,a,e)}),b}}})}])}(),function(){ngObibaMica.search.factory("TaxonomiesSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("TaxonomiesSearchResource"),{},{get:{method:"GET",isArray:!0,errorHandler:!0}})}])}(),function(){ngObibaMica.search.factory("TaxonomyResource",["$resource","ngObibaMicaUrl","$cacheFactory","SetService","$translate",function(a,b,c,d,e){return a(b.getUrl("TaxonomyResource"),{},{get:{method:"GET",errorHandler:!0,cache:c("taxonomyResource"),transformResponse:function(a){var b=JSON.parse(a);return b.name.startsWith("Mica_")&&!b.name.endsWith("_taxonomy")&&TaxonomyCartFilter.filter(d,b,e),b}}})}])}(),function(){ngObibaMica.search.factory("VocabularyResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("VocabularyResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){function a(a,b,c){var d="micaHideSearchHelpText",e="micaHideClassificationHelpBox";b(["search.help","search.coverage-help"]).then(function(b){a.options.SearchHelpText||c.get(d)||(a.options.SearchHelpText=b["search.help"]),a.options.ClassificationHelpText||c.get(e)||(a.options.ClassificationHelpText=b["classifications.help"])}),a.closeHelpBox=function(){c.put(d,!0),a.options.SearchHelpText=null},a.closeClassificationHelpBox=function(){c.put(e,!0),a.options.ClassificationHelpText=null},c.get(d)&&(a.options.SearchHelpText=null),c.get(e)&&(a.options.ClassificationHelpText=null)}ngObibaMica.search.controller("SearchController",["$timeout","$scope","$rootScope","$location","$translate","$filter","$cookies","ngObibaMicaSearchTemplateUrl","ObibaServerConfigResource","JoinQuerySearchResource","JoinQueryCoverageResource","AlertService","ServerErrorUtils","LocalizedValues","RqlQueryService","RqlQueryUtils","SearchContext","CoverageGroupByService","VocabularyService","EntitySuggestionRqlUtilityService","SearchControllerFacetHelperService","options","PaginationService",function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){function y(){function a(a){var b=e.search()[a];return b&&b.split(",").filter(function(a){return a}).map(function(a){return a.trim()})}var b=a("targetTabsOrder");c.targetTabsOrder=(b||c.options.targetTabsOrder).filter(function(a){return S[a]});var d=a("searchTabsOrder");c.searchTabsOrder=d||c.options.searchTabsOrder;var f=a("resultTabsOrder");c.resultTabsOrder=(f||c.options.resultTabsOrder).filter(function(a){return S[a]}),e.search().target?c.target=e.search().target:c.target||(c.target=c.targetTabsOrder[0])}function z(a){c.search.result={},c.search.loading=!1,m.alert({id:"SearchController",type:"danger",msg:n.buildMessage(a),delay:5e3})}function A(){return"layout2"===c.search.layout||c.search.query}function B(a){if(!a||!QUERY_TYPES[a.toUpperCase()])throw new Error("Invalid type: "+a)}function C(a){if(a&&(!BUCKET_TYPES[a.replace("-","_").toUpperCase()]||!s.canGroupBy(a)))throw new Error("Invalid bucket "+a)}function D(a){if(!a||!DISPLAY_TYPES[a.toUpperCase()])throw new Error("Invalid display: "+a)}function E(){return c.taxonomyTypeMap[c.resultTabsOrder[0]]}function F(){return c.searchTabsOrder[0]||DISPLAY_TYPES.LIST}function G(a){return a.listLayout?a.listLayout:a.searchLayout?a.searchLayout:"layout2"}function H(){try{var a=e.search(),b=c.resultTabsOrder.indexOf(T[a.type])>-1?a.type:E(),d=a.bucket&&s.canGroupBy(a.bucket)?a.bucket:s.defaultBucket(),f=c.searchTabsOrder.indexOf(a.display)>-1?a.display:F(),g=a.query||"";return B(b),C(d),D(f),c.search.type=b,c.search.bucket=d,c.search.display=f,c.search.query=g,c.search.rqlQuery=p.parseQuery(g),c.search.layout=I(a.layout?a.layout:G(c.options)),!0}catch(a){m.alert({id:"SearchController",type:"danger",msg:a.message,delay:5e3})}return!1}function I(a){return a&&["layout1","layout2"].indexOf(a)>-1?a:"layout2"}function J(a){a.sort(function(a,b){return"network"===a.target||"variable"===b.target?-1:"variable"===a.target||"network"===b.target?1:a.target<b.target?1:a.target>b.target?-1:0})}function K(){function a(){var a=p.getTargetQuerySort(c.search.type,c.search.rqlQuery),b=a&&a.args?a.args:null;return b||(b=c.search.type===QUERY_TYPES.VARIABLES?SORT_FIELDS.NAME:SORT_FIELDS.ACRONYM,c.search.type===QUERY_TYPES.VARIABLES?b=[SORT_FIELDS.VARIABLE_TYPE,SORT_FIELDS.CONTAINER_ID,SORT_FIELDS.POPULATION_WEIGHT,SORT_FIELDS.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.DATASET_ID,SORT_FIELDS.INDEX,SORT_FIELDS.NAME]:c.search.type===QUERY_TYPES.DATASETS&&(b=[SORT_FIELDS.STUDY_TABLE.STUDY_ID,SORT_FIELDS.STUDY_TABLE.POPULATION_WEIGHT,SORT_FIELDS.STUDY_TABLE.DATA_COLLECTION_EVENT_WEIGHT,SORT_FIELDS.ACRONYM])),b}function d(a){return{studyTotalCount:{total:a.studyResultDto.totalCount,hits:a.studyResultDto.totalHits},datasetTotalCount:{total:a.datasetResultDto.totalCount,hits:a.datasetResultDto.totalHits},variableTotalCount:{total:a.variableResultDto.totalCount,hits:a.variableResultDto.totalHits},networkTotalCount:{total:a.networkResultDto.totalCount,hits:a.networkResultDto.totalHits}}}if("/search"===e.path()){var f=p.prepareSearchQueryAndSerialize(c.search.display,c.search.type,c.search.rqlQuery,c.lang,a());switch(c.search.display){case DISPLAY_TYPES.LIST:c.search.loading=!0,c.search.executedQuery=f,k[c.search.type]({query:f},function(a){c.search.result.list=a,c.search.loading=!1,c.search.countResult=d(a),b(function(){var a=p.getQueryPaginations(c.search.rqlQuery);x.update(a,c.search.countResult)})},z);break;case DISPLAY_TYPES.COVERAGE:Object.keys(c.search.criteriaItemMap).map(function(a){return c.search.criteriaItemMap[a]}).filter(function(a){return QUERY_TARGETS.VARIABLE===a.getTarget()&&"Mica_variable"!==a.taxonomy.name}).length>0?(c.search.loading=!0,c.search.executedQuery=p.prepareCoverageQuery(f,c.search.bucket),l.get({query:c.search.executedQuery},function(a){c.search.result.coverage=a,c.search.loading=!1,c.search.countResult=a.totalCounts},z)):c.search.result={};break;case DISPLAY_TYPES.GRAPHICS:c.search.loading=!0,c.search.executedQuery=p.prepareGraphicsQuery(f,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"]),k.studies({query:c.search.executedQuery},function(a){c.search.result.graphics=a,c.search.loading=!1,c.search.countResult=d(a)},z)}}}function L(a,b){Array.isArray(b)?b.forEach(function(b){b.vocabularies.forEach(function(d){d.existingItem=p.findCriteriaItemFromTreeById(a,CriteriaIdGenerator.generate(b,d),c.search.criteria,!0)})}):b.vocabularies.forEach(function(d){d.existingItem=p.findCriteriaItemFromTreeById(a,CriteriaIdGenerator.generate(b,d),c.search.criteria,!0)})}function M(){H()&&p.createCriteria(c.search.rqlQuery,c.lang).then(function(a){c.search.criteria=a.root,c.search.criteria&&c.search.criteria.children&&J(c.search.criteria.children),c.search.criteriaItemMap=a.map,A()&&K(),c.search.selectedTarget&&c.search.selectedTaxonomy&&L(c.search.selectedTarget,c.search.selectedTaxonomy),c.$broadcast("ngObibaMicaQueryUpdated",c.search.criteria)})}function N(a,b,d){function e(a){a?(t.isNumericVocabulary(d)&&(d.rangeTerms=a.getRangeTerms()),t.isMatchVocabulary(d)&&(d.matchString=a.selectedTerms.join("")),d.wholeVocabularyIsSelected=["exists","match"].indexOf(a.type)>-1,(d.terms||[]).forEach(function(b){b.selected="exists"===a.type||a.selectedTerms.indexOf(b.name)>-1})):(d.rangeTerms={},d.matchString=null,d.wholeVocabularyIsSelected=!1,(d.terms||[]).forEach(function(a){a.selected=!1})),d._existingItem=a}d.__defineSetter__("existingItem",e),d.__defineGetter__("existingItem",function(){return d._existingItem}),d.existingItem=p.findCriteriaItemFromTreeById(a,CriteriaIdGenerator.generate(b,d),c.search.criteria,!0)}function O(a,b){a&&b&&(Array.isArray(b)?b.forEach(function(b){b.vocabularies.forEach(function(c){N(a,b,c)})}):b.vocabularies.forEach(function(c){N(a,b,c)})),c.search.selectedTarget=a,c.search.selectedTaxonomy=b,c.search.showTaxonomyPanel=null!==b,c.search.showTaxonomyPanel||K()}function P(a,b,c){if(b!==c)try{C(e.search().bucket),M()}catch(a){var d=s.defaultBucket();e.search("bucket",d).replace()}}function Q(a,b,d){var e=c.search.rqlQuery,f=p.findTargetQuery(a,e);f||(f=new RqlQuery(a),e.push(f));var g;d&&(g=ha.get(a));var h=u.createMatchQuery(b,g);if(h){var i=u.givenTargetQueryGetFilterQuery(f);if(i){var j=u.givenFilterQueryGetMatchQuery(i);j?j.args=h.args:i.push(h)}else f.push(new RqlQuery(RQL_NODE.FILTER).push(h))}else u.removeFilteredMatchQueryFromTargetQuery(f);X()}function R(){c.taxonomyNav=[],c.lang=f.use(),r.setLocale(c.lang),y(),v.help(c.targetTabsOrder,c.lang).then(function(a){c.facetedTaxonomies=a.getFacetedTaxonomies(),c.hasFacetedTaxonomies=a.getHasFacetedTaxonomies(),c.targetTabsOrder=a.getTabOrderTodisplay(),c.taxonomyNav=a.getTaxonomyNav()}),M()}c.options=w,a(c,f,h),c.taxonomyTypeMap={variable:"variables",study:"studies",network:"networks",dataset:"datasets"},f(["search.classifications-title","search.classifications-link","search.faceted-navigation-help"]).then(function(a){c.hasClassificationsTitle=a["search.classifications-title"],c.hasClassificationsLinkLabel=a["search.classifications-link"],c.hasFacetedNavigationHelp=a["search.faceted-navigation-help"]});var S={variable:c.options.variables.showSearchTab,dataset:c.options.datasets.showSearchTab,study:c.options.studies.showSearchTab,network:c.options.networks.showSearchTab},T=Object.keys(c.taxonomyTypeMap).reduce(function(a,b){return a[c.taxonomyTypeMap[b]]=b,a},{});c.lang=f.use();var U=function(){var a=e.search();delete a.query,e.search(a)},V=function(){c.search.advanced=!c.search.advanced},W=function(){for(var a=c.search.criteria.children||[],b=a.length;b--;)for(var d=a[b].children||[],e=d.length;e--;)if(d[e].type===RQL_NODE.OR||d[e].type===RQL_NODE.AND)return!0};d.$on("$translateChangeSuccess",function(a,b){b.language!==r.currentLocale()&&(c.lang=f.use(),r.setLocale(c.lang),M())});var X=function(){var a=(new RqlQuery).serializeArgs(c.search.rqlQuery.args),b=e.search();""===a?delete b.query:b.query=a,e.search(b)},Y=function(){var a=(new RqlQuery).serializeArgs(c.search.rqlQuery.args),b=e.search();""===a?delete b.query:b.query=a,e.search(b).replace()},Z=function(a){p.removeCriteriaItem(a),X()},$=function(a,b,d,e,f){if(angular.isUndefined(e)&&(e=!0),a.id){var h,i=CriteriaIdGenerator.generate(a.taxonomy,a.vocabulary),j=p.findCriteriaItemFromTree(a,c.search.criteria);j&&-1!==i.indexOf("dceId")&&f?(Z(j),h="search.criterion.updated",p.addCriteriaItem(c.search.rqlQuery,a,b)):j?(h="search.criterion.updated",p.updateCriteriaItem(j,a,d)):(h="search.criterion.created",p.addCriteriaItem(c.search.rqlQuery,a,b)),e&&m.growl({id:"SearchControllerGrowl",type:"info",msgKey:h,msgArgs:[o.forLocale(a.vocabulary.title,c.lang),g("translate")("taxonomy.target."+a.target)],delay:3e3}),X()}},_=function(a){if(a){B(a);var b=e.search();b.type=a,b.display=DISPLAY_TYPES.LIST,e.search(b)}},aa=function(a){if(a){C(a);var b=e.search();b.bucket=a,e.search(b)}},ba=function(a,b,d,e){c.search.rqlQuery=c.search.rqlQuery||new q(RQL_NODE.AND),p.prepareQueryPagination(c.search.rqlQuery,a,b,d),e?Y():X()},ca=function(a){if(a){D(a);var b=e.search();b.display=a,e.search(b)}},da=function(a,b,d,e,f,g){if(b&&_(b),e){var h=p.findCriteriaItemFromTree(a,c.search.criteria);h&&ngObibaMica.search.CriteriaReducer.reduce(h.parent,h)}ca(d&&c.search.display?c.search.display:DISPLAY_TYPES.LIST),$(a,RQL_NODE.AND,!0,f,g)},ea=function(a){var b=p.findCriterion(c.search.criteria,a.id);Z(b)},fa=function(a,b,d,e){if(e=e||{},e.text&&(e.text=e.text.replace(/[^a-zA-Z0-9*" _-]/g,"")),angular.isString(e)&&(e={term:e}),d){var f;if(t.isNumericVocabulary(d))return f=p.createCriteriaItem(a,b,d,null,c.lang),f.rqlQuery=q.buildRqlQuery(f),q.updateRangeQuery(f.rqlQuery,e.from,e.to),void $(f,null,!0);if(t.isMatchVocabulary(d))return f=p.createCriteriaItem(a,b,d,null,c.lang),f.rqlQuery=q.buildRqlQuery(f),q.updateMatchQuery(f.rqlQuery,e.text),void $(f,null,!0)}if("layout1"===w.searchLayout)$(p.createCriteriaItem(a,b,d,e&&e.term,c.lang));else{var g=d.terms.filter(function(a){return a.selected}).map(function(a){return a.name}),h=p.findCriterion(c.search.criteria,CriteriaIdGenerator.generate(b,d));if(h&&e.term){if(h.rqlQuery.name=RQL_NODE.IN,e.term.selected)h.rqlQuery=q.mergeInQueryArgValues(h.rqlQuery,[e.term.name]);else{var i=h.rqlQuery.args[1]||[];h.type===RQL_NODE.EXISTS&&(i=h.vocabulary.terms.map(function(a){return a.name}));var j=i.indexOf(e.term.name);i=Array.isArray(i)?i:[i],j>-1?(i.splice(j,1),0===i.length&&(h.rqlQuery.name=RQL_NODE.EXISTS)):i.push(e.term.name),h.rqlQuery=q.mergeInQueryArgValues(h.rqlQuery,i)}d.terms.length>1&&g.length===d.terms.length&&(h.rqlQuery.name=RQL_NODE.EXISTS,h.rqlQuery.args.pop()),c.refreshQuery()}else{var k=d.terms.length>1&&g.length===d.terms.length;$(p.createCriteriaItem(a,b,d,!k&&e&&e.term,c.lang))}}},ga={SEARCH:"search",CLASSIFICATION:"classification"},ha=new Map([[QUERY_TARGETS.NETWORK,["acronym","name"]],[QUERY_TARGETS.STUDY,["acronym","name"]],[QUERY_TARGETS.DATASET,["acronym","name"]],[QUERY_TARGETS.VARIABLE,["name","label"]]]);c.searchSuggestion=Q,c.goToSearch=function(){c.viewMode=ga.SEARCH,e.search("taxonomy",null),e.search("vocabulary",null),e.search("target",null),e.path("/search")},c.goToClassifications=function(){c.viewMode=ga.CLASSIFICATION,e.path("/classifications"),e.search("target",c.targetTabsOrder[0])},c.navigateToTarget=function(a){e.search("target",a),e.search("taxonomy",null),e.search("vocabulary",null),c.target=a},c.QUERY_TYPES=QUERY_TYPES,c.BUCKET_TYPES=BUCKET_TYPES,c.search={layout:"layout2",query:null,advanced:!1,rqlQuery:new RqlQuery,executedQuery:null,type:null,bucket:null,result:{list:null,coverage:null,graphics:null},criteria:[],criteriaItemMap:{},loading:!1},c.viewMode=ga.SEARCH,c.searchHeaderTemplateUrl=i.getHeaderUrl("search"),c.classificationsHeaderTemplateUrl=i.getHeaderUrl("classifications"),c.onTaxonomyFilterPanelToggleVisibility=O,c.selectDisplay=ca,c.selectCriteria=$,c.removeCriteriaItem=Z,c.refreshQuery=X,c.clearSearchQuery=U,c.toggleSearchQuery=V,c.showAdvanced=W,c.onTypeChanged=_,c.onBucketChanged=aa,c.onDisplayChanged=ca,c.onUpdateCriteria=da,c.onRemoveCriteria=ea,c.onSelectTerm=fa,c.QUERY_TARGETS=QUERY_TARGETS,c.onPaginate=ba,c.canExecuteWithEmptyQuery=A,c.inSearchMode=function(){return c.viewMode===ga.SEARCH},c.toggleFullscreen=function(){c.isFullscreen=!c.isFullscreen},c.isSearchAvailable=!0,j.get(function(a){c.isSearchAvailable=!a.isSingleStudyEnabled||a.isNetworkEnabled&&!a.isSingleNetworkEnabled||a.isCollectedDatasetEnabled||a.isHarmonizedDatasetEnabled}),c.unbindLocationChange=c.$on("$locationChangeSuccess",P),d.$on("ngObibaMicaSearch.fullscreenChange",function(a,b){c.isFullscreen=b}),d.$on("ngObibaMicaSearch.sortChange",function(a,b){c.search.rqlQuery=p.prepareSearchQueryNoFields(c.search.display,c.search.type,c.search.rqlQuery,c.lang,b),X()}),d.$on("ngObibaMicaSearch.searchSuggestion",function(a,b,c,d){Q(c,b,d)}),R()}]).controller("ResultTabsOrderCountController",[function(){}])}(),ngObibaMica.search.config(["$routeProvider",function(a){var b=["ngObibaMicaSearch",function(a){return a.getOptionsAsyn()}];a.when("/search",{templateUrl:"search/views/search-layout.html",controller:"SearchController",reloadOnSearch:!1,resolve:{options:b}}).when("/classifications",{templateUrl:"search/views/classifications.html",controller:"SearchController",reloadOnSearch:!1,resolve:{options:b}})}]);var CoverageGroupByService=function(){function a(a){this.options=a.getOptions(),this.groupByOptions=this.options.coverage.groupBy}return a.prototype.isSingleStudy=function(){return!this.options.studies.showSearchTab},a.prototype.canShowStudyType=function(){return this.options.studies.studiesColumn.showStudiesTypeColumn},a.prototype.canShowStudy=function(){return this.groupByOptions.study||this.groupByOptions.dce},a.prototype.canShowDce=function(a){return(a.indexOf("study")>-1||a.indexOf("dce")>-1)&&this.groupByOptions.study&&this.groupByOptions.dce},a.prototype.canShowDataset=function(){return this.groupByOptions.dataset},a.prototype.canShowVariableTypeFilter=function(a){var b=(a.indexOf("study")>-1||a.indexOf("dce")>-1)&&this.groupByOptions.study,c=a.indexOf("dataset")>-1&&this.groupByOptions.dataset;return b||c},a.prototype.studyTitle=function(){return"search.coverage-buckets.study"},a.prototype.studyBucket=function(){return BUCKET_TYPES.STUDY},a.prototype.dceBucket=function(){return this.groupByOptions.study&&this.groupByOptions.dce?BUCKET_TYPES.DCE:this.studyBucket()},a.prototype.datasetTitle=function(){return"search.coverage-buckets.dataset"},a.prototype.datasetBucket=function(){return BUCKET_TYPES.DATASET},a.prototype.canGroupBy=function(a){var b=!1;switch(a){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:b=this.groupByOptions.study;break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:case BUCKET_TYPES.DCE_HARMONIZATION:b=this.groupByOptions.dce;break;case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:b=this.groupByOptions.dataset}return b},a.prototype.defaultBucket=function(){return this.groupByOptions.study?this.options.studies.showSearchTab?this.studyBucket():this.dceBucket():this.groupByOptions.dataset?this.datasetBucket():""},a}();ngObibaMica.search.service("CoverageGroupByService",["ngObibaMicaSearch",CoverageGroupByService]),function(){function a(a,b){return{compile:function(c,d,e){var f="";f=c.item.type===RQL_NODE.OR||c.item.type===RQL_NODE.AND||c.item.type===RQL_NODE.NAND||c.item.type===RQL_NODE.NOR?angular.element(a.get(e)):angular.element('<criterion-dropdown criterion="item" query="query"></criterion-dropdown>'),c.item.rqlQuery.args&&b(f)(c,function(a){d.replaceWith(a)})}}}ngObibaMica.search.factory("CriteriaNodeCompileService",["$templateCache","$compile",a])}(),function(){function a(a,b,c,d,e,f,g,h){function i(a,b){var e=new obiba.utils.NgObibaStringUtils,f=e.cleanDoubleQuotesLeftUnclosed(b);return f=e.cleanOrEscapeSpecialLuceneBrackets(f),f=e.cleanSpecialLuceneCharacters(f),a&&b&&f.length>1?d.query({locale:c.use(),documentType:a,query:f}).$promise.then(function(a){for(var b=Array.isArray(a)?a:[],c=0;c<b.length;c++)b[c]=e.quoteQuery(b[c].replace(/\/.*/,""));return b},function(a){g.alert({id:"SearchController",type:"danger",msg:h.buildMessage(a),delay:5e3})}):[]}function j(a,c){var d=e.parseQuery(b.search().query),f=e.findTargetQuery(typeToTarget(a),d),g=e.findQueryInTargetByVocabulary(f,"className");return g&&(c="className:"+g.args[1]+" AND ("+c.replace(/\/.*/,"")+")"),i(a,c)}function k(a,b){if(b){var c=e.findTargetQuery(a,b);if(c){var d=f.givenFilterQueryGetMatchQuery(f.givenTargetQueryGetFilterQuery(c));return d&&d.args?Array.isArray(d.args[0])&&1===d.args[0].length?d.args[0][0]:Array.isArray(d.args[0])&&d.args[0].length>1?d.args[0].join(","):d.args[0].length?d.args[0][0]:"":""}}return""}function l(b,c,d){var e=new obiba.utils.NgObibaStringUtils,f=e.cleanDoubleQuotesLeftUnclosed(c);f=e.cleanOrEscapeSpecialLuceneBrackets(f),f=e.cleanSpecialLuceneCharacters(f),a.$new().$emit("ngObibaMicaSearch.searchSuggestion",f,b,d)}this.getCurrentSuggestion=k,this.suggest=i,this.selectSuggestion=l,this.suggestForTargetQuery=j}function b(){function a(a,b){var c=[];return c.push([a]),Array.isArray(b)?c.push(b):b&&c.push([b]),c}function b(b,c){var d=null,e=b.trim();return e.length&&(d=new RqlQuery(RQL_NODE.MATCH),d.args=a(e,c)),d}function c(a){return a?a.args.filter(function(a){return a.name===RQL_NODE.FILTER}).pop():null}function d(a){return a?a.args.filter(function(a){return a.name===RQL_NODE.MATCH}).pop():null}function e(a){var b=c(a);b&&(1===b.args.length&&b.args[0].name===RQL_NODE.MATCH?a.args=a.args.filter(function(a){return a.name!==RQL_NODE.FILTER}):b.args=b.args.filter(function(a){return a.name!==RQL_NODE.MATCH}))}this.createMatchQuery=b,this.givenTargetQueryGetFilterQuery=c,this.givenFilterQueryGetMatchQuery=d,this.removeFilteredMatchQueryFromTargetQuery=e}ngObibaMica.search.service("EntitySuggestionRqlUtilityService",b),ngObibaMica.search.service("EntitySuggestionService",["$rootScope","$location","$translate","DocumentSuggestionResource","RqlQueryService","EntitySuggestionRqlUtilityService","AlertService","ServerErrorUtils",a])}(),function(){function a(a,b,c){var d=a[0],e=c.$new(),f={$on:angular.bind(e,e.$on),enable:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},cancel:function(){d.cancelFullScreen?d.cancelFullScreen():d.mozCancelFullScreen?d.mozCancelFullScreen():d.webkitExitFullscreen?d.webkitExitFullscreen():d.msExitFullscreen&&d.msExitFullscreen()},isEnabled:function(){return!!(d.fullscreenElement||d.mozFullScreenElement||d.webkitFullscreenElement||d.msFullscreenElement)}};return a.on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){e.$emit("ngObibaMicaSearch.fullscreenChange",f.isEnabled())}),f}ngObibaMica.search.factory("FullScreenService",["$document","$window","$rootScope",a])}(),function(){function a(a,b,c,d){function e(){return c.get({target:QUERY_TARGETS.TAXONOMY,taxonomy:"Mica_taxonomy"}).$promise}function f(b){var c=a.defer();return e().then(function(a){var d=(a.vocabularies||[]).filter(function(a){return b.indexOf(a.name)>-1}),e=d.map(function(a){switch(a.name){case QUERY_TARGETS.VARIABLE:return i.parseVariableTaxonomies(a);case QUERY_TARGETS.NETWORK:case QUERY_TARGETS.STUDY:case QUERY_TARGETS.DATASET:return i.parseEntityTaxonomies(a)}});e.sort(function(a,c){return b.indexOf(a.name)-b.indexOf(c.name)}),c.resolve(e||[])}),c.promise}function g(){return h}var h=d.getOptions().taxonomyPanelOptions,i=new ngObibaMica.search.MetaTaxonomyParser(h);this.getTaxonomyPanelOptions=g,this.getMetaTaxonomyForTargets=f,this.getMetaTaxonomiesPromise=e}ngObibaMica.search.service("MetaTaxonomyService",["$q","$translate","TaxonomyResource","ngObibaMicaSearch",a])}(),function(){function a(){var a={networks:{showSearchTab:1},studies:{showSearchTab:1},datasets:{showSearchTab:1},variables:{showSearchTab:1}};this.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a&&(a[c]=b[c])})},this.getOptions=function(){return angular.copy(a)}}ngObibaMica.search.service("ObibaSearchConfig",a)}(),function(){function a(a,b,c){return this.studyPage=function(d,e){var f=(e.toLowerCase().indexOf("individual")>-1?"individual":"harmonization")+"-study";return d?b.replaceAll(a.getUrl("StudyPage"),{":type":c(f),":study":c(d)}):""},this.studyPopulationPage=function(d,e,f){var g=("individual"===e.toLowerCase()?"individual":"harmonization")+"-study";return d?b.replaceAll(a.getUrl("StudyPopulationsPage"),{":type":c(g),":study":c(d),":population":c(f)}):""},this.StudyDcePage=function(d,e,f){var g=("individual"===e.toLowerCase()?"individual":"harmonization")+"-study";return d?b.replaceAll(a.getUrl("StudyDcePage"),{":type":c(g),":study":c(d),":dce":f}):""},this.networkPage=function(d){return d?b.replaceAll(a.getUrl("NetworkPage"),{":network":c(d)}):""},this.datasetPage=function(d,e){var f=("collected"===e.toLowerCase()?"collected":"harmonized")+"-dataset";return d?b.replaceAll(a.getUrl("DatasetPage"),{":type":c(f),":dataset":c(d)}):""},this.variablePage=function(d){return d?b.replaceAll(a.getUrl("VariablePage"),{":variable":c(d)}):""},this.downloadList=function(c,d){return b.replaceAll(a.getUrl("JoinQuerySearchCsvResource"),{":type":c,":query":d})},this.downloadCoverage=function(c){return b.replaceAll(a.getUrl("JoinQueryCoverageDownloadResource"),{":query":c})},this.entitiesCountPage=function(b){var d=a.getUrl("BaseUrl")+a.getUrl("EntitiesCountBaseUrl");return b&&(d=d+"?query="+c(b)),d},this.downloadOpalView=function(c,d){return b.replaceAll(a.getUrl("SetOpalExportResource"),{":type":c,":id":d})},this.searchPage=function(b){var d=a.getUrl("BaseUrl")+a.getUrl("SearchBaseUrl");return b&&(d=d+"?query="+c(b)),d},this}ngObibaMica.search.service("PageUrlService",["ngObibaMicaUrl","StringUtils","urlEncode",a])}(),function(){function a(a){function b(a,b){var c,f=!1;for(c in e){var g=e[c],h=b[c+"TotalCount"].hits||0,i=a[c],j=g.totalHitsChanged(h);f=f||j,g.update(i,h)}for(c in e)d[c]&&Array.isArray(d[c])&&d[c].forEach(function(a){return a.onUpdate(e[c].data(),f)})}function c(a,b){if(b){if(!b.onUpdate)throw new Error("PaginationService::registerListener() - listener must implement onUpdate()");d[a]=[].concat(d[a]||[],b)}}var d={},e=Object.keys(QUERY_TARGETS).reduce(function(b,c){if(null===/TAXONOMY/.exec(c)){var d=QUERY_TARGETS[c];b[d]=new ngObibaMica.search.PaginationState(d,a.getDefaultListPageSize(d))}return b},{});this.registerListener=c,this.update=b}ngObibaMica.search.service("PaginationService",["ngObibaMicaSearch",a])}();var QUERY_TYPES={NETWORKS:"networks",STUDIES:"studies",DATASETS:"datasets",VARIABLES:"variables"},QUERY_TARGETS={NETWORK:"network",STUDY:"study",DATASET:"dataset",VARIABLE:"variable",TAXONOMY:"taxonomy"},BUCKET_TYPES={NETWORK:"network",STUDY:"study",STUDY_INDIVIDUAL:"study-individual",STUDY_HARMONIZATION:"study-harmonization",DCE:"dce",DCE_INDIVIDUAL:"dce-individual",DCE_HARMONIZATION:"dce-harmonization",DATASET:"dataset",DATASET_COLLECTED:"dataset-collected",DATASET_HARMONIZED:"dataset-harmonized",DATASCHEMA:"dataschema"},RQL_NODE={VARIABLE:"variable",DATASET:"dataset",STUDY:"study",NETWORK:"network",LIMIT:"limit",SORT:"sort",AND:"and",NAND:"nand",OR:"or",NOR:"nor",NOT:"not",FACET:"facet",LOCALE:"locale",AGGREGATE:"aggregate",BUCKET:"bucket",FIELDS:"fields",FILTER:"filter",CONTAINS:"contains",IN:"in",OUT:"out",EQ:"eq",GT:"gt",GE:"ge",LT:"lt",LE:"le",BETWEEN:"between",MATCH:"match",EXISTS:"exists",MISSING:"missing"},SORT_FIELDS={ACRONYM:"acronym",NAME:"name",CONTAINER_ID:"containerId",POPULATION_WEIGHT:"populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"dataCollectionEventWeight",POPULATION_ID:"populationId",DATASET_ID:"datasetId",VARIABLE_TYPE:"variableType",INDEX:"index",STUDY_TABLE:{POPULATION_WEIGHT:"studyTable.populationWeight",DATA_COLLECTION_EVENT_WEIGHT:"studyTable.dataCollectionEventWeight",STUDY_ID:"studyTable.studyId",POPULATION_ID:"studyTable.populationId"}};!function(){function a(a,b,c,d,e,f,g,h){function i(a,b){return b.children.filter(function(b){return b.target===a}).pop()}function j(a,b,c,d){var e=i(a,c),f={};return C.findItemNodeById(e,b,f,d)?f.item:null}function k(a,b){var c=i(a.target,b),d={};return C.findItemNode(c,a,d)?d.item:null}function l(a,b){return b.args.filter(function(b){return b.name===a}).pop()}function m(a,b,c){function d(a,b,c){return a.args.some(function(e){return null!==b.exec(e)?(c.parent=a,!0):e instanceof RqlQuery&&d(e,b,c)})}if(!a)return null;var e={};return d(a,new RegExp((b||"")+"\\."+c+"$"),e),e.parent}function n(a,b){return m(a,null,b)}function o(a,b){switch(a){case DISPLAY_TYPES.LIST:switch(b){case QUERY_TARGETS.STUDY:return g.fields(D.studies.fields);case QUERY_TARGETS.VARIABLE:return g.fields(["attributes.label.*","variableType","datasetId","datasetAcronym"]);case QUERY_TARGETS.DATASET:return g.fields(D.datasets.fields);case QUERY_TARGETS.NETWORK:return g.fields(D.networks.fields)}}return null}function p(a){switch(a){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:return!0}return!1}function q(a){switch(a){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.NETWORK:case RQL_NODE.STUDY:return!0}return!1}function r(a){switch(a){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.MATCH:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0}return!1}function s(a){return r(a.type)}function t(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(-1===f||-1===g)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),null!==b.parent&&0===e.args.length&&t(b)}function u(a){var b=a.parent,c=a.rqlQuery,d=c.args,e=a.parent.rqlQuery,f=e.args.indexOf(c),g=b.children.indexOf(a);if(-1===f||-1===g)throw new Error("Criteria node not found: "+a);b.children.splice(g,1),a.children.forEach(function(a){a.parent=b}),b.children.splice.apply(b.children,[g,0].concat(a.children)),e.args.splice(f,1),d&&(d instanceof Array?e.args.splice.apply(e.args,[f,0].concat(d)):e.args.splice(f,0,d)),0===e.args.length&&t(b)}function v(a){var b=a.parent;if(!b)throw new Error("Cannot remove criteria when parent is NULL");var c=a.rqlQuery,d=a.parent.rqlQuery,e=d.args.indexOf(c);if(-1===e)throw new Error("Criteria node not found: "+a);d.args.splice(e,1),-1!==[RQL_NODE.OR,RQL_NODE.AND,RQL_NODE.NAND,RQL_NODE.NOR].indexOf(b.type)?u(b):0===d.args.length&&t(b)}function w(a){if(a&&a.args){var b=a.args.filter(function(a){return r(a.name)||p(a.name)});return(1!==b.length||!g.isFreeTextMatch(b[0]))&&b.length>0}return!1}function x(a){return(a||[]).filter(function(a){return w(a.rqlQuery)})}function y(a){return a?x(a.children):[]}function z(a,b,c,d,e,f){var i=angular.copy(c),j=typeToTarget(b);g.addLocaleQuery(i,d);var k=l(j,i);if(k||(k=new RqlQuery(j),i.args.push(k)),g.getLimitQuery(k)||g.addLimit(k,g.limit(0,h.getDefaultListPageSize(j))),f){var m=o(a,j);m&&g.addFields(k,m)}return e&&g.addSort(k,e),i}function A(a,b,c,d){var e=l(b,a);e||(e=new RqlQuery(b),a.args.push(e)),g.addLimit(e,g.limit(c,d))}function B(a){return a&&0!==a.args.length?a.args.reduce(function(a,b){if(q(b.name)){var c=g.getLimitQuery(b);c&&(a[b.name]={from:c.args[0],size:c.args[1]})}return a},{}):{}}var C=this,D=h.getOptions();this.findItemNodeById=function(a,b,c,d){var e=b.split(".");return!!(a&&a.children&&c)&&a.children.some(function(a){return(d?b===a.id:a.id&&a.id.split(".").reduce(function(a,b){return a&&e.indexOf(b)>-1},!0))?(c.item=a,!0):C.findItemNodeById(a,b,c,d)})},this.findItemNode=function(a,b,c){return C.findItemNodeById(a,b.id,c)},this.getRenderableTargetCriteria=x,this.getRenderableTargetCriteriaFromRoot=y,this.parseQuery=function(a){try{return(new RqlParser).parse(a)}catch(a){b.error(a.message)}return new RqlQuery},this.removeCriteriaItem=function(a){s(a)?v(a):t(a)},this.createCriteriaItem=function(a,b,c,g,h){function i(b,c,d){return new CriteriaItemBuilder(e,h).target(a).taxonomy(b).vocabulary(c).term(d)}return angular.isString(b)?d.get({target:a,taxonomy:b}).$promise.then(function(a){return c=a.vocabularies.filter(function(a){return a.name===c||f.vocabularyAlias(a)===c})[0],g=c&&c.terms?c.terms.filter(function(a){return a.name===g})[0]:null,i(a,c,g).build()}):i(b,c,g).build()},this.addCriteriaItem=function(a,b,c){var d=a.args.filter(function(a){return b.target===a.name}).pop();d||(d=new RqlQuery(RQL_NODE[b.target.toUpperCase()]),a.args.push(d));var e=b.rqlQuery?b.rqlQuery:g.buildRqlQuery(b);return g.addQuery(d,e,c)},this.updateCriteriaItem=function(a,b,c){function d(){a=f?a.first():a,a.rqlQuery.name=RQL_NODE.EXISTS,a.rqlQuery.args.splice(1,1)}var e,f=a.isRepeatable(),h=!f&&a.rqlQuery.name===RQL_NODE.MATCH;b.rqlQuery&&RQL_NODE.EXISTS===b.rqlQuery.name?d():(c&&b.rqlQuery&&(a.rqlQuery.name=b.rqlQuery.name),b.rqlQuery?e=b.rqlQuery.args[h?0:1]:b.term?e=[b.term.name]:d(),e&&(f?g.updateRepeatableQueryArgValues(a,e):g.updateQueryArgValues(a.rqlQuery,e,c)))},this.builders=function(b,d,f,g){function h(a,c,d){var f=new CriteriaBuilder(a,c,d,e,g);f.initialize(b),f.build(),i.resolve({root:f.getRootItem(),map:f.getLeafItemMap()})}var i=a.defer();return c.get({target:b}).$promise.then(function(a){h(d,f,a)}),i.promise},this.createCriteria=function(b,c){var d=a.defer(),e=(new CriteriaItemBuilder).type(RQL_NODE.AND).rqlQuery(b).build(),f={};if(!g.hasTargetQuery(b))return d.resolve({root:e,map:f}),d.promise;var h=[],i=this,j=0;return b.args.forEach(function(a){QUERY_TARGETS[a.name.toUpperCase()]&&h.push(a)}),h.forEach(function(a){i.builders(a.name,a,e,c).then(function(a){e.children.push(a.root),f=angular.extend(f,a.map),++j===h.length&&d.resolve({root:e,map:f})})}),d.promise},this.prepareCriteriaTermsQuery=function(a,b,c){function d(a,b,c){if(!a||!a.args)return null;if((a.name===RQL_NODE.IN||a.name===RQL_NODE.MISSING||a.name===RQL_NODE.CONTAINS)&&a.args[0]===b)return a;for(var e=a.args.length;e--;){d(a.args[e],b,c)&&(a.args[e]=c)}}var e=this.parseQuery(a),f=e.args.filter(function(a){return a.name===b.target}).pop();if(f){var h=new RqlQuery(RQL_NODE.EXISTS),i=g.criteriaId(b.taxonomy,b.vocabulary);h.args.push(i),d(f,i,h),f.args.push(g.aggregate([i])),f.args.push(g.limit(0,0))}return e.args.push(new RqlQuery(RQL_NODE.FACET)),c&&g.addLocaleQuery(e,c),e.serializeArgs(e.args)},this.getTargetQuerySort=function(a,b){var c=typeToTarget(a),d=l(c,b),e=null;return d&&(e=d.args.filter(function(a){return a.name===RQL_NODE.SORT}).pop()),e},this.isOperator=p,this.isLeaf=r,this.getQueryPaginations=B,this.prepareQueryPagination=A,this.findCriteriaItemFromTreeById=j,this.findCriteriaItemFromTree=k,this.findTargetCriteria=i,this.findTargetQuery=l,this.findQueryInTargetByVocabulary=n,this.findQueryInTargetByTaxonomyVocabulary=m,this.prepareSearchQuery=function(a,b,c,d,e){return z(a,b,c,d,e,!0)},this.prepareSearchQueryNoFields=function(a,b,c,d,e){return z(a,b,c,d,e,!1)},this.prepareSearchQueryAndSerialize=function(a,b,c,d,e){return(new RqlQuery).serializeArgs(C.prepareSearchQuery(a,b,c,d,e).args)},this.prepareCoverageQuery=function(a,b){var c,d=this.parseQuery(a),e=new RqlQuery("aggregate"),f=b.split("-"),g=f[0],h=f.length>1?f[1]:void 0;switch(g){case BUCKET_TYPES.NETWORK:c="networkId";break;case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.STUDY_HARMONIZATION:c="studyId";break;case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:c="dceId";break;case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:case BUCKET_TYPES.DATASET_HARMONIZED:c="datasetId"}var i=new RqlQuery("bucket");i.args.push(c),e.args.push(i);var j;if(d.args.forEach(function(a){j||"variable"!==a.name||(j=a)}),j||(j=new RqlQuery("variable"),d.args.push(j)),j.args.length>0&&"limit"!==j.args[0].name){var k=new RqlQuery("in");k.args.push("Mica_variable.variableType"),void 0===h?b===BUCKET_TYPES.DATASET_HARMONIZED||b===BUCKET_TYPES.DATASCHEMA?k.args.push("Dataschema"):k.args.push(["Collected","Dataschema"]):["individual","collected"].indexOf(h)>-1?k.args.push("Collected"):["harmonization","harmonized"].indexOf(h)>-1&&k.args.push("Dataschema");var l=new RqlQuery("and");l.args.push(k),l.args.push(j.args[0]),j.args[0]=l}return j.args.push(e),d.serializeArgs(d.args)},this.prepareGraphicsQuery=function(a,b,c){var d=this.parseQuery(a),e=new RqlQuery(RQL_NODE.AGGREGATE);if(b.forEach(function(a){e.args.push(a)}),c&&c.length>0){var f=new RqlQuery(RQL_NODE.BUCKET);c.forEach(function(a){f.args.push(a)}),e.args.push(f)}var g,h=!1,i=!1;return d.args.forEach(function(a){if("study"===a.name){i=!0;var b=null;h=a.args.filter(function(a,c){return"limit"===a.name&&(b=c),["limit","sort","aggregate"].indexOf(a.name)<0}).length,null!==b&&a.args.splice(b,1),g=a}}),i||(g=new RqlQuery("study"),d.args.push(g)),h||g.args.push(new RqlQuery(RQL_NODE.MATCH)),g.args.push(e),d.args.push(new RqlQuery("facet")),d.serializeArgs(d.args)},this.getTargetAggregations=function(a,b,c){function d(a,b){var d=b.terms;if(d&&d.length>0){var f=a&&a.map(function(a){return a.key})||[];if(a){var g=[];return d.forEach(function(a){0!==f.length&&-1!==f.indexOf(a.name)||g.push({count:0,default:0,description:e.forLocale(a.description,c),key:a.name,title:e.forLocale(a.title,c)})}),a.concat(g)}return d.map(function(a){return{count:0,default:0,description:e.forLocale(a.description,c),key:a.name,title:e.forLocale(a.title,c)}})}return a}function g(a,b){if(a.children){var c=a.children.filter(function(a){return a.hasOwnProperty(b)}).pop();if(c)return c[b]}return null}var h=f.vocabularyAlias(b.vocabulary),i=a[b.target+"ResultDto"];if(i&&i.aggs){var j=b.taxonomy.name.startsWith("Mica_"),k=j?h:b.taxonomy.name,l=i.aggs.filter(function(a){return a.aggregation===k}).pop();if(l){if(j)return f.isNumericVocabulary(b.vocabulary)?l["obiba.mica.StatsAggregationResultDto.stats"]:f.isRangeVocabulary(b.vocabulary)?d(l["obiba.mica.RangeAggregationResultDto.ranges"],b.vocabulary):d(l["obiba.mica.TermsAggregationResultDto.terms"],b.vocabulary);if(l.children.filter(function(a){return a.aggregation===h}).pop())return f.isRangeVocabulary(b.vocabulary)?d(g(l,"obiba.mica.RangeAggregationResultDto.ranges"),b.vocabulary):d(g(l,"obiba.mica.TermsAggregationResultDto.terms"),b.vocabulary)}}return d([],b.vocabulary)},this.findCriterion=function(a,b){function c(a,b){var d;if(a.id===b)return a;for(var e=a.children.filter(function(a){return a instanceof CriteriaItem}),f=e.length;f--;)if(d=c(e[f],b))return d}return c(a,b)},this.cleanQuery=function(a){var b=angular.copy(a);if(b.args){angular.forEach(b.args,function(a){if(a.args)for(var b=a.args.length;b--;)"limit"!==a.args[b].name&&"sort"!==a.args[b].name&&"fields"!==a.args[b].name||a.args.splice(b,1)});for(var c=b.args.length;c--;)"locale"!==b.args[c].name&&b.args[c].args&&0!==b.args[c].args.length||b.args.splice(c,1)}return b}}ngObibaMica.search.service("RqlQueryService",["$q","$log","TaxonomiesResource","TaxonomyResource","LocalizedValues","VocabularyService","RqlQueryUtils","ngObibaMicaSearch",a])}(),function(){function a(a){function b(a){var b=a.args.filter(function(a){switch(a.name){case RQL_NODE.AND:case RQL_NODE.NAND:case RQL_NODE.OR:case RQL_NODE.NOR:case RQL_NODE.NOT:case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EQ:case RQL_NODE.GT:case RQL_NODE.GE:case RQL_NODE.LT:case RQL_NODE.LE:case RQL_NODE.BETWEEN:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:return!0;case RQL_NODE.MATCH:return a.args.length>1}return!1}).pop();return b?a.args.findIndex(function(a){return a.name===b.name}):-1}function c(a){return a&&a.terms?a.terms.map(function(a){return a.name}):[]}function d(a,b){return a.args.filter(function(a){switch(a.name){case RQL_NODE.VARIABLE:case RQL_NODE.DATASET:case RQL_NODE.STUDY:case RQL_NODE.NETWORK:return!b||b===a.name;default:return!1}}).length>0}function e(){return new RqlQuery(QUERY_TARGETS.VARIABLE)}function f(a,b){var c=new RqlQuery(RQL_NODE.EQ);return c.args.push(b),c}function g(a,b){var c=new RqlQuery(RQL_NODE.OR);return c.args=[a,b],c}function h(a){var b=new RqlQuery(RQL_NODE.AGGREGATE);return a.forEach(function(a){b.args.push(a)}),b}function i(a){var b=new RqlQuery(RQL_NODE.FIELDS);return b.args.push(a),b}function j(a,b){var c=new RqlQuery(RQL_NODE.LIMIT);return c.args.push(a),c.args.push(b),c}function k(a,b,c){var d=new RqlQuery(a);return d.args.push(b),c&&c.length>0&&d.args.push(c),d}function l(a,b){return k(b&&b.length>0?RQL_NODE.IN:RQL_NODE.EXISTS,a,b)}function m(a,b){var c=new RqlQuery(RQL_NODE.MATCH);return c.args.push(b||"*"),c.args.push(a),c}function n(a){return a.name===RQL_NODE.MATCH&&1===a.args.length}function o(a,b){return a.args[0]=b||"*",a}function p(a,b,c){var d=new RqlQuery(RQL_NODE.BETWEEN);return d.args.push(a),s(d,b,c),d}function q(a,b){return b&&b.length>0?a.args[1]=b:a.args.splice(1,1),a}function r(a,b,c){if(b&&b.length>0){var d=a.args[1];if(!d||c)a.args[1]=b;else{d instanceof Array||(d=[d]);var e=b.filter(function(a){return-1===d.indexOf(a)});a.args[1]=d.concat(e)}}else a.args.splice(1,1);return a}function s(a,b,c,d){d?(a.name=RQL_NODE.MISSING,a.args.splice(1,1)):angular.isDefined(b)&&null!==b&&angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.BETWEEN,a.args[1]=[b,c]):angular.isDefined(b)&&null!==b?(a.name=RQL_NODE.GE,a.args[1]=b):angular.isDefined(c)&&null!==c?(a.name=RQL_NODE.LE,a.args[1]=c):(a.name=RQL_NODE.EXISTS,a.args.splice(1,1))}function t(b){if(a.isNumericVocabulary(b.vocabulary))return p(D(b.taxonomy,b.vocabulary),null,null);if(a.isMatchVocabulary(b.vocabulary))return m(D(b.taxonomy,b.vocabulary),null);var c;return Array.isArray(b.selectedTerms)&&b.selectedTerms.length>0?c=b.selectedTerms:b.term&&(c=b.term.name),l(D(b.taxonomy,b.vocabulary),c)}function u(a,c,d){if(0===a.args.length)a.args.push(c);else{var e=b(a);if(-1===e)a.args.push(c);else{var f=a.args.splice(e,1).pop();if(!d&&c.args&&c.args.length>0){var g="Mica_"+a.name;if(!n(c)){d=("match"===c.name?c.args[1]:c.args[0]).startsWith(g+".")?RQL_NODE.AND:RQL_NODE.OR}}var h=new RqlQuery(d||RQL_NODE.AND);h.args.push(f,c),a.args.push(h)}}return a}function v(a,b){a.items().forEach(function(a){var c=a.rqlQuery;switch(c.name){case RQL_NODE.EXISTS:c.name=RQL_NODE.CONTAINS,r(c,b,!1);break;case RQL_NODE.CONTAINS:r(c,b,!1);break;case RQL_NODE.IN:var d=c.args[1]?[].concat(c.args[1]):[];if(1===d.length){c.name=RQL_NODE.CONTAINS,r(c,b,!1);break}var e,f=c.args[0],h=d.filter(function(a){return b.indexOf(a)<0}).map(function(a){return k(RQL_NODE.CONTAINS,f,[].concat(a,b))});if(h.length>1){var i=h.splice(0,2);e=g(i[0],i[1]),h.forEach(function(a){e=g(a,e)}),c.name=e.name,c.args=e.args}else c.name=RQL_NODE.CONTAINS,c.args=h[0].args}})}function w(a,b,c){switch(a.name){case RQL_NODE.EXISTS:case RQL_NODE.MISSING:a.name=RQL_NODE.IN,r(a,b,c);break;case RQL_NODE.CONTAINS:case RQL_NODE.IN:r(a,b,c);break;case RQL_NODE.BETWEEN:case RQL_NODE.GE:case RQL_NODE.LE:a.args[1]=b;break;case RQL_NODE.MATCH:a.args[0]=b}}function x(a,b){switch(a.name){case RQL_NODE.CONTAINS:case RQL_NODE.IN:case RQL_NODE.OUT:case RQL_NODE.EXISTS:case RQL_NODE.MISSING:q(a,b)}}function y(a,b){if(!a.args.filter(function(a){return a.name===RQL_NODE.LOCALE}).pop()){var c=new RqlQuery("locale");c.args.push(b),a.args.push(c)}}function z(a,b){if(a&&a.args){var c=a.args.filter(function(a){return a.name===RQL_NODE.FIELDS}).pop();c?c.args=b.args:a.args.push(b)}}function A(a){return a&&a.args?a.args.filter(function(a){return a.name===RQL_NODE.LIMIT}).pop():null}function B(a,b){if(a&&a.args){var c=A(a);c?c.args=b.args:a.args.push(b)}}function C(a,b){var c=a.args.filter(function(a){return a.name===RQL_NODE.SORT}).pop();c||(c=new RqlQuery("sort"),a.args.push(c)),c.args=Array.isArray(b)?b:[b]}function D(a,b){return a.name+"."+b.name}function E(a,b,c,d){var e=a.args.filter(function(a){return a.name===b}).pop();return B(e,j(0,c)),d&&z(e,i(d)),(new RqlQuery).serializeArgs(a.args)}function F(a,b,c,d,e){var f=a.args.filter(function(a){return a.name===RQL_NODE.LOCALE}).pop(),g=a.args.filter(function(a){return a.name===b}).pop();B(g,j(0,c)),d&&z(g,i(d));var h=e.slice(0,c),k=new RqlQuery(RQL_NODE.AND);if(Array.isArray(h)&&h.length){var m=new RqlQuery(b);m.args.push(l("id",h)),g.args.forEach(function(a){["fields","limit","sort"].indexOf(a.name)>-1&&m.args.push(a)}),k.args.push(m)}else k.args.push(g);return f&&k.args.push(f),(new RqlQuery).serializeArgs(k.args)}this.vocabularyTermNames=c,this.hasTargetQuery=d,this.variableQuery=e,this.eqQuery=f,this.orQuery=g,this.aggregate=h,this.fields=i,this.limit=j,this.fieldQuery=k,this.inQuery=l,this.matchQuery=m,this.isFreeTextMatch=n,this.updateMatchQuery=o,this.rangeQuery=p,this.updateQueryInternal=q,this.mergeInQueryArgValues=r,this.updateRangeQuery=s,this.buildRqlQuery=t,this.addQuery=u,this.updateRepeatableQueryArgValues=v,this.updateQueryArgValues=w,this.updateQuery=x,this.addLocaleQuery=y,this.addFields=z,this.getLimitQuery=A,this.addLimit=B,this.addSort=C,this.criteriaId=D,this.rewriteQueryWithLimitAndFields=E,this.createSelectionsQuery=F}ngObibaMica.search.service("RqlQueryUtils",["VocabularyService",a])}(),function(){function a(){var a=null;this.setLocale=function(b){a=b},this.currentLocale=function(){return a}}ngObibaMica.search.service("SearchContext",a)}();var SearchResultSelectionsService=function(){function a(a,b){this.PaginationService=a,this.$log=b,this.decorators={}}return a.prototype.decorateSearchResult=function(a,b){this.decorators[a]||(this.decorators[a]=new SearchResultSelectionsDecorator(QUERY_TARGETS.VARIABLE,this.PaginationService)),this.decorators[a].decorate(b)},a.prototype.getSelections=function(a){return this.decorators[a]?this.decorators[a].getSelections():{}},a.prototype.getSelectionIds=function(a){return this.decorators[a]?this.decorators[a].getSelectionIds():{}},a.prototype.clearSelections=function(a){return this.decorators[a]?this.decorators[a].clearSelections():{}},a.$inject=["PaginationService","$log"],a}();ngObibaMica.search.service("SearchResultSelectionsService",SearchResultSelectionsService),function(){function a(a,b){function c(c){c=c||b.parseQuery(a.search().query);var d,e=b.findTargetQuery(QUERY_TARGETS.STUDY,c);return e&&(d=b.findQueryInTargetByVocabulary(e,"className")),d}function d(a,b){return!a||(Array.isArray(a.args[1])?a.args[1].indexOf(b)>-1:a.args[1]===b)}function e(a){return d(a,"Study")}function f(a){return d(a,"HarmonizationStudy")}function g(a){return!a||a.name===RQL_NODE.EXISTS||e(a)&&f(a)}this.filter=function(d){var e,f=b.parseQuery(a.search().query),g=c(f);switch(g?(e=g,e.name===RQL_NODE.EXISTS&&(e.name=RQL_NODE.IN)):e=new RqlQuery(RQL_NODE.IN),e.args=["Mica_study.className"],d){case ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:e.args.push("Study");break;case ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES:e.args.push("HarmonizationStudy");break;case ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:e.args.push(["Study","HarmonizationStudy"])}if(!g){var h=b.findTargetQuery(QUERY_TARGETS.STUDY,f);if(h||(h=new RqlQuery(QUERY_TARGETS.STUDY),f.args.push(h)),h.args.length>0){var i=h.args.filter(function(a){return b.isLeaf(a.name)||b.isOperator(a.name)}).pop();if(i){var j=new RqlQuery(RQL_NODE.AND),k=h.args.indexOf(i);j.args.push(e,i),h.args[k]=j}else h.args.push(e)}else h.args=[e]}a.search("query",(new RqlQuery).serializeArgs(f.args))},this.getStudyClassNameChoices=function(){return{choseAll:g(c()),choseIndividual:e(c()),choseHarmonization:f(c())}}}ngObibaMica.search.service("StudyFilterShortcutService",["$location","RqlQueryService",a])}(),function(){function a(a,b,c,d){function e(a,b){return c.get({target:a,taxonomy:b}).$promise}function f(a,c){return b.get({target:a,query:"taxonomyName:"+c.join(" OR taxonomyName:")}).$promise}function g(a,b){b.sort(function(b,c){return a.indexOf(b.name)-a.indexOf(c.name)})}function h(b,e,f){var g=a.defer(),h=null;return c.get({target:b,taxonomy:e}).$promise.then(function(a){a.vocabularies.some(function(a){if(a.name===f||d.vocabularyAlias(a)===f)return h=a,!0}),g.resolve(h)}),g.promise}function i(b,c){var h=a.defer();return Array.isArray(c)?f(b,c).then(function(a){a.forEach(function(a){a.vocabularies=d.visibleVocabularies(a.vocabularies)}),g(c,a),h.resolve(a)}):e(b,c).then(function(a){a.vocabularies=d.visibleVocabularies(a.vocabularies),h.resolve(a)}),h.promise}this.findVocabularyInTaxonomy=h,this.getTaxonomy=e,this.getTaxonomies=i}ngObibaMica.search.service("TaxonomyService",["$q","TaxonomiesResource","TaxonomyResource","VocabularyService",a])}(),function(){function a(a,b,c){function d(c){return b.forLocale(c,a.use())}function e(a){return a.normalize("NFD").replace(/\//g," ").replace(/[^\w|^\s|^-]/g,"")}function f(a,b){if(b){var f=e(b).toLowerCase().split(" ").filter(function(a){return a.length>x}),g=Array.isArray(a)?a:a.vocabularies,h=c.getTaxonomyPanelOptions().fieldsToFilter;return(g||[]).filter(function(a){return a.filteredTerms=(a.terms||[]).filter(function(a){var b=h.reduce(function(b,c){return b+" "+d(a[c])},h[0]),c=e(b).trim().toLowerCase();return f.map(function(a){if(a.startsWith("-")){var b=a.substr(1);return b.length<=x||-1===c.indexOf(b)}return c.indexOf(a)>=0}).reduce(function(a,b){return a&&b},!0)}),!a.terms||a.filteredTerms.length>0})}}function g(a){if(!a)return!1;var b=a.attributes?a.attributes.filter(function(a){return"hidden"===a.key}).pop():null;return!b||"false"===b.value}function h(a){if(!a||!a.attributes)return!1;var b=a.attributes.filter(function(a){return["hidden","facet"].indexOf(a.key)>-1}).reduce(function(a,b){return a[b.key]=b.value,a},{});return"true"===b.facet&&(!b.hidden||"false"===b.hidden)}function i(a,b){return(a.attributes||[]).filter(function(a){return a.key.search(b)>-1}).reduce(function(a,b){return a[b.key]=b.value,a},{})}function j(a,b,c){var d=c;return a.attributes&&a.attributes.some(function(a){return a.key===b&&(d=a.value,!0)}),d}function k(a){return(a||[]).filter(g)}function l(a){return(a||[]).filter(h)}function m(a){return j(a,"type",y.STRING)}function n(a){return j(a,"field",a.name)}function o(a){return j(a,"alias",a.name)}function p(a){return j(a,"termsSortKey",null)}function q(a){return m(a)===y.STRING&&a.terms}function r(a){return m(a)===y.STRING&&!a.terms}function s(a){return!a.terms&&(m(a)===y.INTEGER||m(a)===y.DECIMAL)}function t(a){return a.terms&&(m(a)===y.INTEGER||m(a)===y.DECIMAL)}function u(a){return"true"===j(a,"facet","false")}function v(a,c,d){var e=p(a);if(e&&c&&c.length>0)switch(e){case"name":c.sort(function(a,b){return a[e].localeCompare(b[e])});break;case"title":c.sort(function(a,c){var f=b.forLocale(a[e],d),g=b.forLocale(c[e],d);return f.localeCompare(g)})}}function w(b,c){v(b,b.terms,c||a.$use())}var x=1,y={STRING:"string",INTEGER:"integer",DECIMAL:"decimal"};return this.filter=f,this.isVisibleVocabulary=g,this.findVocabularyAttributes=i,this.visibleVocabularies=k,this.visibleFacetVocabularies=l,this.isRangeVocabulary=t,this.isTermsVocabulary=q,this.isMatchVocabulary=r,this.isNumericVocabulary=s,this.isFacettedVocabulary=u,this.sortVocabularyTerms=w,this.sortFilteredVocabularyTerms=v,this.vocabularyAlias=o,this.vocabularyField=n,this}ngObibaMica.search.service("VocabularyService",["$translate","LocalizedValues","MetaTaxonomyService",a])}(),ngObibaMica.search.filter("dceDescription",function(){return function(a){return a.split(":<p>").map(function(a){return"<p>"+a})[2]}}),ngObibaMica.search.filter("orderBySelection",function(){return function(a,b){if(!a)return[];var c=[],d=[];return a.forEach(function(a){b[a.key]?c.push(a):d.push(a)}),c.concat(d)}}),ngObibaMica.search.filter("regex",function(){return function(a,b,c,d){var e=[];try{var f=new RegExp(b,"i");e=a.filter(function(a){return c.some(function(b){var c=a[b];return angular.isArray(c)&&d?c.filter(function(a){return a.locale===d}).some(function(a){return f.test(a.text)}):f.test(c)})})}catch(a){}return e}}),ngObibaMica.search.filter("renderableTargets",["RqlQueryService",function(a){return function(b){return a.getRenderableTargetCriteria(b)}}]),function(){ngObibaMica.search.STUDY_FILTER_CHOICES={ALL_STUDIES:"all",INDIVIDUAL_STUDIES:"individual",HARMONIZATION_STUDIES:"harmonization"}}(),ngObibaMica.search.filter("visibleVocabularies",["VocabularyService",function(a){return function(b){return a.visibleVocabularies(b)}}]),function(){ngObibaMica.search.SortVocabularyTerms=function(a){return function(b,c){return a.sortFilteredVocabularyTerms(c,b),b}},ngObibaMica.search.filter("sortTerms",["VocabularyService",ngObibaMica.search.SortVocabularyTerms])}();var CRITERIA_ITEM_EVENT={deleted:"event:delete-criteria-item",refresh:"event:refresh-criteria-item"};!function(){function a(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"=",onRemove:"=",onRefresh:"=",isFacetted:"="},templateUrl:"search/components/criteria/criteria-root/component.html",link:function(a){a.$on(CRITERIA_ITEM_EVENT.deleted,function(b,c){a.onRemove(c)}),a.$on(CRITERIA_ITEM_EVENT.refresh,function(){a.onRefresh()})}}}ngObibaMica.search.directive("criteriaRoot",a)}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},templateUrl:"search/components/criteria/criteria-target/component.html"}}ngObibaMica.search.directive("criteriaTarget",a)}(),function(){function a(){var a=[],b=[];this.dirty=!1,this.open=!1,this.loading=!0,this.addOnOpen=function(b){a.push(b)},this.addOnClose=function(a){b.push(a)},this.onOpen=function(){a.forEach(function(a){a()})},this.onClose=function(){b.forEach(function(a){a()})}}function b(b,c,d,e,f){var g=function(){if(b.state.open){b.state.onClose();var a=b.state.dirty;b.state.open=!1,b.state.dirty=!1,a&&b.$emit(CRITERIA_ITEM_EVENT.refresh)}},h=function(){if(b.state.open)return void g();b.state.open=!0,b.state.onOpen()},i=function(){b.$emit(CRITERIA_ITEM_EVENT.deleted,b.criterion)},j=function(a){13===a.keyCode&&g()};b.state=new a,b.timestamp=(new Date).getTime(),b.localize=function(a){return d.forLocale(a,b.criterion.lang)},b.localizeCriterion=function(){var a=b.criterion.rqlQuery;if((a.name===RQL_NODE.IN||a.name===RQL_NODE.OUT||a.name===RQL_NODE.CONTAINS)&&b.criterion.selectedTerms&&b.criterion.selectedTerms.length>0){var e=a.name===RQL_NODE.IN?" | ":" ",f=a.name===RQL_NODE.OUT?"-":"";return b.criterion.selectedTerms.map(function(a){if(!b.criterion.vocabulary.terms)return a;var c=b.criterion.vocabulary.terms.filter(function(b){return b.name===a}).pop();return f+(c?d.forLocale(c.title,b.criterion.lang):a)}).join(e)}var g=a.name;switch(a.name){case RQL_NODE.EXISTS:g=":"+c("translate")("any");break;case RQL_NODE.MISSING:g=":"+c("translate")("none");break;case RQL_NODE.EQ:g="="+a.args[1];break;case RQL_NODE.GE:g=">"+a.args[1];break;case RQL_NODE.LE:g="<"+a.args[1];break;case RQL_NODE.BETWEEN:g=":["+a.args[1]+")";break;case RQL_NODE.IN:case RQL_NODE.CONTAINS:g="";break;case RQL_NODE.MATCH:g=":match("+a.args[0]+")"}return d.forLocale(b.criterion.vocabulary.title,b.criterion.lang)+g},b.vocabularyType=e.vocabularyType,b.onKeyup=j,b.truncate=f.truncate,b.remove=i,b.openDropdown=h,b.closeDropdown=g,b.VocabularyService=e}function c(a,c,d){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"="},controller:["$scope","$filter","LocalizedValues","VocabularyService","StringUtils",b],templateUrl:d.getTemplateUrl("CriterionDropdownTemplate"),link:function(b,d){var e=function(a){document.querySelector("#"+b.criterion.id.replace(".","-")+"-dropdown-"+b.timestamp).contains(a.target)||c(function(){b.$apply("closeDropdown()")})};a.on("click",e),d.on("$destroy",function(){a.off("click",e)})}}}ngObibaMica.search.directive("criterionDropdown",["$document","$timeout","ngObibaMicaSearchTemplateUrl",c])}(),function(){var a="search/components/criteria/item-region/item-node/component.html";ngObibaMica.search.controller("CriterionLogicalController",["$scope",function(a){a.updateLogical=function(b){a.item.rqlQuery.name=b,a.$emit(CRITERIA_ITEM_EVENT.refresh)}}]).directive("criteriaNode",[function(){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",templateUrl:a}}]).directive("criteriaLeaf",["CriteriaNodeCompileService",function(b){return{restrict:"EA",replace:!0,scope:{item:"=",query:"=",advanced:"="},controller:"CriterionLogicalController",link:function(c,d){b.compile(c,d,a)}}}])}(),ngObibaMica.search.controller("MatchCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=function(){a.state.dirty=!0,e.updateMatchQuery(a.criterion.rqlQuery,a.match)},h=a.criterion.rqlQuery.args[0];a.match="*"===h?"":h,a.update=g,a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).directive("matchCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"MatchCriterionTermsController",templateUrl:"search/components/criteria/item-region/match/component.html"}}]),ngObibaMica.search.controller("NumericCriterionController",["$scope","RqlQueryService","LocalizedValues","JoinQuerySearchResource","RqlQueryUtils","SearchContext",function(a,b,c,d,e,f){a.lang=f.currentLocale();var g=a.criterion.rqlQuery.args[1];angular.isArray(g)?(a.from=a.criterion.rqlQuery.args[1][0],a.to=a.criterion.rqlQuery.args[1][1]):(a.from=a.criterion.rqlQuery.name===RQL_NODE.GE?g:null,a.to=a.criterion.rqlQuery.name===RQL_NODE.LE?g:null);var h=function(){var c=a.criterion.target,e=b.prepareCriteriaTermsQuery(a.query,a.criterion);d[targetToType(c)]({query:e}).$promise.then(function(c){var d=b.getTargetAggregations(c,a.criterion,a.lang);d&&d.default&&(a.min=d.default.min,a.max=d.default.max)})},i=function(){h()},j=function(){a.updateSelection()};a.updateSelection=function(){e.updateRangeQuery(a.criterion.rqlQuery,a.from,a.to,a.selectMissing),a.state.dirty=!0},a.selectMissing=a.criterion.rqlQuery.name===RQL_NODE.MISSING,a.state.addOnClose(j),a.state.addOnOpen(i),a.localize=function(b){return c.forLocale(b,a.criterion.lang)}}]).directive("numericCriterion",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"NumericCriterionController",templateUrl:"search/components/criteria/item-region/numeric/component.html"}}]),ngObibaMica.search.controller("searchCriteriaRegionController",["$scope","RqlQueryService","$timeout",function(a,b,c){var d=!1;a.$watchCollection("search.criteria",function(){a.renderableTargets=b.getRenderableTargetCriteriaFromRoot(a.search.criteria)}),a.$watchCollection("search.criteriaItemMap",function(){a.search.criteriaItemMap&&(d=Object.keys(a.search.criteriaItemMap).length>1)}),a.$watchCollection("search.rqlQuery",function(){var c=b.cleanQuery(angular.copy(a.search.rqlQuery));a.query=(new RqlQuery).serializeArgs(c.args)});var e=function(){return(a.options.studyTaxonomiesOrder.length||a.options.datasetTaxonomiesOrder.length||a.options.networkTaxonomiesOrder.length)&&d};a.showCopiedQueryTooltipStatus=!1;var f=function(){a.showCopiedQueryTooltipStatus=!0,c(function(){a.showCopiedQueryTooltipStatus=!1},1e3)};a.showCopiedQueryTooltip=f,a.canShowCriteriaRegion=e}]).directive("searchCriteriaRegion",["ngObibaMicaSearchTemplateUrl",function(a){return{restrict:"EA",replace:!0,scope:{options:"=",search:"="},controller:"searchCriteriaRegionController",templateUrl:a.getTemplateUrl("searchCriteriaRegionTemplate")}}]),ngObibaMica.search.controller("StringCriterionTermsController",["$scope","RqlQueryService","LocalizedValues","StringUtils","JoinQuerySearchResource","RqlQueryUtils","SearchContext","$filter",function(a,b,c,d,e,f,g,h){a.lang=g.currentLocale();var i=function(b){return-1!==a.checkboxTerms.indexOf(b)},j=function(){a.state.dirty=!0,a.criterion.rqlQuery.name=a.selectedFilter;var b=[];a.selectedFilter!==RQL_NODE.MISSING&&a.selectedFilter!==RQL_NODE.EXISTS&&Object.keys(a.checkboxTerms).forEach(function(c){a.checkboxTerms[c]&&b.push(c)}),0===b.length&&a.selectedFilter!==RQL_NODE.MISSING&&(a.criterion.rqlQuery.name=RQL_NODE.EXISTS),f.updateQuery(a.criterion.rqlQuery,b)},k=function(){j()},l=function(){return a.selectedFilter===RQL_NODE.IN||a.selectedFilter===RQL_NODE.OUT},m=function(){return a.selectedFilter===RQL_NODE.CONTAINS},n=function(){a.state.loading=!0;var c=a.criterion.target,d=b.prepareCriteriaTermsQuery(a.query,a.criterion,a.lang);e[targetToType(c)]({query:d}).$promise.then(function(c){if(a.state.loading=!1,a.terms=b.getTargetAggregations(c,a.criterion,a.lang),a.terms){if(a.criterion.taxonomy.name.startsWith("Mica_")&&"sets"===a.criterion.vocabulary.name){var d=a.criterion.vocabulary.terms;a.terms=a.terms.filter(function(b){return d.filter(function(c){return c.name===b.key&&(b.title=a.localize(c.title),!0)}).length>0})}a.terms.forEach(function(b){a.checkboxTerms[b.key]=a.isSelectedTerm(b)}),a.terms=h("orderBySelection")(a.terms,a.checkboxTerms)}})};a.isSelectedTerm=function(b){return a.criterion.selectedTerms&&-1!==a.criterion.selectedTerms.indexOf(b.key)},a.state.addOnOpen(n),a.checkboxTerms={},a.RQL_NODE=RQL_NODE,a.selectedFilter=a.criterion.type,a.isSelected=i,a.updateFilter=k,a.localize=function(b){return c.forLocale(b,a.criterion.lang)},a.truncate=d.truncate,a.isInOutFilter=l,a.isContainsFilter=m,a.updateSelection=j}]).directive("stringCriterionTerms",[function(){return{restrict:"EA",replace:!0,scope:{criterion:"=",query:"=",state:"="},controller:"StringCriterionTermsController",templateUrl:"search/components/criteria/item-region/string-terms/component.html"}}]),function(){function a(){function a(a){var c=(new obiba.utils.NgObibaStringUtils).cleanDoubleQuotesLeftUnclosed(a.target.value),d={text:c||"*"};13===a.keyCode&&b.onSelectArgs({vocabulary:b.vocabulary,args:d})}var b=this;b.enterText=a}ngObibaMica.search.component("matchVocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectArgs:"&"},templateUrl:"search/components/criteria/match-vocabulary-filter-detail/component.html",controller:[a]})}(),function(){function a(){function a(a){var c=a.target[0].value,d=a.target[1].value,e={};c&&(e.from=parseInt(c,10)),d&&(e.to=parseInt(d,10)),b.onSelectArgs({vocabulary:b.vocabulary,args:e})}var b=this;b.setRangeValue=a}ngObibaMica.search.component("numericVocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectArgs:"&"},templateUrl:"search/components/criteria/numeric-vocabulary-filter-detail/component.html",controller:[a]})}();var TermsVocabularyFilterDetailController=function(){function a(){this.constantLimitNumber=12,this.limitNumber=this.constantLimitNumber}return a.prototype.clickCheckbox=function(a){var b={term:a};this.onSelectArgs({vocabulary:this.vocabulary,args:b})},a}(),TermsVocabularyFilterDetailComponent=function(){function a(){this.transclude=!0,this.bindings={onSelectArgs:"&",vocabulary:"<"},this.controller=TermsVocabularyFilterDetailController,this.controllerAs="$ctrl",this.templateUrl="search/components/criteria/terms-vocabulary-filter-detail/component.html"}return a}();ngObibaMica.search.component("termsVocabularyFilterDetail",new TermsVocabularyFilterDetailComponent),function(){function a(){function a(a){return c.result&&c.result[a+"TotalCount"]?c.result[a+"TotalCount"].hits:""}function b(a){c.onSelectType({type:targetToType(a)})}var c=this;c.getTotalHits=a,c.selectType=b}ngObibaMica.search.component("entityCounts",{transclude:!0,bindings:{result:"<",target:"<",onSelectType:"&",resultTabsOrder:"<",taxonomyTypeMap:"<"},templateUrl:"search/components/entity-counts/component.html",controller:[a]})}(),function(){function a(a){function b(){h.model=a.getCurrentSuggestion(h.target,h.rqlQuery)||""}function c(b){return a.suggest(h.entityType,b)}function d(b){a.selectSuggestion(h.target,b,"true"===h.withSpecificFields)}function e(a){13===a.keyCode&&d(h.model)}function f(){h.model="",d("")}function g(a){a.rqlQuery.currentValue&&b()}var h=this;h.model="",h.suggest=c,h.select=d,h.clear=f,h.onKeyUp=e,h.$onChanges=g}ngObibaMica.search.component("entitySearchTypeahead",{bindings:{target:"<",entityType:"<",rqlQuery:"<",withSpecificFields:"@",placeholderText:"@",showButton:"@"},templateUrl:"search/components/entity-search-typeahead/component.html",controller:["EntitySuggestionService",a]})}(),ngObibaMica.search.controller("MatchVocabularyFacetController",["$scope","RqlQueryService",function(a,b){function c(c,d){var e=b.findCriterion(c,CriteriaIdGenerator.generate(a.$parent.taxonomy,d));e&&e.rqlQuery&&e.rqlQuery.args[1]?a.text=e.rqlQuery.args[0]:a.text=null}function d(){a.$parent.selectTerm(a.$parent.target,a.$parent.taxonomy,a.vocabulary,{text:a.text||"*"})}a.onKeypress=function(a){13!==a.keyCode&&"click"!==a.type||d()},a.$on("ngObibaMicaQueryUpdated",function(b,d){a.vocabulary.isMatch&&a.vocabulary.isOpen&&c(d,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,d,e){e.name!==a.vocabulary.name||e.isOpen||c(a.criteria,e)})}]),ngObibaMica.search.controller("NumericVocabularyFacetController",["$scope","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(a,b,c,d){function e(e,f){function g(a,b){var e=angular.copy(a.rqlQuery);return b.rqlQuery=d.buildRqlQuery(b),c.addCriteriaItem(e,b),e}var h=c.findCriterion(e,CriteriaIdGenerator.generate(a.$parent.taxonomy,f));h||(h=c.createCriteriaItem(a.target,a.$parent.taxonomy,a.vocabulary)),h.rqlQuery&&h.rqlQuery.args[1]?angular.isArray(h.rqlQuery.args[1])?(a.from=h.rqlQuery.args[1][0],a.to=h.rqlQuery.args[1][1]):h.rqlQuery.name===RQL_NODE.GE?a.from=h.rqlQuery.args[1]:a.to=h.rqlQuery.args[1]:(a.from=null,a.to=null,a.min=null,a.max=null);var i=d.hasTargetQuery(e.rqlQuery,h.target)?angular.copy(e.rqlQuery):g(e,h),j=c.prepareCriteriaTermsQuery(i,h);b[targetToType(a.target)]({query:j}).$promise.then(function(b){var d=c.getTargetAggregations(b,h,a.lang);d&&d.default&&(a.min=d.default.min,a.max=d.default.max)})}function f(){a.$parent.selectTerm(a.$parent.target,a.$parent.taxonomy,a.vocabulary,{from:a.from,to:a.to})}a.onKeypress=function(a){13!==a.keyCode&&"click"!==a.type||f()},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.vocabulary.isNumeric&&a.vocabulary.isOpen&&e(c,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,c,d){a.vocabulary.isNumeric&&d.name===a.vocabulary.name&&!d.isOpen&&e(a.criteria,d)})}]),ngObibaMica.search.controller("TaxonomiesFacetsController",["$scope","$timeout","TaxonomyResource","TaxonomiesResource","LocalizedValues","ngObibaMicaSearch","RqlQueryUtils","VocabularyService",function(a,b,c,d,e,f,g,h){function i(c){a.taxonomies[c]||d.get({target:c},function(d){a.taxonomies[c]=a.facetedTaxonomies[c].map(function(a){return d.filter(function(b){return a.name===b.name})[0]}).filter(function(a){return a}).map(function(a){return a.isOpen=!1,a.vocabularies="Maelstrom Research"===a.author?a.vocabularies:h.visibleFacetVocabularies(a.vocabularies),a.vocabularies.map(function(b){var c=h.findVocabularyAttributes(b,/^facet/i);b.isOpen="true"===c.facetExpanded,b.position=parseInt(c.facetPosition),b.limit=10,b.isMatch=h.isMatchVocabulary(b),b.isNumeric=h.isNumericVocabulary(b),a.isOpen=a.isOpen||b.isOpen}),a}),1===a.taxonomies[c].length&&(a.taxonomies[c][0].isOpen=1),a.criteria&&b(function(){a.$broadcast("ngObibaMicaQueryUpdated",a.criteria)})})}a.options=f.getOptions(),a.taxonomies={},a.targets=[],a.RqlQueryUtils=g,a.$watch("facetedTaxonomies",function(b){b&&(a.targets=a.options.targetTabsOrder.filter(function(a){if(b[a])return b[a].length}),a.target=a.targets[0],i(a.target))}),a.selectTerm=function(b,c,d,e){a.onSelectTerm(b,c,d,e)},a.setTarget=function(b){a.target=b,i(b)},a.loadVocabulary=function(b,c){a.$broadcast("ngObibaMicaLoadVocabulary",b,c)},a.localize=function(b){return e.forLocale(b,a.lang)},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.criteria=c})}]).directive("taxonomiesFacetsPanel",[function(){return{restrict:"EA",scope:{facetedTaxonomies:"=",onRefresh:"=",onSelectTerm:"=",lang:"=",criteria:"="},controller:"TaxonomiesFacetsController",templateUrl:"search/components/facets/taxonomy/component.html"}}]),ngObibaMica.search.controller("TermsVocabularyFacetController",["$scope","$filter","JoinQuerySearchResource","RqlQueryService","RqlQueryUtils",function(a,b,c,d,e){function f(a,b){return a.selectedTerms&&(a.rqlQuery.name===RQL_NODE.EXISTS||-1!==a.selectedTerms.indexOf(b.key))}function g(b,g){function h(a,b){var c=angular.copy(a.rqlQuery);return b.rqlQuery=e.buildRqlQuery(b),d.addCriteriaItem(c,b),c}var i=null,j=!1;a.loading=!0;var k=d.findCriterion(b,CriteriaIdGenerator.generate(a.$parent.taxonomy,g));if(k?j=!0:k=d.createCriteriaItem(a.target,a.$parent.taxonomy,a.vocabulary),e.hasTargetQuery(b.rqlQuery,k.target)){if(i=angular.copy(b.rqlQuery),!j){var l=k.target===QUERY_TARGETS.VARIABLE&&"Mica_variable"!==k.taxonomy.name?RQL_NODE.OR:RQL_NODE.AND;d.addCriteriaItem(i,k,l)}}else i=h(b,k);var m=d.prepareCriteriaTermsQuery(i,k,k.lang);c[targetToType(a.target)]({query:m}).$promise.then(function(b){a.vocabulary.visibleTerms=0,d.getTargetAggregations(b,k,k.lang).forEach(function(b){a.vocabulary.terms.some(function(c){if(c.name===b.key)return c.selected=f(k,b),c.count=b.count,c.isVisible=a.options.showFacetTermsWithZeroCount||b.count>0,a.vocabulary.visibleTerms+=c.isVisible,!0})}),a.loading=!1})}a.loading=!1,a.selectTerm=function(b,c,f,g){var h=f.terms.filter(function(a){return a.selected}).map(function(a){return a.name}),i=d.findCriterion(a.criteria,CriteriaIdGenerator.generate(c,f));i?(0===h.length?d.removeCriteriaItem(i):(i.rqlQuery.name=RQL_NODE.IN,e.updateQuery(i.rqlQuery,h)),a.onRefresh()):a.onSelectTerm(b,c,f,g)},a.$on("ngObibaMicaQueryUpdated",function(b,c){a.vocabulary.isNumeric||a.vocabulary.isMatch||!a.vocabulary.isOpen||g(c,a.vocabulary)}),a.$on("ngObibaMicaLoadVocabulary",function(b,c,d){d.name!==a.vocabulary.name||a.vocabulary.isNumeric||a.vocabulary.isMatch||d.isOpen||g(a.criteria,d)})}]),function(){function a(a){return{link:function(b,c,d){d.fullscreen&&b.$watch(d.fullscreen,function(b){var d=a.isEnabled();b&&!d?(a.enable(c[0]),c.addClass("isInFullScreen")):!b&&d&&(a.cancel(),c.removeClass("isInFullScreen"))})}}}ngObibaMica.search.directive("fullscreen",["FullScreenService",a])}(),function(){function a(){return{require:"ngInclude",link:function(a,b){b.replaceWith(b.children())}}}ngObibaMica.search.directive("includeReplace",a)}(),function(){function a(){function a(){d.onFilterChange({queryString:d.queryString})}function b(){d.queryString="",a()}function c(a){if(a.taxonomyName){var b=!1;d.taxonomiesQuery.forEach(function(a){a.name===d.taxonomyName&&a.queryString&&(d.queryString=a.queryString,b=!0)}),b||(d.queryString="")}}var d=this;d.$onChanges=c,d.change=a,d.clear=b}ngObibaMica.search.component("inputSearchFilter",{transclude:!0,bindings:{taxonomiesQuery:"<",taxonomyName:"<",queryString:"<",onFilterChange:"&"},templateUrl:"search/components/input-search-filter/component.html",controller:[a]})}(),function(){function a(){function a(a){d.onSelectTaxonomy({target:d.metaTaxonomy.name,taxonomy:a})}function b(){return targetToType(d.metaTaxonomy.name)}function c(){d.entityType=b()}var d=this;d.status={isFirstOpen:!0},d.selectTaxonomy=a,d.$onInit=c}ngObibaMica.search.component("metaTaxonomyFilterList",{transclude:!0,bindings:{metaTaxonomy:"<",showTaxonomyPanel:"<",rqlQuery:"<",onSelectTaxonomy:"&"},templateUrl:"search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html",controller:a})}(),function(){function a(a,b,c){function d(){a.getMetaTaxonomyForTargets(g.tabs).then(function(a){g.metaTaxonomies=a})}function e(a,d){g.selectedTaxonomy!==d?(g.selectedTaxonomy&&g.selectedTaxonomy.state.inactive(),g.selectedTaxonomy=d,g.selectedTaxonomy.state.active(),g.selectedTaxonomy.state.loading(),c(function(){b.getTaxonomies(a,d.info.names||d.info.name).then(function(b){g.selectedTaxonomy.state.loaded(),g.onToggle({target:a,taxonomy:b})})})):(g.selectedTaxonomy.state.none(),g.selectedTaxonomy=null,g.onToggle({target:a,taxonomy:g.selectedTaxonomy}))}function f(a){g.selectedTaxonomy&&a.showTaxonomyPanel&&!0!==a.showTaxonomyPanel.currentValue&&(g.selectedTaxonomy.state.none(),g.selectedTaxonomy=null)}var g=this;g.selectedTaxonomy=null,g.onSelectTaxonomy=e,g.$onChanges=f,g.$onInit=d}ngObibaMica.search.component("metaTaxonomyFilterPanel",{bindings:{tabs:"<",showTaxonomyPanel:"<",onToggle:"&",rqlQuery:"<"},templateUrl:"search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html",controller:["MetaTaxonomyService","TaxonomyService","$timeout",a]})}(),function(){function a(a,b,c,d,e,f,g,h,i,j){function k(){f.get({target:b.taxonomies.target},function(a){b.taxonomies.all=a,l(a,b.taxonomies.target),b.taxonomies.search.active=!1,m.updateStateFromLocation()})}BaseTaxonomiesController.call(this,a,b,c,d,e,f,g,h,i,j);var l=function(a,c){var d=a.reduce(function(a,b){if(c)return b.vocabularies=j.visibleVocabularies(b.vocabularies),a[b.name]=b,a},{});return b.metaTaxonomy.$promise.then(function(a){var e=a.vocabularies.filter(function(a){return a.name===c})[0];b.taxonomyGroups=e.terms.map(function(a){if(!a.terms){var c=d[a.name];return c?(c.title=a.title,c.description=a.description,{title:null,taxonomies:[c]}):null}var e=a.terms.map(function(a){var b=d[a.name];return b?(b.title=a.title,b.description=a.description,b):null}).filter(function(a){return a}),f=a.title.filter(function(a){return a.locale===b.lang})[0],g=a.description?a.description.filter(function(a){return a.locale===b.lang})[0]:void 0;return{title:f?f.text:null,description:g?g.text:null,taxonomies:e}}).filter(function(a){return a})})},m=this;b.$watch("target",function(a){a&&(b.taxonomies.target=a,b.taxonomies.search.active=!0,b.taxonomies.all=null,b.taxonomies.taxonomy=null,b.taxonomies.vocabulary=null,b.taxonomies.term=null,k())}),this.refreshTaxonomyCache=function(){b.clearCache(),k()},b.refreshTaxonomyCache=this.refreshTaxonomyCache}ngObibaMica.search.controller("ClassificationPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","VocabularyService",a]).directive("classificationsPanel",[function(){return{restrict:"EA",replace:!0,scope:{target:"=",onSelectTerm:"=",isHistoryEnabled:"=",lang:"="},controller:"ClassificationPanelController",templateUrl:"search/components/panel/classification/component.html"}}])}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,c){e.get({target:a,taxonomy:c},function(a){b.taxonomies.taxonomy=a,b.taxonomies.vocabulary=null,b.taxonomies.term=null,b.taxonomies.search.active=!1},function(a){b.taxonomies.search.active=!1,j.alert({id:"SearchController",type:"danger",msg:k.buildMessage(a),delay:5e3})})}BaseTaxonomiesController.call(this,a,b,c,d,e,f,g,h,i,l),b.$watchGroup(["taxonomyName","target"],function(a){a[0]&&a[1]&&(b.showTaxonomies&&b.showTaxonomies(),b.taxonomies.target=a[1],b.taxonomies.search.active=!0,b.taxonomies.all=null,b.taxonomies.taxonomy=null,b.taxonomies.vocabulary=null,b.taxonomies.term=null,m(a[1],a[0]))}),this.refreshTaxonomyCache=function(a,c){b.clearCache(),m(a,c)},b.refreshTaxonomyCache=this.refreshTaxonomyCache}ngObibaMica.search.controller("TaxonomiesPanelController",["$rootScope","$scope","$translate","$location","TaxonomyResource","TaxonomiesResource","ngObibaMicaSearch","RqlQueryUtils","$cacheFactory","AlertService","ServerErrorUtils","VocabularyService",a]).controller("NumericVocabularyPanelController",["$scope",function(a){a.$watch("taxonomies",function(){a.from=null,a.to=null},!0)}]).controller("MatchVocabularyPanelController",["$scope",function(a){a.$watch("taxonomies",function(){a.text=null},!0)}]).directive("taxonomiesPanel",[function(){return{restrict:"EA",replace:!0,scope:{taxonomyName:"=",target:"=",onClose:"=",onSelectTerm:"=",taxonomiesShown:"=",lang:"="},controller:"TaxonomiesPanelController",templateUrl:"search/components/panel/taxonomies-panel/component.html",link:function(a,b){a.closeTaxonomies=function(){b.collapse("hide"),a.onClose()},a.showTaxonomies=function(){b.collapse("show")},b.on("show.bs.collapse",function(){a.taxonomiesShown=!0}),b.on("hide.bs.collapse",function(){a.taxonomiesShown=!1}),a.$watch("taxonomiesShown",function(a){a?b.collapse("show"):b.collapse("hide")})}}}])}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{taxonomy:"=",lang:"=",onNavigate:"="},templateUrl:"search/components/panel/taxonomy-panel/component.html"}}ngObibaMica.search.directive("taxonomyPanel",[a])}(),function(){function a(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",term:"=",lang:"=",onSelect:"="},templateUrl:"search/components/panel/term-panel/component.html"}}ngObibaMica.search.directive("termPanel",[a])}(),function(){ngObibaMica.search.VocabularyPanel=function(){return{restrict:"EA",replace:!0,scope:{target:"=",taxonomy:"=",vocabulary:"=",lang:"=",onNavigate:"=",onSelect:"=",onHideSearchNavigate:"=",isInHideNavigate:"="},templateUrl:"search/components/panel/vocabulary-panel/component.html"}},ngObibaMica.search.directive("vocabularyPanel",[ngObibaMica.search.VocabularyPanel])}();var CellStatValueController=function(){function a(a){this.$log=a}return a.prototype.clickCriteria=function(){this.updateCriteria()},a.prototype.$onInit=function(){this.resultTabOrder.indexOf(this.destinationTab)<0&&(this.disable=!0)},a.$inject=["$log"],a}(),CellStatValueComponent=function(){function a(){this.transclude=!0,this.bindings={destinationTab:"@",entityCount:"<",resultTabOrder:"<",updateCriteria:"&"},this.controller=CellStatValueController,this.controllerAs="$ctrl",this.templateUrl="search/components/result/cell-stat-value/component.html"}return a}();ngObibaMica.search.component("cellStatValue",new CellStatValueComponent),ngObibaMica.search.controller("CoverageResultTableController",["$scope","$location","$q","$translate","$filter","LocalizedValues","PageUrlService","RqlQueryUtils","RqlQueryService","CoverageGroupByService","StudyFilterShortcutService","TaxonomyService","AlertService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){for(var c=0,d=0,e=0;e<b.length;e++)c>=a[d].termsCount&&(d++,c=0),c+=b[e].termsCount,b[e].taxonomyName=a[d].entity.name}function o(a,b,c){var d=0;return a.reduce(function(a,e){return a[e.entity.name]=b.slice(d,d+e.termsCount).map(function(a){return e.termsCount>1&&"vocabularyName"===c&&(a.canRemove=!0),a[c]=e.entity.name,a}),d+=e.termsCount,a},{})}function p(b){b?a.selectBucket(BUCKET_TYPES.DCE):a.bucket.startsWith("dce")&&a.selectBucket(BUCKET_TYPES.STUDY)}function q(a,b){a!==b&&p(a)}function r(){var c=k.getStudyClassNameChoices();c.choseAll?a.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:c.choseIndividual?a.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:c.choseHarmonization&&(a.bucketSelection._studySelection=ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES),angular.extend(a,c);var d=b.search().bucket;d!==BUCKET_TYPES.STUDY&&d!==BUCKET_TYPES.DCE||(a.bucketSelection._dceBucketSelected=d===BUCKET_TYPES.DCE)}function s(){var c=b.search();c.display&&c.display===DISPLAY_TYPES.COVERAGE&&(a.bucket=c.bucket?c.bucket:j.defaultBucket(),a.bucketStartsWithDce=a.bucket.startsWith("dce"),a.singleStudy=j.isSingleStudy(),r())}function t(b){a.groupByOptions.canShowVariableTypeFilter(b)?a.selectBucket(b):BUCKET_TYPES.STUDY!==b&&a.selectBucket(BUCKET_TYPES.DCE)}function u(b){a.selectBucket(b)}function v(){return a.bucket.indexOf("study")>-1||a.bucket.indexOf("dce")>-1}function w(){return a.bucket.indexOf("dataset")>-1}function x(b){b===BUCKET_TYPES.STUDY?t(a.bucketSelection.dceBucketSelected||a.groupByOptions.isSingleStudy()?BUCKET_TYPES.DCE:BUCKET_TYPES.STUDY):b===BUCKET_TYPES.DATASET&&u(BUCKET_TYPES.DATASET)}function y(a,b){switch(a){case BUCKET_TYPES.STUDY:case BUCKET_TYPES.STUDY_INDIVIDUAL:case BUCKET_TYPES.DCE:case BUCKET_TYPES.DCE_INDIVIDUAL:return g.studyPage(b,"individual");case BUCKET_TYPES.STUDY_HARMONIZATION:case BUCKET_TYPES.DCE_HARMONIZATION:return g.studyPage(b,"harmonization");case BUCKET_TYPES.NETWORK:return g.networkPage(b);case BUCKET_TYPES.DATASCHEMA:case BUCKET_TYPES.DATASET_HARMONIZED:return g.datasetPage(b,"harmonized");case BUCKET_TYPES.DATASET:case BUCKET_TYPES.DATASET_COLLECTED:return g.datasetPage(b,"collected")}return""}function z(c){var g=a.bucket.startsWith("dce")?"dceId":"id",h="search.criterion.created",j=i.parseQuery(b.search().query),k=i.findTargetQuery(E[a.bucket],j);k||(k=new RqlQuery(E[a.bucket]),j.args.push(k));var n,o=i.findQueryInTargetByVocabulary(k,g);if(o?(h="search.criterion.updated",n=o,n.name===RQL_NODE.EXISTS&&(n.name=RQL_NODE.IN)):n=new RqlQuery(RQL_NODE.IN),n.args=["Mica_"+E[a.bucket]+"."+g],n.args.push(c.map(function(a){return a.value})),!o)if(k.args.length>0){var p=new RqlQuery(RQL_NODE.AND);k.args.forEach(function(a){p.args.push(a)}),p.args.push(n),k.args=[p]}else k.args=[n];b.search("query",(new RqlQuery).serializeArgs(j.args)),l.findVocabularyInTaxonomy(E[a.bucket],"Mica_"+E[a.bucket],g).then(function(b){m.growl({id:"SearchControllerGrowl",type:"info",msgKey:h,msgArgs:[b?f.forLocale(b.title,d.use()):g,e("translate")("taxonomy.target."+E[a.bucket])],delay:3e3})})}function A(){function b(a){var b;return k[a]?(b=0,k[a]=k[a]+1):(b=1,k[a]=1),b}function c(a,b,c){l[a]?(b<l[a][0]&&(l[a][0]=b),c>l[a][1]&&(l[a][1]=c)):l[a]=[b,c]}function d(a,b){var c;if(a)if(a.indexOf("-")>0){var d=a.split("-");if(!b){var e=parseInt(d[1]);e<12?d[1]=e+1:(d[0]=parseInt(d[0])+1,d[1]=1)}var f=d[0]+"/"+d[1]+"/01";c=Date.parse(f)}else c=b?Date.parse(a+"/01/01"):Date.parse(a+"/12/31");return c}function e(a,b){var c=d(a,!0),e=b?d(b,!1):p,f=e<p?e:p;return e===c?100:Math.round(a?100*(f-c)/(e-c):0)}var h,i={colSpan:a.bucket.startsWith("dce")?j.isSingleStudy()?2:3:1,ids:{}},k={},l={},m=(new Date).getFullYear(),n=(new Date).getMonth()+1,o=m+"-"+n,p=d(o,!0),q=!0;return a.result.rows.forEach(function(d,k){if(d.hitsTitles=d.hits.map(function(a){return f.formatNumber(a)}),i.ids[d.value]=[],a.bucket.startsWith("dce")){var l,n,p=d.value.split(":"),r=d.className.indexOf("Harmonization")>-1||"."===p[2],s=d.title.split(":"),t=d.description.split(":");n=p[0],h?n!==h&&(q=!q,h=n):h=n,l=b(n),c(n,d.start||o,d.end||o),i.ids[d.value].push({id:j.isSingleStudy()?"-":n,url:g.studyPage(n,r?"harmonization":"individual"),title:s[0],description:t[0],rowSpan:l,index:k++}),n=p[0]+":"+p[1],l=b(n),i.ids[d.value].push({id:n,url:g.studyPopulationPage(p[0],r?"harmonization":"individual",p[1]),title:s[1],description:t[1],rowSpan:l,index:k++}),i.ids[d.value].push({id:r?"-":d.value,title:s[2],description:t[2],start:d.start,current:o,end:d.end,progressClass:q?"info":"warning",url:g.StudyDcePage(p[0],r?"harmonization":"individual",d.value),rowSpan:1,index:k++})}else{var u=a.bucket.split("-"),v=u[0];v===BUCKET_TYPES.DATASET?v+=d.className.indexOf("Harmonization")>-1?"-harmonized":"-collected":v+=d.className.indexOf("Harmonization")>-1?"-harmonization":"-individual",i.ids[d.value].push({id:d.value,url:y(v,d.value),title:d.title,description:d.description,min:d.start,start:d.start,current:m,end:d.end,max:d.end,progressStart:0,progress:e(d.start?d.start+"-01":o,d.end?d.end+"-12":o),progressClass:q?"info":"warning",rowSpan:1,index:k++}),q=!q}}),a.bucket.startsWith("dce")&&a.result.rows.forEach(function(a,b){a.hitsTitles=a.hits.map(function(a){return f.formatNumber(a)}),i.ids[a.value][0].rowSpan>0&&(i.ids[a.value][0].rowSpan=k[i.ids[a.value][0].id]),i.ids[a.value][1].rowSpan>0&&(i.ids[a.value][1].rowSpan=k[i.ids[a.value][1].id]);var c=a.value.split(":");if(l[c[0]]){var e=l[c[0]][0],g=l[c[0]][1],h=i.ids[a.value][2].start||o,j=i.ids[a.value][2].end||o,m=d(g,!1)-d(e,!0);i.ids[a.value][2].min=e,i.ids[a.value][2].max=g,i.ids[a.value][2].progressStart=100*(d(h,!0)-d(e,!0))/m,i.ids[a.value][2].progress=100*(d(j,!1)-d(h,!0))/m,i.ids[a.value].index=b}}),i}function B(a){return a.reduce(function(a,b){return a?(i.updateCriteriaItem(a,b),a):(b.rqlQuery=h.buildRqlQuery(b),b)},null)}function C(b){k.filter(b,a.lang)}function D(){s()}var E={},F={};E[BUCKET_TYPES.NETWORK]=QUERY_TARGETS.NETWORK,E[BUCKET_TYPES.STUDY]=QUERY_TARGETS.STUDY,E[BUCKET_TYPES.STUDY_INDIVIDUAL]=QUERY_TARGETS.STUDY,E[BUCKET_TYPES.STUDY_HARMONIZATION]=QUERY_TARGETS.STUDY,E[BUCKET_TYPES.DCE]=QUERY_TARGETS.VARIABLE,E[BUCKET_TYPES.DCE_INDIVIDUAL]=QUERY_TARGETS.VARIABLE,E[BUCKET_TYPES.DCE_HARMONIZATION]=QUERY_TARGETS.VARIABLE,E[BUCKET_TYPES.DATASCHEMA]=QUERY_TARGETS.DATASET,E[BUCKET_TYPES.DATASET]=QUERY_TARGETS.DATASET,E[BUCKET_TYPES.DATASET_COLLECTED]=QUERY_TARGETS.DATASET,E[BUCKET_TYPES.DATASET_HARMONIZED]=QUERY_TARGETS.DATASET,a.showMissing=!0,a.toggleMissing=function(b){a.showMissing=b},a.groupByOptions=j,a.bucketSelection={get studySelection(){return this._studySelection},set studySelection(b){this._studySelection=b,!a.bucket||a.bucket&&(a.bucket.indexOf(BUCKET_TYPES.STUDY)>-1||a.bucket.indexOf(BUCKET_TYPES.DCE)>-1)?t(a.bucket.split("-")[0]):a.bucket&&a.bucket.indexOf(BUCKET_TYPES.DATASET)>-1&&u(a.bucket.split("-")[0]),C(b)},get dceBucketSelected(){return this._dceBucketSelected},set dceBucketSelected(a){var b=this._dceBucketSelected;this._dceBucketSelected=a,q(a,b)}},a.isStudyBucket=v,a.isDatasetBucket=w,a.selectTab=x,a.selectBucket=function(b){a.bucket=b,a.$parent.onBucketChanged(b)},a.$on("$locationChangeSuccess",s),a.rowspans={},a.getSpan=function(b,c){var d=0;if(c){var e=b+":"+c;return d=a.result.rows.filter(function(a){return a.title.startsWith(e+":")}).length,a.rowspans[e]=d,d}return d=a.result.rows.filter(function(a){return a.title.startsWith(b+":")}).length,a.rowspans[b]=d,d},a.hasSpan=function(b,c){return c?a.rowspans[b+":"+c]>0:a.rowspans[b]>0},a.hasVariableTarget=function(){var a=b.search().query;return a&&h.hasTargetQuery(i.parseQuery(a),RQL_NODE.VARIABLE)},a.hasSelected=function(){return a.table&&a.table.rows&&a.table.rows.filter(function(a){return a.selected}).length},a.selectAll=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.selected=!0})},a.selectNone=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.selected=!1})},a.selectFull=function(){a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.hits?a.selected=0===a.hits.filter(function(a){return 0===a}).length:a.selected=!1})},a.BUCKET_TYPES=BUCKET_TYPES,a.downloadUrl=function(){return g.downloadCoverage(a.query)},a.$watch("result",function(){if(a.table={cols:[]},F={},a.result&&a.result.rows){var b=a.result;b.cols=A(),a.table=b,F=o(a.table.vocabularyHeaders,a.table.termHeaders,"vocabularyName"),o(a.table.taxonomyHeaders,a.table.termHeaders,"taxonomyName"),n(a.table.taxonomyHeaders,a.table.vocabularyHeaders)}}),a.updateCriteria=function(b,d,e,f){var g=a.bucket.startsWith("dce")?"dceId":"id",h={varItem:i.createCriteriaItem(QUERY_TARGETS.VARIABLE,d.taxonomyName,d.vocabularyName,d.entity.name)};if(b){var j=a.bucket.split("-")[0];if("dce"===j&&b.endsWith(":.")){j="study";var k=b.split(":")[0];h.item=i.createCriteriaItem(E[j],"Mica_"+E[j],"id",k)}else h.item=i.createCriteriaItem(E[j],"Mica_"+E[j],g,b)}else a.bucket.endsWith("individual")?h.item=i.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","Study"):a.bucket.endsWith("harmonization")?h.item=i.createCriteriaItem(QUERY_TARGETS.STUDY,"Mica_"+QUERY_TARGETS.STUDY,"className","HarmonizationStudy"):a.bucket.endsWith("collected")?h.item=i.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","StudyDataset"):a.bucket.endsWith("harmonized")&&(h.item=i.createCriteriaItem(QUERY_TARGETS.DATASET,"Mica_"+QUERY_TARGETS.DATASET,"className","HarmonizationDataset"));c.all(h).then(function(b){a.onUpdateCriteria(b.varItem,f,!1,!0),b.item&&a.onUpdateCriteria(b.item,f),b.bucketItem&&a.onUpdateCriteria(b.bucketItem,f)})},a.isFullCoverageImpossibleOrCoverageAlreadyFull=function(){var b=a.table?a.table.rows||[]:[],c=0;return 0===b.length||(b.forEach(function(a){a.hits&&a.hits.filter(function(a){return 0===a}).length>0&&c++}),0===c||b.length===c)},a.selectFullAndFilter=function(){var b=[];a.table&&a.table.rows&&a.table.rows.forEach(function(a){a.hits&&0===a.hits.filter(function(a){return 0===a}).length&&b.push(a)}),z(b,!0)},a.updateFilterCriteria=function(){z(a.table.rows.filter(function(a){return a.selected}))},a.removeTerm=function(b){var d=F[b.vocabularyName].filter(function(a){return a.entity.name!==b.entity.name}).map(function(a){return i.createCriteriaItem(QUERY_TARGETS.VARIABLE,a.taxonomyName,a.vocabularyName,a.entity.name)});c.all(d).then(function(b){a.onUpdateCriteria(B(b),null,!0,!1,!1)})},a.removeVocabulary=function(b){i.createCriteriaItem(QUERY_TARGETS.VARIABLE,b.taxonomyName,b.entity.name).then(function(b){a.onRemoveCriteria(b)})},D()}]).directive("coverageResultTable",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",bucket:"=",query:"=",criteria:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"CoverageResultTableController",templateUrl:"search/components/result/coverage-result/component.html"}}]),function(){function a(a,b,c,d,e,f){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:f.getTemplateUrl("searchDatasetsResultTable"),link:function(f){f.classNames={},d.get({target:"dataset",taxonomy:"Mica_dataset"}).$promise.then(function(b){b.vocabularies?f.classNames=b.vocabularies.filter(function(a){return"className"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{}):a.warn("Taxonomy has no vocabularies")}),f.updateCriteria=function(a,b){e.createCriteriaItem("dataset","Mica_dataset","id",a).then(function(a){f.onUpdateCriteria(a,b)})};var g=c.getOptions();f.options=g.datasets,f.resultTabOrder=g.resultTabsOrder,f.optionsCols=f.options.datasetsColumn,f.PageUrlService=b}}}ngObibaMica.search.directive("datasetsResultTable",["$log","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService","ngObibaMicaSearchTemplateUrl",a])}(),ngObibaMica.search.controller("GraphicsResultController",["GraphicChartsConfig","GraphicChartsUtils","RqlQueryService","$filter","$scope","D3GeoConfig","D3ChartConfig",function(a,b,c,d,e,f,g){e.hasChartObjects=function(){return e.chartObjects&&Object.keys(e.chartObjects).length>0};var h=function(a,c,d,e,f,g){return b.getArrayByAggregation(a,c).then(function(b){var c=b.map(function(a){return a.participantsNbr&&g?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});if(c.length>0)return c.unshift(d),angular.extend(f,{title:e}),{data:c,entries:b,options:f,vocabulary:a}})},i=a.getOptions().ChartsOptions;e.updateCriteria=function(a,b){c.createCriteriaItem("study","Mica_study",b,a).then(function(a){e.onUpdateCriteria(a,"studies")})},e.$watch("result",function(a){e.chartObjects={},e.noResults=!0,a&&a.studyResultDto.totalHits&&(e.noResults=!1,h("populations-model-selectionCriteria-countriesIso",a.studyResultDto,[d("translate")(i.geoChartOptions.header[0]),d("translate")(i.geoChartOptions.header[1])],d("translate")(i.geoChartOptions.title)+" (N="+a.studyResultDto.totalHits+")",i.geoChartOptions.options).then(function(b){if(b){var c=(new f).withData(b.entries).withTitle(d("translate")(i.geoChartOptions.title)+" (N="+a.studyResultDto.totalHits+")");c.withColor(i.geoChartOptions.options.colors);var g={geoChartOptions:{directiveTitle:b.options.title,headerTitle:d("translate")("graphics.geo-charts"),chartObject:{geoTitle:b.options.title,options:b.options,type:"GeoChart",vocabulary:b.vocabulary,data:b.data,entries:b.entries,d3Config:c}}};g.geoChartOptions.getTable=function(){return g.geoChartOptions.chartObject},angular.extend(e.chartObjects,g)}}),h("model-methods-design",a.studyResultDto,[d("translate")(i.studiesDesigns.header[0]),d("translate")(i.studiesDesigns.header[1])],d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")",i.studiesDesigns.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("multiBarHorizontalChart").withTitle(d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!1,d("translate")("graphics.nbr-studies"));c.options.chart.showLegend=!1,c.options.chart.color=i.numberParticipants.options.colors;var f={studiesDesigns:{headerTitle:d("translate")("graphics.study-design"),chartObject:{options:b.options,type:"BarChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};angular.extend(e.chartObjects,f)}}),h("model-methods-design",a.studyResultDto,[d("translate")(i.studiesDesigns.header[0]),d("translate")(i.studiesDesigns.header[1]),d("translate")(i.studiesDesigns.header[2])],d("translate")(i.studiesDesigns.title)+" (N="+a.studyResultDto.totalHits+")",i.studiesDesigns.options,!0).then(function(a){if(a){var b={chartObjectTable:{options:a.options,type:"BarChart",data:a.data,vocabulary:a.vocabulary,entries:a.entries}};b.getTable=function(){return b.chartObjectTable},angular.extend(e.chartObjects.studiesDesigns,b)}}),h("model-numberOfParticipants-participant-number-range",a.studyResultDto,[d("translate")(i.numberParticipants.header[0]),d("translate")(i.numberParticipants.header[1])],d("translate")(i.numberParticipants.title)+" (N="+a.studyResultDto.totalHits+")",i.numberParticipants.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("pieChart").withTitle(d("translate")(i.numberParticipants.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!0);c.options.chart.legendPosition="right",c.options.chart.color=i.numberParticipants.options.colors;var f={numberParticipants:{headerTitle:d("translate")("graphics.number-participants"),chartObject:{options:b.options,type:"PieChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};f.numberParticipants.getTable=function(){return f.numberParticipants.chartObject},angular.extend(e.chartObjects,f)}}),h("populations-dataCollectionEvents-model-bioSamples",a.studyResultDto,[d("translate")(i.biologicalSamples.header[0]),d("translate")(i.biologicalSamples.header[1])],d("translate")(i.biologicalSamples.title)+" (N="+a.studyResultDto.totalHits+")",i.biologicalSamples.options).then(function(b){if(b){var c=new g(b.vocabulary).withType("multiBarHorizontalChart").withTitle(d("translate")(i.biologicalSamples.title)+" (N="+a.studyResultDto.totalHits+")").withData(angular.copy(b.entries),!1,d("translate")("graphics.nbr-studies"));c.options.chart.showLegend=!1,c.options.chart.color=i.numberParticipants.options.colors;var f={biologicalSamples:{headerTitle:d("translate")("graphics.bio-samples"),chartObject:{options:b.options,type:"BarChart",data:b.data,vocabulary:b.vocabulary,entries:b.entries,d3Config:c}}};f.biologicalSamples.getTable=function(){return f.biologicalSamples.chartObject},angular.extend(e.chartObjects,f)}}))})}]).directive("graphicsResult",[function(){return{restrict:"EA",replace:!0,scope:{result:"=",loading:"=",onUpdateCriteria:"="},controller:"GraphicsResultController",templateUrl:"search/components/result/graphics-result/component.html"}}]),function(){function a(a,b,c,d,e){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:e.getTemplateUrl("searchNetworksResultTable"),link:function(e){function f(){var a=d.getStudyClassNameChoices();angular.extend(e,a),e.colSpans={datasets:(e.optionsCols.showNetworksStudyDatasetColumn&a.choseIndividual)+(e.optionsCols.showNetworksHarmonizationDatasetColumn&a.choseHarmonization),variables:(e.optionsCols.showNetworksStudyVariablesColumn&a.choseIndividual)+(e.optionsCols.showNetworksDataschemaVariablesColumn&a.choseHarmonization)}}var g=b.getOptions();e.options=g.networks,e.resultTabOrder=g.resultTabsOrder,e.optionsCols=e.options.networksColumn,e.PageUrlService=a,e.$on("$locationChangeSuccess",function(){f()}),e.updateCriteria=function(a,b,d){var f;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(f=b,b="datasets");var g;"HarmonizationStudy"!==b&&"Study"!==b||(g=b,b="studies");var h;"DataschemaVariable"!==b&&"CollectedVariable"!==b||(h=b.replace("Variable",""),b="variables"),b=d||b,c.createCriteriaItem("network","Mica_network","id",a).then(function(a){f?c.createCriteriaItem("dataset","Mica_dataset","className",f).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):g?c.createCriteriaItem("study","Mica_study","className",g).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):h?c.createCriteriaItem("variable","Mica_variable","variableType",h).then(function(c){e.onUpdateCriteria(a,b),e.onUpdateCriteria(c,b)}):e.onUpdateCriteria(a,b)})},f()}}}ngObibaMica.search.directive("networksResultTable",["PageUrlService","ngObibaMicaSearch","RqlQueryService","StudyFilterShortcutService","ngObibaMicaSearchTemplateUrl",a])}();var SearchResultPaginationController=function(){function a(a){this.PaginationService=a,this.preventPageChangeEvent=!1}return a.prototype.onUpdate=function(a,b){this.preventPageChangeEvent=b,this.pagination=a,this.showPaginationTotal=!0===this.showTotal&&this.pagination.pageCount>1},a.prototype.pageChanged=function(){this.onChange({from:(this.pagination.currentPage-1)*this.pagination.selected.value,replace:!0===this.preventPageChangeEvent,size:this.pagination.selected.value,target:this.target})},a.prototype.pageSizeChanged=function(){this.pageChanged()},a.prototype.$onInit=function(){this.PaginationService.registerListener(this.target,this)},a.$inject=["PaginationService"],a}(),SearchResultPaginationComponent=function(){function a(){this.templateUrl="search/components/result/pagination/component.html",this.transclude=!1,this.transclude=!0,this.bindings={onChange:"&",showTotal:"<",target:"<"},this.controller=SearchResultPaginationController,this.controllerAs="$ctrl"}return a}();ngObibaMica.search.component("searchResultPagination",new SearchResultPaginationComponent),ngObibaMica.search.controller("SearchResultController",["$scope","ngObibaMicaSearch","ngObibaMicaUrl","RqlQueryService","RqlQueryUtils","ngObibaMicaSearchTemplateUrl","AlertService","SetService","SearchResultSelectionsService","$uibModal","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){function l(b){Object.keys(a.activeTarget).forEach(function(c){a.activeTarget[c].active=b===c})}function m(b,c){var f=d.parseQuery(a.query),g=typeToTarget(a.type);return e.rewriteQueryWithLimitAndFields(f,g,b,c)}a.targetTypeMap=a.$parent.taxonomyTypeMap,a.QUERY_TARGETS=QUERY_TARGETS,a.QUERY_TYPES=QUERY_TYPES,a.options=b.getOptions(),a.activeTarget={},a.activeTarget[QUERY_TYPES.VARIABLES]={active:!1,name:QUERY_TARGETS.VARIABLE},a.activeTarget[QUERY_TYPES.DATASETS]={active:!1,name:QUERY_TARGETS.DATASET},a.activeTarget[QUERY_TYPES.STUDIES]={active:!1,name:QUERY_TARGETS.STUDY},a.activeTarget[QUERY_TYPES.NETWORKS]={active:!1,name:QUERY_TARGETS.NETWORK},a.getUrlTemplate=function(a){switch(a){case"list":return f.getTemplateUrl("searchResultList");case"coverage":return f.getTemplateUrl("searchResultCoverage");case"graphics":return f.getTemplateUrl("searchResultGraphics")}},a.selectType=function(b){l(b),a.type=b,a.$parent.onTypeChanged(b)},a.getTotalHits=function(b){return a.result.list&&a.result.list[b+"ResultDto"]?a.result.list[b+"ResultDto"].totalHits:"..."},a.getSelectionsReportUrl=function(){if(QUERY_TYPES.VARIABLES!==a.type)return a.getReportUrl();var b=e.createSelectionsQuery(d.parseQuery(a.query),typeToTarget(a.type),1e5,null,i.getSelectionIds(a.type));return k(function(){i.clearSelections(a.type)}),c.getUrl("JoinQuerySearchCsvResource").replace(":type",a.type).replace(":query",encodeURI(b))},a.getReportUrl=function(){if(null===a.query)return a.query;var b=m(1e5);return c.getUrl("JoinQuerySearchCsvResource").replace(":type",a.type).replace(":query",encodeURI(b))},a.onCartUpdate=function(b,d){var e=d.count-(b?b.count:0);SetsAlertBuilder.newBuilder(g).withCount(e).withMsgKey("sets.cart.variables-added").withEmptyMsgKey("sets.cart.no-variable-added").withRedirectUrl(c.getUrl("CartPage")).showAlert(),i.clearSelections(a.type)},a.onSetUpdate=function(b,d,e){SetsAlertBuilder.newBuilder(g).withId(b).withName(d).withCount(e).withMsgKey("sets.set.variables-added").withEmptyMsgKey("sets.set.no-variable-added").withRedirectUrl(c.getUrl("SetsPage")).showAlert(),i.clearSelections(a.type)},a.addToCart=function(b){var c=i.getSelections(a.type),d=c?Object.keys(c):null;if(null===a.query)return a.query;var e=h.getCartSet(b);if(d&&d.length>0)h.addDocumentToCart(b,d).then(function(b){a.onCartUpdate(e,b)});else{var f=m(h.getMaxItemsPerSets(),["id"]);h.addDocumentQueryToCart("variables",f).then(function(b){a.onCartUpdate(e,b)})}},a.addToSet=function(b){var c=i.getSelections(a.type);j.open({keyboard:!1,component:"addToSetModal",resolve:{query:function(){return a.query},type:function(){return b},ids:function(){return c}}}).result.then(function(b){a.onSetUpdate(b.id,b.name,b.newCount)})},a.getSelections=function(){var b=i.getSelections(a.type);return b?Object.keys(b):null},a.getStudySpecificReportUrl=function(){if(null===a.query)return a.query;var b=d.parseQuery(a.query),f=typeToTarget(a.type),g=b.args.filter(function(a){return a.name===f}).pop();e.addLimit(g,e.limit(0,1e5));var h=(new RqlQuery).serializeArgs(b.args);return c.getUrl("JoinQuerySearchCsvReportResource").replace(":type",a.type).replace(":query",encodeURI(h))},a.$watchCollection("result",function(){a.result.list&&(a.activeTarget[QUERY_TYPES.VARIABLES].totalHits=a.result.list.variableResultDto.totalHits,a.activeTarget[QUERY_TYPES.DATASETS].totalHits=a.result.list.datasetResultDto.totalHits,a.activeTarget[QUERY_TYPES.STUDIES].totalHits=a.result.list.studyResultDto.totalHits,a.activeTarget[QUERY_TYPES.NETWORKS].totalHits=a.result.list.networkResultDto.totalHits)}),a.$watch("type",function(a){l(a)}),a.DISPLAY_TYPES=DISPLAY_TYPES,h.serverConfig().then(function(b){a.userCanCreateCart=b.currentUserCanCreateCart,a.userCanCreateSets=b.currentUserCanCreateSets})}]).directive("resultPanel",[function(){return{restrict:"EA",replace:!0,scope:{type:"=",bucket:"=",query:"=",criteria:"=",display:"=",result:"=",lang:"=",loading:"=",pagination:"<",searchTabsOrder:"=",resultTabsOrder:"=",onTypeChanged:"=",onBucketChanged:"=",onPaginate:"=",onUpdateCriteria:"=",onRemoveCriteria:"="},controller:"SearchResultController",templateUrl:"search/components/result/search-result/component.html"}}]);var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),SearchResultSelectionsDecorator=function(a){function b(b,c){var d=a.call(this,b)||this;return d.PaginationService=c,d.PaginationService.registerListener(d.documentType,d),d}return __extends(b,a),b.prototype.decorate=function(b){a.prototype.decorate.call(this,b),this.component.select=this.select.bind(this),this.component.selectPage=this.selectPage.bind(this),this.component.selectAll=this.selectAll.bind(this)},b.prototype.getSelections=function(){return this.component.page.all?[]:a.prototype.getSelections.call(this)},b.prototype.getSelectionIds=function(){return this.component.page.all?[]:a.prototype.getSelectionIds.call(this)},b.prototype.update=function(){var a=this;this.component.selections&&Object.keys(this.component.selections).forEach(function(b){return a.component.selections[b]?a.component.selections[b]=!0:delete a.component.selections[b]})},b.prototype.selectPage=function(){this.selectPageInternal(this.component.page.selections[this.component.pagination.currentPage])},b.prototype.select=function(a){var b=this,c=this.component.selections[a],d=this.component.page.selections[this.component.pagination.currentPage];if(c){this.component.summaries.reduce(function(a,c){return a&&b.component.selections[c.id]},!0)&&(this.component.page.selections[this.component.pagination.currentPage]=!0)}else d&&(this.component.page.all&&(this.component.page.all=!1),this.selectPageInternal(d),delete this.component.page.selections[this.component.pagination.currentPage]),delete this.component.selections[a]},b.prototype.selectAll=function(){this.component.page.all=!this.component.page.all,this.component.page.all?this.selectPageInternal(this.component.page.all):this.clearSelections()},b.prototype.onUpdate=function(a){var b=this.component.pagination;this.component.pagination=a,b&&(b.pageCount!==a.pageCount?this.clearSelections():b.currentPage!==a.currentPage&&this.component.page.all&&this.selectPageInternal(this.component.page.all))},b.prototype.selectPageInternal=function(a){var b=this;a?this.component.page.selections[this.component.pagination.currentPage]=a:(this.component.page.all=!1,delete this.component.page.selections[this.component.pagination.currentPage]),this.component.summaries.forEach(function(c){return a?b.component.selections[c.id]=a:delete b.component.selections[c.id]})},b}(AbstractSelectionsDecorator);!function(){function a(a,b,c,d,e,f,g,h,i,j){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"=",onUpdateCriteria:"="},templateUrl:i.getTemplateUrl("searchStudiesResultTable"),link:function(c){function i(a){j.filter(a,c.lang)}function k(){var a=j.getStudyClassNameChoices();angular.extend(c,a)}function l(){Object.keys(c.taxonomy).length<1||!c.taxonomy.vocabularies||Object.keys(c.datasourceTitles).length>0||c.taxonomy.vocabularies.some(function(a){return"populations-dataCollectionEvents-dataSources"===a.name&&(a.terms.forEach(function(a){c.datasourceTitles[a.name]={title:h.forLocale(a.title,c.lang)}}),!0)})}b.all([f.get({target:"study",taxonomy:"Mica_study"}).$promise]).then(function(b){var d=b[0];c.taxonomy=d,l(),d.vocabularies?c.designs=d.vocabularies.filter(function(a){return"methods-design"===a.name})[0].terms.reduce(function(a,b){return a[b.name]=b.title.map(function(a){return{lang:a.locale,value:a.text}}),a},{}):a.warn("Taxonomy has no vocabularies"),k()}),c.taxonomy={},c.designs={},c.datasourceTitles={},c.studyFilterSelection={get selection(){return this._selection},set selection(a){this._selection=a,i(a)}},c.$on("$locationChangeSuccess",function(){k()}),c.$watch("lang",l),c.hasDatasource=function(a,b){return a&&a.indexOf(b)>-1};var m=e.getOptions();c.options=m.studies,c.resultTabOrder=m.resultTabsOrder,c.optionsCols=c.options.studiesColumn,c.PageUrlService=d,c.updateCriteria=function(a,b,d){var e;"HarmonizationDataset"!==b&&"StudyDataset"!==b||(e=b,b="datasets");var f;"HarmonizationStudy"!==b&&"Study"!==b||(f=b,b="studies");var h;"DataschemaVariable"!==b&&"CollectedVariable"!==b||(h=b.replace("Variable",""),b="variables"),b=d||b,g.createCriteriaItem("study","Mica_study","id",a).then(function(a){e?g.createCriteriaItem("dataset","Mica_dataset","className",e).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):f?g.createCriteriaItem("study","Mica_study","className",f).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):h?g.createCriteriaItem("variable","Mica_variable","variableType",h).then(function(d){c.onUpdateCriteria(a,b),c.onUpdateCriteria(d,b)}):c.onUpdateCriteria(a,b)})}}}}ngObibaMica.search.directive("studiesResultTable",["$log","$q","$location","PageUrlService","ngObibaMicaSearch","TaxonomyResource","RqlQueryService","LocalizedValues","ngObibaMicaSearchTemplateUrl","StudyFilterShortcutService",a])}(),function(){function a(){return{restrict:"EA",replace:!0,controller:"ResultTabsOrderCountController",templateUrl:"search/components/result/tabs-order-count/component.html"}}ngObibaMica.search.directive("resultTabsOrderCount",a)}(),function(){function a(a,b,c){return{restrict:"EA",replace:!0,scope:{lang:"=",summaries:"=",loading:"="},templateUrl:"search/components/result/variables-result-table/component.html",link:function(d){d.options=b.getOptions().variables,d.optionsCols=d.options.variablesColumn,d.PageUrlService=a,c.decorateSearchResult(QUERY_TYPES.VARIABLES,d)}}}ngObibaMica.search.directive("variablesResultTable",["PageUrlService","ngObibaMicaSearch","SearchResultSelectionsService",a])}(),function(){function a(){return{restrict:"A",scope:{trigger:"=scrollToTop"},link:function(a,b){a.$watch("trigger",function(){b[0].scrollTop=0})}}}ngObibaMica.search.directive("scrollToTop",a)}(),function(){function a(a,b,c,d,e,f,g,h){function i(a,b){return!((b||[]).indexOf(a.name)>-1)&&0===(a.attributes||[]).filter(function(a){return"showSearch"===a.key}).length}function j(a,b){var c=0,d=new RegExp(a,"ig");return b.itemTitle.match(d)?c=10:b.itemDescription&&b.itemDescription.match(d)?c=8:b.itemParentTitle.match(d)?c=6:b.itemParentDescription&&b.itemParentDescription.match(d)&&(c=4),c}function k(a,d){var e=[],f=0,g=d.target,h=d.taxonomy;return h.vocabularies&&h.vocabularies.filter(function(a){return b.isVisibleVocabulary(a)&&i(a,t.hideSearch)}).forEach(function(b){if(b.terms)b.terms.filter(function(a){return i(a,t.hideSearch)}).forEach(function(d){var i=c.createCriteriaItem(g,h,b,d,t.lang);e.push({score:j(a,i),item:i}),f++});else{var d=c.createCriteriaItem(g,h,b,null,t.lang);e.push({score:j(a,d),item:d}),f++}}),{results:e,total:f}}function l(a){return h.get({query:e.quoteQuery(a.replace(/\/.*/g,"")),locale:t.lang,target:t.documents.search.target}).$promise.then(function(b){if(b){var c=[],d=0,e=10;if(b.forEach(function(b){var e=k(a,b);c.push.apply(c,e.results),d+=e.total}),c.sort(function(a,b){return b.score-a.score}),c=c.splice(0,e),d>c.length){var g={query:a,total:d,size:e,message:f.translate("search.showing",[e,d]),status:"has-warning"};c.push({score:-1,item:g})}return c.map(function(a){return a.item})}return[]},function(a){d.alert({id:t.alertId,type:"danger",msg:g.buildMessage(a),delay:5e3})})}function m(a,b){if(t.target===a&&t.taxonomyName===b&&t.taxonomiesShown)return void(t.taxonomiesShown=!1);t.taxonomiesShown=!0,t.target=a,t.taxonomyName=b}function n(){t.target=null,t.taxonomyName=null}function o(a){t.documents.search.target=a}function p(a){t.onSelectCriteria({item:a}),t.selectedCriteria=null}function q(b,c){var d=b[c]&&b[c].filter(function(b){return b.locale===a.use()}).pop();return d?d.text:c}function r(){t.onGotoClassifications({})}function s(a,b,c,d){t.onSelectTerm({target:a,taxonomy:b,vocabulary:c,args:d})}var t=this;t.selectedCriteria=null,t.target=null,t.documents={search:{text:null,active:!1,target:null}},t.selectCriteria=p,t.searchCriteria=l,t.selectSearchTarget=o,t.clearTaxonomy=n,t.showTaxonomy=m,t.translateTaxonomyNav=q,t.goToClassifications=r,t.selectTerm=s}ngObibaMica.search.component("searchBoxRegion",{bindings:{targets:"<",options:"<",alertId:"@",lang:"<",taxonomyNav:"<",onSelectCriteria:"&",onGotoClassifications:"&",onSelectTerm:"&"},templateUrl:"search/components/search-box-region/component.html",controller:["$translate","VocabularyService","RqlQueryService","AlertService","StringUtils","LocaleStringUtils","ServerErrorUtils","TaxonomiesSearchResource",a]})}(),function(){function a(a,b,c,d){return{restrict:"EA",replace:!0,templateUrl:"search/components/study-filter-shortcut/component.html",link:function(a){function c(a){d.filter(a,b.use())}function e(){var b=d.getStudyClassNameChoices();b.choseAll?a.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.ALL_STUDIES:b.choseIndividual?a.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.INDIVIDUAL_STUDIES:b.choseHarmonization&&(a.studyFilterSelection._selection=ngObibaMica.search.STUDY_FILTER_CHOICES.HARMONIZATION_STUDIES)}a.studyFilterSelection={get selection(){return this._selection},set selection(a){this._selection=a,c(a)}},a.$on("$locationChangeSuccess",function(){e()}),e()}}}ngObibaMica.search.directive("studyFilterShortcut",["$location","$translate","RqlQueryService","StudyFilterShortcutService",a])}(),function(){function a(){function a(a,b){c.onSelectTaxonomyTerm({taxonomy:c.taxonomy,vocabulary:a,args:b})}function b(a){c.onRemoveCriterion({item:a})}var c=this;c.selectVocabularyArgs=a,c.removeCriterion=b}ngObibaMica.search.component("taxonomyFilterDetail",{bindings:{taxonomy:"<",vocabularies:"<",onSelectTaxonomyTerm:"&",onRemoveCriterion:"&"},templateUrl:"search/components/taxonomy/taxonomy-filter-detail/component.html",controller:[a]})}(),function(){function a(a,b){function c(a){return a.reduce(function(a,b){return(a||"").concat(b.name)},"")}function d(a){var b=o.taxonomiesQuery.filter(function(b){return b.name===a});return 1===b.length?b[0].queryString:null}function e(a,b){var c=!1;void 0!==a&&void 0!==b&&(o.taxonomiesQuery.forEach(function(d){d.name===a&&void 0!==d.queryString&&(d.queryString=b,c=!0)}),c||o.taxonomiesQuery.push({name:a,queryString:b})),o.taxonomiesQuery.filter(function(a){return a.queryString})}function f(a,b,c){o.onSelectTerm({target:o.target,taxonomy:a,vocabulary:b,args:c})}function g(a){var b;o.taxonomyIsArray?(b=c(o.taxonomy),i(a)):(b=o.taxonomy.name,h(a)),e(b,a)}function h(b){o.filteredVocabularies=b?a.filter(o.taxonomy.vocabularies,b):k(o.taxonomy)}function i(b){o.filteredVocabularies={},b?o.taxonomy.forEach(function(c){var d=a.filter(c,b);d.length>0&&(o.filteredVocabularies[c.name]=d)}):o.taxonomy.forEach(function(a){o.filteredVocabularies[a.name]=k(a)})}function j(){o.classClose=!0,b(function(){o.onToggle(o.target,null)},200)}function k(a){return a.vocabularies.map(function(a){return a.filteredTerms=a.terms,a})}function l(a){if(o.taxonomyIsArray=Array.isArray(o.taxonomy),o.taxonomyName=o.taxonomyIsArray?c(o.taxonomy):o.taxonomy.name,a.taxonomy){var b=d(o.taxonomyName);b?g(b):g()}}function m(a){o.onRemoveCriterion({item:a})}function n(a){j(),o.onSelectType({type:a})}var o=this;o.taxonomiesQuery=[],o.classClose=!1,o.$onChanges=l,o.selectTaxonomyVocabularyArgs=f,o.selectType=n,o.onFilterChange=g,o.togglePannel=j,o.removeCriterion=m}ngObibaMica.search.component("taxonomyFilterPanel",{transclude:!0,bindings:{showTaxonomyPanel:"<",result:"<",resultTabsOrder:"<",taxonomyTypeMap:"<",target:"<",taxonomy:"<",onSelectType:"&",onSelectTerm:"&",onRemoveCriterion:"&",onToggle:"<"},templateUrl:"search/components/taxonomy/taxonomy-filter-panel/component.html",controller:["VocabularyService","$timeout",a]})}(),function(){function a(){function a(a){return g.onSelectType({type:a})}function b(a,b){function c(b){return a.clientX>b.x&&a.clientX<b.x+b.width&&a.clientY>b.y&&a.clientY<b.y+b.height}var d=null!==a.target.closest("#back-to-top"),e=h.querySelectorAll(".overlay-front-on-box-shodow");e.forEach(function(a){d=d||c(a.getBoundingClientRect())}),e&&!d&&(a.preventDefault(),b&&b())}function c(){h.onkeyup=null,h.onmouseup=null}function d(){h.onmouseup=function(a){b(a,g.togglePannel)},h.onkeyup=function(a){27===a.keyCode&&(c(),g.togglePannel())}}function e(a){return g.onFilterChange({queryString:a})}function f(){c()}var g=this,h=document.querySelectorAll("body")[0];g.selectType=a,g.filterChange=e,g.$onDestroy=f,d()}ngObibaMica.search.component("vocabularyFilterDetailHeading",{transclude:!0,bindings:{showTaxonomyPanel:"<",taxonomyName:"<",taxonomiesQuery:"<",clearQuery:"<",onFilterChange:"&",taxonomyTypeMap:"<",resultTabsOrder:"<",target:"<",onSelectType:"&",result:"<",togglePannel:"&"},templateUrl:["ngObibaMicaSearchTemplateUrl",function(a){return a.getTemplateUrl("vocabularyFilterDetailHeading")}],controller:[a]})}(),function(){function a(a){function b(b){a.isTermsVocabulary(b)||a.isRangeVocabulary(b)?h.criterionType="string-terms":a.isNumericVocabulary(b)?h.criterionType="numeric":a.isMatchVocabulary(b)&&(h.criterionType="match")}function c(a){if("string-terms"!==h.criterionType||a.term.selected)h.onSelectVocabularyArgs({vocabulary:h.vocabulary,args:a});else{0===h.vocabulary.terms.filter(function(a){return a.selected}).length?h.onRemoveCriterion({item:h.vocabulary.existingItem}):h.onSelectVocabularyArgs({vocabulary:h.vocabulary,args:a})}}function d(){h.onRemoveCriterion({item:h.vocabulary.existingItem})}function e(a){c({term:a.map(function(a){return a.selected=!0,a})})}function f(a){return!!Array.isArray(a)&&a.filter(function(a){return a.selected}).length<a.length}function g(a){a.vocabulary&&b(h.vocabulary)}var h=this;h.$onChanges=g,h.canStillSelectMore=f,h.selectAllFilteredVocabularyTerms=e,h.selectVocabularyArgs=c,h.removeCriterion=d}ngObibaMica.search.component("vocabularyFilterDetail",{transclude:!0,bindings:{vocabulary:"<",onSelectVocabularyArgs:"&",onRemoveCriterion:"&"},templateUrl:"search/components/vocabulary/vocabulary-filter-detail/component.html",controller:["VocabularyService",a]})}(),function(){ngObibaMica.DatasetVariableCrosstab=angular.module("obiba.mica.DatasetVariableCrosstab",["ui.bootstrap","obiba.notification","obiba.mica.analysis","schemaForm","schemaForm-datepicker","pascalprecht.translate","angularMoment","ui.bootstrap","ui.select"])}(),function(){ngObibaMica.DatasetVariableCrosstab.controller("DatasetVariableCrosstabController",["$rootScope","$scope","$routeParams","$log","$location","$route","$translate","DatasetResource","DatasetCategoricalVariablesResource","DatasetVariablesResource","DatasetVariableResource","DatasetVariablesCrosstabResource","ServerErrorAlertService","ContingencyService","LocalizedValues","ChiSquaredCalculator","PageUrlService","ngObibaMicaAnalysisTemplateUrl","AnalysisConfigService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){function t(b,c){var d=e.path;e.path=function(b,c){if(!1===c)var g=f.current,h=a.$on("$locationChangeSuccess",function(){f.current=g,h()});return d.apply(e,[b])},e.path(b+"/"+c,!1),e.path=d}function u(a,b){function c(){return{min:"-",max:"-",mean:"-",stdDeviation:"-"}}a.privacyCheck=a.aggregations.filter(function(a){return null!==a.statistics}).length===a.aggregations.length;var d=a.aggregations.map(function(a){return a.term});a.privacyCheck?b.forEach(function(b,e){-1===d.indexOf(b)&&a.aggregations.splice(e,0,{n:"-",statistics:c()})}):(a.aggregations.forEach(function(a){a.statistics=c()}),a.all.statistics=c())}function v(a,c){function d(a,b){return 0===b?0:a/b*100}function e(a,b,c){return a*b/c}function f(a,b){return 0===b?0:Math.pow(a-b,2)/b}function g(a,b){return(a-1)*(b-1)}function h(a){a.frequencies||(a.frequencies=[]);var b=a.frequencies.map(function(a){return a.value});c.forEach(function(c,d){-1===b.indexOf(c)&&a.frequencies.splice(d,0,{count:a.privacyCheck?0:"-",value:c})})}function i(a,b,c,g){g?(a.percent=d(a.n,b),a.frequencies.forEach(function(h,i){h.percent=d(h.count,c.frequencies[i].count),h.cpercent=d(h.count,a.n),g.sum+=f(h.count,e(a.n,c.frequencies[i].count,b))})):a.frequencies.forEach(function(a){a.percent=d(a.count,b),a.cpercent=d(a.n,b)})}var j=a.privacyThreshold,k=a.all.total;a.all.privacyCheck=a.all.frequencies&&a.all.frequencies.length>0,h(a.all,j),i(a.all,k,a.all),a.aggregations&&(a.chiSquaredInfo={pValue:0,sum:0,df:g(b.crosstab.rhs.xVariable.categories.length,b.crosstab.lhs.xVariable.categories.length)},a.privacyCheck=!0,a.aggregations.forEach(function(b){b.privacyCheck=!!b.frequencies&&b.frequencies.length>0,a.privacyCheck=a.privacyCheck&&b.privacyCheck,h(b),i(b,k,a.all,a.chiSquaredInfo)}),a.privacyCheck&&(a.chiSquaredInfo.pValue=1-p.compute(a.chiSquaredInfo)))}function w(a){var c=b.crosstab.rhs.xVariable.categories?b.crosstab.rhs.xVariable.categories.map(function(a){return a.name}):void 0,d=b.crosstab.lhs.xVariable.categories?b.crosstab.lhs.xVariable.categories.map(function(a){return a.name}):void 0;return a&&a.forEach(function(a){a.totalPrivacyCheck=-1!==a.all.n,(!a.totalPrivacyCheck||a.all.n>0)&&(C(b.crosstab.rhs.xVariable)?u(a,d):v(a,c)),a.studyTable&&(a.info=I(a.studyTable))}),a}function x(a,b){var c=null;return a&&a.categories&&(c=a.categories.filter(function(a){return a.name===b})),c?c[0]:b}var y=s.getOptions(),z=function(a){b.serverError=!0,m.alert("MainController",a)},A=function(a){!a||a.trim().length<2||i.get({dsType:c.type,dsId:c.ds,query:a.trim()+"*"},function(a){b.crosstab.lhs.variables=a.variables},z)},B=function(a){!a||a.trim().length<2||j.get({dsType:c.type,dsId:c.ds,query:a.trim()+"*"},function(a){b.crosstab.rhs.variables=a.variables},z)},C=function(a){return a&&"CONTINUOUS"===a.nature},D=function(){return b.crosstab.lhs.variable&&b.crosstab.rhs.variable&&!C(b.crosstab.rhs.variable)},E=function(){b.crosstab.lhs.variable&&b.crosstab.rhs.variable&&(b.crosstab.lhs.xVariable=b.crosstab.lhs.variable,b.crosstab.rhs.xVariable=b.crosstab.rhs.variable,t(n.removeVariableFromUrl(e.path()),n.createVariableUrlPart(b.crosstab.lhs.xVariable.id,b.crosstab.rhs.xVariable.id)),b.loading=!0,l.get({dsType:c.type,dsId:c.ds,v1:b.crosstab.lhs.xVariable.name,v2:b.crosstab.rhs.xVariable.name},function(a){0===Object.keys(a).filter(function(a){return"$"!==a[0]}).length?z({status:"crosstab.no-data"}):(b.crosstab.contingencies=w(a.contingencies?a.contingencies:[a]),b.datasetHarmo&&(b.crosstab.all=w(a.all?[a.all]:[])[0])),b.loading=!1},z))},F=function(){if(D()){var a=b.crosstab.lhs.variable;b.crosstab.lhs.variable=b.crosstab.rhs.variable,b.crosstab.rhs.variable=a,E()}},G=function(){b.crosstab={lhs:{variable:null,xVariable:null,variables:[]},rhs:{variable:null,xVariable:null,variables:[]},all:null,contingencies:null}},H=function(){G()},I=function(a){var b=a.studySummary,c={},d={};if(a.studySummary){var e=a.studySummary;c=e.populationSummaries?e.populationSummaries[0]:null,d=c&&c.dataCollectionEventSummaries?c.dataCollectionEventSummaries.filter(function(b){return b.id===a.dataCollectionEventId}):null}var f=g.use();return{summary:o.forLang(b.acronym,f),population:c?o.forLang(c.name,f):"",dce:d?o.forLang(d[0].name,f):"",project:a.project,table:a.table,tableName:o.forLang(a.name,f)}},J=function(a){return n.getCrossDownloadUrl({":dsType":c.type,":dsId":c.ds,":docType":a,":v1":b.crosstab.lhs.xVariable.name,":v2":b.crosstab.rhs.xVariable.name})},K=function(a){return x(b.crosstab.lhs.xVariable,a)},L=function(a){return x(b.crosstab.rhs.xVariable,a)},M=function(a){return a.totalPrivacyCheck?a.privacyCheck?"":"dataset.crosstab.privacy-check-failed":"dataset.crosstab.total-privacy-check-failed"},N=function(a){return b.crosstab.rhs.xVariable?C(b.crosstab.rhs.xVariable)?!a.totalPrivacyCheck||a.all.n>0?r.getTemplateUrl("variableStatistics"):r.getTemplateUrl("variableStatisticsEmpty"):!a.totalPrivacyCheck||a.all.n>0?r.getTemplateUrl("variableFrequencies"):r.getTemplateUrl("variableFrequenciesEmpty"):void d.error("RHS variable is not initialized!")};b.crosstabTemplateUrl=r.getTemplateUrl("variableCrosstab"),b.isStatistical=C,b.getTemplatePath=N,b.getPrivacyErrorMessage=M,b.canExchangeVariables=D,b.exchangeVariables=F,b.extractSummaryInfo=I,b.lhsVariableCategory=K,b.rhsVariableCategory=L,b.clear=H,b.submit=E,b.searchCategoricalVariables=A,b.searchVariables=B,b.PageUrlService=q,b.DocType={CSV:"csv",EXCEL:"excel"},b.StatType={CPERCENT:1,RPERCENT:2,CHI:3},b.routeParams=c,b.options={showDetailedStats:y.crosstab.showDetailedStats,showDetails:!0,statistics:b.StatType.CPERCENT},b.downloadUrl=J,G(),h.get({dsType:c.type,dsId:c.ds},function(a){b.dataset=a,b.dataset.translatedAcronym=o.forLang(b.dataset.acronym,g.use()),b.datasetHarmo=b.dataset.hasOwnProperty("obiba.mica.HarmonizedDatasetDto.type")},z);var O=0;c.varId&&k.get({varId:c.varId},function(a){b.crosstab.lhs.variable=a,b.crosstab.lhs.variables=[a],++O>1&&E()},z),c.byId&&k.get({varId:c.byId},function(a){b.crosstab.rhs.variable=a,b.crosstab.rhs.variables=[a],++O>1&&E()},z)}])}(),function(){ngObibaMica.DatasetVariableCrosstab.filter("variableCategory",function(){return function(a,b){var c=null;return a&&(c=a.filter(function(a){return a.name===b})),c?c[0]:null}}).filter("variableLabel",["AttributeService",function(a){return function(b){var c="";if(b){var d=a.getAttributes(b,["label"]);return d&&d.forEach(function(b){return c=a.getValue(b),!1}),c}}}]).filter("roundNumber",["$filter",function(a){return function(b){return isNaN(b)?b:a("number")(b,2)}}])}(),function(){ngObibaMica.DatasetVariableCrosstab.config(["$routeProvider",function(a){a.when("/crosstab/:type/:ds",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"}).when("/crosstab/:type/:ds/variable/:varId",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"}).when("/crosstab/:type/:ds/variable/:varId/by/:byId",{templateUrl:"analysis/crosstab/views/crosstab-variable-crosstab.html",controller:"DatasetVariableCrosstabController"})}])}(),ngObibaMica.analysis=angular.module("obiba.mica.analysis",["obiba.alert","ui.bootstrap","pascalprecht.translate","templates-ngObibaMica"]),function(){ngObibaMica.analysis.config(["$provide",function(a){a.provider("ngObibaMicaAnalysisTemplateUrl",(new NgObibaMicaTemplateUrlFactory).create({entities:{header:null,footer:null},variableCrosstab:{template:null},variableFrequencies:{template:null},variableFrequenciesEmpty:{template:null},variableStatistics:{template:null},variableStatisticsEmpty:{template:null}}))}])}(),function(){ngObibaMica.DatasetVariableCrosstab.factory("DatasetCategoricalVariablesResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DatasetCategoricalVariablesResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){ngObibaMica.DatasetVariableCrosstab.factory("DatasetResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DatasetResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){ngObibaMica.DatasetVariableCrosstab.factory("DatasetVariableResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DatasetVariableResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){ngObibaMica.DatasetVariableCrosstab.factory("DatasetVariablesCrosstabResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DatasetVariablesCrosstabResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){ngObibaMica.DatasetVariableCrosstab.factory("DatasetVariablesResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("DatasetVariablesResource"),{},{get:{method:"GET",errorHandler:!0}})}])}(),function(){ngObibaMica.search.factory("EntitiesCountResource",["$resource","ngObibaMicaUrl",function(a,b){var c=b.getUrl("EntitiesCountResource"),d=-1===c.indexOf(":query")?"POST":"GET";return a(c,{},{get:{method:d,headers:{"Content-Type":"POST"===d?"application/x-www-form-urlencoded":"application/json"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},errorHandler:!0}})}])}(),function(){ngObibaMica.search.factory("VariableResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(a,b,c){return a(b.getUrl("VariableResource"),{},{get:{method:"GET",errorHandler:!0,cache:c("variableResource")}})}])}(),function(){ngObibaMica.search.factory("VariableSummaryResource",["$resource","ngObibaMicaUrl","$cacheFactory",function(a,b,c){return a(b.getUrl("VariableSummaryResource"),{},{get:{method:"GET",errorHandler:!0,cache:c("variableSummaryResource")}})}])}(),function(){function a(a,b,c){var d="micaHideEntitiesCountHelpText";b(["analysis.entities-count.help"]).then(function(b){a.options.EntitiesCountHelpText||c.get(d)||(a.options.EntitiesCountHelpText=b["analysis.entities-count.help"])}),a.closeHelpBox=function(){c.put(d,!0),a.options.EntitiesCountHelpText=null},c.get(d)&&(a.options.EntitiesCountHelpText=null)}ngObibaMica.analysis.controller("EntitiesCountController",["$scope","$location","$translate","$cookies","LocalizedValues","AnalysisConfigService","EntitiesCountResource","AlertService","ServerErrorUtils","ngObibaMicaAnalysisTemplateUrl",function(b,c,d,e,f,g,h,i,j,k){function l(){b.query?(b.loading=!0,h.get({query:b.query},function(a){b.result=a,b.loading=!1,b.localizedTotal=(b.result.belowPrivacyThreshold?"<":"")+f.formatNumber(b.result.total,d.use())},function(a){b.result={},b.loading=!1,i.alert({id:"EntitiesCountController",type:"danger",msg:j.buildMessage(a),delay:5e3})})):b.result={}}b.options=g.getOptions(),a(b,d,e),b.entitiesHeaderTemplateUrl=k.getHeaderUrl("entities"),b.result={},b.query=c.search().query,b.loading=!1,l(),b.$on("$locationChangeSuccess",function(){b.query=c.search().query,l()})}])}(),ngObibaMica.analysis.config(["$routeProvider",function(a){a.when("/entities-count",{templateUrl:"analysis/views/analysis-entities-count.html",controller:"EntitiesCountController",reloadOnSearch:!1})}]);var AnalysisConfigService=function(){function a(){this.options={crosstab:{showDetailedStats:!0},showAnalysis:!0}}return a.prototype.setOptions=function(a){var b=this;"object"==typeof a&&Object.keys(a).forEach(function(c){c in b.options&&(b.options[c]=a[c])})},a.prototype.getOptions=function(){return angular.copy(this.options)},a.prototype.showAnalysis=function(){return this.options.showAnalysis},a}();ngObibaMica.analysis.service("AnalysisConfigService",[AnalysisConfigService]);var ChiSquaredCalculator=function(){function a(){}return a.prototype.compute=function(a){var b=null,c=a.sum,d=a.df;return d<=0||(b=this.gammacdf(c/2,d/2)),b=Math.round(1e5*b)/1e5},a.prototype.logGamma=function(a){var b=1+76.18009173/a-86.50532033/(a+1)+24.01409822/(a+2)-1.231739516/(a+3)+.00120858003/(a+4)-536382e-11/(a+5);return(a-.5)*Math.log(a+4.5)-(a+4.5)+Math.log(2.50662827465*b)},a.prototype.gcf=function(a,b){for(var c=0,d=1,e=1,f=a,g=0,h=0;Math.abs((e-g)/e)>1e-5;)g=e,h+=1,c=e+(h-b)*c,d=f+(h-b)*d,e=a*c+h*e,f=a*d+h*f,c/=f,d/=f,e/=f,f=1;return 1-Math.exp(b*Math.log(a)-a-this.logGamma(b))*e},a.prototype.gser=function(a,b){for(var c=1/b,d=c,e=1;c>1e-5*d;)c=c*a/(b+e),d+=c,e+=1;return d*=Math.exp(b*Math.log(a)-a-this.logGamma(b))},a.prototype.gammacdf=function(a,b){return a<=0?0:a<b+1?this.gser(a,b):this.gcf(a,b)},a}();ngObibaMica.DatasetVariableCrosstab.service("ChiSquaredCalculator",[ChiSquaredCalculator]);var ContingencyService=function(){function a(){}return a.prototype.removeVariableFromUrl=function(a){return a.replace(/\/variable\/.*/,"")},a.prototype.getCrossDownloadUrl=function(a){return this.searchReplace(":dsType/:dsId/download_:docType/cross/:v1/by/:v2/ws",a)},a.prototype.createVariableUrlPart=function(a,b){return this.searchReplace("variable/:var/by/:by",{":by":b,":var":a})},a.prototype.searchReplace=function(a,b){return a.replace(/:\w+/g,function(a){return b[a]||a})},a}();ngObibaMica.DatasetVariableCrosstab.service("ContingencyService",[ContingencyService]);var EntitiesCountService=function(){function a(a,b){this.$location=a,this.ObibaServerConfigResource=b;var c=this;b.get(function(a){c.hasMultipleStudies=!a.isSingleStudyEnabled||a.isHarmonizedDatasetEnabled})}return a.prototype.isSingleStudy=function(){return!this.hasMultipleStudies},a.prototype.update=function(a,b){if(a!==b){var c=this.$location.search();c.query=c.query.split(a).join("").replace(/,,/,",").replace(/^,/,"").replace(/,$/,""),b&&0!==b.length&&(c.query&&c.query.length>0?c.query=c.query+","+b:c.query=b),this.$location.search(c)}},a.$inject=["$location","ObibaServerConfigResource"],a}();ngObibaMica.analysis.service("EntitiesCountService",["$location","ObibaServerConfigResource",EntitiesCountService]);var CrosstabStudyTableController=function(){function a(a){this.PageUrlService=a,this.contingency={}}return a.prototype.$onChanges=function(){this.contingency.studyTable&&(this.studyLink=this.PageUrlService.studyPage(this.contingency.studyTable.studyId,"individual-study"))},a.$inject=["PageUrlService"],a}(),CrosstabStudyTableComponent=function(){function a(){this.transclude=!0,this.bindings={contingency:"<"},this.controller=CrosstabStudyTableController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/crosstab-study-table/component.html"}return a}();ngObibaMica.DatasetVariableCrosstab.component("crosstabStudyTable",new CrosstabStudyTableComponent);var EntitiesCountResultTableController=function(){function a(a,b,c,d,e){this.PageUrlService=a,this.LocalizedValues=b,this.EntitiesCountService=c,this.$translate=d,this.$log=e,this.result={}}return a.prototype.$onInit=function(){this.table={rows:new Array}},a.prototype.$onChanges=function(){this.table=this.asTable(),this.localizedTotal=this.LocalizedValues.formatNumber(this.result.total?this.result.total:0),this.result.belowPrivacyThreshold&&(this.localizedTotal="<"+this.localizedTotal)},a.prototype.showStudyColumn=function(){return!this.EntitiesCountService.isSingleStudy()},a.prototype.localize=function(a){return this.LocalizedValues.forLang(a,this.$translate.use())},a.prototype.asTable=function(){var a=this,b={rows:new Array};return this.studyCount=this.result.counts?this.result.counts.length:0,this.studyCount&&this.result.counts.forEach(function(c){var d=a.localize(c.study.acronym),e=a.localize(c.study.name);if(c.counts){var f=0;c.counts.forEach(function(g){var h=a.localize(g.dataset.acronym),i=a.localize(g.dataset.name);g.counts&&g.counts.forEach(function(j){var k=j.variable.id.split(":"),l=k[1];j.studyTableName&&(l=l+" ("+a.localize(j.studyTableName)+")");var m=k[2],n=a.PageUrlService.variablePage(j.variable.id),o=a.PageUrlService.datasetPage(g.dataset.id,m),p="Dataschema"===m?"harmonization":"individual",q=new Array({colspan:1,link:a.PageUrlService.studyPage(c.study.id,p),rowspan:0===f?1:0,title:0===f?e:"",value:0===f?d:""},{colspan:1,link:n||o,rowspan:1,title:a.localize(j.variable.name),value:l},{colspan:1,link:o,rowspan:1,title:i,value:h},{colspan:1,link:void 0,rowspan:1,title:j.query,value:j.query},{colspan:1,link:void 0,rowspan:1,title:void 0,value:a.LocalizedValues.formatNumber(j.count)});b.rows.push(q),f++})}),b.rows[b.rows.length-f][0].rowspan=f+1,b.rows.push(new Array({colspan:1,rowspan:0,title:void 0,value:void 0},{colspan:3,rowspan:1,title:c.query,value:void 0},{colspan:1,rowspan:1,title:void 0,value:(c.belowPrivacyThreshold?"<":"")+a.LocalizedValues.formatNumber(c.total)}))}}),b},a.$inject=["PageUrlService","LocalizedValues","EntitiesCountService","$translate","$log"],a}(),EntitiesCountResultTableComponent=function(){function a(){this.transclude=!0,this.bindings={result:"<"},this.controller=EntitiesCountResultTableController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/entities-count-result-table/component.html"}return a}();ngObibaMica.analysis.component("entitiesCountResultTable",new EntitiesCountResultTableComponent);var Operation;!function(a){a.All="all",a.Exists="exists",a.Empty="empty",a.In="in",a.Out="out"}(Operation||(Operation={}));var VariableCriteriaController=function(){function a(a,b,c,d,e,f,g){this.VariableResource=a,this.VariableSummaryResource=b,this.LocalizedValues=c,this.EntitiesCountService=d,this.$log=e,this.$translate=f,this.$filter=g,this.query="",this.state={open:!1},this.categoriesData=[],this.selectedCategories={},this.selectedNumericalOperation="range",this.selectedTemporalOperation="range"}return a.prototype.$onInit=function(){this.loading=!0,this.initializeState()},a.prototype.onKeyup=function(a){13===a.keyCode?this.closeDropdown(!1):27===a.keyCode&&this.closeDropdown(!0)},a.prototype.onSearchTextKeyup=function(a){var b=this.searchText.trim();if(this.categoriesData){var c=new RegExp(b,"i");this.categoriesData.forEach(function(a){a.visible=null!==a.label.match(c)})}},a.prototype.onNumericalMinKeyup=function(a){this.selectedMin=this.ensureNumericValue(this.selectedMin+""," ")},a.prototype.onNumericalMaxKeyup=function(a){this.selectedMax=this.ensureNumericValue(this.selectedMax+""," ")},a.prototype.onNumericalValuesKeyup=function(a){this.selectedNumericalValues=this.ensureNumericValue(this.selectedNumericalValues," ")},a.prototype.closeDropdown=function(a){this.state.open=!1,a||this.update(this.makeNewQuery())},a.prototype.openDropdown=function(){if(this.state.open)return void this.closeDropdown(!1);this.state.open=!0},a.prototype.onRemove=function(){this.update("")},a.prototype.getQueryTitle=function(a){var b=this;if(!this.rqlQuery)return"?";var c=this.getOperationTitle(),d=this.getRqlQueryWithArgs();if(d.args.length>1){var e=d.args[1];"CATEGORICAL"===this.getNature()&&(e=e.map(function(a){return b.localizeCategory(a)})),c="range"===d.name?c+" ["+e.join(", ")+"]":c+" ("+e.join(", ")+")"}return a?c.length>50?c.substring(0,50)+"...":c:c.length>50?c:""},a.prototype.showInOperations=function(){return"CATEGORICAL"===this.getNature()||this.isNumerical()||this.isTemporal()},a.prototype.showCategoricalOptions=function(){return"CATEGORICAL"===this.getNature()&&this.showOptions()},a.prototype.showNumericalOptions=function(){return"CONTINUOUS"===this.getNature()&&this.isNumerical()&&this.showOptions()},a.prototype.showTemporalOptions=function(){return"TEMPORAL"===this.getNature()&&this.isTemporal()&&this.showOptions()},a.prototype.localizeNumber=function(a){return this.LocalizedValues.formatNumber(a)},a.prototype.initializeState=function(){if(this.rqlQuery=this.parseQuery(),this.rqlQuery.args){var a=this.getQueryWithArgs();this.id=a.args[0].join(":"),this.VariableResource.get({id:this.id},this.onVariable(),this.onError())}},a.prototype.getQueryWithArgs=function(){return this.isQueryNot()?this.rqlQuery.args[0]:this.rqlQuery},a.prototype.isQueryNot=function(){return"not"===this.rqlQuery.name},a.prototype.update=function(a){this.EntitiesCountService.update(this.query,a)},a.prototype.showOptions=function(){return Operation.All!==this.selectedOperation&&Operation.Exists!==this.selectedOperation&&Operation.Empty!==this.selectedOperation},a.prototype.getNature=function(){return this.variable?this.variable.nature:"?"},a.prototype.isNumerical=function(){return this.variable&&("integer"===this.variable.valueType||"decimal"===this.variable.valueType)},a.prototype.isLogical=function(){return this.variable&&"boolean"===this.variable.valueType},a.prototype.isTemporal=function(){return this.variable&&("date"===this.variable.valueType||"datetime"===this.variable.valueType)},a.prototype.getOperationTitle=function(){var a=this.getRqlQueryWithArgs();return this.isNotQuery()?"exists"===a.name?this.$filter("translate")("analysis.empty"):this.$filter("translate")("analysis.out"):this.$filter("translate")("analysis."+("range"===a.name?"in":a.name))},a.prototype.getRqlQueryWithArgs=function(){return this.isNotQuery()?this.rqlQuery.args[0]:this.rqlQuery},a.prototype.isNotQuery=function(){return this.rqlQuery&&"not"===this.rqlQuery.name},a.prototype.parseQuery=function(){try{return(new RqlParser).parse(this.normalize(this.query)).args[0]}catch(a){this.$log.error(a.message)}return new RqlQuery},a.prototype.normalize=function(a){return a.split(":").join("/")},a.prototype.localizeCategory=function(a){if(!this.variable.categories)return this.isLogical()?this.$filter("translate")("global."+a):a;var b=this.variable.categories.filter(function(b){return b.name===a+""});if(0===b.length)return a;var c=b[0];if(!c.attributes)return a;var d=c.attributes.filter(function(a){return"label"===a.name});return 0===d.length?a:this.localize(d[0].values)||a},a.prototype.localize=function(a){return this.LocalizedValues.forLang(a,this.$translate.use())},a.prototype.prepareCategories=function(){var a=this;if(this.categoriesData=[],"CATEGORICAL"===this.getNature()){var b=this.variable.categories;b?b.forEach(function(b){a.categoriesData.push({label:a.localizeCategory(b.name),name:b.name,visible:!0})}):this.isLogical()&&(this.categoriesData.push({label:this.$filter("translate")("global.true"),name:"true",visible:!0}),this.categoriesData.push({label:this.$filter("translate")("global.false"),name:"false",visible:!0}))}},a.prototype.prepareOptions=function(){var a=this;this.prepareCategories();var b=this.getRqlQueryWithArgs();if(b.args.length>1)if("in"===b.name)this.showCategoricalOptions()?b.args[1].forEach(function(b){a.selectedCategories[b]=!0}):this.showNumericalOptions()?(this.selectedNumericalOperation="in",this.selectedNumericalValues=b.args[1].filter(function(a){return!isNaN(a)}).join(" ")):this.showTemporalOptions()&&(this.selectedTemporalOperation="in",this.selectedTemporalValue=b.args[1].length>0?new Date(Date.parse(b.args[1][0])):void 0);else if("range"===b.name&&b.args[1].length>0){var c=b.args[1][0];if("*"===c?(this.selectedMin=void 0,this.selectedFrom=void 0):this.showNumericalOptions()&&!isNaN(c)?this.selectedMin=c:this.showTemporalOptions()&&(this.selectedFrom=new Date(Date.parse(c))),b.args[1].length>=2){var d=b.args[1][1];"*"===d?(this.selectedMax=void 0,this.selectedTo=void 0):this.showNumericalOptions()&&!isNaN(d)?this.selectedMax=d:this.showTemporalOptions()&&(this.selectedTo=new Date(Date.parse(d)))}}this.selectedOperation="range"===this.rqlQuery.name?"in":this.rqlQuery.name,!this.isQueryNot()||"in"!==b.name&&"range"!==b.name||(this.selectedOperation="out"),this.isQueryNot()&&"exists"===b.name&&(this.selectedOperation="empty")},a.prototype.ensureNumericValue=function(a,b){var c="";if(a)for(var d=0;d<a.length;d++){var e=a.charAt(d);(e===b||"decimal"===this.variable.valueType&&"."===e||"-"===e||!isNaN(parseInt(e,10)))&&(c+=e)}return c},a.prototype.makeNewQuery=function(){var a,b=this,c="";if(this.showCategoricalOptions()&&(a=Object.keys(this.selectedCategories).filter(function(a){return b.selectedCategories[a]}).map(function(a){return a}).join(",")),this.showNumericalOptions())if("range"===this.selectedNumericalOperation){var d=this.selectedMin&&"-"!==this.selectedMin?this.selectedMin:"*",e=this.selectedMax&&"-"!==this.selectedMax?this.selectedMax:"*";a=[d,e].join(",")}else a=this.selectedNumericalValues.split(" ").join(",");if(this.showTemporalOptions())if("range"===this.selectedTemporalOperation){var d=this.selectedFrom?this.dateToString(this.selectedFrom):"*",e=this.selectedTo?this.dateToString(this.selectedTo):"*";a=[d,e].join(",")}else a=this.dateToString(this.selectedTemporalValue);switch(this.selectedOperation){case Operation.All:case Operation.Exists:c=this.selectedOperation+"({field})";break;case Operation.Empty:c="not(exists({field}))";break;case Operation.In:a&&a.length>0?this.showCategoricalOptions()||this.showNumericalOptions()&&"in"===this.selectedNumericalOperation||this.showTemporalOptions()&&"in"===this.selectedTemporalOperation?c="in({field},({args}))":(this.showNumericalOptions()&&"range"===this.selectedNumericalOperation||this.showTemporalOptions()&&"range"===this.selectedTemporalOperation)&&(c="range({field},({args}))"):(c="not(exists({field}))",this.selectedOperation="empty");break;case Operation.Out:a&&a.length>0?this.showCategoricalOptions()||this.showNumericalOptions()&&"in"===this.selectedNumericalOperation||this.showTemporalOptions()&&"in"===this.selectedTemporalOperation?c="not(in({field},({args})))":(this.showNumericalOptions()&&"range"===this.selectedNumericalOperation||this.showTemporalOptions()&&"range"===this.selectedTemporalOperation)&&(c="not(range({field},({args})))"):(c="exists({field})",this.selectedOperation="exists")}return c=c.replace("{field}",this.variable.id),c=c.replace("{args}",a)},a.prototype.dateToString=function(a){if(!a)return"";var b=a.getMonth()+1,c=a.getDate();return[a.getFullYear(),(b>9?"":"0")+b,(c>9?"":"0")+c].join("-")},a.prototype.onVariable=function(){var a=this;return function(b){a.variable=b,a.loading=!1,a.prepareOptions(),a.VariableSummaryResource.get({id:b.id},a.onVariableSummary(),a.onError())}},a.prototype.onVariableSummary=function(){var a=this;return function(b){if(a.summary=b,a.summary["Math.ContinuousSummaryDto.continuous"]){var c=a.summary["Math.ContinuousSummaryDto.continuous"].summary;a.rangeMin=c.min,a.rangeMax=c.max;var d=a.summary["Math.ContinuousSummaryDto.continuous"].frequencies,e=d?d.filter(function(a){return"NOT_NULL"===a.value}).pop():void 0;a.existsFrequency=e?e.freq:0;var f=d.filter(function(a){return"N/A"===a.value}).pop();a.emptyFrequency=f?f.freq:0,a.allFrequency=a.existsFrequency+a.emptyFrequency}if(a.summary["Math.CategoricalSummaryDto.categorical"]){var g=a.summary["Math.CategoricalSummaryDto.categorical"].frequencies;a.categoriesData.forEach(function(a){var b=g.filter(function(b){return b.value===a.name});b.length>0&&(a.frequency=b[0].freq)}),a.allFrequency=a.summary["Math.CategoricalSummaryDto.categorical"].n,a.existsFrequency=a.summary["Math.CategoricalSummaryDto.categorical"].otherFrequency+g.filter(function(a){return"N/A"!==a.value}).map(function(a){return a.freq}).reduce(function(a,b){return a+b}),a.emptyFrequency=a.allFrequency-a.existsFrequency}if(a.summary["Math.TextSummaryDto.textSummary"]){a.allFrequency=a.summary["Math.TextSummaryDto.textSummary"].n;var d=a.summary["Math.TextSummaryDto.textSummary"].frequencies;d&&(a.existsFrequency=d.filter(function(a){return"N/A"!==a.value}).map(function(a){return a.freq}).reduce(function(a,b){return a+b})),a.summary["Math.TextSummaryDto.textSummary"].otherFrequency&&(a.existsFrequency=a.existsFrequency+a.summary["Math.TextSummaryDto.textSummary"].otherFrequency),a.emptyFrequency=a.allFrequency-a.existsFrequency}if(a.summary["Math.DefaultSummaryDto.defaultSummary"]){a.allFrequency=a.summary["Math.DefaultSummaryDto.defaultSummary"].n;var d=a.summary["Math.DefaultSummaryDto.defaultSummary"].frequencies,e=d?d.filter(function(a){return"NOT_NULL"===a.value}).pop():void 0;a.existsFrequency=e?e.freq:0,a.emptyFrequency=a.allFrequency-a.existsFrequency}}},a.prototype.onError=function(){var a=this;return function(b){a.variable=void 0,a.loading=!1}},a.$inject=["VariableResource","VariableSummaryResource","LocalizedValues","EntitiesCountService","$log","$translate","$filter"],a}(),VariableCriteriaComponent=function(){function a(){this.transclude=!0,this.bindings={query:"<"},this.controller=VariableCriteriaController,this.controllerAs="$ctrl",this.templateUrl="analysis/components/variable-criteria/component.html"}return a}();ngObibaMica.analysis.component("variableCriteria",new VariableCriteriaComponent),ngObibaMica.lists=angular.module("obiba.mica.lists",["obiba.mica.search"]),ngObibaMica.lists.run().config(["$provide",function(a){a.provider("ngObibaMicaLists",NgObibaMicaListsOptionsFactory)}]).config(["ngObibaMicaSearchTemplateUrlProvider",function(a){a.setTemplateUrl("searchStudiesResultTable","lists/views/list/studies-search-result-table-template.html"),a.setTemplateUrl("searchNetworksResultTable","lists/views/list/networks-search-result-table-template.html"),a.setTemplateUrl("searchDatasetsResultTable","lists/views/list/datasets-search-result-table-template.html"),a.setTemplateUrl("searchResultList","lists/views/search-result-list-template.html"),a.setTemplateUrl("searchInputList","lists/views/input-search-widget/input-search-widget-template.html"),a.setTemplateUrl("searchCriteriaRegionTemplate","lists/views/region-criteria/search-criteria-region-template.html"),a.setTemplateUrl("CriterionDropdownTemplate","lists/views/region-criteria/criterion-dropdown-template.html")}]).config(["$provide",function(a){a.provider("sortWidgetOptions",SortWidgetOptionsProvider)}]).filter("getBaseUrl",function(){return function(a){return"/mica/"+a}}).filter("doSearchQuery",function(){return function(a,b){return"/mica/repository#/search?type="+a+"&query="+b+"&display=list"}}),ngObibaMica.lists.service("sortWidgetService",["$filter","$location","RqlQueryService","sortWidgetOptions",function(a,b,c,d){var e=d.getOptions(),f=this;this.getSortOrderOptions=function(){return e.sortOrderField.options.map(function(b){return a("translate")(b.label)}),{options:e.sortOrderField.options}},this.getSortOrderOption=function(a){var b=null;return a||(a=e.sortOrderField.defaultValue),angular.forEach(f.getSortOrderOptions().options,function(c){c.value===a&&(b=c)}),b||f.getSortOrderOption(e.sortOrderField.defaultValue)},this.getSortArg=function(){var a=b.search(),d=c.parseQuery(a.query);if(d){var f=c.getTargetQuerySort(targetToType(d.args[0].name),d);if(f)return f.args[0]}return e.sortOrderField.defaultValue},this.getLabel=function(a,b){var c=null;return angular.forEach(a.options,function(a){a.value===b&&(c=a.label)}),c}}]),function(){ngObibaMica.lists.controller("listSearchWidgetController",["$scope","$rootScope","$location","RqlQueryService","ngObibaMicaUrl",function(a,b,c,d,e){function f(){a.query=c.search().query,a.target=typeToTarget(a.type),a.rqlQuery=d.parseQuery(a.query)}a.navigateToSearchPage=function(){var b=d.findTargetQuery(typeToTarget(a.type),d.parseQuery(a.query));if(b){var c=d.findQueryInTargetByVocabulary(b,"className")||d.findQueryInTargetByVocabulary(b,"id");if(c){b.args=[c];var f=new RqlQuery(RQL_NODE.AND);return f.args.push(b),e.getUrl("BaseUrl")+e.getUrl("SearchBaseUrl")+"?type="+a.type+"&query="+(new RqlQuery).serializeArgs(f.args)+"&display=list"}}return""},a.$on("$locationChangeSuccess",function(){f()});var g=b.$new();a.selectSuggestion=function(a){g.$emit("ngObibaMicaSearch.searchSuggestion",a)},a.search=function(){g.$emit("ngObibaMicaSearch.searchSuggestion",a.searchFilter.replace(/\/.*/g,""))},f()}]).controller("listSortWidgetController",["$scope","$rootScope","sortWidgetService",function(a,b,c){function d(){a.selected=c.getSortOrderOption(c.getSortArg())}var e=b.$new();a.selectSortOrder=c.getSortOrderOptions(),a.getLabel=c.getLabel,a.selected=a.selectSortOrder.options.defaultValue,d(),a.$on("$locationChangeSuccess",function(){d()}),a.selectSortOrderOption=function(b){a.selected=b,e.$emit("ngObibaMicaSearch.sortChange",b.value)}}])}(),ngObibaMica.lists.directive("listSortWidget",[function(){return{restrict:"EA",controller:"listSortWidgetController",templateUrl:"lists/views/sort-widget/sort-widget-template.html"}}]).directive("listSearchWidget",["ngObibaMicaSearchTemplateUrl",function(a){return{restrict:"EA",require:"^^suggestionField",transclude:!0,replace:!0,scope:{type:"="},controller:"listSearchWidgetController",templateUrl:a.getTemplateUrl("searchInputList")}}]).directive("suggestionField",["$location","DocumentSuggestionResource","$translate","RqlQueryService","EntitySuggestionService",function(a,b,c,d,e){return{restrict:"EA",replace:!0,scope:{documentType:"=",model:"=",placeholderText:"=",select:"="},templateUrl:"lists/views/input-search-widget/suggestion-field.html",link:function(a){a.suggest=function(b){return e.suggestForTargetQuery(a.documentType,b)}}}}]);var BadgeCountController=function(){function a(a){this.$log=a}return a.$inject=["$log"],a}(),BadgeCountComponent=function(){function a(){this.transclude=!0,this.bindings={badgeOptions:"<",entityCount:"<",entityType:"<",labelBadge:"<",query:"<"},this.controller=BadgeCountController,this.controllerAs="$ctrl",this.templateUrl="lists/components/badge-count/component.html"}return a}();ngObibaMica.search.component("badgeCount",new BadgeCountComponent),ngObibaMica.graphics=angular.module("obiba.mica.graphics",["obiba.graphics","obiba.utils","templates-ngObibaMica"]),ngObibaMica.graphics.config(["$provide",function(a){a.provider("GraphicChartsData",GraphicChartsDataProvider)}]).run(["GraphicChartsConfigurations",function(a){a.setClientConfig()}]),ngObibaMica.graphics.directive("obibaChart",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"=",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"="},templateUrl:"graphics/views/charts-directive.html",controller:"GraphicChartsController"}}]).directive("obibaTable",[function(){return{restrict:"EA",replace:!0,scope:{fieldTransformer:"=",chartType:"@",chartAggregationName:"=",chartEntityDto:"=",chartOptionsName:"=",chartOptions:"=",chartHeader:"=",chartTitle:"=",chartTitleGraph:"=",chartSelectGraphic:"=",chartOrdered:"=",chartNotOrdered:"="},templateUrl:"graphics/views/tables-directive.html",controller:"GraphicChartsController"}}]),ngObibaMica.graphics.controller("GraphicChartsController",["$rootScope","$scope","$filter","$window","GraphicChartsConfig","GraphicChartsUtils","GraphicChartsData","RqlQueryService","ngObibaMicaUrl","D3GeoConfig","D3ChartConfig",function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.chartObject={},g.getData(function(a){a&&f.getArrayByAggregation(b.chartAggregationName,a[b.chartEntityDto]).then(function(f){var g=f.map(function(a){return a.participantsNbr?[a.title,a.value,a.participantsNbr]:[a.title,a.value]});b.updateCriteria=function(a,b){h.createCriteriaItem("study","Mica_study",b,a).then(function(a){var b=e.getOptions().entityType,c=e.getOptions().entityIds,f=a.id.split("."),g=i.getUrl("SearchBaseUrl")+"?type=studies&query="+b+"(in(Mica_"+b+".id,"+c+")),study(in("+f[0]+"."+f[1]+","+f[2].replace(":","%253A")+"))";d.location.href=i.getUrl("BaseUrl")+g})},g&&(null!==/^Table-/.exec(b.chartType)?(b.chartObject.ordered=b.chartOrdered,b.chartObject.notOrdered=b.chartNotOrdered,b.chartHeader.length<3?b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]:b.chartObject.header=[c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1]),c("translate")(b.chartHeader[2])],b.chartObject.type=b.chartType,b.chartObject.data=g,b.chartObject.vocabulary=b.chartAggregationName,b.chartObject.entries=f,b.chartObject.getTable=function(){return b.chartObject}):(b.chartHeader.length<3?g.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])]):(g.map(function(a){return a.pop(),a}),g.unshift([c("translate")(b.chartHeader[0]),c("translate")(b.chartHeader[1])])),b.chartObject.term=!0,b.chartObject.type=b.chartType,b.chartObject.data=g,b.chartObject.options={backgroundColor:{fill:"transparent"}},angular.extend(b.chartObject.options,b.chartOptions),b.chartObject.options.title=c("translate")(b.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")",b.$parent.directive={title:b.chartObject.options.title})),"GeoChart"===b.chartType?(b.chartObject.d3Config=(new j).withData(f).withTitle(b.chartObject.options.title),b.chartObject.options&&b.chartObject.d3Config.withColor(b.chartOptions.colors)):(b.chartObject.d3Config=new k(b.chartAggregationName).withType("PieChart"===b.chartType?"pieChart":"multiBarHorizontalChart").withData(f,"PieChart"===b.chartType,c("translate")("graphics.nbr-studies")).withTitle(c("translate")(b.chartTitleGraph)+" (N="+a.studyResultDto.totalHits+")"),"PieChart"!==b.chartType&&(b.chartObject.d3Config.options.chart.showLegend=!1),b.chartObject.options&&b.chartObject.options.colors&&(b.chartObject.d3Config.options.chart.color=b.chartOptions.colors),b.chartObject.d3Config.options.chart.legendPosition="right",b.chartObject.d3Config.options.chart.legend={margin:{top:0,right:10,bottom:0,left:0}})})})}b.ready=!0,b.$watch("chartAggregationName",function(){b.chartAggregationName&&l()})}]),ngObibaMica.graphics.factory("GraphicChartsDataResource",["$resource","ngObibaMicaUrl",function(a,b){var c=b.getUrl("JoinQuerySearchResource"),d=-1===c.indexOf(":query")?"POST":"GET";return a(c,{},{studies:{method:d,headers:{"Content-Type":"POST"===d?"application/x-www-form-urlencoded":"application/json"},errorHandler:!0,params:{type:"studies"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]).service("GraphicChartsConfig",function(){var a={options:{entityIds:"NaN",entityType:null,ChartsOptions:{geoChartOptions:{header:["graphics.country","graphics.nbr-studies"],title:"graphics.geo-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#e5edfb","#cfddf5","#b8cbed","#a0b8e2","#88a4d4"]}},studiesDesigns:{header:["graphics.study-design","graphics.nbr-studies","graphics.number-participants"],title:"graphics.study-design-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"},1:{axis:"nbrParticipants"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"},nbrParticipants:{label:"Number of Participants"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}},numberParticipants:{header:["graphics.number-participants","graphics.nbr-studies"],title:"graphics.number-participants-chart-title",options:{backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"],pieSliceTextStyle:{color:"#000000"}}},biologicalSamples:{header:["graphics.bio-samples","graphics.nbr-studies"],title:"graphics.bio-samples-chart-title",options:{bars:"horizontal",series:{0:{axis:"nbrStudies"}},axes:{x:{nbrStudies:{side:"top",label:"Number of Studies"}}},backgroundColor:{fill:"transparent"},colors:["#b8cbed","#e5edfb","#cfddf5","#a0b8e2","#88a4d4"]}}}}};return a.setOptions=function(b){"object"==typeof b&&Object.keys(b).forEach(function(c){c in a.options&&(a.options[c]=b[c])})},a.getOptions=function(){return angular.copy(a.options)},a}).service("GraphicChartsUtils",["LocalizedValues","TaxonomyResource","VocabularyService","$q","$translate",function(a,b,c,d,e){var f={};f.getTerms=function(a){function e(){var b=null;f.vocabularies&&angular.forEach(f.vocabularies,function(d){c.vocabularyAlias(d)===a&&(b=d.terms)}),g.resolve(b)}var g=d.defer();return f.vocabularies?e():b.get({target:"study",taxonomy:"Mica_study"}).$promise.then(function(a){f.vocabularies=angular.copy(a.vocabularies),e()}),g.promise},this.getArrayByAggregation=function(b,c){var g=d.defer();b&&c||g.resolve([]);var h=[];return f.getTerms(b).then(function(d){var f=d,i=0;angular.forEach(c.aggs,function(c){if(c.aggregation===b)if(c["obiba.mica.RangeAggregationResultDto.ranges"])i=0,angular.forEach(f,function(b){angular.forEach(c["obiba.mica.RangeAggregationResultDto.ranges"],function(c){b.name===c.key&&c.count&&(h[i]={title:a.forLocale(b.title,e.use()),value:c.count,key:c.key},i++)})});else{if("populations-model-selectionCriteria-countriesIso"===c.aggregation){var d=e.use();f.sort(function(b,c){var e=a.forLocale(b.title,d),f=a.forLocale(c.title,d);return e<f?-1:e>f?1:0})}var g=0;i=0,angular.forEach(f,function(b){angular.forEach(c["obiba.mica.TermsAggregationResultDto.terms"],function(d){b.name===d.key&&d.count&&("model-methods-design"===c.aggregation?(angular.forEach(d.aggs,function(b){if("model-numberOfParticipants-participant-number"===b.aggregation){var c=b["obiba.mica.StatsAggregationResultDto.stats"];g=a.formatNumber(c?c.data.sum:0)}}),h[i]={title:a.forLocale(b.title,e.use()),value:d.count,participantsNbr:g,key:d.key}):h[i]={title:a.forLocale(b.title,e.use()),value:d.count,key:d.key},i++)})})}}),g.resolve(h)}),g.promise}}]).service("GraphicChartsQuery",["RqlQueryService","RqlQueryUtils","$translate",function(a,b,c){this.queryDtoBuilder=function(d,e){var f;d&&"NaN"!==d||(f="study(exists(Mica_study.id))"),e&&"NaN"!==d&&(f=e+"(in(Mica_"+e+".id,("+d+")))");var g=angular.copy(a.parseQuery(f));b.addLocaleQuery(g,c.use());var h=(new RqlQuery).serializeArgs(g.args);return a.prepareGraphicsQuery(h,["Mica_study.populations-selectionCriteria-countriesIso","Mica_study.populations-dataCollectionEvents-bioSamples","Mica_study.numberOfParticipants-participant-number"],["Mica_study.methods-design"])}}]),ngObibaMica.localized=angular.module("obiba.mica.localized",["obiba.notification","pascalprecht.translate","templates-ngObibaMica"]),ngObibaMica.localized.directive("localized",["LocalizedValues",function(a){return{restrict:"AE",scope:{value:"=",lang:"=",ellipsisSize:"=",markdownIt:"=",keyLang:"@",keyValue:"@"},templateUrl:"localized/localized-template.html",link:function(b){b.keyLang=b.keyLang||"lang",b.keyValue=b.keyValue||"value",b.LocalizedValues=a}}}]).directive("localizedNumber",["LocalizedValues",function(a){return{restrict:"E",scope:{number:"=value"},template:"{{::localizedNumber}}",controller:["$scope",function(b){b.localizedNumber=a.formatNumber(b.number)}]}}]).directive("localizedInput",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",customValidator:"="},templateUrl:"localized/localized-input-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedInputGroup",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",remove:"=",customValidator:"="},templateUrl:"localized/localized-input-group-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]).directive("localizedTextarea",[function(){return{restrict:"AE",require:"^form",scope:{name:"@",model:"=",label:"@",required:"@",disabled:"=",lang:"=",help:"@",rows:"@",customValidator:"="},templateUrl:"localized/localized-textarea-template.html",link:function(a,b,c,d){(angular.isUndefined(a.model)||null===a.model)&&(a.model=[{lang:a.lang,value:""}]),a.$watch("model",function(b){(angular.isUndefined(b)||null===b)&&(a.model=[{lang:a.lang,value:""}]),0===a.model.filter(function(b){if(b.lang===a.lang)return b}).length&&a.model.push({lang:a.lang,value:""})},!0),a.fieldName=a.name+"-"+a.lang,a.form=d}}}]),ngObibaMica.localized.service("LocalizedValues",["$translate",function(a){var b=this;this.for=function(a,c,d,e){if(angular.isArray(a)){var f=a.filter(function(a){return a[d]===c});if(f&&f.length>0)return f[0][e];var g=a.map(function(a){return a[d]});if(g.length>0)return b.for(a,1===g.length?g[0]:"en",d,e)}else if(angular.isObject(a))return b.for(Object.keys(a).map(function(b){return{lang:b,value:a[b]}}),c,d,e);return a||""},this.forLocale=function(a,b){var c=this.for(a,b,"locale","text");return c&&""!==c||(c=this.for(a,"und","locale","text")),c&&""!==c||(c=this.for(a,"en","locale","text")),c},this.forLang=function(a,b){var c=this.for(a,b,"lang","value");return c&&""!==c||(c=this.for(a,"und","lang","value")),c&&""!==c||(c=this.for(a,"en","lang","value")),c},this.formatNumber=function(b){return void 0===b||null===b||"number"!=typeof b?b:b.toLocaleString(a.use())},this.arrayToObject=function(a){var b={};return a&&a.forEach(function(a){b[a.lang]=a.value}),b},this.objectToArray=function(a,b){var c=[];if(a){var d=b||Object.keys(a);d&&d.forEach(function(b){c.push({lang:b,value:a[b]})})}return 0===c.length?void 0:c}}]).service("LocalizedSchemaFormService",["$filter",function(a){this.translate=function(a){return a?"string"==typeof a?this.translateString(a):"object"==typeof a?Array.isArray(a)?this.translateArray(a):this.translateObject(a):a:a},this.translateObject=function(a){if(!a)return a;for(var b in a)a.hasOwnProperty(b)&&("string"==typeof a[b]?a[b]=this.translateString(a[b]):"object"==typeof a[b]&&(Array.isArray(a[b])?a[b]=this.translateArray(a[b]):a[b]=this.translateObject(a[b])));return a},this.translateArray=function(a){if(!a)return a;var b=this;return a.map(function(a){return b.translate(a)}),a},this.translateString=function(b){return b?b.replace(/t\(([^\)]+)\)/g,function(b,c){return a("translate")(c)}):b}}]),ngObibaMica.localized.filter("localizedNumber",["LocalizedValues",function(a){return function(b){return 0===b?0:b?a.formatNumber(b):""}}]).filter("localizedString",["$translate","LocalizedValues",function(a,b){return function(c){return b.forLocale(c,a.use())}}]),ngObibaMica.fileBrowser=angular.module("obiba.mica.fileBrowser",["pascalprecht.translate","ui.bootstrap","templates-ngObibaMica"]).config(["$provide",function(a){a.provider("ngObibaMicaFileBrowserOptions",new NgObibaMicaFileBrowserOptionsProvider)}]),ngObibaMica.fileBrowser.directive("fileBrowser",[function(){return{restrict:"EA",replace:!0,controller:"FileBrowserController",scope:{docPath:"@",docId:"@",tokenKey:"@",subject:"=",refresh:"=",showTitle:"@"},templateUrl:"file-browser/views/file-browser-template.html",link:function(a,b){a.selfNode=b[0]}}}]),ngObibaMica.fileBrowser.controller("FileBrowserController",["$rootScope","$scope","$log","$filter","StringUtils","FileBrowserService","BrowserBreadcrumbHelper","AlertService","ServerErrorUtils","FileBrowserFileResource","FileBrowserSearchResource","ngObibaMicaFileBrowserOptions","FileBrowserDownloadService","CustomWatchDomElementService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){b.data.search.text=null,b.data.search.active=!1}function p(a,c){var d;b.data.search.active=!1,d=c?{path:a,keyToken:c}:{path:a},j.get(d,function(d){404!==d.code?(b.pagination.selected=-1,b.data.document=b.data.details.document=d,b.data.document.children||(b.data.document.children=[]),c&&(b.data.document.keyToken=c),b.data.document.path===b.data.rootPath&&(b.data.document.children=b.data.document.children.filter(function(a){return l.folders.excludes.indexOf(a.name)<0}),b.data.document.size=b.data.document.children.length),b.data.breadcrumbs=g.toArray(a,b.data.rootPath),b.data.isFile=f.isFile(d),b.data.isRoot=f.isRoot(d),b.noDocument=!1,"FOLDER"===d.type&&d.size<1&&(b.noDocument=!0)):b.noDocument=!0},w)}function q(a,b,c){a.stopPropagation();var d=b.path;d=0===d.lastIndexOf("/")?"/":d.substring(0,d.lastIndexOf("/")),u(d,c)}function r(){if(!b.data.isRoot&&b.data.document){var a=b.data.document.path.replace(/\\/g,"/").replace(/\/[^\/]*$/,"");p(a||"/")}}function s(){b.pagination.selected=-1,b.data.details.show=!1}function t(a,d){function e(b){var c="";try{var d=[];l.folders.excludes.forEach(function(b){var c=a.replace(/\//g,"\\/")+"\\/"+b.replace(/\s/,"\\ ");d.push(c),d.push(c+"\\/*")}),c=d.length>0?"NOT path:("+d.join(" OR ")+")":""}catch(a){}return b?b+" AND "+c:c}d.query=e(d.query);var f=angular.extend({},{path:a},d);k.search(f,function(a){var c=b.data.document?angular.copy(b.data.document):{};c.children=a,b.data.document=c},function(a){c.debug("ERROR:",a)})}var u=function(a,b){o(),p(a,b)},v=function(a,b,c){a.stopPropagation(),b&&u(b.path,c)},w=function(a){h.alert({id:"FileSystemController",type:"danger",msg:i.buildMessage(a)}),403!==a.status&&b.data.document&&v(b.data.document)},x=function(a){b.data.search.active=!0,s();var c=b.data.search.recursively,d=null,e=null,f=999;switch(b.data.search.query=a,a){case"RECENT":a="",d="desc",e="lastModifiedDate",f=10}var g={query:a,recursively:c,sort:e,order:d,limit:f};t(b.data.document.path,g)},y=function(){b.data.search.recursively=!b.data.search.recursively,b.data.search.text?x(b.data.search.text):b.data.search.query&&x(b.data.search.query)},z=function(){o(),p(b.data.document.path)},A=function(a){switch(a.keyCode){case 13:b.data.search.text?x(b.data.search.text):z();break;case 27:b.data.search.active&&z()}},B=function(a,c){b.pagination.selected=c,b.data.details.document=a,b.data.details.show=!0},C=function(a){return f.isFile(a)&&a.attachment.type?a.attachment.type.split(/,|\s+/):[]},D=function(a){return f.getLocalizedValue(a,l.locale)},E=function(a){return f.hasLocalizedValue(a,l.locale)},F=function(a,c){a&&c&&(b.docPath=a,b.docId=c),b.docPath&&"/"!==b.docPath&&b.docId&&(b.data.docRootIcon=g.rootIcon(b.docPath),b.data.rootPath=b.docPath+("null"!==b.docId?"/"+b.docId:""),b.tokenKey?p(b.data.rootPath,b.tokenKey,null):p(b.data.rootPath,null))};b.downloadTarget=l.downloadInline?"_blank":"_self",b.getDownloadUrl=m.getUrl,b.screen=a.screen,b.truncate=e.truncate,b.getDocumentIcon=f.getDocumentIcon,b.navigateToPath=u,b.navigateTo=v,b.navigateBack=r,b.navigateToParent=q,b.clearSearch=z,b.searchDocuments=x,b.toggleRecursively=y,b.searchKeyUp=A,b.isFile=f.isFile,b.isRoot=f.isRoot,b.getLocalizedValue=D,b.hasLocalizedValue=E,b.hideDetails=s,b.showDetails=B,b.getTypeParts=C,b.documentsTitle=l.documentsTitle,b.pagination={selected:-1,currentPage:1,itemsPerPage:20},b.data={keyToken:null,details:{document:null,show:!1},docRootIcon:null,rootPath:null,document:null,accesses:[],search:{text:null,active:!1,recursively:!0},breadcrumbs:null,isFile:!1,isRoot:!1,editDescField:!1},b.$watchGroup(["docPath","docId"],function(){F()}),b.__defineSetter__("selfNode",function(a){a&&n.configWatch(a,["refresh","show-title"]).customWatch(function(){"true"===a.attributes[4].value&&(F(a.attributes[1].value,a.attributes[2].value),b.showTitle=a.attributes[6].value)})})}]),ngObibaMica.fileBrowser.factory("FileBrowserFileResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("FileBrowserFileResource"),{path:"@path",keyToken:"@keyToken"},{get:{method:"GET",errorHandler:!0}})}]).factory("FileBrowserSearchResource",["$resource","ngObibaMicaUrl",function(a,b){return a(b.getUrl("FileBrowserSearchResource"),{path:"@path"},{search:{method:"GET",isArray:!0,errorHandler:!0}})}]).service("FileBrowserDownloadService",["ngObibaMicaUrl","ngObibaMicaFileBrowserOptions",function(a,b){return this.getUrl=function(c,d){var e=a.getUrl("FileBrowserDownloadUrl").replace(/:path/,window.encodeURIComponent(c)).replace(/:inline/,b.downloadInline);return e=d?e.replace(/:key/,d):e.replace(/:key/,"")},this}]).service("FileBrowserService",[function(){this.isFile=function(a){return a&&"FILE"===a.type},this.isRoot=function(a){return a&&"/"===a.path},this.getLocalizedValue=function(a,b){if(!a)return null;var c=a.filter(function(a){return a.lang===b});return c&&c.length>0?c[0].value:null},this.hasLocalizedValue=function(a,b){var c=this.getLocalizedValue(a,b);return null!==c&&c.trim().length>0},this.getDocumentIcon=function(a){if(!a)return"";if("FOLDER"===a.type)return"fa-folder";var b=a.path.match(/\.(\w+)$/);if(b&&b.length>1)switch(b[1].toLowerCase()){case"doc":case"docx":case"odm":case"gdoc":return"fa-file-word-o";case"xls":case"xlsx":return"fa-file-excel-o";case"pdf":return"fa-file-pdf-o";case"ppt":case"odt":return"fa-file-powerpoint-o";case"xt":return"fa-file-text-o"}return"fa-file"}}]).service("BrowserBreadcrumbHelper",[function(){this.toArray=function(a,b){if(a){a=a.replace(b,"");var c=a.replace(/\/$/,"").split("/").slice(1),d=[],e=null;return c.forEach(function(a){e=(null===e?b:e)+"/"+a,d.push({name:a,path:e})}),d}return[{name:"",path:""}]},this.rootIcon=function(a){var b=/^\/([^\/]*)/.exec(a);switch(b?b[1]:""){case"study":return"i-obiba-study";case"network":return"i-obiba-network";case"study-dataset":return"i-obiba-study-dataset";case"harmonization-dataset":return"i-obiba-harmo-dataset";default:return"fa fa-hdd-o"}}}]),angular.module("templates-ngObibaMica",["access/components/action-log/component.html","access/components/action-log/item/component.html","access/components/action-log/item/delete-modal.html","access/components/action-log/item/edit-modal.html","access/components/entity-list/component.html","access/components/print-friendly-view/component.html","access/components/status-progressbar/component.html","access/views/data-access-amendment-view.html","access/views/data-access-request-documents-view.html","access/views/data-access-request-form.html","access/views/data-access-request-history-view.html","access/views/data-access-request-list.html","access/views/data-access-request-profile-user-modal.html","access/views/data-access-request-submitted-modal.html","access/views/data-access-request-validation-modal.html","access/views/data-access-request-view.html","analysis/components/crosstab-study-table/component.html","analysis/components/entities-count-result-table/component.html","analysis/components/variable-criteria/component.html","analysis/crosstab/views/crosstab-variable-crosstab.html","analysis/crosstab/views/crosstab-variable-frequencies-empty.html","analysis/crosstab/views/crosstab-variable-frequencies.html","analysis/crosstab/views/crosstab-variable-statistics-empty.html","analysis/crosstab/views/crosstab-variable-statistics.html","analysis/views/analysis-entities-count.html","attachment/attachment-input-template.html","attachment/attachment-list-template.html","file-browser/views/document-detail-template.html","file-browser/views/documents-table-template.html","file-browser/views/file-browser-template.html","file-browser/views/toolbar-template.html","graphics/views/charts-directive.html","graphics/views/tables-directive.html","lists/components/badge-count/component.html","lists/views/input-search-widget/input-search-widget-template.html","lists/views/list/datasets-search-result-table-template.html","lists/views/list/networks-search-result-table-template.html","lists/views/list/studies-search-result-table-template.html","lists/views/region-criteria/criterion-dropdown-template.html","lists/views/region-criteria/search-criteria-region-template.html","lists/views/search-result-list-template.html","lists/views/sort-widget/sort-widget-template.html","localized/localized-input-group-template.html","localized/localized-input-template.html","localized/localized-template.html","localized/localized-textarea-template.html","search/components/criteria/criteria-root/component.html","search/components/criteria/criteria-target/component.html","search/components/criteria/item-region/dropdown/component.html","search/components/criteria/item-region/item-node/component.html","search/components/criteria/item-region/match/component.html","search/components/criteria/item-region/numeric/component.html","search/components/criteria/item-region/region/component.html","search/components/criteria/item-region/string-terms/component.html","search/components/criteria/match-vocabulary-filter-detail/component.html","search/components/criteria/numeric-vocabulary-filter-detail/component.html","search/components/criteria/terms-vocabulary-filter-detail/component.html","search/components/entity-counts/component.html","search/components/entity-search-typeahead/component.html","search/components/facets/taxonomy/component.html","search/components/input-search-filter/component.html","search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html","search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html","search/components/panel/classification/component.html","search/components/panel/taxonomies-panel/component.html","search/components/panel/taxonomy-panel/component.html","search/components/panel/term-panel/component.html","search/components/panel/vocabulary-panel/component.html","search/components/result/cell-stat-value/component.html","search/components/result/coverage-result/component.html","search/components/result/datasets-result-table/component.html","search/components/result/graphics-result/component.html","search/components/result/networks-result-table/component.html","search/components/result/pagination/component.html","search/components/result/search-result/component.html","search/components/result/search-result/coverage.html","search/components/result/search-result/graphics.html","search/components/result/search-result/list.html","search/components/result/studies-result-table/component.html","search/components/result/tabs-order-count/component.html","search/components/result/variables-result-table/component.html","search/components/search-box-region/component.html","search/components/study-filter-shortcut/component.html","search/components/taxonomy/taxonomy-filter-detail/component.html","search/components/taxonomy/taxonomy-filter-panel/component.html","search/components/vocabulary-filter-detail-heading/component.html","search/components/vocabulary/vocabulary-filter-detail/component.html","search/views/classifications.html","search/views/classifications/taxonomy-accordion-group.html","search/views/classifications/taxonomy-template.html","search/views/classifications/vocabulary-accordion-group.html","search/views/criteria/criterion-header-template.html","search/views/criteria/target-template.html","search/views/list/pagination-template.html","search/views/search-layout.html","search/views/search-result-graphics-template.html","search/views/search-result-list-dataset-template.html","search/views/search-result-list-network-template.html","search/views/search-result-list-study-template.html","search/views/search-result-list-variable-template.html","search/views/search.html","search/views/search2.html","sets/components/add-to-set-modal/component.html","sets/components/cart-documents-table/component.html","sets/components/set-variables-table/component.html","sets/views/cart.html","sets/views/sets.html","utils/components/entity-schema-form/component.html","utils/components/table-alert-header/component.html","utils/services/user-profile-modal/service.html","utils/views/unsaved-modal.html","views/pagination-template.html"]),angular.module("access/components/action-log/component.html",[]).run(["$templateCache",function(a){a.put("access/components/action-log/component.html",'<form class="form-inline voffset2" name="actionLogForm">\n  <div class="form-group">\n    <input type="text"\n           class="form-control"\n           ng-model="$ctrl.item.action"\n           ng-required="true"\n           placeholder="{{\'data-access-request.action-log.action-placeholder\' | translate}}"\n           typeahead-editable="true"\n           uib-typeahead="value for value in $ctrl.predefinedActionNames | filter:$viewValue | limitTo:8">\n  </div>\n  <div class="form-group">\n    <div class="input-group">\n      <input type="datetime"\n             class="form-control"\n             uib-datepicker-popup="dd/MM/yyyy"\n             ng-model="$ctrl.item.changedOn"\n             ng-required="true"\n             ng-focus="$ctrl.open = !$ctrl.item.changedOn" is-open="$ctrl.open"\n             placeholder="dd/MM/yyyy"\n             show-button-bar="false">\n\n      <span class="input-group-btn">\n        <button type="button" class="btn btn-sm btn-default" ng-click="$ctrl.open = !$ctrl.open">\n          <i class="glyphicon glyphicon-calendar"></i>\n        </button>\n      </span>\n    </div>\n  </div>\n\n  <button type="button" class="btn btn-sm btn-info" ng-click="$ctrl.add($ctrl.item)">{{\'global.add\' | translate}}\n    <i class="fa fa-plus"></i>\n  </button>\n\n  <div class="form-group has-error" ng-if="$ctrl.showError && (!$ctrl.item.action || !$ctrl.item.changedOn)">\n    <span class="control-label">{{\'data-access-request.action-log.required\' | translate}}</span>\n  </div>\n</form>')}]),angular.module("access/components/action-log/item/component.html",[]).run(["$templateCache",function(a){a.put("access/components/action-log/item/component.html",'<ul class="list-inline" ng-if="$ctrl.showButtons">\n  <li>\n    <a ng-click="$ctrl.edit($ctrl.item)">\n      <i class="fa fa-pencil"></i>\n    </a>\n  </li>\n  <li>\n    <a ng-click="$ctrl.remove($ctrl.item)">\n      <i class="fa fa-trash-o"></i>\n    </a>\n  </li>\n</ul>')}]),angular.module("access/components/action-log/item/delete-modal.html",[]).run(["$templateCache",function(a){a.put("access/components/action-log/item/delete-modal.html",'<div class="modal-header">\n  <h4 class="modal-title">\n    <i class="fa fa-exclamation-triangle"></i>\n    {{\'data-access-request.action-log.delete.title\' | translate}}\n  </h4>\n</div>\n\n<div class="modal-body">\n  {{\'data-access-request.action-log.delete.message\' | translate:$modal.item}}\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-responsive btn-default" type="button" ng-click="$dismiss()" translate>cancel</button>\n  <button class="btn btn-responsive btn-primary" type="button" ng-click="$close()" translate>ok</button>\n</div>')}]),angular.module("access/components/action-log/item/edit-modal.html",[]).run(["$templateCache",function(a){a.put("access/components/action-log/item/edit-modal.html",'<div class="modal-header">\n  <h4 class="modal-title">\n    {{\'data-access-request.action-log.edit.title\' | translate}}\n  </h4>\n</div>\n\n<div class="modal-body">\n  <form name="actionLogModalForm">\n    <div class="form-group">\n      <input type="text"\n             class="form-control"\n             ng-model="$modal.item.action"\n             ng-required="true"\n             placeholder="{{\'data-access-request.action-log.action-placeholder\' | translate}}"\n             typeahead-editable="true"\n             uib-typeahead="value for value in $modal.predefinedActionNames | filter:$viewValue | limitTo:8">\n    </div>\n\n    <div class="form-group">\n      <div class="input-group">\n        <input type="datetime" class="form-control" uib-datepicker-popup="dd/MM/yyyy" ng-model="$modal.item.changedOn" ng-required="true"\n          ng-focus="$modal.open = !$modal.item.changedOn" is-open="$modal.open" placeholder="dd/MM/yyyy" show-button-bar="false">\n\n        <span class="input-group-btn">\n          <button type="button" class="btn btn-sm btn-default" ng-click="$modal.open = !$modal.open">\n            <i class="glyphicon glyphicon-calendar"></i>\n          </button>\n        </span>\n      </div>\n    </div>\n  </form>\n</div>\n\n<div class="modal-footer">\n  <button class="btn btn-responsive btn-default" type="button" ng-click="$dismiss()" translate>cancel</button>\n  <button class="btn btn-responsive btn-primary" type="button" ng-disabled="!$modal.item.action || !$modal.item.changedOn"\n    ng-click="$close($modal.item)" translate>ok</button>\n</div>')}]),angular.module("access/components/entity-list/component.html",[]).run(["$templateCache",function(a){a.put("access/components/entity-list/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <div class="row">\n    <div class="col-xs-12">\n      <a ng-href="#{{$ctrl.entityBaseUrl}}/new" class="btn btn-info" ng-if="$ctrl.canAdd">\n        <i class="fa fa-plus"></i>\n        <span>{{$ctrl.addButtonCaption | translate}}</span>\n      </a>\n\n      <span ng-bind-html="config.newRequestButtonHelpText" ng-if="$ctrl.canAdd"></span>\n\n      <span class="pull-right" ng-if="$ctrl.requests.length > 0 && !$ctrl.parentId">\n        <a target="_self" download class="btn btn-info" ng-href="{{$ctrl.getCsvExportHref()}}">\n          <i class="fa fa-download"></i> {{\'report\' | translate}}\n        </a>\n\n        <a target="_self" download class="btn btn-info" ng-href="{{$ctrl.getHistoryExportHref()}}">\n          <i class="fa fa-download"></i> {{\'history\' | translate}}\n        </a>\n      </span>\n    </div>\n  </div>\n\n  <p class="help-block">\n    <span ng-if="!$ctrl.canAdd" translate>data-access-amendment.cannot-add</span>\n    <span ng-if="$ctrl.canAdd && $ctrl.requests.length == 0 && !loading">{{$ctrl.noneCaption | translate}}</span>\n  </p>\n\n  <p ng-if="$ctrl.loading" class="voffset2 loading">\n  </p>\n\n  <div ng-if="$ctrl.requests.length > 0">\n    <div class="row voffset2">\n      <div class="col-xs-4">\n        <span class="input-group input-group-sm no-padding-top">\n          <span class="input-group-addon" id="data-access-requests-search">\n            <i class="glyphicon glyphicon-search"></i>\n          </span>\n          <input ng-model="$ctrl.searchText" type="text" class="form-control" aria-describedby="data-access-requests-search">\n        </span>\n      </div>\n      <div class="col-xs-2">\n        <ui-select id="status-select" theme="bootstrap" ng-model="$ctrl.searchStatus.filter" reset-search-input="true">\n          <ui-select-match allow-clear="true" placeholder="{{\'data-access-request.status-placeholder\' | translate}}">\n            <span ng-bind-html="$select.selected.translation"></span>\n          </ui-select-match>\n          <ui-select-choices repeat="data in $ctrl.REQUEST_STATUS">\n            {{data.translation}}\n          </ui-select-choices>\n        </ui-select>\n      </div>\n      <div class="col-xs-6">\n        <dir-pagination-controls class="pull-right"></dir-pagination-controls>\n      </div>\n    </div>\n\n    <div class="table-responsive">\n      <table class="table table-bordered table-striped" obiba-table-sorter="$ctrl.requests">\n        <thead>\n          <tr>\n            <th data-column-name="id">ID</th>\n            <th ng-if="$ctrl.showApplicant" data-column-name="applicant">{{"data-access-request.applicant" | translate}}</th>\n            <th data-column-name="title">{{"title" | translate}}</th>\n            <th data-column-name="lastUpdate">{{"data-access-request.lastUpdate" | translate}}</th>\n            <th data-column-name="submissionDate">{{"data-access-request.submissionDate" | translate}}</th>\n            <th data-column-name="status">{{"data-access-request.status" | translate}}</th>\n            <th data-column-name="request.amendmentsSummary.pending" ng-if="!$ctrl.parentId">{{"data-access-request.pending-amendments" | translate}}</th>\n            <th data-column-name="request.amendmentsSummary.total" ng-if="!$ctrl.parentId">{{"data-access-request.total-amendments" | translate}}</th>\n            <th translate>actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr dir-paginate="request in $ctrl.requests | filter:{status: $ctrl.searchStatus.filter.key} : true | filter:$ctrl.searchText | itemsPerPage: 20">\n            <td>\n              <a ng-href="#{{$ctrl.entityBaseUrl}}/{{request.id}}" ng-if="$ctrl.actions.canView(request)" translate>{{request.id}}</a>\n              <span ng-if="!$ctrl.actions.canView(request)">{{request.id}}</span>\n            </td>\n            <td ng-if="$ctrl.showApplicant">\n              <span ng-if="!request.profile.attributes">\n                {{request.applicant}}\n              </span>\n              <span ng-if="request.profile.attributes && $ctrl.actions.canViewProfile(\'mica-user\') && !$ctrl.actions.canViewProfile(\'mica-data-access-officer\')">\n                {{$ctrl.UserProfileService.getFullName(request.profile) || request.applicant}}\n              </span>\n              <a href ng-click="$ctrl.UserProfileModalService.show(request.profile)" ng-if="request.profile.attributes && $ctrl.actions.canViewProfile(\'mica-data-access-officer\')">\n                {{$ctrl.UserProfileService.getFullName(request.profile) || request.applicant}}\n              </a>\n            </td>\n            <td>\n              {{request.title}}\n            </td>\n            <td>\n              <span title="{{(request.lastUpdate || request.timestamps.created) | amDateFormat: \'lll\'}}">\n                {{(request.lastUpdate || request.timestamps.created) | amCalendar}}\n              </span>\n\n            </td>\n            <td>\n              <span ng-if="request.submissionDate" title="{{ request.submissionDate | amDateFormat: \'lll\' }}">\n                {{request.submissionDate | amCalendar}}\n              </span>\n            </td>\n            <td>\n              {{request.status | translate}}\n            </td>\n            <td ng-if="!$ctrl.parentId">\n              <span ng-if="request.amendmentsSummary">\n                {{request.amendmentsSummary.pending}}\n              </span>\n              <span ng-if="!request.amendmentsSummary"></span>\n            </td>\n            <td ng-if="!$ctrl.parentId">\n              <span ng-if="request.amendmentsSummary">\n                {{request.amendmentsSummary.total}}\n              </span>\n              <span ng-if="!request.amendmentsSummary"></span>\n            </td>\n            <td>\n              <ul class="list-inline">\n                <li ng-if="$ctrl.actions.canEdit(request)">\n                  <a ng-href="#{{$ctrl.entityBaseUrl}}/{{request.id}}/edit" title="{{\'edit\' | translate}}">\n                    <i class="fa fa-pencil"></i>\n                  </a>\n                </li>\n                <li>\n                  <a ng-if="$ctrl.actions.canDelete(request)" ng-click="$ctrl.deleteRequest(request)" title="{{\'delete\' | translate}}">\n                    <i class="fa fa-trash-o"></i>\n                  </a>\n                </li>\n              </ul>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("access/components/print-friendly-view/component.html",[]).run(["$templateCache",function(a){a.put("access/components/print-friendly-view/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<div>\n  <div class="clearfix"></div>\n  <div class="voffset2" ng-if="$ctrl.project && $ctrl.project.permissions && $ctrl.project.permissions.view">\n    <div ng-if="$ctrl.project" class="pull-right">\n      <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n        <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{$ctrl.project.id}}">{{$ctrl.project.id}}</a>\n      </small>\n    </div>\n  </div>\n\n  <div>\n    <form id="request-form" name="forms.requestForm">\n      <obiba-schema-form-renderer model="$ctrl.model" schema-form="$ctrl.accessForm" read-only="true"></obiba-schema-form-renderer>\n    </form>\n  </div>\n\n  <div ng-if="$ctrl.lastSubmittedDate">\n    <h3 translate>data-access-request.submissionDate</h3>\n    <p>{{$ctrl.lastSubmittedDate.changedOn | amDateFormat:\'dddd, MMMM Do YYYY\' | capitalizeFirstLetter}}</p>\n  </div>\n</div>\n')}]),angular.module("access/components/status-progressbar/component.html",[]).run(["$templateCache",function(a){a.put("access/components/status-progressbar/component.html",'<div class="progress obiba-status-progress">\n    <div class="progress-bar obiba-status-progress-bar"\n         ng-class="{\'progress-bar-default\': $ctrl.percent < 1, \'progress-bar-success\': $ctrl.percent > 0}"\n         role="progressbar"\n         ng-style="{\'width\': $ctrl.percent + \'%\'}">\n        <span>{{$ctrl.status | translate}}</span>\n    </div>\n</div>')}]),angular.module("access/views/data-access-amendment-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-amendment-view.html",'<div>\n  <print-friendly-view class="visible-print" valid-form="true" model="model" access-form="dataAccessForm" last-submitted-date="lastSubmittedDate">\n  </print-friendly-view>\n\n  <div class="hidden-print">\n    <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n    <obiba-alert id="DataAccessAmendmentViewController"></obiba-alert>\n\n    <p class="help-block col-md-4" ng-if="requestEntity.applicant">\n      <span translate>created-by</span>\n      <span ng-if="!actions.canViewProfile(\'mica-data-access-officer\')">\n        {{getFullName(requestEntity.profile) || requestEntity.applicant}},\n      </span>\n      <span ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n        <a href ng-click="userProfile(requestEntity.profile)">\n          {{getFullName(requestEntity.profile) || requestEntity.applicant}}</a>,\n      </span>\n      <span title="{{requestEntity.timestamps.created | amDateFormat: \'lll\'}}">{{requestEntity.timestamps.created | amCalendar}}</span>\n      <status-progressbar status="requestEntity.status" config="dataAccessForm"></status-progressbar>\n    </p>\n\n    <div class="pull-right" ng-if="read && formDrawn">\n      <a ng-click="submit()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canSubmit(requestEntity)" class="btn btn-info"\n        translate>submit</a>\n\n      <a ng-click="reopen()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReopen(requestEntity)" class="btn btn-info"\n        translate>reopen</a>\n\n      <a ng-click="review()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReview(requestEntity)" class="btn btn-info"\n        translate>review</a>\n\n      <a ng-click="conditionallyApprove()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canConditionallyApprove(requestEntity)"\n        class="btn btn-info" translate>conditionallyApprove</a>\n\n      <a ng-click="approve()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canApprove(requestEntity)" class="btn btn-info"\n        translate>approve</a>\n\n      <a ng-click="reject()" ng-if="actions.canEditStatus(requestEntity) && nextStatus.canReject(requestEntity)" class="btn btn-info"\n        translate>reject</a>\n\n      <a ng-href="#{{entityUrl}}/edit" ng-if="actions.canEdit(requestEntity)" class="btn btn-primary" title="{{\'edit\' | translate}}">\n        <i class="fa fa-pencil-square-o"></i>\n      </a>\n\n      <a ng-click="printForm()" class="btn btn-default" title="{{\'global.print\' | translate}}">\n        <i class="fa fa-print"></i>\n        <span translate>global.print</span>\n      </a>\n\n      <a ng-click="delete()" ng-if="actions.canDelete(requestEntity)" class="btn btn-danger" title="{{\'delete\' | translate}}">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <form id="request-form" name="forms.requestForm">\n      <div class="pull-right" ng-if="!read && formDrawn">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(forms.requestForm)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <obiba-schema-form-renderer model="model" schema-form="dataAccessForm" read-only="read" on-redraw="toggleFormDrawnStatus"></obiba-schema-form-renderer>\n\n      <div class="clearfix"></div>\n\n      <div class="pull-right" ng-if="!read && formDrawn">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(forms.requestForm)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n    </form>\n  </div>\n</div>')}]),angular.module("access/views/data-access-request-documents-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-documents-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <div class="help-block" ng-bind-html="config.documentsSectionHelpText || \'data-access-request.documents-help\' | translate"></div>\n\n  <div class="form-group">\n\n    <div class="panel panel-default" ng-show="showAttachmentsForm">\n      <div class="panel-body">\n        <attachment-input files="attachments" multiple="true" on-error="onAttachmentError" delete-attachments="actions.canDeleteAttachments(dataAccessRequest)"></attachment-input>\n\n        <div class="voffset2">\n          <a ng-click="cancelAttachments()" type="button" class="btn btn-default">\n            <span translate>cancel</span>\n          </a>\n\n          <a ng-click="updateAttachments()" type="button" class="btn btn-primary">\n            <span translate>save</span>\n          </a>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="showAttachmentsForm">\n      <p ng-if="dataAccessRequest.attachments.length == 0" class="voffset2" translate>\n        data-access-request.no-documents\n      </p>\n      <attachment-list files="dataAccessRequest.attachments" href-builder="getDownloadHref"></attachment-list>\n      <a ng-if="actions.canEditAttachments(dataAccessRequest)" ng-click="editAttachments()" type="button" class="btn btn-info">\n'+"        <span>{{actions.canDeleteAttachments(dataAccessRequest) ? 'data-access-request.edit-documents' : 'data-access-request.add-documents' | translate}}</span>\n      </a>\n    </div>\n\n  </div>\n</div>")}]),angular.module("access/views/data-access-request-form.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-form.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <obiba-alert id="DataAccessRequestEditController"></obiba-alert>\n\n  \x3c!-- \'ng-if\' does not bind the form to controller scope --\x3e\n  <div ng-show="validForm">\n\n    <form name="form" role="form" novalidate class="ng-scope ng-invalid ng-invalid-required ng-dirty">\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n        <a ng-click="save()" type="button" class="btn btn-primary">\n          <span translate>save</span>\n        </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <obiba-schema-form-renderer model="sfForm.model" schema-form="sfForm" read-only="false"></obiba-schema-form-renderer>\n\n      <div class="pull-right" ng-if="loaded">\n        <a ng-click="cancel()" type="button" class="btn btn-default">\n          <span translate>cancel</span>\n        </a>\n\n      <a ng-click="save()" type="button" class="btn btn-primary">\n        <span translate>save</span>\n      </a>\n\n        <a ng-click="validate(form)" type="button" class="btn btn-info">\n          <span translate>validate</span>\n        </a>\n      </div>\n    </form>\n\n    <div class="clearfix voffet2"></div>\n  </div>\n\n</div>\n')}]),angular.module("access/views/data-access-request-history-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-history-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-if="actions.canEditActionLogs(dataAccessRequest)">\n  <action-log-editor source-collection="dataAccessRequest.actionLogHistory" predefined-actions="dataAccessForm.predefinedActions"\n    update="updateActionLogs(logs)"></action-log-editor>\n</div>\n<div class="table-responsive">\n  <table id="data-access-request-history" class="table table-bordered table-striped" obiba-table-sorter="logsHistory">\n    <thead>\n      <tr>\n        <th class="status-icon"></th>\n        <th translate>status</th>\n        <th translate>changed-by</th>\n        <th data-column-name="changedOn" translate>changed-on</th>\n        <th class="col-xs-1" ng-if="actions.canEditActionLogs(dataAccessRequest)" translate>actions</th>\n      </tr>\n    </thead>\n    <tbody>\n      <tr ng-repeat="log in logsHistory track by $index">\n        <td>\n          <span>\n            <i class="{{log.icon}} hoffset"></i>\n          </span>\n        </td>\n        <td>\n          <span ng-if="log.reference">{{\'data-access-amendment.title\' | translate}}\n            <a ng-href="#{{\'/data-access-request/\' + dataAccessRequest.id + \'/amendment/\' + log.reference}}">{{log.reference}}</a>\n          </span>\n          {{log.msg | translate}}\n        </td>\n        <td>{{UserProfileService.getFullName(log.profile) || log.author}}</td>\n        <td>\n          <span title="{{log.changedOn | amDateFormat: \'lll\'}}">\n            {{log.changedOn | amCalendar}}\n          </span>\n        </td>\n        <td ng-if="actions.canEditActionLogs(dataAccessRequest)">\n          <span ng-if="!loading">\n            <action-log-item-editor item="log" source-collection="dataAccessRequest.actionLogHistory" predefined-actions="dataAccessForm.predefinedActions"\n              update="updateActionLogs(logs)"></action-log-item-editor>\n          </span>\n          \n          <span class="loading" ng-if="loading"></span>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>')}]),angular.module("access/views/data-access-request-list.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-list.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div id="data-access-request-list">\n  <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n  <entity-list parent-id="null" can-add="true"></entity-list>\n\n</div>\n')}]),angular.module("access/views/data-access-request-profile-user-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-profile-user-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true"\n      ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n\n    <table class="table table-bordered table-striped">\n      <tbody>\n      <tr>\n        <th>{{\'data-access-request.profile.name\' | translate}}</th>\n        <td>{{getFullName(applicant)}}</td>\n      </tr>\n      <tr>\n        <th>{{\'data-access-request.profile.email\' | translate}}</th>\n        <td>{{getProfileEmail(applicant)}}</td>\n      </tr>\n      <tr ng-repeat="attribute in applicant.attributes | filterProfileAttributes">\n          <th>{{\n              (\'userProfile.\' + attribute.key | translate) !== (\'userProfile.\' + attribute.key) ?\n              (\'userProfile.\' + attribute.key | translate) :\n              (attribute.key)\n              }}\n          </th>\n          <td>{{attribute.value}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <a class="btn btn-default" ng-if="getProfileEmail(applicant)" href="mailto:{{getProfileEmail(applicant)}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4"\n      ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-submitted-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-submitted-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$close(\'OK\')">&times;</button>\n    <h4 class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.submit-confirmation.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p>{{\'data-access-request.submit-confirmation.message\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$close(\'OK\')">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-validation-modal.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-validation-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$dismiss()">&times;</button>\n    <h4 ng-if="isValid" class="modal-title">\n      <i class="fa fa-check fa-lg"></i>\n      {{\'data-access-request.validation.title-success\' | translate}}\n    </h4>\n    <h4 ng-if="!isValid" class="modal-title">\n      <i class="fa fa-times fa-lg"></i>\n      {{\'data-access-request.validation.title-error\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n    <p ng-if="isValid">{{\'data-access-request.validation.success\' | translate}}</p>\n    <p ng-if="!isValid" translate>{{\'data-access-request.validation.error\' | translate}}</p>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4" ng-click="$dismiss()">\n      <span ng-hide="confirm.ok" translate>ok</span>\n      {{confirm.ok}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("access/views/data-access-request-view.html",[]).run(["$templateCache",function(a){a.put("access/views/data-access-request-view.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  \x3c!--<div class="visible-print" print-friendly-view></div>--\x3e\n  <print-friendly-view\n    class="visible-print"\n    project="dataAccessRequest.project"\n    valid-form="validForm"\n    model="form.model"\n    access-form="dataAccessForm"\n    last-submitted-date="lastSubmittedDate">\n  </print-friendly-view>\n  <div class="hidden-print">\n    <div ng-if="headerTemplateUrl" ng-include="headerTemplateUrl"></div>\n\n    <obiba-alert id="DataAccessRequestViewController"></obiba-alert>\n\n    <div ng-if="validForm">\n\n      <p class="help-block col-md-4"><span translate>created-by</span>\n        <span ng-if="!actions.canViewProfile(\'mica-data-access-officer\')">\n           {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}},\n        </span>\n        <span ng-if="actions.canViewProfile(\'mica-data-access-officer\')">\n          <a href ng-click="userProfile(dataAccessRequest.profile)">\n            {{getFullName(dataAccessRequest.profile) || dataAccessRequest.applicant}}</a>,\n        </span>\n        <span title="{{dataAccessRequest.timestamps.created | amDateFormat: \'lll\'}}">{{dataAccessRequest.timestamps.created | amCalendar}}</span>\n        <status-progressbar status="dataAccessRequest.status" config="dataAccessForm"></status-progressbar>\n      </p>\n\n      <div class="pull-right">\n        <a ng-click="submit()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canSubmit(dataAccessRequest)"\n          class="btn btn-info" translate>submit\n        </a>\n        <a ng-click="reopen()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReopen(dataAccessRequest)"\n          class="btn btn-info" translate>reopen\n        </a>\n        <a ng-click="review()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReview(dataAccessRequest)"\n          class="btn btn-info" translate>review\n        </a>\n        <a ng-click="conditionallyApprove()"\n           ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canConditionallyApprove(dataAccessRequest)"\n           class="btn btn-info" translate>conditionallyApprove\n        </a>\n        <a ng-click="approve()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canApprove(dataAccessRequest)"\n          class="btn btn-info" translate>approve\n        </a>\n        <a ng-click="reject()"\n          ng-if="actions.canEditStatus(dataAccessRequest) && nextStatus.canReject(dataAccessRequest)"\n          class="btn btn-info" translate>reject\n        </a>\n        <a ng-href="#/data-access-request/{{dataAccessRequest.id}}/edit"\n          ng-if="actions.canEdit(dataAccessRequest)"\n          class="btn btn-primary" title="{{\'edit\' | translate}}">\n          <i class="fa fa-pencil-square-o"></i>\n        </a>\n        <span ng-if="tabs.activeTab === TAB_NAMES.form">\n          <a ng-if="dataAccessForm.downloadTemplate === false" ng-click="printForm()"\n           class="btn btn-default" title="{{\'global.print\' | translate}}">\n            <i class="fa fa-print"></i> <span translate>global.print</span>\n          </a>\n          <a ng-if="dataAccessForm.downloadTemplate === true" target="_self" href="{{requestDownloadUrl}}" class="btn btn-default">\n            <i class="fa fa-download"></i> <span>{{config.downloadButtonCaption || \'download\' | translate}}</span>\n          </a>\n        </span>\n        <a ng-click="delete()"\n          ng-if="actions.canDelete(dataAccessRequest)"\n          class="btn btn-danger" title="{{\'delete\' | translate}}">\n          <i class="fa fa-trash-o"></i>\n        </a>\n      </div>\n\n      <div class="clearfix"></div>\n\n      <div class="voffset2" ng-if="dataAccessRequest.project.permissions && dataAccessRequest.project.permissions.view">\n        <div ng-if="dataAccessRequest.project" class="pull-right">\n          <small class="help-block inline"> {{\'research-project.label\' | translate}} :\n            <a route-checker route-checker-hides-parent="true" href ng-href="#/project/{{dataAccessRequest.project.id}}">{{dataAccessRequest.project.id}}</a>\n          </small>\n        </div>\n      </div>\n      <uib-tabset active="tabs.activeTab" class="voffset5">\n        \x3c!--Form--\x3e\n        <uib-tab index="0" select="selectTab(TAB_NAMES.form)" heading="{{\'data-access-request.form\' | translate}}">\n          <form id="request-form" name="forms.requestForm">\n            <obiba-schema-form-renderer model="form.model" schema-form="dataAccessForm" read-only="true"></obiba-schema-form-renderer>\n          </form>\n        </uib-tab>\n        \x3c!--Amendments--\x3e\n        <uib-tab ng-if="dataAccessForm.amendmentsEnabled" index="1" select="selectTab(TAB_NAMES.amendments)">\n          <uib-tab-heading>\n            {{\'data-access-amendments\' | translate}}\n          </uib-tab-heading>\n\n          <div ng-show="parentId" class="voffset1">\n            <entity-list parent-id="parentId" can-add="actions.canAddAmendments(dataAccessRequest)"></entity-list>\n          </div>\n        </uib-tab>\n        \x3c!--Documents--\x3e\n        <uib-tab index="2" select="selectTab(TAB_NAMES.documents)">\n          <uib-tab-heading>\n            {{config.documentsSectionTitle || \'data-access-request.documents\' | translate}}\n            <span class="badge hoffset1" ng-show="dataAccessRequest.attachments"><small>{{dataAccessRequest.attachments.length}}</small></span>\n          </uib-tab-heading>\n          <div ng-include="\'access/views/data-access-request-documents-view.html\'"></div>\n        </uib-tab>\n        \x3c!--Comments--\x3e\n        <uib-tab index="3"\n                 ng-if="config.commentsEnabled"\n                 select="selectTab(TAB_NAMES.comments)"\n                 heading="{{\'data-access-request.comments\' | translate}}">\n          <obiba-comments class="voffset2" comments="form.comments"\n                          on-update="updateComment" on-delete="deleteComment"\n                          name-resolver="getFullName(profile)"\n                          edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n          <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n        </uib-tab>\n        <uib-tab index="4"\n                 ng-if="config.commentsEnabled && actions.canViewPrivateComments(dataAccessRequest)"\n                 select="selectTab(TAB_NAMES.privateComments)"\n                 heading="{{\'data-access-request.private-comments\' | translate}}">\n          <obiba-comments class="voffset2" comments="form.comments"\n                          on-update="updateComment" on-delete="deleteComment"\n                          name-resolver="getFullName(profile)"\n                          edit-action="EDIT" delete-action="DELETE"></obiba-comments>\n          <obiba-comment-editor on-submit="submitComment"></obiba-comment-editor>\n        </uib-tab>\n        \x3c!--History--\x3e\n        <uib-tab index="5" select="selectTab(TAB_NAMES.history)" heading="{{\'data-access-request.history\' | translate}}">\n          <div ng-include="\'access/views/data-access-request-history-view.html\'"></div>\n        </uib-tab>\n      </uib-tabset>\n    </div>\n  </div>\n\n</div>\n')}]),angular.module("analysis/components/crosstab-study-table/component.html",[]).run(["$templateCache",function(a){a.put("analysis/components/crosstab-study-table/component.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span title="{{$ctrl.contingency.info.population ? $ctrl.contingency.info.population + \':\' + $ctrl.contingency.info.dce : \'\'}}">\n  <span ng-if="$ctrl.contingency.studyTable">\n    <a ng-href="{{$ctrl.studyLink}}">{{$ctrl.contingency.info.summary}}</a>\n    <span>{{$ctrl.contingency.info.tableName}}</span>\n  </span>\n</span>')}]),angular.module("analysis/components/entities-count-result-table/component.html",[]).run(["$templateCache",function(a){a.put("analysis/components/entities-count-result-table/component.html",'<div>\n  <p class="help-block" ng-if="$ctrl.result && $ctrl.result.query && (!$ctrl.result.counts || $ctrl.result.counts.length === 0)" translate>search.no-results</p>\n  <table class="table table-bordered table-striped" ng-if="$ctrl.result && $ctrl.result.counts && $ctrl.result.counts.length>0">\n    <thead>\n      <th ng-if="$ctrl.showStudyColumn()" translate>taxonomy.target.study</th>\n      <th translate>taxonomy.target.variable</th>\n      <th translate>taxonomy.target.dataset</th>\n      <th style="width: 400px" translate>analysis.criteria</th>\n      <th style="width: 100px" translate>analysis.count</th>\n    </thead>\n    <tbody>\n        <tr ng-repeat="row in $ctrl.table.rows">\n          <td ng-if="row[0].rowspan>0 && $ctrl.showStudyColumn()" colspan="{{row[0].colspan}}" rowspan="{{row[0].rowspan}}" title="{{row[0].title}}">\n            <a href="{{row[0].link}}">{{row[0].value}}</a>\n          </td>\n          \n          \x3c!-- per variable criteria --\x3e\n          <td ng-if="row.length===5" colspan="{{row[1].colspan}}">\n              <a href="{{row[1].link}}">{{row[1].value}}</a>\n              <div class="help-block">{{row[1].title}}</div>\n          </td>\n          <td ng-if="row.length===5" colspan="{{row[2].colspan}}" title="{{row[2].title}}">\n              <a href="{{row[2].link}}">{{row[2].value}}</a>\n          </td>\n          <td ng-if="row.length===5" colspan="{{row[3].colspan}}">\n            <variable-criteria query="row[3].value"></variable-criteria>  \n          </td>\n          <td ng-if="row.length===5" colspan="{{row[4].colspan}}">\n            {{row[4].value}}\n          </td>\n\n          \x3c!-- all criteria --\x3e\n          <td ng-if="row.length===3" colspan="{{row[1].colspan}}" title="{{row[1].title}}">\n            <b translate>analysis.all-criteria</b>\n          </td>\n          <td ng-if="row.length===3" colspan="{{row[2].colspan}}">\n            <span ng-if="$ctrl.studyCount === 1" class="badge">{{$ctrl.localizedTotal}}</span>\n            <b ng-if="$ctrl.studyCount > 1">{{row[2].value}}</b>\n          </td>\n        </tr>\n        <tr ng-if="$ctrl.studyCount > 1">\n          <td colspan="{{$ctrl.showStudyColumn() ? 4 : 3}}">\n            <b translate>total</b>\n          </td>\n          <td>\n            <span class="badge">{{$ctrl.localizedTotal}}</span>\n          </td>\n        </tr>\n    </tbody>\n  </table>\n</div>')}]),angular.module("analysis/components/variable-criteria/component.html",[]).run(["$templateCache",function(a){a.put("analysis/components/variable-criteria/component.html",'<div>\n  <p ng-if="$ctrl.loading" class="voffset2 loading"></p>\n  \n  <div  ng-hide="$ctrl.loading" class="btn-group voffset1 btn-variable" ng-class="{open: $ctrl.state.open}" ng-keyup="$ctrl.onKeyup($event)">\n\n    <button class="btn btn-xs dropdown btn-variable" ng-click="$ctrl.openDropdown()">\n      <span title="{{$ctrl.getQueryTitle(false)}}" test-ref="search-criterion">\n        {{$ctrl.getQueryTitle(true)}}\n      </span>\n      <span class="fa fa-caret-down"></span>\n    </button>\n    <button class="btn btn-xs btn-default" ng-click="$ctrl.onRemove()">\n      <span class="fa fa-times"></span>\n    </button>\n\n    <ul class="dropdown-menu query-dropdown-menu" aria-labelledby="">\n        <li class="criteria-list-item">\n          <span>{{$ctrl.variable.name}}</span>\n          <span class="pull-right" title="{{\'search.close-and-search\' | translate}}" ng-click="$ctrl.closeDropdown()"><i class="fa fa-check"></i></span>\n        </li>\n        <li class=\'divider\'></li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.all-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="all">\n              {{\'analysis.all\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.allFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.exists-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="exists">\n              {{\'analysis.exists\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.existsFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item">\n          <label title="{{\'analysis.empty-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="empty">\n              {{\'analysis.empty\' | translate}}\n          </label>\n          <div class="pull-right">\n            <span class="agg-term-count">{{$ctrl.localizeNumber($ctrl.emptyFrequency)}}</span>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showInOperations()">\n          <label title="{{\'analysis.in-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="in">\n              {{\'analysis.in\' | translate}}\n          </label>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showInOperations()">\n          <label title="{{\'analysis.out-help\' | translate}}">\n            <input ng-click="$ctrl.onUpdateOperation()" type="radio" ng-model="$ctrl.selectedOperation" value="out">\n              {{\'analysis.out\' | translate}}\n          </label>\n        <li>\n\n        <li class="divider" ng-if="$ctrl.showCategoricalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showCategoricalOptions() && $ctrl.categoriesData && $ctrl.categoriesData.length>10">\n          <span class="input-group input-group-sm no-padding-top">\n            <input ng-model="$ctrl.searchText" type="text" class="form-control" aria-describedby="category-search" ng-keyup="$ctrl.onSearchTextKeyup($event)">\n            <span class="input-group-addon" id="category-search"><i class="fa fa-search"></i></span>\n          </span>\n        </li>\n        <li ng-if="$ctrl.showCategoricalOptions()">\n          <ul class="no-padding criteria-list-terms">\n            <li class="criteria-list-item" ng-if="category.visible" ng-repeat="category in $ctrl.categoriesData">\n              <label class="control-label">\n                <input \n                  ng-model="$ctrl.selectedCategories[category.name]"\n                  type="checkbox"\n                  ng-click="$ctrl.updateSelection()"/>\n                  <span title="{{category.name}}">{{category.label}}</span>\n              </label>\n              <div class="pull-right">\n                <span class="agg-term-count">{{$ctrl.localizeNumber(category.frequency)}}</span>\n              </div>\n            </li>\n          </ul>\n        </li>\n\n        <li class="divider" ng-if="$ctrl.showNumericalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions()">\n          <select class="form-control input-sm form-select" ng-model="$ctrl.selectedNumericalOperation">\n            <option value="range">{{\'analysis.range\' | translate}}</option>\n            <option value="in">{{\'analysis.values\' | translate}}</option>\n          </select>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions() && $ctrl.selectedNumericalOperation === \'range\'">\n          <div class="row">\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="range-min" translate>analysis.min</label>\n                <input ng-model="$ctrl.selectedMin" type="text" class="form-control" id="range-min" ng-keyup="$ctrl.onNumericalMinKeyup($event)" placeholder="{{$ctrl.rangeMin}}">\n              </div>\n            </div>\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="range-max" translate>analysis.max</label>\n                <input ng-model="$ctrl.selectedMax" type="text" class="form-control" id="range-max" ng-keyup="$ctrl.onNumericalMaxKeyup($event)" placeholder="{{$ctrl.rangeMax}}">\n              </div>    \n            </div>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showNumericalOptions() && $ctrl.selectedNumericalOperation === \'in\'">\n          <div class="form-group">\n            <label for="in-values" translate>analysis.values-title</label>\n            <input ng-model="$ctrl.selectedNumericalValues" type="text" class="form-control" id="in-values" ng-keyup="$ctrl.onNumericalValuesKeyup($event)">\n          </div>\n        </li>\n\n        <li class="divider" ng-if="$ctrl.showTemporalOptions()"></li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions()">\n          <select class="form-control input-sm form-select" ng-model="$ctrl.selectedTemporalOperation">\n            <option value="range">{{\'analysis.range\' | translate}}</option>\n            <option value="in">{{\'analysis.value\' | translate}}</option>\n          </select>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions() && $ctrl.selectedTemporalOperation === \'range\'">\n          <div class="row">\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="from-date" class="control-label" translate>analysis.to</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="from-date" type="text" class="form-control" aria-describedby="from-date-picker" uib-datepicker-popup="yyyy-MM-dd" \n                    ng-model="$ctrl.selectedFrom" is-open="$ctrl.fromDatePickerOpened"/>\n                  <span class="input-group-addon" id="from-date-picker" ng-click="$ctrl.fromDatePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n            <div class="col-xs-6">\n              <div class="form-group">\n                <label for="to-date" class="control-label" translate>analysis.to</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="to-date" type="text" class="form-control" aria-describedby="to-date-picker" uib-datepicker-popup="yyyy-MM-dd" \n                    ng-model="$ctrl.selectedTo" is-open="$ctrl.toDatePickerOpened"/>\n                  <span class="input-group-addon" id="to-date-picker" ng-click="$ctrl.toDatePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </li>\n        <li class="criteria-list-item" ng-if="$ctrl.showTemporalOptions() && $ctrl.selectedTemporalOperation === \'in\'">\n          <div class="row">\n            <div class="col-xs-12">\n              <div class="form-group">\n                <label for="in-date" class="control-label" translate>analysis.date-title</label>  \n                <span class="input-group input-group-sm no-padding-top">\n                  <input id="in-date" type="text" class="form-control" aria-describedby="date-picker" uib-datepicker-popup="yyyy-MM-dd" \n                    ng-model="$ctrl.selectedTemporalValue" is-open="$ctrl.datePickerOpened"/>\n                  <span class="input-group-addon" id="date-picker" ng-click="$ctrl.datePickerOpened = true"><i class="fa fa-calendar"></i></span>\n                </span>\n              </div>\n            </div>\n          </div>\n        </li>\n    </ul>\n\n  </div>\n\n</div>\n')}]),angular.module("analysis/crosstab/views/crosstab-variable-crosstab.html",[]).run(["$templateCache",function(a){a.put("analysis/crosstab/views/crosstab-variable-crosstab.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-cloak>\n  <h4>{{dataset.translatedAcronym}} {{\'dataset.crosstab.title\' | translate}}</h4>\n\n  <obiba-alert id="DatasetVariableCrosstabController"></obiba-alert>\n\n  \x3c!-- crosstab variable selection --\x3e\n  <div class="well well-sm">\n    <div class="row">\n      <div class="cross-tab col-xs-4">\n        <ui-select ng-model="crosstab.lhs.variable" theme="bootstrap">\n          <ui-select-match placeholder="{{\'dataset.crosstab.categorical\' | translate}}">{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices refresh="searchCategoricalVariables($select.search)" refresh-delay="0"\n                             repeat="variable in crosstab.lhs.variables">\n\n            <div>{{variable.name}}</div>\n            <small>{{variable | variableLabel}}</small>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="col-xs-1 text-center no-padding no-margin sm-width">\n        <i class="fa fa-times fa-2x"></i>\n      </div>\n\n      <div class="cross-tab col-xs-4">\n        <ui-select ng-model="crosstab.rhs.variable" theme="bootstrap">\n          <ui-select-match placeholder="{{\'dataset.crosstab.another\' | translate}}">{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices refresh="searchVariables($select.search)" refresh-delay="0"\n                             repeat="variable in crosstab.rhs.variables">\n\n            <div>{{variable.name}}</div>\n            <small>{{variable | variableLabel}}</small>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="col-xs-3">\n        <span>\n          <button type="button" class="btn btn-primary" aria-hidden="true" ng-click="submit()">{{\'submit\' | translate}}\n          </button>\n          <button ng-if="canExchangeVariables()" type="button" class="btn btn-primary"\n                  aria-hidden="true" ng-click="exchangeVariables()"> v1 <i class="fa fa-exchange fa-1x"></i> v2\n          </button>\n          <button type="button" class="btn btn-default" aria-hidden="true" ng-click="clear()">{{\'clear\' | translate}}\n          </button>\n        </span>\n      </div>\n    </div>\n    <span class="help-block">{{\'dataset.crosstab.query-help\' | translate}}</span>\n  </div>\n\n  \x3c!-- crosstab results --\x3e\n  <div ng-if="crosstab.contingencies && crosstab.contingencies.length > 0">\n\n    <div>\n      \x3c!-- table detail and stats options --\x3e\n      <div class="btn-group">\n        <label class="btn" ng-class="{\'btn-info\': options.showDetails, \'btn-default\': !options.showDetails}"\n               ng-model="options.showDetails" uib-btn-checkbox>{{\'global.detailed\' | translate}}</label>\n        <div class="btn-group" ng-if="!isStatistical(crosstab.rhs.xVariable)">\n          <label class="btn" ng-class="{\'btn-info\': options.statistics === StatType.CPERCENT, \'btn-default\': options.statistics !== StatType.CPERCENT}"\n                 ng-model="options.statistics" uib-btn-radio="StatType.CPERCENT">{{\'global.percentage\' | translate}} <i class="fa fa-long-arrow-down"></i></label>\n          <label class="btn" ng-class="{\'btn-info\': options.statistics === StatType.RPERCENT, \'btn-default\': options.statistics !== StatType.RPERCENT}"\n                 ng-model="options.statistics" uib-btn-radio="StatType.RPERCENT">{{\'global.percentage\' | translate}} <i class="fa fa-long-arrow-right"></i></label>\n        </div>\n      </div>\n\n      \x3c!-- download menu --\x3e\n      <div class="pull-right sm-bottom-margin">\n        <div class="btn-group" role="group">\n          <button type="button" class="btn btn-info btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"\n                  aria-expanded="false">\n            <i class="glyphicon glyphicon-download-alt"></i> <span>{{\'download\' | translate}}</span>\n            <span class="caret"></span>\n          </button>\n          <ul class="dropdown-menu dropdown-menu-compact">\n            <li><a obiba-file-download url="downloadUrl(DocType.EXCEL)" target="_self" download ><i class="fa fa-file-excel-o"></i> {{\'excel\' | translate}}</a></li>\n            <li><a obiba-file-download url="downloadUrl(DocType.CSV)" target="_self" download ><i class="fa fa-file-text-o"></i> {{\'csv\' | translate}}</a></li>\n          </ul>\n        </div>\n      </div>\n    </div>\n    \x3c!-- progress image --\x3e\n    <div>\n      <div ng-if="loading" class="loading "></div>\n    </div>\n\n    <table ng-if="!loading" class="table table-striped table-bordered no-margin no-padding">\n      <thead>\n      <tr>\n        <th style="vertical-align: top" class="" ng-if="datasetHarmo" width="20%"\n            rowspan="{{crosstab.lhs.xVariable.categories.length}}">{{options.showDetailedStats ? (\'dataset.study-table.title\' | translate) : \'\'}}\n        </th>\n        <th style="vertical-align: top" rowspan="{{crosstab.lhs.xVariable.categories.length}}" width="10%">\n          <a href="{{PageUrlService.variablePage(crosstab.rhs.xVariable.id)}}">{{crosstab.rhs.xVariable.name}}</a>\n        </th>\n        <th class="text-center" colspan="{{crosstab.lhs.xVariable.categories.length}}">\n          <a href="{{PageUrlService.variablePage(crosstab.lhs.xVariable.id)}}">{{crosstab.lhs.xVariable.name}}</a>\n        </th>\n        <th style="vertical-align: top" class="text-center" rowspan="{{crosstab.lhs.xVariable.categories.length}}">\n          {{\'total\' | translate}}\n        </th>\n      </tr>\n      <tr>\n        <th class="text-center" ng-repeat="category in crosstab.lhs.xVariable.categories">\n          <span  class="clickable" popover-title="" popover-popup-delay="250" popover-placement="bottom" popover-trigger="\'mouseenter\'"\n                uib-popover="{{crosstab.lhs.xVariable.categories | variableCategory:category.name | variableLabel}}">{{category.name}}</span>\n        </th>\n      </tr>\n      </thead>\n\n      \x3c!-- Categorical --\x3e\n      <tbody ng-repeat="contingency in crosstab.contingencies track by $index"\n             ng-if="!isStatistical(crosstab.rhs.xVariable) && (!datasetHarmo || (datasetHarmo && options.showDetailedStats))"\n             ng-include="getTemplatePath(contingency)">\n      </tbody>\n      <tbody ng-if="!isStatistical(crosstab.rhs.xVariable) && datasetHarmo && options.showDetailedStats">\n      <tr>\n        <td colspan="{{crosstab.lhs.xVariable.categories.length + 3}}"></td>\n      </tr>\n      </tbody>\n      <tbody ng-repeat="contingency in [crosstab.all]" ng-init="grandTotal = true"\n             ng-if="datasetHarmo && !isStatistical(crosstab.rhs.xVariable)"\n             ng-include="getTemplatePath(contingency)">\n      </tbody>\n\n      \x3c!-- Statistical --\x3e\n      <tbody ng-repeat="contingency in crosstab.contingencies"\n             ng-if="isStatistical(crosstab.rhs.xVariable) && (!datasetHarmo || (datasetHarmo && options.showDetailedStats))"\n             ng-include="getTemplatePath(contingency)">\n      </tbody>\n      <tbody ng-if="isStatistical(crosstab.rhs.xVariable) && datasetHarmo && options.showDetailedStats">\n      <tr>\n        <td colspan="{{crosstab.lhs.xVariable.categories.length + 3}}"></td>\n      </tr>\n      </tbody>\n      <tbody ng-repeat="contingency in [crosstab.all]" ng-init="grandTotal = true"\n             ng-if="datasetHarmo && isStatistical(crosstab.rhs.xVariable)"\n             ng-include="getTemplatePath(contingency)">\n      </tbody>\n\n    </table>\n  </div>\n  <span ng-bind-html="renderHtml(body)"></span>\n</div>\n')}]),angular.module("analysis/crosstab/views/crosstab-variable-frequencies-empty.html",[]).run(["$templateCache",function(a){a.put("analysis/crosstab/views/crosstab-variable-frequencies-empty.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr>\n  <td ng-if="datasetHarmo" rowspan="{{crosstab.rhs.xVariable.categories.length + 1}}">\n    <crosstab-study-table contingency="contingency"></crosstab-study-table>\n  </td>\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 2}}"><em>{{\'search.no-results\' | translate}}</em></td>\n</tr>\n')}]),angular.module("analysis/crosstab/views/crosstab-variable-frequencies.html",[]).run(["$templateCache",function(a){a.put("analysis/crosstab/views/crosstab-variable-frequencies.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr ng-if="options.showDetails" ng-repeat="frequency in contingency.aggregations[0].frequencies track by $index">\n  <td ng-if="datasetHarmo && $index === 0" rowspan="{{crosstab.rhs.xVariable.categories.length + 2}}">\n      <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n\n  <td>\n    <span class="clickable" popover-title="" popover-popup-delay="250" popover-placement="bottom" popover-trigger="\'mouseenter\'"\n          uib-popover="{{crosstab.rhs.xVariable.categories | variableCategory:frequency.value | variableLabel}}">\n      {{frequency.value}}\n    </span>\n  </td>\n\n  <td ng-repeat="aggregation in contingency.aggregations">\n    {{aggregation.frequencies[$parent.$index].count}}&nbsp;\n\n    <span ng-show="aggregation.privacyCheck" class="help-inline">\n      <span ng-show="options.statistics === StatType.RPERCENT">\n        ({{aggregation.frequencies[$parent.$index].percent | number:2}}%)\n      </span>\n      <span ng-show="options.statistics === StatType.CPERCENT">\n        ({{aggregation.frequencies[$parent.$index].cpercent | number:2}}%)\n      </span>\n    </span>\n  </td>\n  <td>\n    {{contingency.all.frequencies[$index].count}}&nbsp;\n    <span ng-if="contingency.all.privacyCheck" class="help-inline">\n      <span ng-if="options.statistics === StatType.RPERCENT">\n        (100%)\n      </span>\n      <span ng-if="options.statistics === StatType.CPERCENT">\n        ({{contingency.all.frequencies[$index].percent | number:2}}%)\n      </span>\n    </span>\n  </td>\n</tr>\n<tr>\n  <td ng-if="options.showDetailedStats &&  datasetHarmo && !options.showDetails" rowspan="{{crosstab.rhs.xVariable.categories.length}}">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td><em>N</em></td>\n  <td ng-repeat="aggregation in contingency.aggregations">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{aggregation.n}}&nbsp;\n      <span class="help-inline">\n        <span ng-if="options.statistics === StatType.RPERCENT">\n          ({{aggregation.percent | number:2}}%)\n        </span>\n        <span ng-if="options.statistics === StatType.CPERCENT">\n          (100%)\n        </span>\n      </span>\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n  <td>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{contingency.all.n}}&nbsp;\n      <span ng-if="contingency.privacyCheck" class="help-inline">\n        <span ng-if="options.statistics === StatType.CPERCENT">\n          (100%)\n        </span>\n        <span ng-if="options.statistics === StatType.RPERCENT">\n          (100%)\n        </span>\n      <span>\n    </span>\n  </td>\n</tr>\n\n<tr ng-if="options.showDetails && !grandTotal && contingency.privacyCheck">\n  <td>\n    <em>{{\'dataset.crosstab.chi-squared.test\' | translate}}</em>\n  </td>\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 1}}">\n    <span>\n      2 = {{contingency.chiSquaredInfo.sum | number:4 }},&nbsp;&nbsp;\n      df = {{contingency.chiSquaredInfo.df}},&nbsp;&nbsp;\n      p-value = {{contingency.chiSquaredInfo.pValue | number:4 }}\n    </span>\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{\'dataset.crosstab.privacy-check-failed\' | translate:{arg0:contingency.privacyThreshold} }}\n    </span>\n  </td>\n</tr>\n<tr ng-if="!grandTotal && !contingency.privacyCheck">\n  <td colspan="{{crosstab.lhs.xVariable.categories.length + 2}}">\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{getPrivacyErrorMessage(contingency) | translate:{arg0:contingency.privacyThreshold} }}\n    </span>\n  </td>\n</tr>\n')}]),angular.module("analysis/crosstab/views/crosstab-variable-statistics-empty.html",[]).run(["$templateCache",function(a){a.put("analysis/crosstab/views/crosstab-variable-statistics-empty.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr>\n  <td ng-if="datasetHarmo">\n    <crosstab-study-table contingency="contingency"></crosstab-study-table>\n  </td>\n  <td colspan="4" class="danger"><em>{{\'no-results\' | translate}}</em></td>\n</tr>\n')}]),angular.module("analysis/crosstab/views/crosstab-variable-statistics.html",[]).run(["$templateCache",function(a){a.put("analysis/crosstab/views/crosstab-variable-statistics.html",'\x3c!--\n  ~ Copyright (c) 2015 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<tr ng-if="options.showDetails">\n  <td ng-if="datasetHarmo" rowspan="{{!grandTotal && !contingency.privacyCheck ? \'6\' : \'5\'}}">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td translate>min</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.min | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.min | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>max</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.max | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.max | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>mean</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.mean | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.mean | roundNumber}}</td>\n</tr>\n<tr ng-if="options.showDetails">\n  <td translate>std-deviation</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">{{aggregation.statistics.stdDeviation | roundNumber}}</td>\n  <td class="text-center">{{contingency.all.statistics.stdDeviation | roundNumber}}</td>\n</tr>\n<tr>\n  <td ng-if="datasetHarmo && !options.showDetails">\n    <crosstab-study-table ng-hide="grandTotal" contingency="contingency"></crosstab-study-table>\n    <span ng-if="grandTotal"><strong>{{\'total\' | translate}}</strong></span>\n  </td>\n  <td>N</td>\n  <td class="text-center" ng-repeat="aggregation in contingency.aggregations">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{aggregation.n}}\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n  <td class="text-center">\n    <span ng-if="contingency.totalPrivacyCheck">\n      {{contingency.all.n}}\n    </span>\n    <span ng-if="!contingency.totalPrivacyCheck">\n      -\n    </span>\n  </td>\n</tr>\n<tr>\n  <td ng-if="!grandTotal && !contingency.privacyCheck" colspan="{{crosstab.lhs.xVariable.categories.length + 3}}">\n    <span class="text-danger" ng-if="!contingency.privacyCheck">\n      {{getPrivacyErrorMessage(contingency) | translate:{arg0:contingency.privacyThreshold} }}\n    <span>\n  </td>\n</tr>\n')}]),angular.module("analysis/views/analysis-entities-count.html",[]).run(["$templateCache",function(a){a.put("analysis/views/analysis-entities-count.html",'<div>\n  <div ng-if="entitiesHeaderTemplateUrl" ng-include="entitiesHeaderTemplateUrl"></div>\n  <div>\n      <span class="btn btn-primary" ng-show="result.counts">\n        <span ng-show="result.counts.length>0" translate>{{result.counts[0].entityType}}</span>\n        <span class="badge">{{localizedTotal}}</span>\n      </span>\n      <span ng-if="loading" class="voffset2 loading"></span>\n  </div>\n  <entities-count-result-table ng-hide="loading && !result.total" result="result"></entities-count-result-table>\n  <p ng-hide="query" translate>analysis.entities-count.no-query</p>\n</div>')}]),angular.module("attachment/attachment-input-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-input-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<button ng-hide="{{disabled}}" type="button" class="btn btn-primary btn-xs" aria-hidden="true" ngf-multiple="{{multiple}}" ngf-select\n        ngf-change="onFileSelect($files)" translate>file.upload.button\n</button>\n\n<table ng-show="files.length" class="table table-bordered table-striped">\n  <thead>\n  <tr>\n    <th translate>data-access-request.default.documents.title</th>\n    <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n    <th translate>size</th>\n    <th ng-show="deleteAttachments" translate>actions</th>\n  </tr>\n  </thead>\n  <tbody>\n  <tr ng-repeat="file in files">\n    <td>\n      {{file.fileName}}\n      <uib-progressbar ng-show="file.showProgressBar" class="progress-striped" value="file.progress">\n        {{file.progress}}%\n      </uib-progressbar>\n    </td>\n    <td>\n      <span class="pull-right" ng-if="file.timestamps" title="{{ file.timestamps.created | amDateFormat: \'lll\' }}">{{file.timestamps.created | amCalendar }}</span>\n    </td>\n    <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{file.size | bytes}}\n        </span>\n    </td>\n    <td style="width:20px;" ng-show="deleteAttachments">\n      <a ng-show="file.id" ng-click="deleteFile(file.id)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n      <a ng-show="file.tempId" ng-click="deleteTempFile(file.tempId)" class="action">\n        <i class="fa fa-trash-o"></i>\n      </a>\n    </td>\n  </tr>\n  </tbody>\n</table>\n')}]),angular.module("attachment/attachment-list-template.html",[]).run(["$templateCache",function(a){a.put("attachment/attachment-list-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div>\n  <span ng-if="!hasAttachments && emptyMessage"><em>{{emptyMessage}}</em></span>\n  <table ng-if="hasAttachments" class="table table-bordered table-striped" >\n    <thead>\n    <tr>\n      <th translate>data-access-request.default.documents.title</th>\n      <th class="col-xs-2"><span class="pull-right" translate>file.upload.date</span></th>\n      <th translate>size</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr ng-repeat="attachment in attachments">\n      <th>\n        <a target="_self" ng-href="{{attachment.href}}"\n           download="{{attachment.fileName}}">{{attachment.fileName}}\n        </a>\n      </th>\n      <td><span class="pull-right" ng-if="attachment.timestamps" title="{{ attachment.timestamps.created | amDateFormat: \'lll\' }}">{{attachment.timestamps.created | amCalendar }}</span></td>\n      <td style="width:1%;">\n        <span class="pull-right" style="white-space: nowrap;">\n          {{attachment.size | bytes}}\n        </span>\n      </td>\n    </tr>\n    </tbody>\n  </table>\n\n</div>\n')}]),angular.module("file-browser/views/document-detail-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/document-detail-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-default">\n  <div class="panel-heading">\n    <span>\n      <span title="{{data.details.document.name}}">\n        <i class="fa {{getDocumentIcon(data.details.document)}}"></i> {{truncate(data.details.document.name, 30)}}\n      </span>\n      <a href class="pull-right" ng-click="hideDetails()"><i class="fa fa-times"></i></a>\n    </span>\n  </div>\n  <div class="panel-body">\n    <div>\n      <label class="text-muted no-margin">\n        <small>{{\'size\' | translate}}</small>\n      </label>\n      <div>\n        <span ng-if="!isFile(data.details.document)">{{data.details.document.size}} {{data.details.document.size === 1 ? \'item\' : \'items\' | translate}}</span>\n        <span ng-if="isFile(data.details.document)">{{data.details.document.size | bytes}}</span>\n        <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(data.details.document.path, data.document.keyToken)}}" class="hoffset2" title="{{\'download\' | translate}}" download>\n          <span><i class="fa fa-download"></i><span class="hoffset2"></span></span>\n        </a>\n      </div>\n    </div>\n\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'created-on\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.created | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n    <div class="voffset2">\n      <label class="text-muted no-margin">\n        <small>{{\'last-modified\' | translate}}</small>\n      </label>\n      <div>\n        <span>{{data.details.document.timestamps.lastUpdate | amDateFormat : \'lll\'}}</span>\n      </div>\n    </div>\n\n    <div ng-if="isFile(data.details.document)" class="voffset2">\n      <div ng-if="data.details.document.attachment.type">\n        <label class="text-muted no-margin">\n          <small>{{\'type\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{data.details.document.attachment.type}}</span>\n        </div>\n      </div>\n\n      <div ng-show="hasLocalizedValue(data.details.document.attachment.description)"\n           class="voffset2">\n        <label class="text-muted no-margin">\n          <small>{{\'description\' | translate}}</small>\n        </label>\n        <div>\n          <span>{{getLocalizedValue(data.details.document.attachment.description)}}</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("file-browser/views/documents-table-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/documents-table-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-default table-responsive table-responsive-dropdown">\n  <div class="panel-heading" ng-if="data.search.active">\n      <a class="no-text-decoration" ng-click="clearSearch()">\n        <i class="fa fa-chevron-left"> </i>\n      </a>\n      <span ng-if="data.search.recursively">{{\'file.search-results.current-sub\' | translate}}</span>\n      <span ng-if="!data.search.recursively">{{\'file.search-results.current\' | translate}}</span>\n      ({{data.document.children.length}})\n  </div>\n  <div ng-if="data.document.children.length > 0" test-ref="file-search-result-list">\n    <table class="table table-bordered table-striped no-padding no-margin">\n      <thead>\n      <tr>\n        <th colspan="2" translate>name</th>\n        <th style="width: 100px" translate>type</th>\n        <th style="width: 100px" translate>size</th>\n        <th style="width: 150px" translate>global.modified</th>\n        <th ng-if="data.search.active" translate>folder</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr ng-show="!data.isRoot && data.document.path !== data.rootPath && !data.search.active">\n        <td colspan="5">\n          <i class="fa fa-folder"></i>\n          <span><a href style="text-decoration: none" class="no-text-decoration" ng-click="navigateBack()"> ..</a></span>\n        </td>\n      </tr>\n      <tr ng-class="{\'selected-row\': $index === pagination.selected}"\n          dir-paginate="document in data.document.children | itemsPerPage: pagination.itemsPerPage"\n          ng-init="fileDocument = isFile(document)"\n          current-page="pagination.currentPage">\n\n        <td ng-click="showDetails(document, $index);">\n          <span>\n            <span ng-if="fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a ng-if="fileDocument" target="{{downloadTarget}}" test-ref="file-name"\n                 style="text-decoration: none" ng-click="$event.stopPropagation();" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}"\n                  title="{{document.name}}">\n                {{document.name}}\n              </a>\n            </span>\n            <span ng-if="!fileDocument">\n              <i class="fa {{getDocumentIcon(document)}}"></i>\n              <a href style="text-decoration: none" ng-click="navigateTo($event, document, data.document.keyToken)">\n                {{document.name}}\n              </a>\n            </span>\n          </span>\n        </td>\n\n        <td class="fit-content">\n          <span class="btn-group pull-right" uib-dropdown is-open="status.isopen">\n            <a title="{{\'file.show-details\' | translate}}" id="single-button" class="dropdown-anchor" uib-dropdown-toggle\n               ng-disabled="disabled">\n              <i class="glyphicon glyphicon-option-horizontal btn-large"></i>\n            </a>\n            <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n              <li role="menuitem">\n                <a href ng-click="showDetails(document, $index)">\n                  <span><i class="fa fa-info"></i><span class="hoffset2">{{\'details\' | translate}}</span></span>\n                </a>\n              </li>\n              <li role="menuitem">\n                <a target="{{downloadTarget}}" ng-href="{{getDownloadUrl(document.path, data.document.keyToken)}}" download>\n                  <span><i class="fa fa-download"></i><span class="hoffset2">{{\'download\' | translate}}</span></span>\n                </a>\n              </li>\n            </ul>\n          </span>\n        </td>\n\n        <td>\n          <span ng-repeat="t in getTypeParts(document) track by $index"\n            class="label label-info" test-ref="file-type"\n            ng-class="{\'hoffset1\' : !$first}">{{t}}</span>\n        </td>\n        <td class="no-wrap" ng-if="fileDocument" test-ref="file-size">\n          {{document.size | bytes}}\n        </td>\n        <td class="no-wrap" ng-if="!fileDocument">\n          {{document.size}} {{document.size === 1 ? \'item\' : \'items\' | translate}}\n        </td>\n        <td>\n          <span title="{{document.timestamps.lastUpdate | amDateFormat: \'lll\'}}" test-ref="file-lastModification">\n            {{document.timestamps.lastUpdate | amTimeAgo}}\n          </span>\n        </td>\n        <td ng-if="data.search.active">\n          <a href class="no-text-decoration" ng-click="navigateToParent($event, document, data.document.keyToken)" test-ref="file-parent">\n'+"            {{document.attachment.path === data.rootPath ? '/' : document.attachment.path.replace(data.rootPath, '')}}\n          </a>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </div>\n</div>")}]),angular.module("file-browser/views/file-browser-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/file-browser-template.html",'<div ng-cloak>\n  <div ng-if="!noDocument">\n    <h4 ng-show="showTitle">{{documentsTitle | translate}}</h4>\n  <div ng-if="!data.document" class="loading"></div>\n\n  <div ng-if="data.document">\n    <obiba-alert id="FileSystemController"></obiba-alert>\n\n    <div>\n      \x3c!-- Document details --\x3e\n      <div class="row">\n        <div class="col-md-12">\n          <div ng-include="\'file-browser/views/toolbar-template.html\'"></div>\n        </div>\n      </div>\n\n      <div class="row voffset2">\n        <div ng-class="{\'col-md-8\': data.details.show, \'col-md-12\': !data.details.show}">\n          <div ng-include="\'file-browser/views/documents-table-template.html\'"></div>\n          <div ng-if="!data.isFile && data.document.children.length < 1 && !data.search.active" class="text-muted">\n            <em>{{\'empty-folder\' | translate}}</em>\n          </div>\n          <div class="pull-right no-margin">\n            <dir-pagination-controls></dir-pagination-controls>\n          </div>\n        </div>\n        <div ng-if="data.details.show" class="col-md-4">\n          <div ng-include="\'file-browser/views/document-detail-template.html\'"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  </div>\n\n</div>')}]),angular.module("file-browser/views/toolbar-template.html",[]).run(["$templateCache",function(a){a.put("file-browser/views/toolbar-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<div>\n    <div class="pull-left voffset3">\n        <ol ng-show="data.document.path !== data.rootPath" class="breadcrumb mica-breadcrumb no-margin no-padding">\n            <li>\n                <a href ng-click="navigateToPath(data.rootPath, data.document.keyToken)">\n                    <span><i class="fa {{getDocumentIcon(data.document)}}"></i></span>\n                </a>\n            </li>\n\n            <li ng-repeat="part in data.breadcrumbs" ng-class="{\'active\': $first === $last && $last}">\n                <a ng-show="!$last && part.name !== \'/\'" href ng-click="navigateToPath(part.path, data.document.keyToken)">\n                    <span ng-show="part.name !== \'/\'">{{part.name}}</span>\n                </a>\n                <span class="no-padding" ng-if="part.name !== \'/\' && $last">{{data.document.name || \'empty\'}}</span>\n            </li>\n        </ol>\n    </div>\n    <div ng-if="!data.document.keyToken" class="pull-right">\n\n      <table style="border:none">\n        <tbody>\n        <tr>\n          <td>\n            <a href>\n              <span class="input-group input-group-sm no-padding-top no-padding-right">\n               <span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span>\n               <input ng-keyup="searchKeyUp($event)"\n                      ng-model="data.search.text"\n                      type="text"\n                      class="form-control ng-pristine ng-untouched ng-valid"\n                      aria-describedby="study-search"\n                      style="max-width: 200px;"\n                      test-ref="file-search-input">\n               <span ng-show="data.search.text" title="{{\'search-tooltip.clear\' | translate}}" ng-click="clearSearch()"\n                  class="input-group-addon">\n                <i class="fa fa-times"></i>\n               </span>\n              </span>\n            </a>\n          </td>\n          <td>\n            <a href ng-model="data.search.recursively"\n              class="btn btn-sm hoffset1"\n              ng-class="{\'btn-info\': data.search.recursively, \'btn-default\': !data.search.recursively}"\n              data-toggle="button" ng-click="toggleRecursively()"\n              title="{{\'search-tooltip.recursively\' | translate}}">\n              <i class="fa i-obiba-hierarchy"></i>\n            </a>\n            <a href ng-click="searchDocuments(\'RECENT\')"\n              class="btn btn-info btn-sm"\n              title="{{\'search-tooltip.most-recent\' | translate}}">\n              <span><i class="fa fa-clock-o fa-lg"></i></span>\n            </a>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n</div>')}]),angular.module("graphics/views/charts-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/charts-directive.html",'<div>\n  <div ng-if="chartObject.type === \'GeoChart\'">\n    <obiba-geo config="chartObject.d3Config"></obiba-geo>\n  </div>\n  <div ng-if="chartObject.type !== \'GeoChart\'">\n    <obiba-nv-chart chart-config="chartObject.d3Config"></obiba-nv-chart>\n  </div>\n</div>\n')}]),angular.module("graphics/views/tables-directive.html",[]).run(["$templateCache",function(a){a.put("graphics/views/tables-directive.html",'<div>\n    <table ng-if="chartObject.entries && chartObject.entries.length" style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chartObject.getTable().data">\n        <thead>\n        <tr>\n        <th ng-repeat="header in chartObject.header track by $index">{{header}}</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr ng-repeat="row in chartObject.entries track by $index">\n            <td>{{row.title}}</td>\n            <td><a href ng-click="updateCriteria(row.key, chartObject.vocabulary)">{{row.value}}</a></td>\n            <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n        </tr>\n        </tbody>\n    </table>\n</div>\n')}]),angular.module("lists/components/badge-count/component.html",[]).run(["$templateCache",function(a){a.put("lists/components/badge-count/component.html",'<span ng-if="$ctrl.badgeOptions.showBadge">\n  <a class="btn btn-default btn-xxs disabled" test-ref="dataSchemaVariableCount"\n        ng-if="$ctrl.badgeOptions.showBadge && !$ctrl.badgeOptions.showTab" disabled>\n    <localized-number value="$ctrl.entityCount"></localized-number>\n  {{ $ctrl.labelBadge | translate }}\n  </a>\n  <a class="btn btn-default btn-xxs"\n     test-ref="dataSchemaVariableCount" href="{{$ctrl.entityType | doSearchQuery:$ctrl.query }}" ng-if="$ctrl.badgeOptions.showTab">\n    <localized-number value="$ctrl.entityCount"></localized-number>\n    {{ $ctrl.labelBadge | translate }}\n  </a>\n</span>')}]),angular.module("lists/views/input-search-widget/input-search-widget-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/input-search-widget/input-search-widget-template.html",'<form class="list-search-widget">\n    <div class="form-group pull-left">\n        <entity-search-typeahead\n                placeholder-text="global.list-search-placeholder"\n                target="target"\n                rql-query="rqlQuery"\n                entity-type="type">\n        </entity-search-typeahead>\n    </div>\n    <div class="pull-left voffset2 hoffset2">\n        <small><a href ng-href="{{navigateToSearchPage()}}">\n            {{\'search.advanced-button\' | translate}}\n        </a></small>\n    </div>\n</form>\n')}]),angular.module("lists/views/list/datasets-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/list/datasets-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading "></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.dataset.noResults</p>\n        <div ng-repeat="summary in summaries" class="row sm-bottom-margin document-item-list flex-row" test-ref="dataset">\n            <div class="col-md-12  col-sm-12 col-xs-12">\n                <h4>\n                    <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                        <localized value="summary.name" lang="lang"></localized>\n                    </a>\n                </h4>\n                <p>\n                    <localized value="summary.description"\n                               ellipsis-size="250"\n                               markdown-it="true"\n                               lang="lang"></localized>\n                </p>\n                <a ng-if="summary.description" href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}" >{{"global.read-more" | translate}}</a>\n                <div class="clear-fix"></div>\n                <div class="sm-top-margin countDetail voffset3">\n                    {{counts=summary[\'obiba.mica.CountStatsDto.datasetCountStats\'];""}}\n                    <a ng-if="counts.networks && options.obibaListOptions.showNetworkBadge!==false"\n                       href="{{\'networks\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}"\n                       class="btn btn-default btn-xxs"\n                       test-ref="studyCount">\n                        <localized-number\n                                value="counts.networks"></localized-number>\n                        {{counts.networks > 1 ? "networks" : "network.label"\n                        | translate}}\n                    </a>\n                    <a ng-if="counts.studies && options.obibaListOptions.showStudyBadge!==false"\n                       href="{{\'studies\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}"\n                       class="btn btn-default btn-xxs"\n                       test-ref="studyCount">\n                        <localized-number\n                                value="counts.studies"></localized-number>\n                        {{counts.studies > 1 ? "studies" : "study.label"\n                        | translate}}\n                    </a>\n\n                    <a ng-if="counts.variables && options.obibaListOptions.showVariableBadge!==false"\n                       href="{{\'variables\' | doSearchQuery : \'dataset(in(Mica_dataset.id,\' + summary.id +  \'))\' }}"\n                       class="btn btn-default btn-xxs"\n                       test-ref="variableCount">\n                        <localized-number\n                                value="counts.variables"></localized-number>\n                        {{counts.variables > 1 ? "variables" : "search.variable.facet-label"\n                        | translate}}\n                    </a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("lists/views/list/networks-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/list/networks-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading "></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.network.noResults</p>\n        <div ng-if="summaries && summaries.length" ng-init="lang = $parent.$parent.lang">\n            <div ng-repeat="summary in summaries"\n                 ng-init="lang = $parent.$parent.lang;"\n                 class="row lg-bottom-margin document-item-list flex-row"\n                 test-ref="network">\n                <div class="col-md-2 hidden-xs hidden-sm text-center">\n                    <img ng-if="summary.logo" ng-src="{{summary.logoUrl}}"\n                         class="img-responsive"/>\n\n                    <h1 ng-if="!summary.logo" src="" alt=""\n                        class="big-character">\n                        <span class="t_badge color_light i-obiba-N"></span>\n                    </h1>\n                </div>\n                <div class="col-md-10  col-sm-12 col-xs-12">\n                    <h4>\n                        <a href="{{PageUrlService.networkPage(summary.id)}}">\n                            <localized value="summary.name"\n                                       lang="lang"></localized>\n                        </a>\n                    </h4>\n                    <p>\n                        <localized value="summary.description" lang="lang"\n                                   ellipsis-size="250"\n                                   markdown-it="true"></localized>\n                    </p>\n                    <a ng-if="summary.description" href="{{PageUrlService.networkPage(summary.id)}}" >{{"global.read-more" | translate}}</a>\n                    <div class="clear-fix"></div>\n                    <div class="sm-top-margin countDetail voffset3">\n                        {{counts=summary[\'obiba.mica.CountStatsDto.networkCountStats\'];""}}\n                        <a ng-if="counts.individualStudies && options.obibaListOptions.showStudyBadge!==false"\n                           href="{{\'studies\' | doSearchQuery:\'network(in(Mica_network.id,\' + summary.id +  \')),study(in(Mica_study.className,Study))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="individualStudyCount">\n                            <localized-number\n                                    value="counts.individualStudies"></localized-number>\n                            {{counts.individualStudies > 1 ?\n                            "global.individual-studies":"global.individual-study"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.studiesWithVariables && options.obibaListOptions.showStudyBadge!==false"\n                           href="{{\'studies\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Collected))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="studyWithVariablesCount">\n                            <localized-number\n                                    value="counts.studiesWithVariables"></localized-number>\n                            {{counts.studiesWithVariables > 1 ?\n                            "metrics.mica.studies-with-variables" :\n                            "metrics.mica.study-with-variables"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.studyVariables && options.obibaListOptions.showVariableBadge!==false"\n                           href="{{\'variables\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Collected))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="studyVariableCount">\n                            <localized-number\n                                    value="counts.studyVariables"></localized-number>\n                            {{counts.studyVariables > 1 ?\n                            "metrics.mica.study-variables" :\n                            "metrics.mica.study-variable"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.harmonizationStudies && options.obibaListOptions.showStudyBadge!==false"\n                           href="{{\'studies\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),study(in(Mica_study.className,HarmonizationStudy))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="harmonizationStudyCount">\n                            <localized-number\n                                    value="counts.harmonizationStudies"></localized-number>\n                            {{counts.harmonizationStudies > 1 ?\n                            "global.harmonization-studies" :\n                            "global.harmonization-study"\n                            | translate}}\n                        </a>\n\n                        <a ng-if="counts.dataschemaVariables && options.obibaListOptions.showVariableBadge!==false"\n                           href="{{\'variables\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \')),variable(in(Mica_variable.variableType,Dataschema))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="harmonizationStudyWithVariablesCount">\n                            <localized-number\n                                    value="counts.dataschemaVariables"></localized-number>\n                            {{counts.dataschemaVariables > 1 ?\n                            "metrics.mica.harmonization-study-variables" :\n                            "metrics.mica.harmonization-study-variable"\n                            | translate}}\n                        </a>\n                        {{datasetsCount = counts.studyDatasets +\n                        counts.harmonizationDatasets; ""}}\n                        <a ng-if="datasetsCount && options.obibaListOptions.showDatasetBadge!==false"\n                           href="{{\'datasets\' | doSearchQuery : \'network(in(Mica_network.id,\' + summary.id +  \'))\' }}"\n                           class="btn btn-default btn-xxs"\n                           test-ref="datasetCount">\n                            <localized-number\n                                    value="datasetsCount"></localized-number>\n                            {{datasetsCount > 1 ? "datasets" :\n                            "dataset.details"\n                            | translate}}\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("lists/views/list/studies-search-result-table-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/list/studies-search-result-table-template.html",'<div>\n    <div class="col-md-12"><div ng-if="loading" class="loading "></div></div>\n    <div ng-show="!loading" class="col-md-12">\n        <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.study.noResults</p>\n        <div ng-if="summaries && summaries.length" ng-init="lang = $parent.$parent.lang">\n            <div ng-repeat="summary in summaries"\n                 ng-init="lang = $parent.$parent.lang; studyPath= summary.studyResourcePath==\'individual-study\'?\'individual-study\':\'harmonization-study\'"\n                 class="row lg-bottom-margin document-item-list flex-row"\n                 test-ref="study">\n\n                <div class="col-md-2 hidden-xs hidden-sm text-center">\n\n                    <img ng-if="summary.logo" ng-src="{{summary.logoUrl}}"\n                         class="img-responsive"/>\n\n                    <h1 ng-if="!summary.logo" src="" alt=""\n                        class="big-character">\n                        <span class="t_badge color_light i-obiba-S"></span>\n                    </h1>\n                </div>\n\n                <div class="col-md-10  col-sm-12 col-xs-12">\n                    <h4>\n                        <a href="{{PageUrlService.studyPage( summary.id, studyPath)}}">\n                            <localized value="summary.name"\n                                       lang="lang"></localized>\n                        </a>\n                    </h4>\n                    <p ng-if="options.obibaListOptions.studiesTrimmedDescription">\n                        <localized value="summary.objectives" lang="lang"\n                                   ellipsis-size="250"\n                                   markdown-it="true"></localized>\n                    </p>\n                    <p ng-if="!options.obibaListOptions.studiesTrimmedDescription">\n                        <localized value="summary.objectives" lang="lang"\n                                   markdown-it="true"></localized>\n                    </p>\n                    <a ng-if="summary.objectives" href="{{PageUrlService.studyPage( summary.id, studyPath)}}" >{{"global.read-more" | translate}}</a>\n                    <div class="clear-fix"></div>\n                    <div ng-if="options.obibaListOptions.studiesSupplInfoDetails" class="voffset3">\n                        <blockquote-small\n                                ng-if="summary.design || summary.targetNumber.noLimit"\n                                class="help-block">\n                                <span ng-if="summary.design">\n                                {{"search.study.design" | translate}} : {{ summary.design === undefined ? \'-\' : \'study_taxonomy.vocabulary.methods-design.term.\' + summary.design + \'.title\' | translate}}\n                                </span> -\n                            <span ng-if="summary.targetNumber.number">\n                                 {{"numberOfParticipants.participants" | translate}} : <localized-number\n                                    value="summary.targetNumber.number"></localized-number>\n                                </span>\n                            <span ng-if="summary.targetNumber.noLimit">\n                                    <span ng-if="summary.design">; </span>\n                                    {{"numberOfParticipants.no-limit" | translate}}\n                                </span>\n                        </blockquote-small>\n                        <div class="sm-top-margin">\n                            {{counts=summary[\'obiba.mica.CountStatsDto.studyCountStats\'];""}}\n                            <badge-count ng-if="counts.networks"\n                                    entity-count="counts.networks"\n                                    entity-type="\'networks\'"\n                                    label-badge="counts.networks>1?\'networks\':\'network.label\'"\n                                    badge-options="options.obibaListOptions.showNetworkBadge"\n                                    query="\'network(in(Mica_network.studyIds,\' + summary.id +  \'))\'">\n                            </badge-count>\n\n                            {{datasetsCount=counts.studyDatasets +\n                            counts.harmonizationDatasets;""}}\n                            <badge-count ng-if="datasetsCount"\n                                    entity-count="datasetsCount"\n                                    entity-type="\'datasets\'"\n                                    label-badge="datasetsCount>1?\'datasets\':\'dataset.details\'"\n                                    badge-options="options.obibaListOptions.showDatasetBadge"\n                                    query="\'study(in(Mica_study.id,\' + summary.id + \'))\'">\n                            </badge-count>\n                            <badge-count ng-if="counts.studyVariables"\n                                         entity-count="counts.studyVariables"\n                                         entity-type="\'variables\'"\n                                         label-badge="counts.studyVariables>1?\'client.label.study-variables\':\'client.label.study-variable\'"\n                                         badge-options="options.obibaListOptions.showVariableBadge"\n                                         query="\'study(in(Mica_study.id,\' + summary.id + \')),variable(in(Mica_variable.variableType,Collected))\'">\n                            </badge-count>\n                            <badge-count ng-if="counts.dataschemaVariables"\n                                         entity-count="counts.dataschemaVariables"\n                                         entity-type="\'variables\'"\n                                         label-badge="counts.dataschemaVariables>1?\'client.label.dataschema-variables\':\'client.label.dataschema-variable\'"\n                                         badge-options="options.obibaListOptions.showVariableBadge"\n                                         query="\'study(in(Mica_study.id,\' + summary.id + \')),variable(in(Mica_variable.variableType,Dataschema))\'">\n                            </badge-count>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n\n    </div>\n</div>')}]),angular.module("lists/views/region-criteria/criterion-dropdown-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/region-criteria/criterion-dropdown-template.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown-{{timestamp}}" class="{{\'btn-group voffset1 btn-\' + criterion.target}}" ng-class=\'{open: state.open}\'\n     ng-keyup="onKeyup($event)">\n\n  <span ng-if="VocabularyService.isFacettedVocabulary(criterion.vocabulary)" ng-class=\'{open: state.open}\'>\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}"\n          ng-click="openDropdown()">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}"\n          popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}"\n          popover-placement="bottom"\n          popover-trigger="\'mouseenter\'">\n    <i class="fa fa-info-circle"> </i>\n  </span>\n    <span title="{{localizeCriterion()}}" test-ref="search-criterion">\n    {{truncate(localizeCriterion())}}\n    </span>\n    <span class=\'fa fa-caret-down\'></span>\n  </button>\n  <button class=\'btn btn-xs btn-default\' ng-click=\'remove(criterion.id)\'>\n    <span class=\'fa fa-times\'></span>\n  </button>\n\n  <match-criterion ng-if="VocabularyService.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n                   state="state"></match-criterion>\n\n  <string-criterion-terms\n          ng-if="VocabularyService.isTermsVocabulary(criterion.vocabulary) || VocabularyService.isRangeVocabulary(criterion.vocabulary)"\n          criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="VocabularyService.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n                     state="state"></numeric-criterion>\n</span>\n</div>')}]),angular.module("lists/views/region-criteria/search-criteria-region-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/region-criteria/search-criteria-region-template.html",'<div id="search-criteria-region" ng-class="options.showSearchBox || options.showSearchBrowser ? \'voffset2\' : \'\'" class="panel panel-default" ng-if="search.criteria.children && search.criteria.children.length>0 && canShowCriteriaRegion()">\n    <div class="panel-body">\n        <table style="border:none">\n            <tbody>\n            <tr >\n                <td style="padding-left: 10px">\n                    <div criteria-root item="search.criteria"  on-remove="removeCriteriaItem"\n                         on-refresh="refreshQuery" query="search.query" class="inline"></div>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>')}]),angular.module("lists/views/search-result-list-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/search-result-list-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n\n<div ng-show="display === \'list\'">\n  \x3c!--ToDo using the entity-counts component to diusplay some counts int lists page--\x3e\n  \x3c!--<entity-counts taxonomy-type-map="targetTypeMap" result-tabs-order="[\'study\', \'variable\', \'network\']" target="target" result="result"></entity-counts>--\x3e\n  <div class="row voffset3">\n    <div class="col-md-2">\n      <span ng-show="options.obibaListOptions.countCaption" role="presentation" ng-repeat="res in resultTabsOrder" ng-class="{active: activeTarget[targetTypeMap[res]].active && resultTabsOrder.length > 1, disabled: resultTabsOrder.length === 1}"\n        ng-if="options[targetTypeMap[res]].showSearchTab">\n        <h4 ng-if="resultTabsOrder.length === 1" class="pull-left">\n          {{totalHits = getTotalHits(res);""}} {{singleLabel = "search." + res + ".label";""}} {{totalHits | localizedNumber }} {{totalHits>1?targetTypeMap[res]:singleLabel\n          | translate}}\n        </h4>\n      </span>\n    </div>\n    <div class="col-md-10">\n      <div ng-show="options.obibaListOptions.searchForm">\n        <list-search-widget type="type"></list-search-widget>\n      </div>\n      <div class="pull-right hoffset1">\n        <div ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="inline" test-ref="pager">\n          <search-result-pagination\n                show-total="false"\n                target="activeTarget[targetTypeMap[res]].name"\n                on-change="onPaginate(target, from, size, replace)">\n          </search-result-pagination>\n        </div>\n      </div>\n      <span ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active && activeTarget[targetTypeMap[res]].totalHits > 0 && options.obibaListOptions.searchForm">\n        <list-sort-widget target="type" class="pull-right"></list-sort-widget>\n      </span>\n    </div>\n  </div>\n  <div class="row">\n    <ng-include include-replace ng-repeat="res in resultTabsOrder" src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n  </div>\n</div>')}]),angular.module("lists/views/sort-widget/sort-widget-template.html",[]).run(["$templateCache",function(a){a.put("lists/views/sort-widget/sort-widget-template.html",'<div class="btn-group dropdown">\n    <button id="SortOrder" type="button" class="btn-sm btn btn-primary dropdown-toggle"\n            data-toggle="dropdown">\n           {{selected.label | translate}}\n        <i ng-if="selected.value.startsWith(\'-\') && selected.label !== \'relevance\'"\n           class="fa fa-long-arrow-down"></i>\n        <i ng-if="!selected.value.startsWith(\'-\') && selected.label !== \'relevance\'"\n           class="fa fa-long-arrow-up"></i>\n    </button>\n    <ul class="dropdown-menu" role="menu" uib-dropdown-menu aria-labelledby="SortOrder">\n        <li ng-repeat="option in selectSortOrder.options" role="menuitem">\n            <a ng-click="selectSortOrderOption(option)" href><span translate>{{option.label}}</span>\n               <i ng-if="option.value.startsWith(\'-\') && option.label !== \'relevance\'"\n                  class="fa fa-long-arrow-down"></i>\n               <i ng-if="!option.value.startsWith(\'-\') && option.label !== \'relevance\'"\n                  class="fa fa-long-arrow-up"></i>\n            </a>\n        </li>\n    </ul>\n</div>\n')}]),angular.module("localized/localized-input-group-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-group-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <div class="input-group">\n    <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <span class="input-group-btn" ng-show="remove">\n    <button class="btn btn-default" type="button" ng-click="remove(model)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n  </span>\n  </div>\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-input-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-input-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n  <input ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" type="text" class="form-control" id="{{fieldName}}" name="{{fieldName}}" ng-disabled="disabled" form-server-error ng-required="required">\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n</div>')}]),angular.module("localized/localized-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n<span ng-bind-html="LocalizedValues.for(value,lang,keyLang,keyValue)  | markdown:markdownIt | ellipsis:ellipsisSize"></span>')}]),angular.module("localized/localized-textarea-template.html",[]).run(["$templateCache",function(a){a.put("localized/localized-textarea-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="form-group" ng-class="{\'has-error\': (form[fieldName].$dirty || form.saveAttempted) && form[fieldName].$invalid}">\n\n  <label for="{{fieldName}}" class="control-label">\n    {{label | translate}}\n    <span ng-show="required">*</span>\n  </label>\n\n  <textarea ng-repeat="localized in model | filter:{lang:lang}" ng-model="localized.value" ng-change="customValidator(form[fieldName])" rows="{{rows ? rows : 5}}" class="form-control" id="{{fieldName}}" name="{{fieldName}}" form-server-error ng-disabled="disabled" ng-required="required"></textarea>\n\n  <ul class="input-error list-unstyled" ng-show="form[fieldName].$dirty && form[fieldName].$invalid">\n    <li ng-show="form[fieldName].$error.required" translate>required</li>\n    <li ng-repeat="(error, errorValue) in form[fieldName].$error" translate>{{error}}</li>\n  </ul>\n\n  <p ng-show="help" class="help-block">{{help | translate}}</p>\n\n</div>')}]),angular.module("search/components/criteria/criteria-root/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/criteria-root/component.html",'<div class="form-inline">\n  <div ng-repeat="child in item.children | renderableTargets" class="inline">\n    <div class="inline hoffset2" ng-if="$index>0">+</div>\n    <criteria-target item="child" query="$parent.query" advanced="$parent.advanced" class="inline"></criteria-target>\n  </div>\n</div>')}]),angular.module("search/components/criteria/criteria-target/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/criteria-target/component.html",'<div>\n  <div class="hidden-xs form-group" title="{{\'search.\' + item.target + \'-where\' | translate}}">\n    <i class="{{\'i-obiba-x-large i-obiba-\' + item.target + \' color-\' + item.target}}">&nbsp;</i>\n  </div>\n  <criteria-node ng-repeat="child in item.children" item="child" query="$parent.query" advanced="$parent.advanced"></criteria-node>\n</div>')}]),angular.module("search/components/criteria/item-region/dropdown/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/dropdown/component.html",'<div id="{{criterion.id.replace(\'.\',\'-\')}}-dropdown-{{timestamp}}" class="{{\'btn-group voffset1 btn-\' + criterion.target}}"\n  ng-class=\'{open: state.open}\' ng-keyup="onKeyup($event)">\n\n  <button class="{{\'btn btn-xs dropdown btn-\' + criterion.target}}" ng-click="openDropdown()">\n    <span uib-popover="{{localize(criterion.vocabulary.description ? criterion.vocabulary.description : criterion.vocabulary.title)}}"\n      popover-title="{{criterion.vocabulary.description ? localize(criterion.vocabulary.title) : null}}" popover-placement="bottom"\n      popover-trigger="\'mouseenter\'">\n      <i class="fa fa-info-circle"> </i>\n    </span>\n    <span title="{{localizeCriterion()}}" test-ref="search-criterion">\n      {{truncate(localizeCriterion())}}\n    </span>\n    <span class=\'fa fa-caret-down\'></span>\n  </button>\n  <button class=\'btn btn-xs btn-default\' ng-click=\'remove(criterion.id)\'>\n    <span class=\'fa fa-times\'></span>\n  </button>\n\n  <match-criterion ng-if="VocabularyService.isMatchVocabulary(criterion.vocabulary)" criterion="criterion" query="query" state="state"></match-criterion>\n\n  <string-criterion-terms ng-if="VocabularyService.isTermsVocabulary(criterion.vocabulary) || VocabularyService.isRangeVocabulary(criterion.vocabulary)"\n    criterion="criterion" query="query" state="state"></string-criterion-terms>\n\n  <numeric-criterion ng-if="VocabularyService.isNumericVocabulary(criterion.vocabulary)" criterion="criterion" query="query"\n    state="state"></numeric-criterion>\n\n</div>')}]),angular.module("search/components/criteria/item-region/item-node/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/item-node/component.html",'<span>\n  <span ng-if="item.children.length > 0">\n    <criteria-leaf item="item.children[0]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n    <div class="btn-group voffset1" ng-show="$parent.advanced" uib-dropdown>\n      <button type="button" class="btn btn-default btn-xs" uib-dropdown-toggle>\n        {{item.type | translate}}\n        <span class="caret"></span>\n      </button>\n      <ul uib-dropdown-menu role="menu">\n        <li role="menuitem">\n          <a href ng-click="updateLogical(\'or\')" translate>or</a>\n        </li>\n        <li role="menuitem">\n          <a href ng-click="updateLogical(\'and\')" translate>and</a>\n        </li>\n      </ul>\n    </div>\n    <criteria-leaf item="item.children[1]" parent-type="$parent.item.type" query="query" advanced="advanced"></criteria-leaf>\n\n  </span>\n  <span ng-if="item.children.length === 0">\n    <criteria-leaf item="item" parent-type="item.parent.type" query="query" advanced="advanced"></criteria-leaf>\n  </span>\n</span>')}]),angular.module("search/components/criteria/item-region/match/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/match/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="criteria-list-item">\n    <form novalidate>\n      <div>\n        <input class="form-control" id="{{criterion.vocabulary.name}}-match" ng-model="match" ng-change="update()" placeholder="{{\'search.match.placeholder\' | translate}}">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/components/criteria/item-region/numeric/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/numeric/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n  <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n  <li class="btn-group">\n    <ul class="criteria-list-item">\n      <li>\n        <label title="{{\'search.any-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="false"> {{\'search.any\' | translate}}\n        </label>\n      </li>\n      <li>\n        <label title="{{\'search.none-help\' | translate}}">\n          <input ng-click="updateSelection()" type="radio" ng-model="selectMissing" ng-value="true"> {{\'search.none\' | translate}}\n        </label>\n      </li>\n    </ul>\n  </li>\n  <li ng-show="!selectMissing" class=\'divider\'></li>\n  <li ng-show="!selectMissing" class="btn-group criteria-list-item">\n    <form novalidate>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-from" translate>from</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-from" placeholder="{{min}}" ng-model="from" style="width:150px">\n      </div>\n      <div class="form-group">\n        <label for="{{criterion.vocabulary.name}}-to" translate>to</label>\n        <input type="number" class="form-control" id="{{criterion.vocabulary.name}}-to" placeholder="{{max}}" ng-model="to" style="width:150px">\n      </div>\n    </form>\n  </li>\n</ul>')}]),angular.module("search/components/criteria/item-region/region/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/region/component.html",'<div id="search-criteria-region" ng-class="options.showSearchBox || options.showSearchBrowser ? \'voffset2\' : \'\'" class="panel panel-default"\n  ng-if="renderableTargets && renderableTargets.length > 0">\n  <div class="panel-body">\n    <table style="border:none">\n      <tbody>\n        <tr>\n          <td>\n            <a href class="btn btn-sm btn-default" ng-click="clearSearchQuery()" translate>clear</a>\n          </td>\n          <td style="padding-left: 10px">\n            <div criteria-root item="search.criteria" query="search.query" advanced="search.advanced" on-remove="removeCriteriaItem"\n              on-refresh="refreshQuery" class="inline"></div>\n\n            <small class="hoffset2" ng-if="showAdvanced()">\n              <a href ng-click="toggleSearchQuery()" title="{{search.advanced ? \'search.basic-help\' : \'search.advanced-help\' | translate}}"\n                translate>\n                {{search.advanced ? \'search.basic\' : \'search.advanced\' | translate}}\n              </a>\n            </small>\n\n            <div ng-show="options.showCopyQuery" class="btn-group voffset1 hoffset2" uib-dropdown auto-close="outsideClick" is-open="status.isopen">\n              <button id="single-button" type="button" class="btn btn-xs btn-success" uib-dropdown-toggle ng-disabled="disabled">\n                {{\'global.copy-query\' | translate}}\n                <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu query-dropdown-menu criteria-list-item" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n                <li role="menuitem">\n                  <div class="form-group">\n                    <label class="control-label" translate>search.query</label>\n                    <div class="input-group">\n                      <input id="copyQuery" type="text" class="form-control" value="{{$parent.query}}" tooltip-is-open="$parent.showCopiedQueryTooltipStatus"\n                        uib-tooltip="{{\'global.copied\' | translate}}" tooltip-trigger="\'none\'" />\n                      <span class="input-group-btn">\n                        <button class="btn" ng-click="$parent.showCopiedQueryTooltip()" ngclipboard data-clipboard-target="#copyQuery" uib-tooltip="{{\'global.copy-to-clipboard\' | translate}}">\n                          <span class="fa fa-copy" alt="Copy to clipboard" />\n                        </button>\n                      </span>\n                    </div>\n                    <small>\n                      <span class="help-block" translate>search.query-copy-help</span>\n                    </small>\n                  </div>\n                </li>\n              </ul>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("search/components/criteria/item-region/string-terms/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/item-region/string-terms/component.html",'<ul class="dropdown-menu query-dropdown-menu" aria-labelledby="{{criterion.vocabulary.name}}-button">\n    <ng-include src="\'search/views/criteria/criterion-header-template.html\'"></ng-include>\n    <li class="btn-group">\n      <ul class="criteria-list-item">\n        <li>\n          <label title="{{\'search.any-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.EXISTS}}">\n            {{\'search.any\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.none-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.MISSING}}">\n            {{\'search.none\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.in-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.IN}}">\n            {{\'search.in\' | translate}}\n          </label>\n        </li>\n        <li>\n          <label title="{{\'search.out-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.OUT}}">\n            {{\'search.out\' | translate}}\n          </label>\n        </li>\n        <li ng-show="criterion.vocabulary.repeatable">\n          <label title="{{\'search.contains-help\' | translate}}">\n            <input ng-click="updateFilter()" type="radio" ng-model="selectedFilter" value="{{RQL_NODE.CONTAINS}}">\n            {{\'search.contains\' | translate}}\n          </label>\n        </li>\n      </ul>\n    </li>\n    <li ng-show="isInOutFilter() || isContainsFilter()" class=\'divider\'></li>\n    <li class="criteria-list-item" ng-show="state.loading">\n      <p class="voffset2 loading">\n      </p>\n    </li>\n    <li ng-show="isInOutFilter() || isContainsFilter()">\n      <ul ng-show="!state.loading" class="no-padding criteria-list-terms">\n        <li class="criteria-list-item" ng-show="terms && terms.length>10">\n          <span class="input-group input-group-sm no-padding-top">\n            <input ng-model="searchText" type="text" class="form-control" aria-describedby="term-search">\n            <span class="input-group-addon" id="term-search"><i class="fa fa-search"></i></span>\n          </span>\n        </li>\n        <li ng-show="terms && terms.length>10"></li>\n        <li class="criteria-list-item"\n          ng-show="isInOutFilter() || isContainsFilter()"\n          ng-repeat="term in terms | regex:searchText:[\'key\',\'title\',\'description\']"\n          uib-popover="{{term.description ? term.description : (truncate(term.title) === term.title ? null : term.title)}}"\n          popover-title="{{term.description ? term.title : null}}"\n          popover-placement="bottom"\n          popover-trigger="\'mouseenter\'">\n            <span>\n              <label class="control-label">\n                <input ng-model="checkboxTerms[term.key]"\n                  type="checkbox"\n                  ng-click="updateSelection()">\n                <span>{{truncate(term.title ? term.title : term.key)}}</span>\n              </label>\n            </span>\n            <span class="pull-right">\n              <span class="agg-term-count" ng-show="isSelectedTerm(term)">{{term.count}}</span>\n              <span class="agg-term-count-default" ng-show="!isSelectedTerm(term)">{{term.count}}</span>\n            </span>\n        </li>\n      </ul>\n    </li>\n  </ul>')}]),angular.module("search/components/criteria/match-vocabulary-filter-detail/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/match-vocabulary-filter-detail/component.html",'<input type="text" class="form-control"\n       placeholder="{{\'search.match.placeholder\' | translate}}"\n       ng-model="$ctrl.vocabulary.matchString"\n       ng-keyup="$ctrl.enterText($event)">')}]),angular.module("search/components/criteria/numeric-vocabulary-filter-detail/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/numeric-vocabulary-filter-detail/component.html",'<form ng-submit="$ctrl.setRangeValue($event)">\n  <label>{{\'global.from\' | translate}}\n    <input type="number"\n           ng-model="$ctrl.vocabulary.rangeTerms.from">\n  </label>\n\n  <label> {{\'global.to\' | translate}}\n    <input type="number"\n           ng-model="$ctrl.vocabulary.rangeTerms.to">\n  </label>\n  <button type="submit" class="btn btn-default btn-xs"><i class="fa fa-chevron-right"></i></button>\n</form>\n\n')}]),angular.module("search/components/criteria/terms-vocabulary-filter-detail/component.html",[]).run(["$templateCache",function(a){a.put("search/components/criteria/terms-vocabulary-filter-detail/component.html",'<div ng-class="{\'row\': ($index + 1) % 4 === 0}"\n     ng-repeat="term in $ctrl.vocabulary.filteredTerms | sortTerms:$ctrl.vocabulary | limitTo:$ctrl.limitNumber">\n  <div class="col-xs-3 col-md-3">\n    <div class="checkbox">\n      <label uib-popover="{{term.description ? term.description : term.title | localizedString}}"\n             popover-title="{{term.description ? term.title : null | localizedString}}"\n             popover-placement="bottom"\n             popover-trigger="\'mouseenter\'"\n             popover-popup-delay="250"\n             popover-class="right-panel-popover"\n             for="term-{{$ctrl.vocabulary.name + \'-\' + $index + \'-\' + term.name}}"\n             class="word-break">\n        <input id="term-{{$ctrl.vocabulary.name + \'-\' + $index + \'-\' + term.name}}"\n               type="checkbox"\n               ng-model="term.selected"\n               ng-click="$ctrl.clickCheckbox(term)"> {{term.title | localizedString}}\n      </label>\n    </div>\n  </div>\n</div>\n<span class="clearfix"></span>\n<div class="row">\n  <div class="col-md-12">\n    <div class="btn-group pull-right">\n      <button type="button" ng-if="$ctrl.limitNumber > $ctrl.constantLimitNumber"\n              class="btn btn-xs btn-primary"\n              ng-click="$ctrl.limitNumber = $ctrl.constantLimitNumber">\n        {{\'search.facet.less\' | translate}}\n      </button>\n      <button type="button" ng-if="$ctrl.vocabulary.filteredTerms.length > $ctrl.limitNumber"\n              class="btn btn-xs btn-primary"\n              ng-click="$ctrl.limitNumber = $ctrl.vocabulary.filteredTerms.length">\n        {{\'search.facet.more\' | translate}}\n      </button>\n    </div>\n  </div>\n</div>\n\n')}]),angular.module("search/components/entity-counts/component.html",[]).run(["$templateCache",function(a){a.put("search/components/entity-counts/component.html",'<ul class="list-no-style list-inline">\n  <li ng-repeat="entity in $ctrl.resultTabsOrder">\n    <a href ng-click="$ctrl.selectType(entity)"\n        class="btn btn-xs"\n        ng-class="{\'btn-default\': (entity !== $ctrl.target), \'btn-primary\': (entity === $ctrl.target)}">\n        {{$ctrl.taxonomyTypeMap[entity] | translate}} <span>{{$ctrl.getTotalHits(entity) | localizedNumber}}</span>\n    </a>\n  </li>\n</ul>')}]),angular.module("search/components/entity-search-typeahead/component.html",[]).run(["$templateCache",function(a){a.put("search/components/entity-search-typeahead/component.html",'<div class="input-group">\n  <div class="form-group has-feedback ">\n    <input type="search"\n           ng-model="$ctrl.model"\n           ng-attr-placeholder="{{$ctrl.placeholderText | translate}}"\n           uib-typeahead="suggestion for suggestion in $ctrl.suggest($viewValue)"\n           typeahead-focus-first="false"\n           typeahead-on-select="$ctrl.select($item)"\n           ng-keyup="$ctrl.onKeyUp($event)"\n           class="form-control">\n    <span ng-if="$ctrl.model"\n          ng-click="$ctrl.clear()"\n          class="form-control-feedback form-control-clear width-initial height-initial padding-right-10">\n        <i class="fa fa-times"></i>\n    </span>\n  </div>\n  <span ng-show="$ctrl.showButton" class="input-group-btn">\n    <button type="submit" class="btn btn-default" ng-click="$ctrl.select($ctrl.model)">\n      <i class="fa fa-search"></i>\n    </button>\n  </span>\n</div>')}]),angular.module("search/components/facets/taxonomy/component.html",[]).run(["$templateCache",function(a){a.put("search/components/facets/taxonomy/component.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n  <ul class="nav nav-tabs" role="tablist" ng-if="targets.length > 1">\n      <li ng-repeat="tab in targets" role="presentation" ng-class="{ active: tab === target }">\n        <a href role="tab" ng-click="setTarget(tab)">{{\'search.\' + tab + \'.facet-label\' | translate}}</a></li>\n    </ul>\n    \n    <uib-accordion close-others="false">\n        <div uib-accordion-group ng-repeat="taxonomy in taxonomies[target]" is-open="taxonomy.isOpen" is-disabled="false" template-url="search/views/classifications/taxonomy-accordion-group.html">\n          <uib-accordion-heading>\n              <i class="fa" ng-class="{\'fa-chevron-down\': taxonomy.isOpen, \'fa-chevron-right\': !taxonomy.isOpen}"></i>\n              <span uib-popover="{{localize(taxonomy.description ? taxonomy.description : taxonomy.title)}}"\n                    popover-title="{{taxonomy.description ? localize(taxonomy.title) : null}}"\n                    popover-placement="bottom"\n                    popover-trigger="\'mouseenter\'"\n                    popover-popup-delay="1000">\n                {{localize(taxonomy.title)}}\n              </span>\n          </uib-accordion-heading>\n          <uib-accordion close-others="false">\n            <div uib-accordion-group ng-repeat="vocabulary in taxonomy.vocabularies" is-open="vocabulary.isOpen" is-disabled="false" template-url="search/views/classifications/vocabulary-accordion-group.html">\n              <uib-accordion-heading>\n                <span uib-popover="{{localize(vocabulary.description ? vocabulary.description : vocabulary.title)}}"\n                      popover-title="{{vocabulary.description ? localize(vocabulary.title) : null}}"\n                      popover-placement="bottom"\n                      popover-trigger="\'mouseenter\'"\n                      popover-popup-delay="1000"\n                      ng-click="loadVocabulary(taxonomy, vocabulary)">\n                  <i class="fa" ng-class="{\'fa-caret-down\': vocabulary.isOpen, \'fa-caret-right\': !vocabulary.isOpen}"></i>\n                  <span>\n                    {{localize(vocabulary.title)}}\n                  </span>\n                  <span ng-if="!vocabulary.title">\n                    {{vocabulary.name}}\n                  </span>\n                </span>\n              </uib-accordion-heading>\n              <div>\n                <div ng-if="vocabulary.isMatch" ng-controller="MatchVocabularyFacetController" class="form-group">\n                  <form novalidate class="form-inline" ng-keypress="onKeypress($event)">\n                    <div class="form-group form-group-sm">\n                      <input type="text" class="form-control" ng-model="text" placeholder="{{\'search.match.placeholder\' | translate}}">\n                      <button class="btn btn-sm btn-default" ng-click="onKeypress($event)" ><i class="fa fa-chevron-right"></i></button>\n                    </div>\n                  </form>\n                </div>\n                <div ng-if="vocabulary.isNumeric" ng-controller="NumericVocabularyFacetController" class="form-group">\n                  <form novalidate class="form-inline"  ng-keypress="onKeypress($event)">\n                    <div class="form-group form-group-sm">\n                      <label for="nav-{{vocabulary.name}}-from" translate>global.from</label>\n                      <input type="number" class="form-control" id="nav-{{vocabulary.name}}-from" ng-model="from" placeholder="{{min}}" style="width:75px;">\n                      <label for="nav-{{vocabulary.name}}-to" translate>global.to</label>\n                      <input type="number" class="form-control" id="nav-{{vocabulary.name}}-to" ng-model="to" placeholder="{{max}}" style="width:75px;">\n                      <button class="btn btn-sm btn-default" ng-click="onKeypress($event)" ><i class="fa fa-chevron-right"></i></button>\n                    </div>\n                  </form>\n                </div>\n                <div ng-if="!vocabulary.isNumeric && !vocabulary.isMatch" ng-controller="TermsVocabularyFacetController">\n                  <div ng-if="loading" class="loading"></div>\n                  <ul class="nav nav-pills nav-stacked" ng-if="vocabulary.visibleTerms > 0">\n                    <li ng-repeat="term in vocabulary.terms | orderBy:[\'-selected\', \'-count\', \'+name\']  | limitTo:vocabulary.limit:begin"\n                        class="checkbox" ng-class="{active: term.name === term.name}" ng-if="term.isVisible">\n                      <label style="max-width: 80%;">\n                        <input type="checkbox" ng-model="term.selected" ng-change="selectTerm(target, taxonomy, vocabulary, {term: term})">\n                        <span uib-popover="{{localize(term.description ? term.description : term.title)}}"\n                              popover-title="{{term.description ? localize(term.title) : null}}"\n                              popover-placement="bottom"\n                              popover-trigger="\'mouseenter\'"\n                              popover-popup-delay="1000">\n                          <span>\n                            {{localize(term.title)}}\n                          </span>\n                          <span ng-if="!term.title">\n                            {{term.name}}\n                          </span>\n                        </span>\n                      </label>\n                        <span class="pull-right" ng-class="{\'text-muted\': !term.selected}">\n                          {{term.count}}\n                        </span>\n                    </li>\n                  </ul>\n                  <span ng-if="vocabulary.visibleTerms === 0">\n                    <em translate>search.facet.no-data</em>\n                  </span>\n                  <div ng-if="!vocabulary.isNumeric && !vocabulary.isMatch && vocabulary.visibleTerms > 10" class="voffset1 pull-right form-group">\n                    <button class="btn btn-xs btn-primary" ng-if="vocabulary.limit" ng-click="vocabulary.limit = undefined" translate>search.facet.more</button>\n                    <button class="btn btn-xs btn-default" ng-if="!vocabulary.limit" ng-click="vocabulary.limit = 10" translate>search.facet.less</button>\n                  </div>\n                </div>\n              </div>\n            </div >\n          </uib-accordion>\n        </div>\n    </uib-accordion>\n    ')}]),angular.module("search/components/input-search-filter/component.html",[]).run(["$templateCache",function(a){a.put("search/components/input-search-filter/component.html",'<div class=" pull-right">\n    <div class="input-group has-feedback">\n       <span class="input-group-addon">\n           <i class="fa fa-filter"></i>\n       </span>\n        <input type="text" ng-model="$ctrl.queryString"  ng-attr-placeholder="{{\'search.placeholder.vocabulary-filter\'  | translate}}"\n               class="input-search-filter form-control" ng-change="$ctrl.change()">\n        <span ng-if="$ctrl.queryString"\n              ng-click="$ctrl.clear()"\n              class="form-control-feedback form-control-clear width-initial height-initial padding-right-5 ">\n          <i class="fa fa-times"></i>\n        </span>\n    </div>\n</div>')}]),angular.module("search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html",[]).run(["$templateCache",function(a){a.put("search/components/meta-taxonomy/meta-taxonomy-filter-list/component.html",'<div uib-accordion-group class="panel-default" is-open="$ctrl.status.isFirstOpen">\n  <div uib-accordion-heading>\n    <span>\n      <i class="fa" ng-class="{\'fa-caret-down\': $ctrl.status.isFirstOpen, \'fa-caret-right\':!$ctrl.status.isFirstOpen}"></i>\n    </span>\n    {{$ctrl.metaTaxonomy.title | localizedString}}\n  </div>\n\n  <ul class="nav nav-pills nav-stacked">\n    <li role="presentation" ng-repeat="taxonomy in $ctrl.metaTaxonomy.taxonomies" ng-class="{\'active\': taxonomy.state.isActive() && $ctrl.showTaxonomyPanel}">\n      <a href ng-click="$ctrl.selectTaxonomy(taxonomy)">\n        <span\n          uib-popover="{{taxonomy.info.description | localizedString}}"\n          popover-title="{{taxonomy.info.trKey ? (taxonomy.info.trKey | translate) : (taxonomy.info.title | localizedString)}}"\n          popover-placement="bottom"\n          popover-trigger="\'mouseenter\'"\n          popover-popup-delay="250">\n          {{taxonomy.info.trKey ? (taxonomy.info.trKey | translate) : (taxonomy.info.title | localizedString)}}\n        </span>\n        <span ng-if="taxonomy.state.isLoading()" class="loading"></span>\n        <span class="pull-right"><i class="fa fa-chevron-right"></i></span>\n      </a>\n    </li>\n  </ul>\n\n</div>\n\n')}]),angular.module("search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/meta-taxonomy/meta-taxonomy-filter-panel/component.html",'<div ng-class="{\'overlay-front-on-box-shodow\' : $ctrl.showTaxonomyPanel}">\n  <uib-accordion close-others="false" is-disabled="false">\n    <meta-taxonomy-filter-list ng-repeat="metaTaxonomy in $ctrl.metaTaxonomies"\n                               meta-taxonomy="metaTaxonomy"\n                               show-taxonomy-panel="$ctrl.showTaxonomyPanel"\n                               rql-query="$ctrl.rqlQuery"\n                               on-select-taxonomy="$ctrl.onSelectTaxonomy(target, taxonomy)">\n    </meta-taxonomy-filter-list>\n  </uib-accordion>\n</div>\n')}]),angular.module("search/components/panel/classification/component.html",[]).run(["$templateCache",function(a){a.put("search/components/panel/classification/component.html",'<div ng-show="!inSearchMode()" class="voffset2">\n    <div>\n      <ol class="breadcrumb">\n        <li ng-if="!taxonomies.taxonomy">\n          {{\'all-\' + taxonomies.target + \'-classifications\' | translate}}\n        </li>\n        <li ng-if="taxonomies.taxonomy">\n          <a href ng-click="navigateTaxonomy()">{{\'all-\' + taxonomies.target + \'-classifications\' |\n            translate}}</a>\n        </li>\n        <li ng-if="taxonomies.taxonomy">\n          <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="!taxonomies.vocabulary && label.locale === lang">\n            {{label.text}}\n          </span>\n          <a href ng-click="navigateTaxonomy(taxonomies.taxonomy)" ng-if="taxonomies.vocabulary">\n            <span ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang">\n              {{label.text}}\n            </span>\n          </a>\n        </li>\n        <li ng-if="taxonomies.vocabulary">\n          <span ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n            {{label.text}}\n          </span>\n        </li>\n        <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}"\n           href class="hoffset1" ng-click="refreshTaxonomyCache()">\n          <span class="fa fa-refresh"></span>\n        </a>\n      </ol>\n  \n    </div>\n  \n    <div ng-if="taxonomies.search.active" class="loading"></div>\n  \n    <div ng-if="!taxonomies.search.active">\n      <div ng-if="!taxonomies.taxonomy">\n        <div ng-repeat="group in taxonomyGroups">\n          <h3 ng-if="group.title">{{group.title}}</h3>\n          <p class="help-block" ng-if="group.description">{{group.description}}</p>\n          <div ng-if="!taxonomies.taxonomy">\n            <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang"\n                     on-navigate="navigateTaxonomy"></div>\n              </div>\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang"\n                     on-navigate="navigateTaxonomy"></div>\n              </div>\n              <div class="col-md-4">\n                <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang"\n                     on-navigate="navigateTaxonomy"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && !taxonomies.vocabulary">\n        <h3 ng-repeat="label in taxonomies.taxonomy.title"\n            ng-if="label.locale === lang">\n          {{label.text}}\n        </h3>\n  \n        <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n          {{label.text}}\n        </p>\n  \n        <div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 1]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div vocabulary-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.taxonomy.vocabularies[$index + 2]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && !taxonomies.term">\n        <h3 ng-repeat="label in taxonomies.vocabulary.title"\n            ng-if="label.locale === lang">\n          {{label.text}}\n        </h3>\n  \n        <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description"\n           ng-if="label.locale === lang">\n          {{label.text}}\n        </p>\n  \n        <div ng-repeat="term in taxonomies.vocabulary.terms" ng-if="$index % 3 == 0" class="row">\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 1]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n          <div class="col-md-4">\n            <div term-panel target="taxonomies.target" taxonomy="taxonomies.taxonomy" vocabulary="taxonomies.vocabulary" term="taxonomies.vocabulary.terms[$index + 2]"\n                 lang="lang" on-navigate="navigateTaxonomy" on-select="selectTerm"></div>\n          </div>\n        </div>\n      </div>\n  \n      <div ng-if="taxonomies.taxonomy && taxonomies.vocabulary && taxonomies.term">\n        <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n          {{label.text}}\n        </h5>\n        <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n          <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n          <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n        </p>\n        <div>\n          <a href class="btn btn-default btn-xs"\n             ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n            <i class="fa fa-plus-circle"></i>\n            <span translate>add-query</span>\n          </a>\n        </div>\n      </div>\n    </div>\n  \n  </div>\n  ')}]),angular.module("search/components/panel/taxonomies-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/panel/taxonomies-panel/component.html",'<div class="collapse">\n  <div class="voffset2">\n    <div class="search-browser panel panel-default">\n      <div class="panel-heading no-padding-top no-padding-bottom">\n        <div class="row no-padding">\n          <div class="col-md-8">\n            <ol class="breadcrumb no-margin no-padding pull-left">\n              <li ng-if="taxonomies.taxonomy">\n                <h4 ng-repeat="label in taxonomies.taxonomy.title" ng-if="label.locale === lang" class="pull-left">\n                  <strong>{{label.text}}</strong>\n                </h4>\n                <a ng-if="options.showSearchRefreshButton" title="{{\'search.refresh-taxonomies\' | translate}}" href class="hoffset1 voffset2 pull-right"\n                  ng-click="refreshTaxonomyCache(target, taxonomies.taxonomy.name)">\n                  <span class="fa fa-refresh"></span>\n                </a>\n              </li>\n            </ol>\n          </div>\n          <div class="col-md-4">\n            <h4 ng-click="closeTaxonomies()" title="{{\'close\' | translate}}" class="pull-right" style="cursor: pointer">\n              <i class="fa fa-close"></i>\n            </h4>\n          </div>\n        </div>\n      </div>\n      <div class="panel-body">\n        <div ng-if="taxonomies.search.active" class="loading"></div>\n\n        <div ng-if="!taxonomies.search.active">\n          <div ng-if="!taxonomies.taxonomy">\n            <div ng-repeat="group in taxonomyGroups">\n              <h4 ng-if="group.title">{{group.title}}</h4>\n              <p class="help-block" ng-if="group.description">{{group.description}}</p>\n              <div ng-if="!taxonomies.taxonomy">\n                <div ng-repeat="taxonomy in group.taxonomies" ng-if="$index % 3 == 0" class="row">\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 1]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                  <div class="col-md-4">\n                    <div taxonomy-panel taxonomy="group.taxonomies[$index + 2]" lang="lang" on-navigate="navigateTaxonomy"></div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div ng-if="taxonomies.taxonomy">\n            <div class="row">\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.taxonomy">\n                <p class="help-block" ng-repeat="label in taxonomies.taxonomy.description" ng-if="label.locale === lang">\n                  {{label.text}}\n                </p>\n                <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.taxonomy.vocabularies">\n                  <li ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies | visibleVocabularies | filter:canNavigate " class="{{taxonomies.vocabulary.name === vocabulary.name ? \'active\' : \'\'}}">\n                    <a class="clearfix" id="search-navigate-taxonomy" href ng-click="navigateTaxonomy(taxonomies.taxonomy, vocabulary)">\n                      <i class="pull-right {{taxonomies.vocabulary.name !== vocabulary.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                      <span ng-repeat="label in vocabulary.title" ng-if="label.locale === lang">\n                        {{label.text}}\n                      </span>\n                      <span ng-if="!vocabulary.title">\n                        {{vocabulary.name}}\n                      </span>\n\n\n                    </a>\n                  </li>\n                </ul>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.vocabulary">\n                <div ng-if="taxonomies.vocabulary">\n                  <h5 ng-repeat="label in taxonomies.vocabulary.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div class="form-group" ng-if="!taxonomies.isNumericVocabulary && !taxonomies.isMatchVocabulary">\n                    <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary)">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p class="help-block" ng-repeat="label in taxonomies.vocabulary.description" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </p>\n                  <div ng-if="taxonomies.isMatchVocabulary" ng-controller="MatchVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline" ui-keypress="{13: \'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {text: text})\'}">\n                      <div class="form-group">\n                        <input type="text" class="form-control" ng-model="text" placeholder="{{\'search.match.placeholder\' | translate}}">\n                      </div>\n                    </form>\n                  </div>\n                  <div ng-if="taxonomies.isNumericVocabulary" ng-controller="NumericVocabularyPanelController">\n                    <div class="form-group">\n                      <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})">\n                        <i class="fa fa-plus-circle"></i>\n                        <span translate>add-query</span>\n                      </a>\n                    </div>\n                    <form novalidate class="form-inline" ui-keypress="{13:\'selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {from: from, to: to})\'}">\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-from" translate>from</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-from" ng-model="from" style="width:150px">\n                      </div>\n                      <div class="form-group">\n                        <label for="nav-{{taxonomies.vocabulary.name}}-to" translate>to</label>\n                        <input type="number" class="form-control" id="nav-{{taxonomies.vocabulary.name}}-to" ng-model="to" style="width:150px">\n                      </div>\n                    </form>\n                  </div>\n                  <ul class="nav nav-pills nav-stacked" ng-if="taxonomies.vocabulary.terms">\n                    <li ng-repeat="term in taxonomies.vocabulary.terms" class="{{taxonomies.term.name === term.name ? \'active\' : \'\'}}">\n                      <a class="clearfix" id="search-navigate-vocabulary" href ng-click="navigateTaxonomy(taxonomies.taxonomy, taxonomies.vocabulary, term)">\n                        <i class="pull-right {{taxonomies.term.name !== term.name ? \'hidden\' : \'\'}} hidden-sm hidden-xs fa fa-chevron-circle-right"></i>\n                        <span ng-repeat="label in term.title" ng-if="label.locale === lang">\n                          {{label.text}}\n                        </span>\n                        <span ng-if="!term.title">\n                          {{term.name}}\n                        </span>\n                      </a>\n                    </li>\n                  </ul>\n                </div>\n                <div ng-if="!taxonomies.vocabulary" translate>search.taxonomy-nav-help</div>\n              </div>\n              <div class="col-md-4 height3" scroll-to-top="taxonomies.term">\n                <div ng-if="taxonomies.term">\n                  <h5 ng-repeat="label in taxonomies.term.title" ng-if="label.locale === lang">\n                    {{label.text}}\n                  </h5>\n                  <div>\n                    <a href class="btn btn-default btn-xs" ng-click="selectTerm(taxonomies.target, taxonomies.taxonomy, taxonomies.vocabulary, {term: taxonomies.term})">\n                      <i class="fa fa-plus-circle"></i>\n                      <span translate>add-query</span>\n                    </a>\n                  </div>\n                  <p ng-repeat="label in taxonomies.term.description" ng-if="label.locale === lang">\n                    <span class="help-block" ng-bind-html="label.text | dceDescription" ng-if="taxonomies.vocabulary.name === \'dceId\'"></span>\n                    <span class="help-block" ng-bind-html="label.text" ng-if="taxonomies.vocabulary.name !== \'dceId\'"></span>\n                  </p>\n                </div>\n                <div ng-if="!taxonomies.term && taxonomies.vocabulary" translate>search.vocabulary-nav-help</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/panel/taxonomy-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/panel/taxonomy-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="taxonomy">\n    <div class="panel-heading">\n      <div ng-repeat="label in taxonomy.title" ng-if="label.locale === lang">\n        <a href ng-click="onNavigate(taxonomy)">{{label.text}}</a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div ng-repeat="label in taxonomy.description" ng-if="label.locale === lang">\n        {{label.text}}\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/panel/term-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/panel/term-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="term">\n    <div class="panel-heading">\n      <div>\n        <localized value="term.title" lang="lang" key-lang="locale" key-value="text"></localized>\n        {{label.text}}\n        <small>\n          <a href ng-click="onSelect(target, taxonomy, vocabulary, {term: term})">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </a>\n        </small>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="term.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!term.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/panel/vocabulary-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/panel/vocabulary-panel/component.html",'<div>\n  <div class="panel panel-default" ng-if="vocabulary">\n    <div class="panel-heading">\n      <div ng-repeat="label in vocabulary.title" ng-if="label.locale === lang" class="clearfix">\n        <a href ng-click="onNavigate(taxonomy, vocabulary)" ng-if="vocabulary.terms">{{label.text}}</a>\n        <span ng-if="!vocabulary.terms">{{label.text}}</span>\n        <a href ng-click="onSelect(target, taxonomy, vocabulary)">\n          <small ng-if="vocabulary.terms">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </small>\n          <small ng-if="!vocabulary.terms">\n            <i class="fa fa-plus-circle" title="{{\'add-query\' | translate}}"></i>\n          </small>\n        </a>\n      </div>\n    </div>\n    <div class="panel-body">\n      <div>\n        <localized value="vocabulary.description" lang="lang" key-lang="locale" key-value="text"></localized>\n      </div>\n      <div ng-if="!vocabulary.description" class="help-block" translate>search.no-description</div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/result/cell-stat-value/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/cell-stat-value/component.html",'<div>\n  <span ng-if="$ctrl.disable"><localized-number value="$ctrl.entityCount"></localized-number></span>\n  <a href ng-click="$ctrl.clickCriteria()" ng-if="!$ctrl.disable">\n    <localized-number value="$ctrl.entityCount"></localized-number>\n  </a>\n</div>')}]),angular.module("search/components/result/coverage-result/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/coverage-result/component.html",'<div class="coverage">\n\n  <div ng-if="hasVariableTarget() && table.taxonomyHeaders">\n    <ul class="nav nav-pills pull-left">\n      <li ng-if="groupByOptions.canShowStudy() && groupByOptions.canShowDataset()" ng-class="{\'active\': bucket.startsWith(\'study\') || bucketStartsWithDce}"\n        class="studies">\n        <a href ng-click="selectTab(\'study\')" translate>{{groupByOptions.studyTitle()}}</a>\n      </li>\n      <li ng-if="groupByOptions.canShowStudy() && groupByOptions.canShowDataset()" ng-class="{\'active\': bucket.startsWith(\'dataset\')}"\n        class="datasets">\n        <a href ng-click="selectTab(\'dataset\')" translate>{{groupByOptions.datasetTitle()}}</a>\n      </li>\n    </ul>\n\n    <div ng-class="{\'pull-right\': groupByOptions.canShowStudy() && groupByOptions.canShowDataset()}">\n      <a ng-if="hasSelected()" href class="btn btn-default" ng-click="updateFilterCriteria()">\n        <i class="fa fa-filter"></i> {{\'search.filter\' | translate}}\n      </a>\n\n      <span ng-if="table.taxonomyHeaders.length > 0">\n        <a href class="btn btn-info btn-responsive" ng-click="selectFullAndFilter()" ng-hide="isFullCoverageImpossibleOrCoverageAlreadyFull()">\n          {{\'search.coverage-select.full\' | translate}}\n        </a>\n        <a obiba-file-download url="downloadUrl()" target="_self" download class="btn btn-info btn-responsive" href>\n          <i class="fa fa-download"></i> {{\'download\' | translate}}\n        </a>\n      </span>\n    </div>\n\n    <div class="clearfix"></div>\n\n    <div class="voffset2" ng-class="{\'pull-right\': groupByOptions.canShowVariableTypeFilter(bucket) && groupByOptions.canShowStudyType()}" ng-if="!singleStudy && groupByOptions.canShowDce(bucket)">\n      <label class="checkbox-inline">\n        <input type="checkbox" ng-model="bucketSelection.dceBucketSelected">\n        <span translate>search.coverage-buckets.dce</span>\n      </label>\n    </div>\n\n    <div class="voffset2" ng-if="!singleStudy && groupByOptions.canShowStudyType()">\n      <div class="btn btn-group" style="padding: 0">\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'all\'" translate>all</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n        <label class="btn btn-sm btn-study" ng-model="bucketSelection.studySelection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n      </div>\n    </div>\n  </div>\n\n  <p class="help-block" ng-if="!loading && !table.taxonomyHeaders">\n    <span ng-if="!hasVariableTarget() || !table.taxonomyHeaders" translate>search.no-coverage</span>\n    <span ng-if="hasVariableTarget()" translate>search.no-results</span>\n  </p>\n\n  <div ng-if="loading" class="loading"></div>\n\n  <div class="table-responsive" ng-if="!loading && table.taxonomyHeaders.length > 0">\n    <table class="table table-bordered table-striped">\n      <thead>\n        <tr>\n          <th rowspan="2" width="50" style="text-align: center">\n            <div class="btn-group voffset1" uib-dropdown>\n              <div uib-dropdown-toggle>\n                <span class="fa fa-square-o"></span>\n                <span class="fa fa-caret-down"></span>\n              </div>\n              <ul uib-dropdown-menu role="menu">\n                <li role="menuitem">\n                  <a href ng-click="selectAll()" translate>search.coverage-select.all</a>\n                </li>\n                <li role="menuitem">\n                  <a href ng-click="selectNone()" translate>search.coverage-select.none</a>\n                </li>\n                <li role="menuitem">\n                  <a href ng-click="selectFull()" translate>search.coverage-select.full</a>\n                </li>\n              </ul>\n            </div>\n          </th>\n          <th rowspan="{{bucketStartsWithDce ? 1 : 2}}" colspan="{{table.cols.colSpan}}" translate>\n            {{\'search.coverage-buckets.\' + bucket}}\n          </th>\n          <th ng-repeat="header in ::table.vocabularyHeaders" colspan="{{::header.termsCount}}">\n            <span uib-popover="{{header.entity.descriptions[0].value}}" popover-title="{{header.entity.titles[0].value}}" popover-placement="bottom"\n              popover-trigger="\'mouseenter\'">\n              {{header.entity.titles[0].value}}\n            </span>\n            <small>\n              <a href ng-click="removeVocabulary(header)">\n                <i class="fa fa-times"></i>\n              </a>\n            </small>\n          </th>\n        </tr>\n        <tr>\n          <th ng-if="bucketStartsWithDce && !singleStudy" translate>search.coverage-dce-cols.study</th>\n          <th ng-if="bucketStartsWithDce" colspan="{{choseHarmonization && !choseAll ? 2 : 1}}" translate>search.coverage-dce-cols.population</th>\n          <th ng-if="bucketStartsWithDce" ng-hide="choseHarmonization && !choseAll" translate>search.coverage-dce-cols.dce</th>\n          <th ng-repeat="header in ::table.termHeaders">\n            <span uib-popover="{{header.entity.descriptions[0].value}}" popover-title="{{header.entity.titles[0].value}}" popover-placement="bottom"\n              popover-trigger="\'mouseenter\'">\n              {{header.entity.titles[0].value}}\n            </span>\n            <small>\n              <a ng-if="header.canRemove" href ng-click="removeTerm(header)">\n                <i class="fa fa-times"></i>\n              </a>\n            </small>\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr ng-repeat="row in ::table.rows track by row.value" ng-show="showMissing || table.termHeaders.length == row.hits.length">\n          <td style="text-align: center">\n            <input type="checkbox" ng-model="row.selected">\n          </td>\n          <td ng-repeat="col in ::table.cols.ids[row.value] track by col.index" colspan="{{$middle && (choseHarmonization && !choseAll) ? 2 : 1}}" ng-hide="col.id === \'-\' && (singleStudy || choseHarmonization && !choseAll)">\n            <span ng-if="col.id === \'-\'">-</span>\n            <a ng-hide="col.rowSpan === 0  || col.id === \'-\'" href="{{col.url}}" uib-popover-html="col.description === col.title ? null : col.description"\n              popover-title="{{col.title}}" popover-placement="bottom" popover-trigger="\'mouseenter\'">{{col.title}}</a>\n            <div style="text-align: center" ng-if="col.start && bucketStartsWithDce">\n              <div>\n                <small class="help-block no-margin" ng-if="::col.end">\n                  {{::col.start}} {{\'to\' | translate}} {{::col.end}}\n                </small>\n                <small class="help-block no-margin" ng-if="!col.end">\n                  {{::col.start}}, {{\'search.coverage-end-date-ongoing\' | translate | lowercase}}\n                </small>\n              </div>\n              <div class="progress no-margin">\n                <div class="progress-bar progress-bar-transparent" role="progressbar" aria-valuenow="{{::col.start}}" aria-valuemin="{{::col.min}}"\n                  aria-valuemax="{{::col.start}}" ng-style="{\'width\': col.progressStart + \'%\'}">\n                </div>\n                <div class="{{\'progress-bar progress-bar-\' + col.progressClass}}" role="progressbar" aria-valuenow="{{col.current}}" aria-valuemin="{{::col.start}}"\n                  aria-valuemax="{{::col.end ? col.end : col.current}}" ng-style="{\'width\': col.progress + \'%\'}">\n                </div>\n              </div>\n            </div>\n          </td>\n          <td ng-repeat="h in ::table.termHeaders" title="{{h.entity.titles[0].value}}">\n            <a href ng-click="updateCriteria(row.value, h, $index, \'variables\')">\n              <span class="label label-info" ng-show="row.hitsTitles[$index]">{{row.hitsTitles[$index]}}</span>\n            </a>\n            <span ng-show="!row.hitsTitles[$index]">0</span>\n          </td>\n        </tr>\n      </tbody>\n      <tfoot>\n        <tr>\n          <th></th>\n          <th colspan="{{table.cols.colSpan}}" translate>all</th>\n          <th ng-repeat="header in ::table.termHeaders" title="{{header.entity.descriptions[0].value}}">\n            <a href ng-click="updateCriteria(null, header, $index, \'variables\')">\n              <localized-number value="header.hits"></localized-number>\n            </a>\n          </th>\n        </tr>\n      </tfoot>\n    </table>\n  </div>\n</div>')}]),angular.module("search/components/result/datasets-result-table/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/datasets-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.dataset.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th translate ng-if="optionsCols.showDatasetsAcronymColumn">acronym</th>\n            <th translate>name</th>\n            <th translate ng-if="optionsCols.showDatasetsTypeColumn">type</th>\n            <th translate ng-if="optionsCols.showDatasetsNetworkColumn">networks</th>\n            <th translate ng-if="optionsCols.showDatasetsStudiesColumn">studies</th>\n            <th translate ng-if="optionsCols.showDatasetsVariablesColumn">variables</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-if="!summaries || !summaries.length">\n            <td colspan="6" translate>search.dataset.noResults</td>\n          </tr>\n          <tr ng-repeat="summary in summaries">\n            <td ng-if="optionsCols.showDatasetsAcronymColumn">\n              <a ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <a ng-if="!optionsCols.showDatasetsAcronymColumn" ng-href="{{PageUrlService.datasetPage(summary.id, summary.variableType)}}">\n                <localized value="summary.name" lang="lang"></localized>\n              </a>\n              <localized ng-if="optionsCols.showDatasetsAcronymColumn" value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showDatasetsTypeColumn">\n              <localized value="classNames[(summary.variableType === \'Collected\' ? \'Study\' : \'Harmonization\') + \'Dataset\']" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showDatasetsNetworkColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="network"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks"\n                               update-criteria="updateCriteria(summary.id, \'networks\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].networks">-</span>\n            </td>\n            <td ng-if="optionsCols.showDatasetsStudiesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="study"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies"\n                               update-criteria="updateCriteria(summary.id, \'studies\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].studies">-</span>\n            </td>\n            <td ng-if="optionsCols.showDatasetsVariablesColumn">\n              <cell-stat-value result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.datasetCountStats\'].variables"\n                               update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/result/graphics-result/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/graphics-result/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n\n  <p class="help-block" ng-if="!loading && !noResults && !hasChartObjects()" translate>search.no-graphic-result</p>\n  <p class="help-block" ng-if="!loading && noResults" translate>search.no-results</p>\n\n  <div ng-repeat="chart in chartObjects" class="panel panel-default">\n    <div class="panel-heading">\n      {{chart.headerTitle}}\n    </div>\n    <div class="panel-body">\n      <div class="row">\n        <div class="col-xs-12 col-lg-6">\n          <div ng-if="chart.chartObject.type === \'GeoChart\'">\n            <obiba-geo config="chart.chartObject.d3Config"></obiba-geo>\n          </div>\n          <div ng-if="chart.chartObject.type !== \'GeoChart\'">\n            <obiba-nv-chart chart-config="chart.chartObject.d3Config"></obiba-nv-chart>\n          </div>\n        </div>\n        <div class="col-xs-12 col-lg-6">\n          <div class="table-responsive" ng-if="chart.getTable().data  &&  chart.getTable().data.length>1">\n            <table style="max-height: 400px;" class="table table-bordered table-striped" fixed-header="chart.getTable().data">\n              <thead>\n                <tr>\n                  <th>{{chart.getTable().data[0][0]}}</th>\n                  <th>{{chart.getTable().data[0][1]}}</th>\n                  <th ng-if="chart.getTable().data[0][2]">{{chart.getTable().data[0][2]}}</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr ng-repeat="row in chart.getTable().entries">\n                  <td>{{row.title}}</td>\n                  <td>\n                    <a href ng-click="updateCriteria(row.key, chart.getTable().vocabulary)">\n                      <localized-number value="row.value"></localized-number>\n                    </a>\n                  </td>\n                  <td ng-if="row.participantsNbr">{{row.participantsNbr}}</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/result/networks-result-table/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/networks-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.network.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th rowspan="2" translate>acronym</th>\n            <th rowspan="2" translate>name</th>\n            <th rowspan="2" translate ng-if="optionsCols.showNetworksStudiesColumn">studies</th>\n            <th translate ng-attr-colspan="{{colSpans.datasets}}" ng-if="(optionsCols.showNetworksStudyDatasetColumn && choseIndividual) || (optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization)">\n              datasets\n            </th>\n            <th rowspan="2" translate ng-if="optionsCols.showNetworksVariablesColumn">variables</th>\n            <th translate ng-attr-colspan="{{colSpans.variables}}" ng-if="(optionsCols.showNetworksStudyVariablesColumn && choseIndividual) || (optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization)">variables</th>\n          </tr>\n          </tr>\n          <tr>\n            <th translate ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual">search.dataset.collected</th>\n            <th translate ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization">search.dataset.harmonized</th>\n            <th translate ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual">search.variable.collected</th>\n            <th translate ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization">search.variable.dataschema</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-if="!summaries || !summaries.length">\n            <td colspan="6" translate>search.network.noResults</td>\n          </tr>\n          <tr ng-repeat="summary in summaries">\n            <td>\n              <a ng-href="{{PageUrlService.networkPage(summary.id)}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <localized value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudiesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="study"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies"\n                               update-criteria="updateCriteria(summary.id, \'studies\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studies">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudyDatasetColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="dataset"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"\n                               update-criteria="updateCriteria(summary.id, \'Study\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksHarmonizationDatasetColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="dataset"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"\n                               update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksVariablesColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].variables"\n                               update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n            <td ng-if="optionsCols.showNetworksStudyVariablesColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyVariables"\n                               update-criteria="updateCriteria(summary.id, \'Study\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showNetworksDataschemaVariablesColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.networkCountStats\'].dataschemaVariables"\n                               update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.networkCountStats\'].harmonizationDatasets">-</span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/result/pagination/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/pagination/component.html",'<div ng-show="$ctrl.pagination.totalHits > 10">\n  <div class="pull-left">\n    <select class="form-control input-sm form-select"\n            ng-model="$ctrl.pagination.selected"\n            ng-options="size.label for size in $ctrl.pagination.pageSizes"\n            ng-change="$ctrl.pageSizeChanged()"></select>\n  </div>\n  <div class="pull-right" style="margin-left: 5px">\n\n    <span ng-show="$ctrl.pagination.maxSize > 1"\n          uib-pagination\n          total-items="$ctrl.pagination.totalHits"\n          max-size="$ctrl.pagination.maxSize"\n          ng-model="$ctrl.pagination.currentPage"\n          boundary-links="true"\n          force-ellipses="true"\n          items-per-page="$ctrl.pagination.selected.value"\n          previous-text="&lsaquo;"\n          next-text="&rsaquo;"\n          first-text="&laquo;"\n          last-text="&raquo;"\n          template-url="search/views/list/pagination-template.html"\n          ng-change="$ctrl.pageChanged()"></span>\n    <ul class="pagination pagination-sm" ng-show="$ctrl.showPaginationTotal">\n      <li>\n        <a href class="pagination-total">{{$ctrl.pagination.from}} - {{$ctrl.pagination.to}} {{\'of\' | translate}} {{$ctrl.pagination.totalHits}}</a>\n      </li>\n    </ul>\n  </div>\n</div>')}]),angular.module("search/components/result/search-result/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/search-result/component.html",'<div class="search-result-tabs">\n  <ng-include include-replace ng-repeat="tab in searchTabsOrder" src="getUrlTemplate(tab)"></ng-include>\n</div>')}]),angular.module("search/components/result/search-result/coverage.html",[]).run(["$templateCache",function(a){a.put("search/components/result/search-result/coverage.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'coverage\'">\n  <coverage-result-table\n    result="result.coverage"\n    loading="loading"\n    bucket="bucket"\n    query="query"\n    criteria="criteria"\n    class="voffset2"\n    on-update-criteria="onUpdateCriteria"\n    on-remove-criteria="onRemoveCriteria"></coverage-result-table>\n</div>\n  ')}]),angular.module("search/components/result/search-result/graphics.html",[]).run(["$templateCache",function(a){a.put("search/components/result/search-result/graphics.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2 graphics-tab"></graphics-result>\n</div>')}]),angular.module("search/components/result/search-result/list.html",[]).run(["$templateCache",function(a){a.put("search/components/result/search-result/list.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'list\'" class="list-table">\n  <result-tabs-order-count options="options" result-tabs-order="resultTabsOrder" active-target="activeTarget" target-type-map="targetTypeMap">\n  </result-tabs-order-count>\n  <div class="voffset2" ng-class="{\'pull-right\': options.studies.showSearchTab, \'pull-left\': !options.studies.showSearchTab, \'hoffset2\': !options.studies.showSearchTab}">\n    <div class="btn-group" ng-if="type==\'variables\' && options.variables.showCart && (userCanCreateCart && userCanCreateSets)">\n      <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">\n        <i class="fa fa-cart-plus"></i> <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu">\n        <li><a ng-if="userCanCreateCart" ng-click="addToCart(type)" href translate>sets.add.button.cart-label</a></li>\n        <li><a ng-if="userCanCreateSets" ng-click="addToSet(type)" href>{{\'sets.add.button.set-label\' | translate}}</a></li>\n      </ul>\n    </div>\n    <a ng-click="addToSet(type)" target="_self" ng-if="type==\'variables\' && options.variables.showCart && !userCanCreateCart && userCanCreateSets" download class="btn btn-success"\n      href>\n      <i class="fa fa-cart-plus"></i>\n    </a>\n    <a ng-click="addToCart(type)" target="_self" ng-if="type==\'variables\' && options.variables.showCart && userCanCreateCart && !userCanCreateSets" download class="btn btn-success"\n      href>\n      <i class="fa fa-cart-plus"></i>\n    </a>\n\n    <a obiba-file-download url="getStudySpecificReportUrl()" target="_self" ng-if="type==\'studies\'" download class="btn btn-info"\n      href>\n      <i class="fa fa-download"></i> {{\'report-group.study.button-name\' | translate}}\n    </a>\n    <a obiba-file-download get-url="getSelectionsReportUrl()" target="_self" download class="btn btn-info" href>\n      <i class="fa fa-download"></i> {{\'download\' | translate}}\n    </a>\n  </div>\n\n  <div class="clearfix" ng-if="options.studies.showSearchTab"></div>\n\n  <div class="tab-content">\n    <div class="pull-left" study-filter-shortcut ng-if="options.studies.showSearchTab && options.studies.studiesColumn.showStudiesTypeColumn"></div>\n    <div ng-repeat="res in resultTabsOrder" ng-show="activeTarget[targetTypeMap[res]].active" class="pull-right voffset2" test-ref="pager">\n      <search-result-pagination\n            show-total="true"\n            target="activeTarget[targetTypeMap[res]].name"\n            on-change="onPaginate(target, from, size, replace)"></search-result-pagination>\n    </div>\n    <div class="clearfix"></div>\n    <ng-include include-replace ng-repeat="res in resultTabsOrder" src="\'search/views/search-result-list-\' + res + \'-template.html\'"></ng-include>\n  </div>\n</div>')}]),angular.module("search/components/result/studies-result-table/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/studies-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.study.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table class="table table-bordered table-striped">\n        <thead>\n          <tr>\n            <th rowspan="2" translate>acronym</th>\n            <th rowspan="2" translate>name</th>\n            <th rowspan="2" translate ng-if="choseAll && optionsCols.showStudiesTypeColumn">type</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesDesignColumn && choseIndividual">search.study.design</th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesQuestionnaireColumn + optionsCols.showStudiesPmColumn + optionsCols.showStudiesBioColumn + optionsCols.showStudiesOtherColumn}}"\n              ng-if="(optionsCols.showStudiesQuestionnaireColumn || optionsCols.showStudiesPmColumn || optionsCols.showStudiesBioColumn || optionsCols.showStudiesOtherColumn) && choseIndividual">\n              search.study.dataSources\n            </th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual">search.study.participants</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesNetworksColumn">networks</th>\n            <th rowspan="2" translate ng-if="optionsCols.showStudiesVariablesColumn">variables</th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesStudyDatasetsColumn + optionsCols.showStudiesStudyVariablesColumn}}"\n              ng-if="choseIndividual && (optionsCols.showStudiesStudyDatasetsColumn || optionsCols.showStudiesStudyVariablesColumn)">search.coverage-buckets.collection\n            </th>\n            <th translate ng-attr-colspan="{{optionsCols.showStudiesHarmonizationDatasetsColumn + optionsCols.showStudiesDataschemaVariablesColumn}}"\n              ng-if="choseHarmonization && (optionsCols.showStudiesHarmonizationDatasetsColumn || optionsCols.showStudiesDataschemaVariablesColumn)">search.coverage-buckets.harmonization</th>\n          </tr>\n          <tr>\n            <th class="text-nowrap" title="{{datasourceTitles.questionnaires.title}}" ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual">\n              <i class="fa fa-file-text-o"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.physical_measures.title}}" ng-if="optionsCols.showStudiesPmColumn && choseIndividual">\n              <i class="fa fa-stethoscope"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.biological_samples.title}}" ng-if="optionsCols.showStudiesBioColumn && choseIndividual">\n              <i class="fa fa-flask"></i>\n            </th>\n            <th class="text-nowrap" title="{{datasourceTitles.others.title}}" ng-if="optionsCols.showStudiesOtherColumn && choseIndividual">\n              <i class="fa fa-plus-square-o"></i>\n            </th>\n            <th translate ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual">datasets</th>\n            <th translate ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual">variables</th>\n            <th translate ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization">datasets</th>\n            <th translate ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization">variables</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-repeat="summary in summaries" ng-init="lang = $parent.$parent.lang">\n            <td>\n              <a ng-href="{{PageUrlService.studyPage(summary.id, summary.studyResourcePath === \'harmonization-study\' ? \'harmonization\' : \'individual\')}}">\n                <localized value="summary.acronym" lang="lang" test-ref="acronym"></localized>\n              </a>\n            </td>\n            <td>\n              <localized value="summary.name" lang="lang"></localized>\n            </td>\n            <td ng-if="choseAll && optionsCols.showStudiesTypeColumn">{{(summary.studyResourcePath === \'individual-study\' ? \'search.study.individual\' : \'search.study.harmonization\')\n              | translate}}</td>\n            <td ng-if="optionsCols.showStudiesDesignColumn && choseIndividual">\n              {{ summary.design === undefined ? \'-\' : \'study_taxonomy.vocabulary.methods-design.term.\' + summary.design + \'.title\' | translate}}\n            </td>\n            <td ng-if="optionsCols.showStudiesQuestionnaireColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'questionnaires\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'questionnaires\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesPmColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'physical_measures\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'physical_measures\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesBioColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'biological_samples\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'biological_samples\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesOtherColumn && choseIndividual">\n              <i class="fa fa-check" ng-if="hasDatasource(summary.dataSources, \'others\')"></i>\n              <span ng-if="!hasDatasource(summary.dataSources, \'others\')">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesParticipantsColumn && choseIndividual">\n              <span ng-if="summary.targetNumber.number">\n                <localized-number value="summary.targetNumber.number"></localized-number>\n              </span>\n              <span translate ng-if="summary.targetNumber.noLimit">\n                numberOfParticipants.no-limit\n              </span>\n              <span ng-if="!summary.targetNumber.number && !summary.targetNumber.noLimit">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesNetworksColumn">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="network"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks"\n                               update-criteria="updateCriteria(summary.id, \'networks\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].networks">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesVariablesColumn">\n              <cell-stat-value result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].variables"\n                               update-criteria="updateCriteria(summary.id, \'variables\')"></cell-stat-value>\n            </td>\n            <td ng-if="optionsCols.showStudiesStudyDatasetsColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="dataset"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"\n                               update-criteria="updateCriteria(summary.id, \'Study\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesStudyVariablesColumn && choseIndividual">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyVariables"\n                               update-criteria="updateCriteria(summary.id, \'Study\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].studyDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesHarmonizationDatasetsColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="dataset"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"\n                               update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'datasets\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n            </td>\n            <td ng-if="optionsCols.showStudiesDataschemaVariablesColumn && choseHarmonization">\n              <cell-stat-value ng-if="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets"\n                               result-tab-order="resultTabOrder"\n                               destination-tab="variable"\n                               entity-count="summary[\'obiba.mica.CountStatsDto.studyCountStats\'].dataschemaVariables"\n                               update-criteria="updateCriteria(summary.id, \'HarmonizationStudy\', \'variables\')"></cell-stat-value>\n              <span ng-if="!summary[\'obiba.mica.CountStatsDto.studyCountStats\'].harmonizationDatasets">-</span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/result/tabs-order-count/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/tabs-order-count/component.html",'<div>\n  <ul class="nav nav-pills pull-left voffset2" test-ref="search-counts">\n    <li role="presentation" ng-repeat="res in resultTabsOrder" ng-class="{active: activeTarget[targetTypeMap[res]].active && resultTabsOrder.length >= 1}"\n      ng-if="options[targetTypeMap[res]].showSearchTab" class="{{targetTypeMap[res]}}">\n      <a href ng-click="selectType(targetTypeMap[res])" ng-if="resultTabsOrder.length > 1">\n        {{targetTypeMap[res] | translate}}\n        <span class="badge hoffset1" test-ref="{{targetTypeMap[res]}}">\n          <small>{{getTotalHits(res) | localizedNumber}}</small>\n        </span>\n      </a>\n      <a href style="cursor: default;" ng-if="resultTabsOrder.length === 1">\n        {{targetTypeMap[res] | translate}}\n        <span class="badge hoffset1" test-ref="{{targetTypeMap[res]}}">\n          <small>{{getTotalHits(res) | localizedNumber}}</small>\n        </span>\n      </a>\n    </li>\n  </ul>\n</div>')}]),angular.module("search/components/result/variables-result-table/component.html",[]).run(["$templateCache",function(a){a.put("search/components/result/variables-result-table/component.html",'<div>\n  <div ng-if="loading" class="loading"></div>\n  <div ng-show="!loading">\n    <p class="help-block" ng-if="!summaries || !summaries.length" translate>search.variable.noResults</p>\n    <div class="table-responsive" ng-if="summaries && summaries.length">\n      <table-alert-header all-selected="page.all" on-select-all="selectAll()" ng-show="page.selections[pagination.currentPage]"></table-alert-header>\n      <table class="table table-bordered table-striped table-layout-fixed" ng-init="lang = $parent.$parent.lang">\n        <thead>\n          <tr>\n            <th class="checkbox-width">\n              <input\n                      ng-model="page.selections[pagination.currentPage]"\n                      type="checkbox"\n                      ng-click="selectPage()"/>\n            </th>\n            <th class="col-width-35" translate>name</th>\n            <th class="col-width-35" translate>search.variable.label</th>\n            <th class="col-width-10" translate ng-if="optionsCols.showVariablesTypeColumn">type</th>\n            <th class="col-width-10" translate ng-if="optionsCols.showVariablesStudiesColumn">search.study.label</th>\n            <th class="col-width-15" translate ng-if="optionsCols.showVariablesDatasetsColumn">search.dataset.label</th>\n          </tr>\n        </thead>\n        <tbody test-ref="search-results">\n          <tr ng-repeat="summary in summaries">\n            <td>\n              <input ng-model="selections[summary.id]" type="checkbox" ng-click="select(summary.id)"/>\n            </td>\n            <td>\n              <a test-ref="name" href="{{PageUrlService.variablePage(summary.id) ? PageUrlService.variablePage(summary.id) : PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n                {{summary.name}}\n              </a>\n            </td>\n            <td>\n              <localized value="summary.variableLabel" lang="lang"></localized>\n            </td>\n            <td ng-if="optionsCols.showVariablesTypeColumn">\n              {{\'search.variable.\' + summary.variableType.toLowerCase() | translate}}\n            </td>\n            <td ng-if="optionsCols.showVariablesStudiesColumn">\n              <a ng-if="summary.studyId" ng-href="{{PageUrlService.studyPage(summary.studyId, summary.variableType == \'Dataschema\' ? \'harmonization\' : \'individual\')}}">\n                <localized value="summary.studyAcronym" lang="lang"></localized>\n              </a>\n              <a ng-if="summary.networkId" ng-href="{{PageUrlService.networkPage(summary.networkId)}}">\n                <localized value="summary.networkAcronym" lang="lang"></localized>\n              </a>\n            </td>\n            <td ng-if="optionsCols.showVariablesDatasetsColumn">\n              <a ng-href="{{PageUrlService.datasetPage(summary.datasetId, summary.variableType)}}">\n                <localized value="summary.datasetAcronym" lang="lang"></localized>\n              </a>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n')}]),angular.module("search/components/search-box-region/component.html",[]).run(["$templateCache",function(a){a.put("search/components/search-box-region/component.html",'<div id="search-region" class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n  <div ng-if="$ctrl.options.showSearchBox" id="search-box-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n      <script type="text/ng-template" id="customTemplate.html">\n        <a ng-if="match.model.id">\n          <table style="border:none;">\n            <tbody>\n            <tr>\n              <td style="min-width: 30px;">\n                <span title="{{match.model.target + \'-classifications\' | translate}}">\n                  <i class="{{\'i-obiba-large i-obiba-\' + match.model.target}}"></i>\n                </span>\n              </td>\n              <td>\n            <span\n              uib-popover-html="match.model.itemDescription | uibTypeaheadHighlight:query"\n              popover-title="{{match.model.itemTitle}}"\n              popover-placement="bottom"\n              popover-trigger="\'mouseenter\'"\n              ng-bind-html="match.model.itemTitle | uibTypeaheadHighlight:query">\n            </span>\n                <small class="help-block no-margin" title="{{match.model.itemParentDescription}}">\n                  {{match.model.itemParentTitle}}\n                </small>\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </a>\n        <a ng-if="!match.model.id" class="{{match.model.status}}">\n          <small class="help-block no-margin">\n            {{match.model.message}}\n          </small>\n        </a>\n      <\/script>\n      <span class="input-group input-group-sm">\n        <span class="input-group-btn" uib-dropdown>\n          <button type="button" class="btn btn-primary" uib-dropdown-toggle>\n            {{\'taxonomy.target.\' + ($ctrl.documents.search.target ? $ctrl.documents.search.target : \'all\')| translate}}\n            <span class="caret"></span>\n          </button>\n          <ul uib-dropdown-menu role="menu">\n            <li>\n              <a href ng-click="$ctrl.selectSearchTarget()" translate>taxonomy.target.all</a>\n            </li>\n            <li ng-repeat="target in $ctrl.targets" role="menuitem">\n              <a href ng-click="$ctrl.selectSearchTarget(target)">{{\'taxonomy.target.\' + target | translate}}</a>\n            </li>\n          </ul>\n        </span>\n        <input type="text" ng-model="$ctrl.selectedCriteria" placeholder="{{\'search.placeholder.\' + ($ctrl.documents.search.target ? $ctrl.documents.search.target : \'all\') | translate}}"\n          uib-typeahead="criteria for criteria in $ctrl.searchCriteria($viewValue)" typeahead-min-length="2" typeahead-loading="$ctrl.documents.search.active"\n          typeahead-template-url="customTemplate.html" typeahead-on-select="$ctrl.selectCriteria($item)" class="form-control">\n        <span class="input-group-addon">\n          <i class="fa fa-search"></i>\n        </span>\n        <span ng-if="$ctrl.options.SearchHelpLinkUrl" class="input-group-btn">\n          <a type="button" target="_blank" class="btn btn-default" href="{{$ctrl.options.SearchHelpLinkUrl}}">\n            <span class="fa fa-question-circle"></span> {{$ctrl.options.SearchHelpLinkLabel}}</a>\n        </span>\n      </span>\n\n    </div>\n  </div>\n  <div ng-if="$ctrl.options.showSearchBrowser" id="search-selector-region" class="{{hasFacetedTaxonomies ? \'\' : \'row\'}}">\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-3\'}}"></div>\n    <div class="{{hasFacetedTaxonomies ? \'\' : \'col-md-6\'}}">\n      <small>\n        <ul class="nav nav-pills taxo-element">\n          <li ng-if="hasClassificationsTitle">\n            <label class="nav-label" translate>search.classifications-title</label>\n          </li>\n          <li ng-repeat="t in $ctrl.taxonomyNav track by $index" title="{{$ctrl.translateTaxonomyNav(t, \'description\')}}">\n            <a href ng-click="$ctrl.showTaxonomy(t.target, t.name)" ng-if="!t.terms">{{$ctrl.translateTaxonomyNav(t, \'title\')}}</a>\n            <span uib-dropdown ng-if="t.terms">\n              <ul class="nav nav-pills">\n                <li>\n                  <a href uib-dropdown-toggle>{{$ctrl.translateTaxonomyNav(t, \'title\')}}\n                    <span class="caret"></span>\n                  </a>\n                </li>\n              </ul>\n              <ul uib-dropdown-menu class="innerul">\n                <li ng-repeat="st in t.terms">\n                  <a href ng-click="$ctrl.showTaxonomy(t.target, st.name)" title="{{$ctrl.translateTaxonomyNav(st, \'description\')}}">{{$ctrl.translateTaxonomyNav(st, \'title\')}}</a>\n                </li>\n              </ul>\n            </span>\n          </li>\n          <li>\n            <a href ng-click="$ctrl.goToClassifications()" title="{{\'search.classifications-show\' | translate}}">\n              <span ng-if="hasClassificationsLinkLabel" translate>search.classifications-link</span>\n              <i class="fa fa-ellipsis-h" ng-if="!hasClassificationsLinkLabel"></i>\n            </a>\n          </li>\n        </ul>\n      </small>\n    </div>\n  </div>\n  <taxonomies-panel ng-if="$ctrl.options.showSearchBrowser" taxonomy-name="$ctrl.taxonomyName" target="$ctrl.target" on-select-term="$ctrl.selectTerm"\n    on-close="$ctrl.clearTaxonomy" lang="$ctrl.lang" taxonomies-shown="$ctrl.taxonomiesShown"></taxonomies-panel>\n</div>')}]),angular.module("search/components/study-filter-shortcut/component.html",[]).run(["$templateCache",function(a){a.put("search/components/study-filter-shortcut/component.html",'<div class="voffset2">\n  <div class="btn btn-group" style="padding: 0">\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'all\'" translate>all</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'individual\'" translate>search.coverage-buckets.individual</label>\n    <label class="btn btn-sm btn-study" ng-model="studyFilterSelection.selection" uib-btn-radio="\'harmonization\'" translate>search.coverage-buckets.harmonization</label>\n  </div>\n</div>')}]),angular.module("search/components/taxonomy/taxonomy-filter-detail/component.html",[]).run(["$templateCache",function(a){a.put("search/components/taxonomy/taxonomy-filter-detail/component.html",'<div class="panel-primary">\n  <div class="panel-heading">\n    <div><strong>{{$ctrl.taxonomy.title | localizedString}}</strong></div>\n  </div>\n\n  <vocabulary-filter-detail\n      ng-repeat="vocabulary in $ctrl.vocabularies"\n      vocabulary="vocabulary"\n      on-select-vocabulary-args="$ctrl.selectVocabularyArgs(vocabulary, args)"\n      on-remove-criterion="$ctrl.removeCriterion(item)">\n  </vocabulary-filter-detail>\n</div>')}]),angular.module("search/components/taxonomy/taxonomy-filter-panel/component.html",[]).run(["$templateCache",function(a){a.put("search/components/taxonomy/taxonomy-filter-panel/component.html",'<div class="vocabulary-filter-detail" ng-class="{\'close_right\':$ctrl.classClose, \'overlay-front-on-box-shodow\' : $ctrl.showTaxonomyPanel}">\n  \n  <div class="ng-clearfix"></div>\n\n  <vocabulary-filter-detail-heading show-taxonomy-panel="$ctrl.showTaxonomyPanel" taxonomy-name="$ctrl.taxonomyName" taxonomies-query="$ctrl.taxonomiesQuery"\n    clear-query="$ctrl.clearQuery" on-filter-change="$ctrl.onFilterChange(queryString)" taxonomy-type-map="$ctrl.taxonomyTypeMap"\n    result-tabs-order="$ctrl.resultTabsOrder" target="$ctrl.target" on-select-type="$ctrl.selectType(type)" result="$ctrl.result"\n    toggle-pannel="$ctrl.togglePannel()">\n  </vocabulary-filter-detail-heading>\n\n  <div class="vocabulary-filter-detail-container">\n    <vocabulary-filter-detail ng-if="!$ctrl.taxonomyIsArray" on-select-vocabulary-args="$ctrl.selectTaxonomyVocabularyArgs($ctrl.taxonomy, vocabulary, args)"\n      ng-repeat="vocabulary in $ctrl.filteredVocabularies track by $index" on-remove-criterion="$ctrl.removeCriterion(item)"\n      vocabulary="vocabulary">\n    </vocabulary-filter-detail>\n\n    <div ng-if="$ctrl.taxonomyIsArray" ng-repeat="subTaxonomy in $ctrl.taxonomy">\n      <taxonomy-filter-detail taxonomy="subTaxonomy" ng-if="$ctrl.filteredVocabularies[subTaxonomy.name]" vocabularies="$ctrl.filteredVocabularies[subTaxonomy.name]"\n        on-select-taxonomy-term="$ctrl.selectTaxonomyVocabularyArgs(taxonomy, vocabulary, args)" on-remove-criterion="$ctrl.removeCriterion(item)">\n      </taxonomy-filter-detail>\n    </div>\n  </div>\n</div>')}]),angular.module("search/components/vocabulary-filter-detail-heading/component.html",[]).run(["$templateCache",function(a){a.put("search/components/vocabulary-filter-detail-heading/component.html",'<div class="panel-body vocabulary-filter-detail-heading">\n    <div class="row">\n        <div class="col-xs-12 col-sm-12 col-lg-4">\n            <input-search-filter\n                    taxonomy-name="$ctrl.taxonomyName"\n                    taxonomies-query="$ctrl.taxonomiesQuery"\n                    class="input-search-filter"\n                    clear-query="$ctrl.clearQuery"\n                    on-filter-change="$ctrl.filterChange(queryString)">\n            </input-search-filter>\n        </div>\n        <div class="col-xs-12 col-sm-11 col-lg-7 voffset1">\n            <entity-counts\n                    taxonomy-type-map="$ctrl.taxonomyTypeMap"\n                    result-tabs-order="$ctrl.resultTabsOrder"\n                    target="$ctrl.target"\n                    on-select-type="$ctrl.selectType(type)"\n                    result="$ctrl.result">\n            </entity-counts>\n        </div>\n        <div class="col-xs-12 col-sm-1 col-lg-1">\n            <button type="button"\n                    class="voffset1 pull-right close"\n                    data-dismiss="alert"\n                    aria-label="Close"\n                    ng-click="$ctrl.togglePannel()"\n                    title="{{\'global.close-panel\'|translate}}"><span aria-hidden="true"></span>\n            </button>\n        </div>\n    </div>\n</div>')}]),angular.module("search/components/vocabulary/vocabulary-filter-detail/component.html",[]).run(["$templateCache",function(a){a.put("search/components/vocabulary/vocabulary-filter-detail/component.html",'<div class="panel-heading">\n  <label >\n    {{$ctrl.vocabulary.title | localizedString}}\n  </label>\n  <span\n       uib-popover="{{$ctrl.vocabulary.description ? $ctrl.vocabulary.description : $ctrl.vocabulary.title | localizedString}}"\n       popover-title="{{$ctrl.vocabulary.description ? $ctrl.vocabulary.title : null | localizedString}}" popover-placement="bottom"\n       popover-trigger="\'mouseenter\'" popover-popup-delay="250">\n    <i class="fa fa-info-circle"> </i>\n  </span>\n\n  <div class="pull-right">\n    <a href="" ng-click="$ctrl.removeCriterion()" ng-if="$ctrl.vocabulary.existingItem">{{\'clear\' | translate}}</a>\n    <a href="" class="hoffset2" ng-click="$ctrl.selectAllFilteredVocabularyTerms($ctrl.vocabulary.filteredTerms)" ng-if="$ctrl.criterionType === \'string-terms\' && $ctrl.canStillSelectMore($ctrl.vocabulary.filteredTerms)">\n      {{\'select-items\' | translate}}\n    </a>\n  </div>\n\n</div>\n<div class="panel-body">\n  <div ng-switch on="$ctrl.criterionType">\n    <div ng-switch-when="string-terms">\n      <terms-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></terms-vocabulary-filter-detail>\n    </div>\n\n    <div ng-switch-when="numeric">\n      <numeric-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></numeric-vocabulary-filter-detail>\n    </div>\n\n    <div ng-switch-default>\n      <match-vocabulary-filter-detail vocabulary="$ctrl.vocabulary" on-select-args="$ctrl.selectVocabularyArgs(args)"></match-vocabulary-filter-detail>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/classifications.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div id="classification-browser-region">\n  <div ng-if="classificationsHeaderTemplateUrl" ng-include="classificationsHeaderTemplateUrl"></div>\n\n  <div class="container alert-fixed-position">\n    <obiba-alert id="SearchController"></obiba-alert>\n  </div>\n\n  <div class="alert-growl-container">\n    <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n  </div>\n\n  <a href class="btn btn-sm btn-success" ng-click="goToSearch()">\n    <i class="fa fa-chevron-left"></i>\n    <span translate>search.back</span>\n  </a>\n\n  \x3c!-- Lang tabs --\x3e\n  <ul class="nav nav-tabs voffset2" role="tablist" ng-if="tabs && tabs.length>1">\n    <li ng-repeat="tab in tabs" role="presentation" ng-class="{ active: tab === lang }"><a href role="tab"\n      ng-click="setLocale(tab)">{{\'language.\' + tab | translate}}</a></li>\n  </ul>\n\n  \x3c!-- Search criteria region --\x3e\n  <search-criteria-region class="voffset2" options="options" search="search"> </search-criteria-region>\n\n  \x3c!-- Classifications region --\x3e\n  <div class="{{tabs && tabs.length>1 ? \'tab-content voffset4\' : \'\'}}">\n    <ul class="nav nav-pills voffset2" role="tablist" ng-if="targetTabsOrder.length > 1">\n      <li ng-repeat="target in targetTabsOrder" role="presentation" ng-class="{ active: target === $parent.target }" class="{{target}}"><a href role="tab"\n          ng-click="navigateToTarget(target)">{{\'taxonomy.target.\' + target | translate}}</a></li>\n    </ul>\n\n    <classifications-panel target="target" is-history-enabled="true" on-select-term="onSelectTerm" lang="lang"></classifications-panel>\n  </div>\n\n</div>')}]),angular.module("search/views/classifications/taxonomy-accordion-group.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-accordion-group.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-taxonomy" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body no-padding small" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/taxonomy-template.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/taxonomy-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-repeat="vocabulary in taxonomies.taxonomy.vocabularies" ng-if="$index % 3 == 0" class="row">\n  <div class="col-md-4">\n    <div vocabulary-panel taxonomy="taxonomies.taxonomy.vocabularies[$index]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 1]"></div>\n  </div>\n  <div class="col-md-4">\n    <div taxonomy-panel taxonomy="taxonomies.taxonomy.vocabularies[$index + 2]"></div>\n  </div>\n</div>')}]),angular.module("search/views/classifications/vocabulary-accordion-group.html",[]).run(["$templateCache",function(a){a.put("search/views/classifications/vocabulary-accordion-group.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="panel panel-vocabulary" ng-class="panelClass || \'panel-default\'">\n  <div role="tab" id="{{::headingId}}" aria-selected="{{isOpen}}" class="panel-heading" ng-keypress="toggleOpen($event)">\n    <h4 class="panel-title">\n      <a role="button" data-toggle="collapse" href aria-expanded="{{isOpen}}" aria-controls="{{::panelId}}" tabindex="0" class="accordion-toggle" ng-click="toggleOpen()" uib-accordion-transclude="heading"><small><span uib-accordion-header ng-class="{\'text-muted\': isDisabled}">{{heading}}</span></small></a>\n    </h4>\n  </div>\n  <div id="{{::panelId}}" aria-labelledby="{{::headingId}}" aria-hidden="{{!isOpen}}" role="tabpanel" class="panel-collapse collapse" uib-collapse="!isOpen">\n    <div class="panel-body" ng-transclude></div>\n  </div>\n</div>')}]),angular.module("search/views/criteria/criterion-header-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/criterion-header-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<li class="criteria-list-item">\n  <label uib-popover="{{localize(criterion.vocabulary.description)}}"\n         popover-title="{{localize(criterion.vocabulary.title)}}"\n         popover-placement="bottom"\n         popover-trigger="\'mouseenter\'">\n    {{localize(criterion.vocabulary.title)}}\n  </label>\n  <span class="pull-right" title="{{\'search.close-and-search\' | translate}}" ng-click="$parent.$parent.closeDropdown()"><i class="fa fa-check"></i></span>\n</li>\n<li class=\'divider\'></li>\n')}]),angular.module("search/views/criteria/target-template.html",[]).run(["$templateCache",function(a){a.put("search/views/criteria/target-template.html","\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span></span>")}]),angular.module("search/views/list/pagination-template.html",[]).run(["$templateCache",function(a){a.put("search/views/list/pagination-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<span>\n  <ul class="pagination pagination-sm">\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-first">\n      <a href ng-click="selectPage(1, $event)">{{::getText(\'first\')}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noPrevious()||ngDisabled}" class="pagination-prev">\n      <a href ng-click="selectPage(page - 1, $event)">{{::getText(\'previous\')}}</a>\n    </li>\n    <li ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}"\n        class="pagination-page">\n      <a href ng-click="selectPage(page.number, $event)">{{page.text}}</a>\n    </li>\n    <li ng-if="::directionLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-next">\n      <a href ng-click="selectPage(page + 1, $event)">{{::getText(\'next\')}}</a>\n    </li>\n    <li ng-if="::boundaryLinks" ng-class="{disabled: noNext()||ngDisabled}" class="pagination-last">\n      <a href ng-click="selectPage(totalPages, $event)">{{::getText(\'last\')}}</a>\n    </li>\n  </ul>\n</span>')}]),angular.module("search/views/search-layout.html",[]).run(["$templateCache",function(a){a.put("search/views/search-layout.html",'<div>\n  <div class="alert alert-warning" ng-if="!isSearchAvailable">\n    <span translate>search.search-not-available</span>\n  </div>\n  <div ng-if="isSearchAvailable">\n    <div class="container alert-fixed-position">\n      <obiba-alert id="SearchController"></obiba-alert>\n    </div>\n\n    <div class="alert-growl-container">\n      <obiba-alert id="SearchControllerGrowl"></obiba-alert>\n    </div>\n\n    <div ng-if="searchHeaderTemplateUrl" ng-include="searchHeaderTemplateUrl"></div>\n\n    <div ng-switch on="search.layout">\n      <div ng-switch-when="layout1">\n        <ng-include src="\'search/views/search.html\'"></ng-include>\n      </div>\n      <div ng-switch-default>\n        <ng-include src="\'search/views/search2.html\'"></ng-include>\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("search/views/search-result-graphics-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-graphics-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="display === \'graphics\'">\n  <graphics-result on-update-criteria="onUpdateCriteria" result="result.graphics" loading="loading" class="voffset2 graphics-tab"></graphics-result>\n</div>')}]),angular.module("search/views/search-result-list-dataset-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-dataset-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.datasets.showSearchTab" ng-class="{\'active\': activeTarget.datasets.active}">\n  <datasets-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.datasetResultDto[\'obiba.mica.DatasetResultDto.result\'].datasets"></datasets-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-network-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-network-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.networks.showSearchTab" ng-class="{\'active\': activeTarget.networks.active}">\n  <networks-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.networkResultDto[\'obiba.mica.NetworkResultDto.result\'].networks"></networks-result-table>\n</div>\n')}]),angular.module("search/views/search-result-list-study-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-study-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.studies.showSearchTab" ng-class="{\'active\': activeTarget.studies.active}">\n  <studies-result-table lang="lang" loading="loading" on-update-criteria="onUpdateCriteria"\n      summaries="result.list.studyResultDto[\'obiba.mica.StudyResultDto.result\'].summaries"></studies-result-table>\n</div>')}]),angular.module("search/views/search-result-list-variable-template.html",[]).run(["$templateCache",function(a){a.put("search/views/search-result-list-variable-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="tab-pane" ng-show="options.variables.showSearchTab" ng-class="{\'active\': activeTarget.variables.active}">\n  <variables-result-table lang="lang" loading="loading"\n      summaries="result.list.variableResultDto[\'obiba.mica.DatasetVariableResultDto.result\'].summaries"></variables-result-table>\n</div>\n')}]),angular.module("search/views/search.html",[]).run(["$templateCache",function(a){a.put("search/views/search.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="inSearchMode()">\n  <div class="row voffset2">\n    <div class="col-md-3" ng-if="hasFacetedTaxonomies" >\n      \x3c!-- Search Facets region --\x3e\n      <taxonomies-facets-panel id="search-facets-region"\n                               faceted-taxonomies="facetedTaxonomies"\n                               criteria="search.criteria"\n                               on-select-term="onSelectTerm"\n                               on-refresh="refreshQuery"\n                               lang="lang"></taxonomies-facets-panel>\n    </div>\n    <div class="{{hasFacetedTaxonomies ? \'col-md-9\' : \'col-md-12\'}}">\n      <search-box-region\n        targets="targetTabsOrder"\n        options="options"\n        alert-id="\'SearchController\'"\n        lang="lang"\n        taxonomy-nav="taxonomyNav"\n        on-select-criteria="selectCriteria(item)"\n        on-goto-classifications="goToClassifications()",\n        on-select-term="onSelectTerm(target, taxonomy, vocabulary, args)">\n      </search-box-region>\n\n      <div ng-if="hasFacetedTaxonomies && hasFacetedNavigationHelp && !(search.criteria.children && search.criteria.children.length > 0)">\n        <p class="help-block" translate>search.faceted-navigation-help</p>\n      </div>\n\n      \x3c!-- Search criteria region --\x3e\n      <search-criteria-region options="options" search="search"> </search-criteria-region>\n\n      \x3c!-- Search Results region --\x3e\n      <div id="search-result-region" class="voffset3 can-full-screen" ng-if="canExecuteWithEmptyQuery()" fullscreen="isFullscreen">\n        <div ng-if="searchTabsOrder.length > 1">\n          <a href class="btn btn-sm btn-default pull-right" ng-click="toggleFullscreen()">\n            <i class="glyphicon" ng-class="{\'glyphicon-resize-full\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen}"></i>\n          </a>\n          <ul class="nav nav-tabs voffset2">\n            <li role="presentation" ng-repeat="tab in searchTabsOrder" ng-class="{active: search.display === tab}">\n              <a href ng-click="selectDisplay(tab)">{{ \'search.\' + tab | translate}}</a>\n            </li>\n          </ul>\n        </div>\n        <div translate>{{\'search.\' + search.display + \'-help\'}}</div>\n        <result-panel display="search.display"\n                      type="search.type"\n                      bucket="search.bucket"\n                      criteria="search.criteria"\n                      query="search.executedQuery"\n                      result="search.result"\n                      loading="search.loading"\n                      pagination="search.pagination"\n                      on-update-criteria="onUpdateCriteria"\n                      on-remove-criteria="onRemoveCriteria"\n                      on-type-changed="onTypeChanged"\n                      on-bucket-changed="onBucketChanged"\n                      on-paginate="onPaginate"\n                      search-tabs-order="searchTabsOrder"\n                      result-tabs-order="resultTabsOrder"\n                      lang="lang"></result-panel>\n      </div>\n\n    </div>\n  </div>\n\n</div>')}]),angular.module("search/views/search2.html",[]).run(["$templateCache",function(a){a.put("search/views/search2.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div ng-show="inSearchMode()">\n\n  \x3c!-- Search criteria region --\x3e\n  <search-criteria-region options="options" search="search"></search-criteria-region>\n  <div ng-class="{\'overlay-back-on\': search.showTaxonomyPanel}">\n  </div>\n  <div ng-class="{\'overlay-front-on\': search.showTaxonomyPanel}">\n    <div class="row voffset2">\n      <div class="col-md-3" ng-if="hasFacetedTaxonomies">\n        \x3c!-- Search Facets region --\x3e\n        <taxonomies-facets-panel id="search-facets-region" faceted-taxonomies="facetedTaxonomies"\n                                criteria="search.criteria" on-select-term="onSelectTerm"\n                                on-refresh="refreshQuery" lang="lang"></taxonomies-facets-panel>\n      </div>\n      <div class="col-md-3" ng-if="!hasFacetedTaxonomies">\n        \x3c!-- Search Facets region --\x3e\n        <meta-taxonomy-filter-panel\n            show-taxonomy-panel="search.showTaxonomyPanel"\n            tabs="targetTabsOrder"\n            rql-query="search.rqlQuery"\n            on-toggle="onTaxonomyFilterPanelToggleVisibility(target, taxonomy)"></meta-taxonomy-filter-panel>\n      </div>\n      <div class="col-md-9">\n        \x3c!-- Search Results region --\x3e\n        <div class="panel panel-default" ng-if="search.showTaxonomyPanel">\n          <taxonomy-filter-panel\n              show-taxonomy-panel="search.showTaxonomyPanel"\n              result-tabs-order="resultTabsOrder"\n              taxonomy-type-map="taxonomyTypeMap"\n              result="search.countResult"\n              target="search.selectedTarget"\n              taxonomy="search.selectedTaxonomy"\n              on-select-type="onTypeChanged(type)"\n              on-select-term="onSelectTerm(target, taxonomy, vocabulary, args)"\n              on-remove-criterion="removeCriteriaItem(item)"\n              on-toggle="onTaxonomyFilterPanelToggleVisibility"></taxonomy-filter-panel>\n        </div>\n        <div class="clearfix"></div>\n        <div id="search-result-region" class="can-full-screen"\n            ng-if="!search.showTaxonomyPanel && canExecuteWithEmptyQuery()" fullscreen="isFullscreen">\n          <div ng-if="searchTabsOrder.length > 1">\n            <a href class="btn btn-sm btn-default pull-right" ng-click="toggleFullscreen()">\n              <i class="glyphicon"\n                ng-class="{\'glyphicon-resize-full\': !isFullscreen, \'glyphicon-resize-small\': isFullscreen}"></i>\n            </a>\n            <ul class="nav nav-tabs">\n              <li role="presentation" ng-repeat="tab in searchTabsOrder"\n                  ng-class="{active: search.display === tab}">\n                <a href ng-click="selectDisplay(tab)">{{ \'search.\' + tab | translate}}</a>\n              </li>\n            </ul>\n          </div>\n          <div translate>{{\'search.\' + search.display + \'-help\'}}</div>\n          <result-panel display="search.display"\n                        type="search.type"\n                        bucket="search.bucket"\n                        criteria="search.criteria"\n                        query="search.executedQuery"\n                        result="search.result"\n                        loading="search.loading"\n                        pagination="search.pagination"\n                        on-update-criteria="onUpdateCriteria"\n                        on-remove-criteria="onRemoveCriteria"\n                        on-type-changed="onTypeChanged"\n                        on-bucket-changed="onBucketChanged"\n                        on-paginate="onPaginate"\n                        search-tabs-order="searchTabsOrder"\n                        result-tabs-order="resultTabsOrder"\n                        lang="lang"></result-panel>\n        </div>\n\n\n      </div>\n    </div>\n  </div>\n</div>')}]),angular.module("sets/components/add-to-set-modal/component.html",[]).run(["$templateCache",function(a){a.put("sets/components/add-to-set-modal/component.html",'<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true" ng-click="$ctrl.cancel()">&times;</button>\n    <h4 class="modal-title" translate>sets.add.modal.title</h4>\n  </div>\n\n  <div class="modal-body">\n    <obiba-alert id="MaxAttainedAlert"></obiba-alert>\n    <p translate>sets.add.modal.sub-title</p>\n    <div ng-if="$ctrl.canAddMoreSets">\n        <div class="radio" ng-show="$ctrl.sets.length">\n          <label for="new_set_choice">\n            <input type="radio" ng-model="$ctrl.choice.radio" ng-required="!$ctrl.choice.radio" value="NEW" id="new_set_choice" ng-change="$ctrl.onRadioChanged()">\n            {{\'sets.add.modal.create-new\' | translate}}\n          </label>\n        </div>\n\n        <input class="form-control" type="text" ng-model="$ctrl.choice.name" ng-keyup="$ctrl.onNameChanged()">\n    </div>\n\n    <div ng-if="$ctrl.sets.length" class="margin-top-10">\n        <div class="radio" ng-show="$ctrl.canAddMoreSets">\n          <label for="existing_set_choice">\n            <input type="radio" ng-model="$ctrl.choice.radio" ng-required="!$ctrl.choice.radio" value="EXISTING" id="existing_set_choice" ng-change="$ctrl.onRadioChanged()">\n            {{\'sets.add.modal.to-existing\' | translate}}\n          </label>\n        </div>\n\n        <select class="form-control" ng-options="set as set.name for set in $ctrl.sets" ng-model="$ctrl.choice.selected" ng-change="$ctrl.onSelected()"></select>\n    </div>\n\n  </div>\n\n  <div class="modal-footer" ng-if="!$ctrl.disableActions">\n    <button class="btn btn-responsive btn-default" type="button" ng-click="$ctrl.cancel()" translate>cancel</button>\n    <button class="btn btn-responsive btn-primary" type="button" ng-click="$ctrl.accept()" ng-disabled="!$ctrl.canAccept" translate>save</button>\n  </div>\n\n  <div class="modal-footer" ng-if="$ctrl.disableActions">\n    <span class="loading"></span>\n  </div>\n</div>')}]),angular.module("sets/components/cart-documents-table/component.html",[]).run(["$templateCache",function(a){a.put("sets/components/cart-documents-table/component.html",'<div>\n  <div class="pull-left" ng-show="$ctrl.documents.total>0">\n    <a ng-if="$ctrl.currentUserCanCreateSets" href="" ng-click="$ctrl.addToSet(type)" class="action btn btn-info btn-responsive">\n      <i class="fa fa-plus"></i> {{\'sets.add.button.set-label\' | translate}}\n    </a>\n\n    <div ng-if="$ctrl.showAnalysis()" class="btn-group" uib-dropdown is-open="$ctrl.analysis.isopen">\n      <button id="single-button" type="button" class="btn btn-primary" uib-dropdown-toggle ng-disabled="disabled">\n        <i class="fa fa-cog"></i> {{\'analysis.action\' | translate}} <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n        <li role="menuitem">\n          <a href="" ng-click="$ctrl.entitiesCount()">\n            {{\'analysis.entities-count.action\' | translate}}</a>\n        </li>\n      </ul>\n    </div>\n\n    <a obiba-file-download get-url="$ctrl.download()" target="_self" download class="action btn btn-info btn-responsive">\n      <i class="fa fa-download"></i> {{\'download\' | translate}}\n    </a>\n\n    <span ng-if="$ctrl.micaConfigShowOpalViews">\n      <a obiba-file-download get-url="$ctrl.opalExport()" method="\'get\'" target="_self" class="action btn btn-primary btn-responsive" download title="{{\'sets.opal-views-download-button-help\' | translate}}">\n        <i class="fa fa-download"></i> {{\'sets.opal-views-download-button-text\' | translate}}\n      </a>\n    </span>\n\n    <a ng-if="$ctrl.micaConfigShowSearch" href="" ng-click="$ctrl.search()" class="action btn btn-info btn-responsive">\n      <i class="fa fa-search"></i>\n    </a>\n\n    <a href="" ng-click="$ctrl.clearSet()" ng-disabled="!$ctrl.hasSelections()" class="action btn btn-danger btn-responsive">\n      <i class="fa fa-trash-o"></i>\n    </a>\n  </div>\n  <div ng-show="$ctrl.pagination.pageCount > 1" class="pull-right">\n    <span\n          uib-pagination\n          total-items="$ctrl.pagination.totalHits"\n          max-size="$ctrl.pagination.maxSize"\n          ng-model="$ctrl.pagination.currentPage"\n          boundary-links="true"\n          force-ellipses="true"\n          items-per-page="$ctrl.pagination.itemsPerPage"\n          previous-text="&lsaquo;"\n          next-text="&rsaquo;"\n          first-text="&laquo;"\n          last-text="&raquo;"\n          template-url="search/views/list/pagination-template.html"\n          ng-change="$ctrl.pageChanged()"></span>\n    <ul class="pagination pagination-sm">\n      <li>\n        <a href class="pagination-total">{{$ctrl.pagination.from}} - {{$ctrl.pagination.to}} {{\'of\' | translate}} {{$ctrl.pagination.totalHits}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="clearfix"></div>\n  <div class="table-responsive">\n    <table-alert-header\n      all-selected="$ctrl.allSelected"\n      on-select-all="$ctrl.updateAllSelected()"\n      ng-show="$ctrl.allPageSelected[$ctrl.pagination.currentPage]">\n    </table-alert-header>\n    <table class="table table-bordered table-striped table-layout-fixed" ng-if="$ctrl.documents.total>0">\n      <thead>\n        <th class="col-width-xs">\n            <input\n            ng-model="$ctrl.allPageSelected[$ctrl.pagination.currentPage]"\n            type="checkbox"\n            ng-click="$ctrl.updateAllCurrentPageSelected()"/>\n        </th>\n        <th class="col-width-md" translate>taxonomy.target.variable</th>\n        <th class="col-width-md" translate>search.variable.label</th>\n        <th ng-if="$ctrl.options.variablesColumn.showVariablesTypeColumn" translate>type</th>\n        <th ng-if="$ctrl.options.variablesColumn.showVariablesStudiesColumn" translate>search.study.label</th>\n        <th ng-if="$ctrl.options.variablesColumn.showVariablesDatasetsColumn" translate>search.dataset.label</th>\n      </thead>\n      <tbody>\n        <tr ng-repeat="row in $ctrl.table.rows">\n          <td>\n              <input\n              ng-model="$ctrl.selections[row[0].value]"\n              type="checkbox"\n              ng-click="$ctrl.updateSelection(row[0].value)"/>\n          </td>\n          <td><a href="{{row[1].link}}">{{row[1].value}}</a></td>\n          <td>{{row[2].value}}</td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesTypeColumn">{{\'search.variable.\' + row[3].value.toLowerCase() | translate}}</td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesStudiesColumn"><a href="{{row[4].link}}">{{row[4].value}}</a></td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesDatasetsColumn"><a href="{{row[5].link}}">{{row[5].value}}</a></td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("sets/components/set-variables-table/component.html",[]).run(["$templateCache",function(a){a.put("sets/components/set-variables-table/component.html",'<div>\n  <div class="pull-left" ng-show="$ctrl.documents.total>0">\n    <a href="" ng-click="$ctrl.addToSet(type)" class="action btn btn-info btn-responsive">\n      <i class="fa fa-plus"></i> {{\'sets.add.button.set-label\' | translate}}\n    </a>\n\n    <div ng-if="$ctrl.showAnalysis()" class="btn-group" uib-dropdown is-open="$ctrl.analysis.isopen">\n      <button id="single-button" type="button" class="btn btn-primary" uib-dropdown-toggle ng-disabled="disabled">\n        <i class="fa fa-cog"></i> {{\'analysis.action\' | translate}} <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu" uib-dropdown-menu role="menu" aria-labelledby="single-button">\n        <li role="menuitem">\n          <a href="" ng-click="$ctrl.entitiesCount()">\n            {{\'analysis.entities-count.action\' | translate}}</a>\n        </li>\n      </ul>\n    </div>\n\n    <a obiba-file-download get-url="$ctrl.download()" target="_self" download class="action btn btn-info btn-responsive">\n      <i class="fa fa-download"></i> {{\'download\' | translate}}\n    </a>\n\n    <span ng-if="$ctrl.micaConfigShowOpalViews">\n      <a obiba-file-download get-url="$ctrl.opalExport()" method="\'get\'" target="_self" class="action btn btn-primary btn-responsive" download title="{{\'sets.opal-views-download-button-help\' | translate}}">\n        <i class="fa fa-download"></i> {{\'sets.opal-views-download-button-text\' | translate}}\n      </a>\n    </span>\n\n    <a ng-if="$ctrl.micaConfigShowSearch" href="" ng-click="$ctrl.search()" class="action btn btn-info btn-responsive">\n      <i class="fa fa-search"></i>\n    </a>\n\n    <a href="" ng-click="$ctrl.clearSet()" ng-disabled="!$ctrl.hasSelections()" class="action btn btn-danger btn-responsive">\n      <i class="fa fa-trash-o"></i>\n    </a>\n  </div>\n\n  <div ng-show="$ctrl.pagination.pageCount > 1" class="pull-right">\n    <span\n      uib-pagination\n      total-items="$ctrl.pagination.totalHits"\n      max-size="$ctrl.pagination.maxSize"\n      ng-model="$ctrl.pagination.currentPage"\n      boundary-links="true"\n      force-ellipses="true"\n      items-per-page="$ctrl.pagination.itemsPerPage"\n      previous-text="&lsaquo;"\n      next-text="&rsaquo;"\n      first-text="&laquo;"\n      last-text="&raquo;"\n      template-url="search/views/list/pagination-template.html"\n      ng-change="$ctrl.pageChanged()"></span>\n\n    <ul class="pagination pagination-sm">\n      <li>\n        <a href class="pagination-total">{{$ctrl.pagination.from}} - {{$ctrl.pagination.to}} {{\'of\' | translate}}\n          {{$ctrl.pagination.totalHits}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="clearfix"></div>\n\n  <div class="table-responsive">\n    <table-alert-header\n      all-selected="$ctrl.allSelected"\n      on-select-all="$ctrl.updateAllSelected()"\n      ng-show="$ctrl.allPageSelected[$ctrl.pagination.currentPage]">\n    </table-alert-header>\n    <table class="table table-bordered table-striped table-layout-fixed" ng-if="$ctrl.documents.total>0">\n      <thead>\n        <th class="checkbox-width">\n          <input ng-model="$ctrl.allPageSelected[$ctrl.pagination.currentPage]" type="checkbox" ng-click="$ctrl.updateAllCurrentPageSelected()" />\n        </th>\n        <th class="col-width-35" translate>taxonomy.target.variable</th>\n        <th class="col-width-35" translate>search.variable.label</th>\n        <th class="col-width-10" ng-if="$ctrl.options.variablesColumn.showVariablesTypeColumn" translate>type</th>\n        <th class="col-width-10" ng-if="$ctrl.options.variablesColumn.showVariablesStudiesColumn" translate>search.study.label</th>\n        <th class="col-width-15" ng-if="$ctrl.options.variablesColumn.showVariablesDatasetsColumn" translate>search.dataset.label</th>\n      </thead>\n      <tbody>\n        <tr ng-repeat="row in $ctrl.table.rows">\n          <td>\n            <input ng-model="$ctrl.selections[row[0].value]" type="checkbox" ng-click="$ctrl.updateSelection(row[0].value)" />\n          </td>\n          <td><a href="{{row[1].link}}">{{row[1].value}}</a></td>\n          <td>{{row[2].value}}</td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesTypeColumn">{{\'search.variable.\' + row[3].value.toLowerCase() | translate}}</td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesStudiesColumn"><a href="{{row[4].link}}">{{row[4].value}}</a></td>\n          <td ng-if="$ctrl.options.variablesColumn.showVariablesDatasetsColumn"><a href="{{row[5].link}}">{{row[5].value}}</a></td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</div>')}]),angular.module("sets/views/cart.html",[]).run(["$templateCache",function(a){a.put("sets/views/cart.html",'<div>\n  <div ng-if="cartHeaderTemplateUrl" ng-include="cartHeaderTemplateUrl"></div>\n  <h3>\n    <span translate>variables</span>\n    <span ng-if="loading" class="voffset2 loading"></span>\n  </h3>\n\n  <div ng-repeat="tab in tabs" >\n    <cart-documents-table ng-if="\'variables\' === tab.type"\n                         type="tab.type"\n                         documents="variables"\n                         on-update="onUpdate"\n                         options="tab.options"\n                         on-page-change="onPaginate"></cart-documents-table>\n\n    <p ng-hide="loading || variables && variables.total>0" translate>sets.cart.no-variables</p>\n  </div>\n</div>')}]),angular.module("sets/views/sets.html",[]).run(["$templateCache",function(a){a.put("sets/views/sets.html",'<div>\n  <div ng-if="setsHeaderTemplateUrl" ng-include="setsHeaderTemplateUrl"></div>\n\n  <div class="row">\n    <div class="col-md-3">\n      <uib-accordion close-others="false">\n        <div uib-accordion-group class="panel-default" ng-repeat="tab in useableTabs" is-open="true">\n\n          <div uib-accordion-heading>\n            <span>\n              {{tab.title | localizedString}}\n            </span>\n\n            <a ng-if="canDelete[tab.name]" class="pull-right" href ng-click="$event.stopPropagation(); deleteChecked(tab.name)">\n              <i class="fa fa-trash-o"></i>\n            </a>\n          </div>\n\n          <span ng-if="!sets[tab.name].length" translate>sets.empty</span>\n\n          <ul class="nav nav-pills nav-stacked">\n            <li role="presentation" ng-repeat="set in sets[tab.name]" ng-class="{\'active\': selectedSet.id === set.id}">\n\n              <span class="checkbox no-margin-top no-margin-bottom" >\n                <input class="margin-top-10 margin-left--5" type="checkbox" ng-model="checked[tab.name][set.id]" ng-click="$event.stopPropagation(); check(tab.name);">\n              </span>\n              <a class="flex margin-left-10" href ng-click="$event.stopPropagation(); selectSet(tab.name, set);">\n                <span class="flex-item3">{{set.name}}</span>\n                <span class="flex-item1 text-right text-muted">{{set.count}}</span>\n              </a>\n            </li>\n          </ul>\n        </div>\n      </uib-accordion>\n    </div>\n\n    <div class="col-md-9">\n      <span ng-if="loading" class="voffset2 loading"></span>\n      <div ng-repeat="tab in tabs" >\n        <set-variables-table ng-if="\'variables\' === tab.type"\n                             set-id="selectedSet.id"\n                             type="tab.type"\n                             options="tab.options"\n                             documents="documents"\n                             on-update="onUpdate"\n                             on-page-change="onPaginate"></set-variables-table>\n      </div>\n    </div>\n  </div>\n</div>\n')}]),angular.module("utils/components/entity-schema-form/component.html",[]).run(["$templateCache",function(a){a.put("utils/components/entity-schema-form/component.html",'<div sf-model="$ctrl.model" sf-form="$ctrl.form.definition" sf-schema="$ctrl.form.schema" sf-options="$ctrl.sfOptions"></div>')}]),angular.module("utils/components/table-alert-header/component.html",[]).run(["$templateCache",function(a){a.put("utils/components/table-alert-header/component.html",'<div class="alert alert-warning actions-select">\n  <span ng-hide="$ctrl.allSelected">\n    <a href ng-click="$ctrl.selectAll()" class="hoffset1">\n      <i class="fa fa-square-o"></i>\n      <strong><span translate>table-selections.select-all</span></strong>\n    </a>\n    <strong><span class="pull-right" translate>table-selections.all-page-selected</span></strong>\n  </span>\n  <span ng-show="$ctrl.allSelected">\n    <a href ng-click="$ctrl.selectAll()" class="hoffset1">\n      <i class="fa fa-check-square-o"></i>\n      <b><span translate>table-selections.unselect-all</span></b>\n    </a>\n  <strong><span class="pull-right" translate>table-selections.all-selected</span></strong>\n  </span>\n</div>\n')}]),angular.module("utils/services/user-profile-modal/service.html",[]).run(["$templateCache",function(a){a.put("utils/services/user-profile-modal/service.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n  <div class="modal-header">\n    <button type="button" class="close" aria-hidden="true"\n      ng-click="$dismiss()">&times;</button>\n    <h4 class="modal-title">\n      {{\'data-access-request.profile.title\' | translate}}\n    </h4>\n  </div>\n  <div class="modal-body">\n\n    <table class="table table-bordered table-striped">\n      <tbody>\n      <tr>\n        <th>{{\'data-access-request.profile.name\' | translate}}</th>\n        <td>{{applicant.fullName}}</td>\n      </tr>\n      <tr>\n        <th>{{\'data-access-request.profile.email\' | translate}}</th>\n        <td>{{applicant.email}}</td>\n      </tr>\n      <tr ng-repeat="attribute in applicant.profile.attributes | filterProfileAttributes">\n          <th>{{\n              (\'userProfile.\' + attribute.key | translate) !== (\'userProfile.\' + attribute.key) ?\n              (\'userProfile.\' + attribute.key | translate) :\n              (attribute.key)\n              }}\n          </th>\n          <td>{{attribute.value}}</td>\n      </tr>\n      </tbody>\n    </table>\n\n    <a class="btn btn-default" ng-if="applicant.email" href="mailto:{{applicant.email}}" target="_blank">\n      {{\'data-access-request.profile.send-email\' | translate}}</a>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btn btn-primary voffest4"\n      ng-click="$dismiss()">\n      <span ng-hide="confirm.close" translate>close</span>\n      {{confirm.close}}\n    </button>\n  </div>\n</div>\n')}]),angular.module("utils/views/unsaved-modal.html",[]).run(["$templateCache",function(a){a.put("utils/views/unsaved-modal.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<div class="modal-content">\n    <div class="modal-header">\n        <h4 class="modal-title" translate>unsaved-title</h4>\n    </div>\n    <div class="modal-body" translate>\n        unsaved-prompt\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-default" type="button" ng-click="cancel()" translate>cancel</button>\n        <button class="btn btn-primary" type="button" ng-click="ok()" translate>ok</button>\n    </div>\n</div>\n')}]),angular.module("views/pagination-template.html",[]).run(["$templateCache",function(a){a.put("views/pagination-template.html",'\x3c!--\n  ~ Copyright (c) 2018 OBiBa. All rights reserved.\n  ~\n  ~ This program and the accompanying materials\n  ~ are made available under the terms of the GNU Public License v3.0.\n  ~\n  ~ You should have received a copy of the GNU General Public License\n  ~ along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(1)">&laquo;</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == 1 }">\n    <a href="" ng-click="setCurrent(pagination.current - 1)">&lsaquo;</a>\n  </li>\n  <li ng-repeat="pageNumber in pages track by $index" ng-class="{ active : pagination.current == pageNumber, disabled : pageNumber == \'...\' }">\n    <a href="" ng-click="setCurrent(pageNumber)">{{ pageNumber }}</a>\n  </li>\n  <li ng-if="directionLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a href="" ng-click="setCurrent(pagination.current + 1)">&rsaquo;</a>\n  </li>\n  <li ng-if="boundaryLinks" ng-class="{ disabled : pagination.current == pagination.last }">\n    <a ng-class="round-border" href="" ng-click="setCurrent(pagination.last)">&raquo;</a>\n  </li>\n</ul>\n\n\n<ul class="pagination no-margin pagination-sm" ng-if="1 < pages.length">\n  <li>\n    <a href="" class="pagination-total" ng-if="1 < pages.length" class="pagination-total"><span>{{ range.lower }} - {{ range.upper }} </span><span translate>pagination.of</span><span> {{ range.total }}</span></a>\n  </li>\n</ul>')}]);